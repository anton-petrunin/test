\documentclass[twoside]{book}

\usepackage{cmap}

\newcommand\hmmax{0}
\newcommand\bmmax{0}

\usepackage{geometry}
\usepackage{puzzles}

% \usepackage{change}
 

\geometry{papersize={142mm,210mm},
%papersize={142mm,210mm},
% a4paper,layoutsize={142mm,210mm},layoutoffset={3.5cm,4cm},
  marginparwidth=12em,
hratio={1:1},vratio={3:4},
width=110mm,height=172mm,headsep=12pt,
footnotesep=12pt plus3pt,
ignorehead,ignorefoot,heightrounded}


\hypersetup{
pdftitle={Математические головоломки},
pdfauthor={Питер Уинклер, перевод Марины Преловской под редакцией К. А. Кнопа,
А. М. Петрунина и
А. В. Устинова},
pdfsubject={Математика}}


\makeindex[title=Указатель головоломок,intoc]

\makeatletter
\newcommand{\rindex}[2][\imki@jobname]{%
\index[#1]{\detokenize{#2}}%
}
\makeatother

\usepackage{add}


\newcommand\VsMO{\emph{Н.~Б.~Васильев, А.~А.~Егоров}. Задачи Всесоюзных математических олимпиад. М.: Наука, 1988}
\newcommand\MMO{\emph{Г. А. Гальперин, А. К. Толпыго}. Московские математические олимпиады. М.: Просвещение, 1986}

\newcommand\Vseros{Всероссийские олимпиады школьников по математике 1993--2006. Окружной и финальный этапы / Н. Х. Агаханов и др.  М.: МЦНМО, 2007}


\makeatletter
\renewenvironment{theindex}{%
\columnseprule 0pt
\columnsep 30pt
\parindent0pt 
\chapter{\indexname}\markboth{\indexname}{\indexname}
% \addcontentsline{toc}{chapter}{\indexname}
\thispagestyle{empty}
\let\item\@idxitem
\multicolsep6pt plus1pt
\columnsep25pt
% \footnotesize
\begin{multicols}{2}
\raggedright
}{%
\end{multicols}
}

\renewcommand\@idxitem{\par\hangindent 12\p@}

\makeatother


\newenvironment{addedbytheeditors}{\par\medskip\small
% \trivlist\item[]
}{\par\addvspace{\medskipamount}} % \endtrivlist

\begin{document}
\include{titul}

\include{oborot}

\clearpage

\null
\thispagestyle{empty}

\clearpage

% Предварительное издание предназначенное исключительно для отлова ляпов. 

% Исправления слать по адресу 
% \url{petrunin@math.psu.edu}.


%%% \input{preface.tex}

\thispagestyle{empty}

%%% Это посвящение

\vspace*{4\baselineskip}

{
\centering
\em

Лоис, с благодарностью за любовь и поддержку, \\
Мартину Гарднеру, вдохновлявшему меня,\\
и многим друзьям, родственникам, коллегам и рецензентам, \\
наивно надеющимся, что публикация этой книги\\
умерит мою страсть к загадкам.

}
\clearpage

\null
\thispagestyle{empty}

\clearpage

\chapter{Предисловие}
% \addcontentsline{toc}{chapter}{Предисловие}

\thispagestyle{empty}

\setlength{\epigraphwidth}{.75\textwidth} % P{.84\textwidth}
\epigraph{Сомнение "--- это вестибюль, через который все должны пройти, прежде чем попасть во дворец Мудрости.
Когда мы пребываем в сомнении и ищем истину своими собственными силами, мы приобретаем нечто, что останется с нами и будет служить нам снова и снова.
Но если во избежание трудностей поиска мы воспользуемся превосходными познаниями друга, это знание не задержится у нас.
Мы его не купили, а взяли взаймы.\vspace{1ex}}{Чарльз Калеб Колтон}                                                                                    

Эти задачи не для всех.

Чтобы оценить и решить их, необходимо, но не достаточно быть в хороших отношениях с математикой.
Вам будет нужно знать, что такое точка и прямая, что такое простое число и сколькими способами можно упорядочить пять карт, которые держит игрок в покер.
Но самое важное, вы должны знать, что такое доказательство.

Вам \emph{не} потребуется профессиональное знание математики.
Вы знаете, что такое группа? Прекрасно, но вам это не понадобится.
Компьютер, калькулятор и учебник по матанализу могут оставаться там, где лежат%
\footnote{В некоторых местах (например, в предпоследней главе) математический анализ все же используется. "--- \emph{Прим. ред.}}, а вот переключатель сообразительности должен быть в положении <<вкл>>.

Кто вы? Любители математики.
Учёные из разных областей науки.
Сильные школьники и студенты.
И да, профессиональным математикам и учителям здесь тоже найдётся над чем подумать.
Эти задачи вы, как правило, не найдёте в журнальных статьях, в списке заданий для домашней работы или в других книгах головоломок.

Так где же нашёл их я? Они передаются из уст в уста.
Среди математиков такие задачи распространяются, как анекдоты.
В некоторых случаях мне удалось отыскать опубликованный источник, такой как всесоюзные математические олимпиады, международные математические олимпиады или рубрики Мартина Гарднера в журнале \emph{Scientific American}, но, конечно, это не всегда исходные источники;
даже если так, задачи могли ходить в устном фольклоре задолго до этого.
В некоторых случаях я могу точно назвать автора задачи (например, если это я сам).
Часто решение моё собственное и необязательно то, которое предусматривалось автором задачи.
Несколько решений одной задачи предлагаются, только когда я не смог устоять перед их красотой.

Формулировки задач и их решения "--- мои, и я беру на себя полную ответственность за ошибки и неточности.
Присылайте жалобы, исправления и информацию об источнике задач на электронную почту pw@akpeters.com.
(Одно исключение: как отмечено в последней главе, я не тот человек, которому надо отправлять предполагаемые решения из «Нерешённых головоломок».)

На момент написания этой книги я уже 28 лет являюсь профессиональным математиком
(14 лет в академии и 14 лет в коммерческой компании).
Собирать математические головоломки я начал еще в школе, в 60-е годы.
В этой книжке представлена примерно сотня моих любимых задач.
Чтобы попасть в эту книгу, задача должна была удовлетворять большинству из следующих требований.

\textit{Занимательность.}
Задача должна доставлять удовольствие.
Задания с математических олимпиад Уильяма Лоуэлла Патнема, проводящихся ежегодно для студентов колледжей в США и Канаде, созданы для проверки способностей студентов.
Это прекрасная цель, но она не всегда сочетается с занимательностью.
(Тем на менее в книге представлены несколько задач с олимпиад Патнема.)

\textit{Универсальность.}
Задача должна говорить о некой общей математической истине.
Сложные логические задачи, алгебраические задачи типа:
«Через два года Алиса будет в два раза старше, чем Боб, когда он был...», задачи, основывающиеся на свойствах конкретных больших  чисел, и множество других типов искусно придуманных задач исключены.

\textit{Красота.}
Задача должна  элементарно и легко формулироваться.
Ведь чтобы задача передавалась устно, нужно, чтобы она легко запоминалась! Ещё лучше, когда в формулировке присутствует элемент неожиданности.

\textit{Трудность.}
Должно быть неочевидно, как решить задачу.

\textit{Решаемость.}
У задачи должно найтись хотя бы одно элементарное и понятное решение.

Последние два пункта порождают противоречие: задача должна иметь простое решение, однако непросто решаться.
Как бывает в хороших загадках, в задаче должно быть трудно отгадать ответ, но легко его понять.
Конечно, для нерешённых задач из последней главы трудность очевидна, а последнее требование мы им не выдвигаем.

О формате книги.
Для удобства задачи довольно свободно разделены по типу условия или решения по главам, соответствующим той или иной области математики.
Решения приводятся в конце каждой главы (за исключением последней).
Конец решения отмечен сердечком ($\heartsuit$).
Если известны происхождение и история задачи, то они представлены там же.
Условие задачи \emph{не} повторяется перед её решением.
Я хотел бы, чтобы читатели пробовали решить задачи самостоятельно прежде чем заглядывать в ответы.

Эти задачи трудны.
Несколько из них долгое время существовали как нерешённые проблемы, пока кто-то не нашёл (красивое) решение, которое вы здесь прочтёте.
Нерешённые задачи в конце книги, представляющие как бы логическое завершение коллекции, возможно, только немногим сложнее, чем все остальные.

Если вы сами решили какую-то из этих задач, то можете по праву гордиться, особенно, если ваше решение лучше моего.

Удачи!

%\begin{flushright}
%--- Петер Винклер
%\end{flushright}

%Comment to Russian readers:

%  Since many of my best puzzles originated in Russia, I feel as though this Russian-language edition is to some extent "bringing coals to Newcastle." 
%But I am confident that most readers will find here lots of great puzzles they haven't seen before, and will also from the great job the translators have done in correcting errors from the English original.
% Happy puzzling!

%    "---Peter Winkler

\subsubsection*{Замечание к русскому изданию}

Поскольку многие из моих любимых головоломок родом из России, издавать эту книжку на русском языке в некотором смысле то же самое, что ехать в Тулу со своим самоваром.
Тем не менее я уверен, что большинство читателей найдут здесь множество замечательных и новых для них задач; кроме того, благодаря работе переводчиков перед их глазами будет текст, в котором исправлены многие ошибки английского ори\-ги\-нала.

Успешного головоломания!

% \begin{flushright}
\rightline{Питер Уинклер}
% \end{flushright}


%%% \input{intuition.tex}

\chapter{Погружение} 
% \addcontentsline{toc}{chapter}{Погружение}

\thispagestyle{empty}

\setlength{\epigraphwidth}{.6\textwidth}
\epigraph{Когда напряжённая умственная работа сменяется периодами отдыха, интуиция словно берёт верх и порождает кристально ясные откровения, привносящие в процесс научного исследования неповторимое удовольствие и наслаждение.\vspace{1ex}}{Фритьоф Капра, физик}

Эта глава предназначена для разминки и содержит задачи, не относящиеся к какой-либо специфической теме или методу.
Однако, как часто бывает в таких случаях, некоторые ключевые идеи могут помочь в дальнейшем.
Вот для начала одна из подобных задач.

\subsection*{Монеты в ряд} %(COINS IN A ROW)
\rindex{Монеты в ряд}

На столе выложен ряд из пятидесяти монет различного достоинства.
Алиса берёт монету с одного конца и кладёт себе в карман, затем Боб берет монету с одного из концов, и так они продолжают по очереди, пока Боб не забирает последнюю монету.

Докажите, что при правильной игре Алиса сможет собрать не меньше денег, чем Боб.

\medskip

Попробуйте сыграть в эту игру сами, для начала с несколькими монетами (или случайными числами), начните с 4 или 6 монет вместо $50$.
Совсем не очевидно, как играть оптимально, не так ли?
Но, может, Алисе и не нужна \emph{оптимальная} стратегия? 

Сейчас подходящий момент установить себе правило "--- пытаться решить задачу до того, как продолжить чтение.

\paragraph{Решение}
Пронумеруем все монеты числами от 1 до 50 и заметим, что, независимо от того, как ходит Боб, Алиса может забрать, по своему выбору, все
монеты с чётными номерами или все монеты с нечётными номерами.
В одном из этих двух случаев она заведомо получит не менее половины общей суммы.
\heart

\medskip
Эту задачу я узнал от математика Н\'{о}ги Ал\'{о}на; говорят, что её давали при приёме на работу в одной израильской IT"=компании.
Вообще говоря, у Алисы есть и лучшие стратегии, чем выбор всех
монет с чётными или нечётными номерами.
Заметим, однако, что если у нас 51~монета вместо 50, то вполне может оказаться, что Боб (игрок,
который ходит вторым) выигрывает, несмотря на меньшее, чем у Алисы, число собранных монет.
Кажется парадоксальным, что чётность общего количества монет так сильно влияет на результат игры, в которой все
действие происходит на концах цепочки.

\medskip

Ну что ж, попробуйте теперь сами.
Начнём с двух менее математических задач, а затем перейдём к вещам посерьёзнее.
Доверьтесь вашей интуиции!

\subsection*{Братья Биксби} %(THE BIXBY BOYS)
\rindex{Братья Биксби}

В первый день занятий миссис Фельдман, войдя в класс, увидела сидящих за первой партой двух абсолютно одинаковых учеников, Дональда и Рональда Биксби.

"--- Вы двойняшки, не так ли? "--- спросила она.

"--- Нет, "--- ответили они хором.

Миссис Фельдман проверила записи в журнале и убедилась, что у мальчиков одни и те же родители и родились они в один и тот же день.
Как такое может быть?

\subsection*{Свет на чердаке}%(THE ATTIC LAMP SWITCH)
\rindex{Свет на чердаке}%
На первом этаже имеются три выключателя, один из них включает свет на чердаке "--- но который? 
Ваша задача "--- после \emph{одного} похода на чердак определить,
какой выключатель относится к чердачной лампочке. Предварительно можно
совершить какие угодно действия с выключателями.

\subsection*{Топливный кризис} %(GASOLINE CRISIS)
\rindex{Топливный кризис}

Представим, что у нас дефицит бензина, так что
заправочные станции, расположенные на кольцевой дороге, все
вместе содержат количество бензина, достаточное лишь чтобы проехать один раз по кольцу.
Докажите, что можно выбрать такую заправку, что, заправившись на ней с
первоначально пустым баком и
далее заправляясь по пути, вы сможете проехать по всей кольцевой дороге.

\subsection*{Бикфордовы шнуры} %(USES OF FUSES)
\rindex{Бикфордовы шнуры}

Имеются два бикфордовых шнура, 
%% (то есть два куска огнепроводного шнура),
каждый из них сгорает ровно за одну минуту; скорость горения может быть неравномерна по длине шнура.
Можно ли при помощи этих двух шнуров отмерить 45 секунд? %???убрать бикфордовых

\subsection*{Числа и прямоугольники} %(INTEGERS AND RECTANGLES)
\rindex{Числа и прямоугольники}

Большой прямоугольник на плоскости разбит на меньшие, у каждого из
которых либо высота, либо основание, либо и то, и то "--- целые числа. 
Докажите, что большой прямоугольник также обладает этим свойством.

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.5]{Figs/Insight/rect}
\includegraphics[scale=.95]{mp/wink-1}

\vspace{-2\jot}
\end{figure}



\subsection*{Весы и гири} %(TIPPING THE SCALES)
\rindex{Весы и гири}

На столе у учителя стоят чашечные весы, правая чашка весов перевешивает.
На весах стоят гири (не обязательно одного веса), на каждой из которых написаны фамилии одного \emph{или нескольких}
% в переводе лучше с курсивом, иначе легко запутаться
учеников.
Ученик, входя в класс, переставляет на другую чашку весов каждую гирю, на которой написана его фамилия.
Докажите, что можно впустить в класс некоторую группу учеников, чтобы в результате перевесила левая чашка весов.

\subsection*{Часы на столе} %(WATCHERS ON THE TABLE)
\rindex{Часы на столе}

На столе лежат пятьдесят точных ручных часов.
Докажите, что существует момент времени, когда сумма расстояний от центра стола до кончиков минутных стрелок больше, чем сумма расстояний от центра стола до центров часов.

\subsection*{Путь по шахматной доске} %(PATH ON CHESSBOARD)
\rindex{Путь по шахматной доске}

Алиса начинает игру и ставит фишку в угол шахматной доски размером $n{\times}n$.
Боб передвигает фишку на соседнее поле, имеющее общую сторону с тем, на котором стоит фишка.
Второй раз ходить на поле, где уже побывала фишка, нельзя. 
Алиса и Боб ходят по очереди.
Проигрывает тот, кому некуда ходить.

При каких $n$ у Алисы есть выигрышная стратегия? 
При каких $n$ она выигрывает, если она делает первый ход не на угловое поле, а на соседнее с ним?

\subsection*{Степень в степени} %(EXPONENT UPON EXPONENT)
\rindex{Степень в степени}

На экзамене по математике для старших классов американской школы 1960-х годов 
был следующий вопрос.
Пусть
$$x\mkern1mu^{x^{ x^{\urdots}}} % {\cdot}^{\mkern2.5mu\cdot^{\mkern2.5mu\cdot}}}}}
=2.$$
Чему равен $x$? %чему равно x/чему равен x --- оба варианта допустимы, но нам наш больше нравится
Предполагаемое решение основывается на том, что степень \emph{нижнего} $x$ равна всему выражению, таким образом, $x^2\z=2$ и $x=\sqrt{2\mkern1mu}$.
Но один ученик заметил, что если бы в задаче требовалось решить уравнение
$$x\mkern1mu^{x^{ x^{\urdots}}} 
% {\cdot}^{\mkern2.5mu\cdot^{\mkern2.5mu\cdot}}}}}
=4,$$
то он бы получил тот же ответ: $x=\sqrt[\scriptstyle 4]{4}=\sqrt{2\mkern1mu}$.

Хмм...
Чему же тогда равно $\sqrt{2\mkern1mu}{}^{\sqrt{2\mkern1mu}{}^{{\sqrt{2\mkern1mu}}^{\mkern2mu\urdots}}}
% \mkern2mu{\cdot}^{\mkern2.5mu\cdot^{\mkern2.5mu\cdot}}}}}
$? 
А можете это доказать?

\subsection*{Солдаты в поле} %(SOLDIERS IN THE FIELD)
\rindex{Солдаты в поле}

Нечётное число солдат расположилось на поле таким образом, что расстояния между всеми парами солдат различны.
При этом каждый солдат должен присматривать за ближайшим к нему другим солдатом.

Докажите, что существует хотя бы один солдат, за которым никто не присматривает.

\subsection*{Отрезки и расстояния} %(INTERVALS AND DISTANCES)
\rindex{Отрезки и расстояния}

Пусть множество $S$ состоит из $k$ непересекающихся отрезков, лежащих в единичном отрезке $[0,1]$.
Предположим, что $S$ обладает следующим свойством: для любого вещественного числа $d$ из отрезка $[0,1]$ в множестве $S$ существуют две точки на расстоянии $d$ друг от друга.
Докажите, что сумма длин отрезков из множества $S$ не меньше~$1/k$.

\subsection*{Собрать 15} %(SUMMING TO 15)
\rindex{Собрать 15}

Алиса и Боб по очереди выбирают число из набора $1, 2,\dots,9$ без повторов.
Выигрывает тот, кто первый наберёт три числа, дающие в сумме~$15$.
Имеется ли у Алисы (она ходит первая)
выигрышная стратегия?

%%% \input{intuition-sol.tex}

\section*{Решения и комментарии}

\subsubsection*{Братья Биксби} % (THE BIXBY BOYS)

Классическая головоломка.
Конечно же, это были тройняшки.
Третий близнец (Арнольд?) был в другом классе.

\subsubsection*{Свет на чердаке} % (THE ATTIC LAMP SWITCH)

Эта задача пронеслась по миру, как эпидемия гриппа, где-то лет десять тому назад;
я не знаю её источника.

\medskip

Действительно, невозможно определить, какой выключатель подключён к лампочке на чердаке, если всё, что вы имеете "--- это один бит информации, полученный от вашего похода на чердак.
Однако можно добыть больше сведений, если использовать ваши руки!
Включите выключатели 1 и 2, подождите несколько минут, затем выключите выключатель 2 и идите на чердак.
Если лампочка не горит, но горячая, значит, выключатель 2 "--- это то, что мы ищем.
\heart

\medskip
Если вы не можете дотянуться до лампочки, но обладаете воистину
огромным терпением, то можно добиться того же результата, включив
выключатель 2 и затем, подождав пару месяцев, включить первый
выключатель и посетить чердак.
Если лампочка перегорела, то виноват в
этом выключатель 2.

\subsubsection*{Топливный кризис} %(GASOLINE CRISIS)

Эта задача была известна довольно давно, её можно найти, например, в чудесной книге Ласло Ловаса\footnote{\emph{L. Lov\'asz}. {Combinatorial Problems and Exercises}. Amsterdam: North Holland, 1979.}.

\medskip

Трюк заключается в следующем:
представьте, что вы начинаете на автозаправке, скажем, №\,1 с \emph{большим запасом} бензина и затем продолжаете свой путь, опустошая каждую автозаправку на кольцевой дороге.
Когда вы вернётесь к заправке №\,1, 
у вас будет столько же бензина, как и в начале пути.

Во время поездки записывайте, сколько остаётся бензина перед каждой заправочной станцией.
Предположим, что это количество минимально перед автозаправкой №\,$k$.
Значит, если начать с автозаправки №\,$k$ с пустым баком, то нет риска оказаться без бензина между заправками.
\heart

\begin{addedbytheeditors}
В основе решения этой задачи лежит так называемая лемма Рени\footnote{\emph{G. Raney}. Functional composition patterns and power series reversion /\!/ Trans. Amer. Math. Soc. 1960. Vol.~94. P.~441--451.}.
Она утверждает, что если
$\langle x_1, x_2,\ldots, x_m\rangle$ "--- любая последовательность целых чисел, сумма 
которых равна $+1$, то ровно у одного из её циклических сдвигов 
$\langle x_1, x_2,\ldots , x_m\rangle, \langle x_2, \ldots, x_m, x_1\rangle, \z\ldots, \langle x_m, x_1, \ldots, x_{m-1}\rangle$
все частичные суммы  положительные. 

Замечательная книга Ласло Ловаса, упомянутая в решении, не является первоисточником задачи.
Формулировка с кольцевой автодорогой и заправками встречалась в Задачнике <<Кванта>> 1971 года (М82)
и в сборнике «Математические соревнования»\footnote{%  \cite[задачи 76 и 77]{matsorev}
\emph{Е. Б. Дынкин, С. А. Станислав, А. Л. Розенталь}. Математические соревнования: Арифметика и алгебра. М.: Наука, 1970. Задачи 76 и 77.}, но ещё раньше она появилась на Пекинской математической олимпиаде\footnote{% \cite[№26.6]{zarubezh}.
Зарубежные математические олимпиады / Под ред. И. Н. Сергеева.
М.: Наука, 1987.} 1964 года. "--- \emph{Прим. ред.}
\end{addedbytheeditors}


\subsubsection*{Бикфордовы шнуры} %(USES OF FUSES)

Подожгите одновременно оба конца первого шнура и один конец второго.
Когда первый шнур сгорит (через полминуты), подожгите незажжённый конец второго шнура.
К моменту, когда он догорит полностью, пройдёт 45 секунд.
\heart

\medskip

Несколько лет назад эта и другие задачи о бикфордовых шнурах распространились по миру, как лесной пожар.
Дик Хесс, эксперт по занимательной математике, 
собрал небольшую книжку таких задач\footnote{\emph{D. Hess}. % , J. Slocum}.
{Shoelace Clock Puzzles}. 1998.}.
Сам он впервые услышал приведённую выше задачу от Карла Морриса из Гарвардского университета.

Хесс рассматривает бикфордовы шнуры (он их зовёт шнурками) различной длины, но поджигает их только с концов.
Если же позволено поджигать шнур во внутренних точках и вы обладаете определённой ловкостью, то можно добиться гораздо большего.
Например, можно отмерить 10 секунд с помощью одного 60-секундного шнура, если зажечь его с обоих концов и в двух внутренних точках, а затем каждый раз, когда сегмент сгорает, поджигать в новой внутренней точке.
Таким образом, всё время горят три сегмента с двух концов, и шнур сгорает в шесть раз быстрее.

Будет немного суеты под конец, и, конечно же, для абсолютной точности
понадобится бесконечное число спичек.

\subsubsection*{Целые числа и прямоугольники} %(INTEGERS AND RECTANGLES)}

Эта задача была предметом особой
статьи Стэна Уэгона из колледжа Макалестер в Сент-Поле, Миннесота%
\footnote{\emph{S. Wagon}. Fourteen proofs of a Result about Tiling a Rectangle /\!/ {Amer. Math. Monthly}. 1987. Vol. 94. P.~601--617.}.

Некоторые из решений, предложенных Уэгоном, забавным образом используют мощную математическую технику.
А одно решение не из их числа таково.

\medskip

Наложим на большой прямоугольник сетку, состоящую из квадратов со стороной $1/2$, так, чтобы нижний левый угол прямоугольника находился в вершине клетки сетки.
Раскрасив клетки сетки в белый и чёрный цвета в шахматном порядке, 
мы видим, что каждый малый прямоугольник ровно наполовину белый и наполовину чёрный.
Следовательно, то же будет верно и для большого прямоугольника.
Но, допустим, высота большого прямоугольника не целое число, тогда часть 
большого прямоугольника между линиями $x=0$ и $x=1/2$ не содержит одинаковое количество белого и чёрного цвета.
Следовательно, основание должно быть целым.\heart

\medskip
Автор книги предлагает следующее решение, которое вы не найдёте в статье Уэгона.
%
Пусть $\varepsilon$ существенно меньше, чем наименьшая из сторон прямоугольников разбиения.
Раскрасим каждый малый прямоугольник с целым основанием светло-серым цветом, кроме тёмных горизонтальных полосок шириной $\varepsilon$ вдоль его верхней и нижней сторон.
Раскрасим оставшиеся прямоугольники тёмно-серым, за исключением светло"=серых вертикальных полосок шириной $\varepsilon$ вдоль левой и правой сторон.

%в решении ссылаются на цвета диаграмы, но при печати она станет ч/б
\begin{figure}[!ht]
\centering
\vspace{\jot}
% \includegraphics[scale=0.5]{Figs/Insight/green}
\includegraphics[scale=.95]{mp/wink-2}

\vspace{-\jot}
\end{figure}


Поместим в нижний левый угол большого прямоугольника начало координат.
Заметим, что у нас есть либо светлый путь с левой стороны большого прямоугольника до его правой стороны, либо тёмный путь с нижней стороны до верхней.
Рассмотрим первый вариант.
Каждая точка пересечения светлого пути с вертикальными сторонами малых прямоугольников имеет целую координату; таким образом, основание большого прямоугольника "--- целое число.
Подобным же образом и тёмный путь снизу вверх даёт целую высоту.

\subsubsection*{Весы и гири} %(TIPPING THE SCALES)

Рассмотрим результат для каждого подмножества учеников, включая пустое.
Заметьте, что каждая гиря окажется на левой чашке весов ровно в половине случаев.
В частности, средний вес гирь на левой чашке для всех подмножеств учеников равен их среднему весу на правой чашке.
Поскольку для пустого множества правая чашка тяжелее, 
для какого-то другого множества тяжелее должна быть левая.\heart

\medskip
{% \small
Источник: II Всесоюзная математическая олимпиада\footnote{% \cite[№110]{VsMO},
\VsMO. Задача №110, автор не указан. "--- \emph{Прим. ред.}}, Ленинград, 1968.
}

%   \medskip
Техника усреднения, описанная выше, будет использоваться в дальнейшем, обратите на неё внимание!

\begin{addedbytheeditors}
В курсе Игоря Пака%
\footnote{Раздел 5 в лекциях: \emph{I. Pack}. Tilings (Math 285, Winter 2013), \url{https://www.math.ucla.edu/~pak/courses/Tile-2013/tile2013.htm} }
собраны разные статьи на эту тему.
"--- \emph{Прим. ред.}
\end{addedbytheeditors}

\setbox180\hbox{\includegraphics[scale=.75]{mp/wink-3}}
\begin{wrapfigure}[12]{r}{\wd180}
\box180
\end{wrapfigure}

\subsubsection*{Часы на столе} %(WATCHERS ON THE TABLE)

Рассматривая только одни часы, 
мы видим, что в течение одного часа среднее расстояние от центра стола $C$ до кончика минутной стрелки $M$ превышает расстояние от $C$ до центра часов~$W$.
Действительно, если провести через точку $C$ прямую $\ell$, перпендикулярную прямой $CW$, 
то среднее расстояние от прямой~$\ell$ до точки $M$, очевидно, равно расстоянию от $W$ до $\ell$,
% {\au{Было бы неплохо обозначить прямую маленькой буквой.}}
что, в свою очередь, равно $CW$.
Но расстояние $CM$ по меньшей мере равно расстоянию от $M$ до~$\ell$, а обычно больше.


Взяв сумму по всем часам, приходим к аналогичному заключению, и отсюда следует, что есть момент в течение одного часа, когда желанное неравенство выполняется.\heart


\medskip

Требование точности часов обеспечивает движение каждой минутной стрелки с постоянной скоростью.
Это не так уж важно, когда скорости различаются, если только наше терпение не ограничено одним часом.

Дополнительное замечание: расположив часы определённым образом,
то \emph{можно} добиться того, чтобы сумма расстояний от центра стола до кончиков минутных стрелок всегда была строго больше, чем сумма расстояний от центра стола до центров часов.

% \medskip

{% \small
Источник: данная задача впервые появилась на X Всесоюзной математической олимпиаде\footnote{% \cite[№220]{VsMO}
\VsMO. Задача №220, автор С. В. Фомин. "--- \emph{Прим. ред.}} в Душанбе, 1976. 
}

\begin{addedbytheeditors}
Можно использовать более простую идею: сумма расстояний от центра
стола $O$ до концов минутных стрелок в два момента времени, отстоящие
на 30 минут, больше удвоенного расстояния от $O$ до центра часов
(сумма длин двух сторон треугольника больше удвоенной длины медианы,
проведенной к третьей стороне). "--- \emph{Прим. ред.}
\end{addedbytheeditors}


\subsubsection*{Путь по шахматной доске} %(PATH ON CHESSBOARD)

Если $n$ "--- чётное число, то у Боба имеется простая выигрышная стратегия, независимо от того, где Алиса начинает.
Он представляет себе, что шахматная доска  покрыта доминошками, каждая доминошка покрывает две соседние клетки.
Боб просто закрывает доминошку на каждом ходу, то есть ставит фишку на вторую клетку той доминошки, куда пошла Алиса.
(Заметим, что эта стратегия работает, даже если Алисе разрешено ставить фишку на любую клетку при каждом ходе!)

Если $n$ нечётное и Алиса начинает с угла, то она выигрывает;
ей надо представить, что доминошки покрывают всю доску, кроме угловой клетки, с которой она начинает.

Тем не менее Алиса проигрывает в случае нечётного $n$, если она должна начинать с клетки, соседней с угловой.
Предположим, что угловые клетки на данной доске чёрные, то есть Алиса начинает с белой клетки.
Существует покрытие всей шахматной доски доминошками, за исключением одной чёрной клетки.
Боб выигрывает, закрывая доминошки.
Алиса
никогда не сможет поставить фишку на незакрытую клетку, потому что все клетки, на которые она ходит, белые.\heart
{\looseness-1\par}

\medskip

{% \small

Источник:
XII Всесоюзная математическая олимпиада\footnote{% \cite[№262]{VsMO}    \VsMO.
\emph{Там же}. Задача №262, автор не указан. "--- \emph{Прим. ред.}}, Ташкент, 1978.%

}


\subsubsection*{Степень в степени} %(EXPONENT UPON EXPONENT)

Если выражение
${\textstyle\sqrt{2\mkern1mu}}{}^{{\sqrt{2\mkern1mu}}{}^{{\sqrt{2\mkern1mu}}^{\mkern2mu\urdots}}}$
имеет какой-то смысл, то это не что иное, как предел последовательности
$${\textstyle\sqrt{2\mkern1mu}}, {\textstyle\sqrt{2\mkern1mu}}{}^{{\sqrt{2\mkern1mu}}}, {\textstyle\sqrt{2\mkern1mu}}{}^{{\sqrt{2\mkern1mu}}{}^{{\sqrt{2\mkern1mu}}}},\dots$$
Этот предел существует, так как последовательность возрастает и ограничена.

Для доказательства первого утверждения обозначим эту последовательность
$s_1, s_2,\dots$ и докажем по индукции, что $1<s_i\z<s_{i+1}$
для каждого $i\ge 1$.
Это сделать легко, поскольку \[s_{i+2}=
{\textstyle\sqrt{2\mkern1mu}\mkern2mu}{}^{s_{i+1}}
>{\textstyle\sqrt{2\mkern1mu}\mkern2mu}{} ^{s_{i}}
=s_{i+1}.\]

Верхнюю грань выражения для $s_i$ можно получить заменив самый верхний $\sqrt{2\mkern1mu}$ на большее число $2$, тогда $s_i$ превратится в двойку.

Теперь, когда мы знаем, что предел существует, обозначим его~$y$.
Он должен удовлетворять уравнению ${\sqrt{2\mkern1mu}}{}^y=y$.
Рассмотрев уравнение $x=y^{1/y}$, 
можно увидеть, применив элементарный матанализ (приношу извинения!),
что $x$ строго возрастает при возрастании $y$ до максимума при $y=e$, после чего убывает.
Таким образом, существует не больше двух значений $y$ для данного $x$, 
и при $x=\sqrt{2\mkern1mu}$ нам известны оба: $y=2$ и $y=4$.

Поскольку наша последовательность ограничена сверху двойкой, можно исключить $4$, и, таким образом, $y=2$.\heart

\medskip

Обобщив приведённое выше доказательство, мы видим, что выражение $x^{x^{x^{\urdots}}}$
имеет смысл и равно наименьшему решению уравнения $x=y^{1/y}$ при $1\le x\le e^{1/e}$.
При $x=e^{1/e}$ выражение равно $e$, но, как только $x$ превысит $e^{1/e}$, последовательность устремляется к бесконечности.

\begin{addedbytheeditors}
Если считать, что выражение $x^{x^{ x^{\urdots}}}
% {\cdot}^{\mkern2.5mu\cdot^{\mkern2.5mu\cdot}}}}}
$ задаёт некоторую функцию $y(x)$, то должно выполняться равенство $x^{y(x)}=y(x)$, которое можно интерпретировать как функциональное уравнение.
Тогда под решением уравнения 
\begin{equation}
\label{xxxy}
x^{x^{ x^{\urdots}}} % {\cdot}^{\mkern2.5mu\cdot^{\mkern2.5mu\cdot}}}}}
=y
\end{equation}
можно понимать значение обратной функции $x(y)$.

Функция,  обратная к функции $f(w)=we^w$, называется \emph{функцией Ламберта} и обозначается $W$.
Она является решением функционального уравнения $z=W(z)e^{W(z)}$.
Уравнение~\eqref{xxxy} можно переписать в виде $-\ln x=\ln\frac{1}{y}\,e^{\ln\slfrac{1}{y }}$.
Поэтому $\ln\frac{1}{y }=W(-\ln x)$
и
$y=\frac{W(-\ln x)}{ -\ln x}$.

Кажущийся парадокс в задаче, объясняется тем, что  функция Ламберта многозначна.
Её значения $y=2$ и $y=4$ при $x=\sqrt{2\mkern1mu}$ лежат на разных ветвях этой функции.

С уравнением~\eqref{xxxy} связана другая интересная функция
$\mathcal{E}(x)\hm=-W(-x)/x$.
Она является решением функционального уравнения
$\mathcal{E}(x)\hm=e^{x\mathcal{E}(x)}$, и поэтому $x^{x^{ x^{\urdots}}}
% {\cdot}^{\mkern2.5mu\cdot^{\mkern2.5mu\cdot}}}}}
=\mathcal{E}(\ln x)$.
Функция $\mathcal{E}(x)$ рассматривалась Эйлером\footnote{%[381] В Конкретной математике  
\emph{L. Eulero}. De serie Lambertina, plurimisque eius 
insignibus proprietatibus /\!/ Acta academiae scientiarum imperialis 
Petropolitanae 3,2 (1779), 29--51. Воспроизведено в его Opera 
Omnia, series 1, volume 6, 350--369.}
и Эйзенштейном\footnote{%[362] В Конкретной математике
\emph{G. Eisenstein}. Entwicklung von $\alpha^{\alpha^{\alpha}}$ /\!/ Journal 
fur die reine und angewandte Mathe\-matik. 1844. B.~28. S.~49--52. 
Воспроизведено в его Mathematische Werke 1. S.~122--125.}. 
Любопытно, что доказательства некоторых свойств её функции носят комбинаторный характер, например  ряд
$$\mathcal{E}(x)=\sum_{k=0}^{\infty}\,(k+1)^{k-1}\frac{x^k}{ k!},$$
выводится из обобщеной леммы Рени, упоминавшейся выше в задаче про бензоколонки%
\footnote{\emph{Р. Грэхем, Д.",Э. Кнут, О. Паташник}. Конкретная математика. М.: Мир, 1998. Разделы 5.4 и 7.5.}.
"--- \emph{Прим. ред.}
\end{addedbytheeditors}

\subsubsection*{Солдаты в поле}%(SOLDIERS IN THE FIELD)
Данная задача была представлена на VI Всероссийской математической олимпиаде\footnote{% \cite[№72]{VsMO}  \emph{Там же}.
\VsMO. Задача №72, автор М. И. Серов. "--- \emph{Прим. ред.}} в Воронеже, 1966~г.
Её легче всего решать, начав с двух солдат, находящихся друг от друга на кратчайшем расстоянии.
Ясно, что они присматривают друг другом, и если кто-то ещё смотрит на одного из них, то у нас имеется солдат, за которым присматривают двое. 
Значит, есть солдат, за которым никто не присматривает.
Если же за этими двумя солдатами больше никто не присматривает, то можно их убрать, не влияя на остальных.
{\looseness-1\par}

Так как число солдат нечётное, то, применяя и далее это рассуждение, мы в конце концов придём к одному солдату, который ни за кем не присматривает, "--- противоречие.\heart

\subsubsection*{Отрезки и расстояния} %(INTERVALS AND DISTANCES)

Обозначим через $s_1,\dots,s_k$ длины отрезков множества $S$,
и пусть их сумма равна $s$.
Рассмотрим интервал $I_{i\mkern-4mu j}$, содержащий все \emph{расстояния}, которые можно получить, взяв первую точку на $i$"~м и вторую на $j$"~м отрезке множества $S$.
Ясно, что длина интервала $I_{i\mkern-4mu j}$ равна $s_i+s_j$.
Просуммируем по всем парам $i\ne j$. Каждая длина появляется $k-1$ раз,
таким образом, сумма длин интервалов по всем парам различных отрезков не превосходит $(k-1) s$.
Расстояния между точками, взятыми из $i$"~го отрезка, имеют значения от $0$ до $s_i$.
Значит, общая длина всех интервалов $I_{i\mkern-4mu j}$ не превосходит $k s$.
Поскольку $k s\ge 1$, получаем $s\ge 1/k$.
\heart

\medskip
Равенство достигается, если максимум всех $s_i$ равен $s$, 
то есть если все отрезки, кроме одного, имеют нулевую длину.
Этого можно добиться, взяв отрезок $[0,\slfrac1k]$ и добавив изолированные точки
$\slfrac2k$, $\slfrac3k$, \dots,~$1$ или взяв отрезок $[1-\slfrac1k,1]$ с точками
$0,\slfrac1k,\dots,\slfrac{(k-2)}k$. %с этим расхождением согласен Питер, в оригинале была небольшая ошибка: https://github.com/anton-petrunin/test/wiki

% \medskip

{% \small


Источник:
XVII Всесоюзная математическая олимпиада%
\footnote{% \cite[№369]{VsMO},  \emph{Там же.}
\VsMO. Задача №369, автор  Е. И. Хухро. "--- \emph{Прим. ред.}}, Кишинёв, 1983.

}
% \medskip

\subsubsection*{Собрать 15} %(SUMMING TO 15)

Быстрый способ решить данную задачу "--- воспользоваться следующим магическим квадратом:
$$
\begin{matrix}
8&1&6\\
3&5&7\\
4&9&2
\end{matrix}
$$
Так как числа в строчке, столбике и диагонали дают в сумме 15, можно сказать, что они играют в крестики-нолики! 
Всем известно, что наилучшая игра в крестики-нолики приводит к ничьей,
то есть ответ на наш вопрос "--- нет, у Алисы нет выигрышной стратегии.
\heart

\medskip
Эта забавная игра упоминается во втором томе классической книги Элвина Берлекампа, Джона Конвея и Ричарда Гая%
\footnote{\emph{E. Berlekamp, J. Conway, R. Guy}. {Winning Ways for Your Mathematical Plays.} Academic Press, 1982; 2nd ed. A K Peters, 2001.}.
В книге задача приписывается некоему Э.~Периколозо Спорджерси
(E.~Pe\-ri\-coloso Sporgersi), что выглядит очень подозрительно "---
такую надпись можно увидеть в итальянских поездах, она предупреждает
пассажиров об опасности высовываться из окна. 

\begin{addedbytheeditors}
Задача взята из «Математических новелл» Мартина Гарднера \footnote{глава 18 в~русском издании книги, см. также главу <<{Игра в 15 на новый   лад}>> в книге: \emph{M. Гарднер}. Есть идея! М.: Мир, 1982, а также статью <<Number Scrabble>> в английской «Википедии».}.
Исходно опубликована голландским психологом Джоном Мишоном%
\footnote{\emph{J. A. Michon}. The Game of JAM: An Isomorph of Tic-Tac-Toe /\!/ The American Journal of Psychology. 1967. Vol.~80(1). P.~137--140.}.
"--- \emph{Прим. ред.}
\end{addedbytheeditors}



%%% \input{numbers.tex}

\chapter{Числа}
% \addcontentsline{toc}{chapter}{Числа}

\thispagestyle{empty}

\setlength{\epigraphwidth}{.4\textwidth}
\epigraph{Счастья светлого полны\\ %We learned to be happy,
На балу танцуем мы.\\ % We danced’ round the hall
А причину что скрывать "---\\ %And learning to count was the key to it all.
Научились мы считать.\vspace{1ex}}{Граф фон Знак, «Улица Сезам»}

%The Count, “Sesame Street” 


Числа "--- это бесконечный источник очарования, а для некоторых "--- болезнь на всю жизнь. %кого-то и страсть на всю жизнь.
Бывает, что свойства конкретного числа овладевают умом человека;
про такие числа придумано множество интригующих задач,
часто требующих делать выводы из на первый
взгляд неполных данных.
%основанных на кажущейся нехватке данных.

Задачи, подобранные здесь, подразумевают более общий подход: они
посвящены не каким-то конкретным числам, а числам вообще.
В
большинстве случаев для их решения понадобится немногим больше, чем
знание того, что любое натуральное число представляется как
произведение простых единственным образом.

% \medskip

Вот задача для примера.

\subsection*{Двери шкафчиков}% ДВЕРИ ШКАФЧИКОВ (LOCKER DOORS)
\rindex{Двери шкафчиков}

Шкафчики в раздевалке школьного спортивного зала пронумерованы по порядку числами от 1 до 100.
Ученик, пришедший первым, открывает все шкафчики.
Второй ученик проходит следом и закрывает все шкафчики с чётными номерами, третий ученик меняет положение дверей у шкафчиков с номерами, кратными~3.

Так продолжается до тех пор, пока не пройдёт сотый ученик.
Какие шкафчики будут после этого открыты?

\paragraph{Решение}

Состояние $n$-го шкафчика (открыт-закрыт) изменяется, когда проходит $k$"=й ученик, если $k$ "--- делитель числа $n$.
Обычно делители можно разбить на пары $\{j,k\}$, где $j\cdot k=n$, так что после прохода учеников
$j$ и $k$ положение двери шкафчика номер~$n$ не меняется. %будет равен 0.
Но если $n$ "--- полный квадрат, то нет другого делителя, отменяющего действия $\sqrt{n}$-го ученика.
Следовательно, в конце будут открыты только шкафчики, номера которых являются полными квадратами: $1$, $4$, $9$, $16$, $25$, $36$, $49$, $64$, $81$ и $100$.\heart

В начале раздела мы сделаем пару наблюдений, касающихся представления целых чисел в десятичной системе счисления, и закончим неожиданно хитрой головоломкой для ужина с друзьями. % (surprisingly subtle dinner table conundrum).

\subsection*{Нули, единицы и двойки}% НУЛИ, ЕДИНИЦЫ И ДВОЙКИ. (ZEROES, ONES AND TWOS)
\rindex{Нули, единицы и двойки}

Пусть $n$ "--- натуральное число.
Докажите, что (а) существует число, кратное $n$ (и не
равное нулю), десятичная запись которого содержит только нули и единицы, и
(б) существует число, кратное $2^n$, десятичная запись которого содержит только единицы и двойки.

\subsection*{Суммы и разности} %СУММЫ И РАЗНОСТИ (SUMS AND DIFFERENCES)
\rindex{Суммы и разности}

Даны 25 различных положительных чисел.
Докажите, что можно выбрать из них два числа так, что ни одно из
оставшихся чисел не равно ни их сумме, ни их разности.

\subsection*{Производство дробей}%??? (GENERATING THE RATIONALS)
\rindex{Производство дробей}

Множество $S$ содержит 0 и 1, а также средние значения всех конечных непустых подмножеств множества $S$.
Докажите, что $S$ содержит все рациональные числа единичного отрезка.

\subsection*{Суммирование дробей}%СУММИРОВАНИЕ ДРОБЕЙ ( SUMMING FRACTIONS )
\rindex{Суммирование дробей}

Дано натуральное число $n>1$. Сложим все дроби $1/pq$, где $p$ и $q$
"--- взаимно простые числа, $0<p<q\leqslant n$ и~$p+q>n$. Докажите,
что в результате всегда будет получаться~$1/2$.

\subsection*{Вычитания по кругу}
%ВЫЧИТАЯ ПО КРУГУ (SUBTRACTING AROUND THE CORNER)
\rindex{Вычитания по кругу}

Напишем последовательность из $n$ положительных чисел.
Заменим каждое из чисел на модуль разности %(absolute difference) 
этого и следующего за ним по кругу числа.
Будем повторять, пока все числа не станут равны нулю.
Докажите, что для $n=5$ этот процесс может продолжаться бесконечно, 
а при $n=4$ он всегда закачивается.

\subsection*{Прибыли и убытки}%ПРИБЫЛИ И УБЫТКИ (PROFIT AND LOSS)
\rindex{Прибыли и убытки}

На совещании акционеров правление представило помесячный отчёт о
прибылях и убытках со времени проведения последнего собрания.
«Заметьте, "--- сказал генеральный директор, "--- за каждые идущие подряд восемь месяцев мы получали прибыль».

«Может,  и так, "--- посетовал один из акционеров, "--- но за каждые идущие подряд пять месяцев мы несли убытки!»

Какое максимальное число месяцев могло пройти после предыдущего собрания?

\subsection*{Первое по алфавиту нечётное число}
\rindex{Первое по алфавиту нечётное число}

Числа от 1 до $10^{10}$ записаны словами (скажем, \emph{двести три} или
\emph{тысяча сто}\footnote{В оригинале, естественно, числа записывались по-английски. "--- \emph{Прим. ред.}}) и затем расставлены в алфавитном порядке
(пробелы игнорируются).
Какое нечётное число
встретится первым?


%%% \input{numbers-sol.tex}

\section*{Решения и комментарии}

\subsubsection*{Нули, единицы и двойки}%НУЛИ, ЕДИНИЦЫ И ДВОЙКИ (ZEROES, ONES AND TWOS) 

Для части (а) применим принцип Дирихле:
если число кроликов в клетках больше числа
клеток, то хотя бы в одной клеткеx находится более одного кролика.

Мы знаем, что существует только $n$ различных остатков от деления на $n$, а множество $\{1, 11, 111, 1111,\dots\}$, наибольший элемент которого состоит из $n+1$ цифр, содержит $n+1$ членов.
Следовательно, в нём содержатся два числа, имеющих одинаковый остаток при делении на $n$.
Отнимите одно от другого!
\heart

\medskip
Дэвид Гейл %(David Gale) 
указал мне на то, %обратил моё внимание на то, 
что если $n$ не делится на 2 и 5, то можно найти число, кратное $n$, 
записываемое (в десятичной системе) одними единицами.
Действительно, приведённое выше доказательство даёт число вида $111\dots111000\dots000$; 
если у нас на конце $k$ нулей, то деление на $10^k=2^k\cdot 5^k$ оставляет нам число, составленное из одних единиц и всё ещё кратное $n$.

\medskip

В части (б) легче всего доказать индукцией по $k$, что существует
число из $k$ цифр, кратное $2^k$, десятичная запись которого состоит
только из единиц и двоек.
Добавление 1 или 2 в начало такого числа
увеличит его на $2^k\cdot 5^k$ или $2^{k+1}\cdot 5^k$, так
что в обоих случаях сохраняется делимость на $2^k$.
Так как два
полученных числа отличаются на $2^k\cdot 5^k$, одно из них должно
делиться на $2^{k+1}$. \heart

\medskip
Первая задача попала ко мне от Муту Мутукришнана %(Muthu Muthukrishnan) 
из отдела исследований AT\&T и Ратгерского университета.
Вторая была представлена на V Всесоюзной математической олимпиаде\footnote{% \cite[№144]{VsMO},
\VsMO. Задача №144, автор  Б.",М.",Ивлев. "--- \emph{Прим. ред.}}
в Риге в~1971 году.
Приведённое здесь решение принадлежит Саше Баргу %(Sasha Barg) 
из Мэрилендского университета.

\medskip

В похожей задаче на I Всесоюзной математической олимпиаде в~Тбилиси в
1967 году требовалось доказать, что существует число, которое делится
на $5^{1000}$ и в десятичной записи не содержит ни
одного нуля.
Одно из возможных доказательств "--- от противного.
Пусть $5^k$ "---
наибольшая возможная степень пятёрки, на которую могут делиться числа, не содержащие нулей в десятичной записи, и пусть
$n$ кратно наибольшей степени пятёрки (скажем, $5^j$, где $j\le k$) среди всех $k+1$-значных чисел без нулей в десятичной записи.
Тогда $n\equiv c\cdot
5^j\pmod{5^{j+1}}$ для некоторого $c\in\{1,2,3,4\}$.
Поскольку $5$
является простым, существует такое $d\in\{1,2,3,4\}$, что $n\equiv
d\cdot 10^j\pmod{5^{j+1}}$.
Отняв от $n$ число $d\cdot 10^{j}$ или
прибавив к нему $(5-d)\cdot 10^{j}$, мы получаем число без нулей и
улучшаем его делимость "--- противоречие. \heart


\subsubsection*{Суммы и разности}%СУММЫ И РАЗНОСТИ (SUMS AND DIFFERENCES) 

Данная задача  также была представлена на V Всесоюзной математической олимпиаде\footnote{% \cite[№153]{VsMO}
\VsMO. Задача №153, автор  Г.",А.",Гальперин. "--- \emph{Прим. ред.}} в Риге, 1971~г.%

\medskip

%Упорядочим числа $x_1<x_2<\dots<x_n$ (мы полагаем $n=25$, но нам %потребуется только то, что $n$ нечётно).
%Если $x_n$ не является одним из искомых чисел, значит для %каждого меньшего числа $x_i$ существует другое число $x_j$, %такое что $x_i+x_j=x_n$.
%Таким образом, первые 24 числа разбиваются на пары и %следовательно $x_i+x_{n-i}\z=x_n$ для любого $i$.

%Сумма $x_{n-1}$ с любым из чисел $x_2,\dots,x_{n-2}$ больше, чем %$x_n\z=x_1+x_{n-1}$.
%Значит, если $x_{n-1}$ не является одним из искомых чисел, то %для каждого числа $x_i$ из $x_2,\dots,x_{n-2}$ есть пара $x_j$, %что 
%$x_{i}+x_{j}=x_{n-1}$.
%Отсюда $x_{i}+x_{n-1-i}=x_{n-1}$ для каждого $i$.
%Однако в этом случае $x_{(n-1)/2}$ парно самому себе, 
%и пара $x_{n-1}$, $x_{(n-1)/2}$ является решением нашей задачи %--- противоречие.
%\heart 

Предположим, что множество $X$ из чисел $x_1 < x_2 < \ldots < x_{25}$ даёт контрпример.
Поскольку суммы $x_{25} + x_1$, $x_{25} + x_2,\dots, x_{25} + x_{24}$ не принадлежат $X$,
соответствующие разности должны принадлежать $X$,
и, значит,
\(x_1 + x_{24} = x_2 + x_{23} = x_3 + x_{22}  =\ldots = x_{12} + x_{13} = x_{25}.\)

%с этим расхождением согласен Питер, в оригинале была небольшая ошибка: https://github.com/anton-petrunin/test/wiki

Заметим, что суммы $x_{24} + x_2$, $x_{24} + x_3,\dots$ превосходят $x_{25}$, а значит, они опять не принадлежат $X$, а
соответствующие разности принадлежат $X$.
Разность
$x_{24} - x_{23}$ может равняться только $x_1$, и, значит, числа от
$x_2$ до $x_{22}$ разбиваются на пары:
\[x_2 + x_{22} = x_3 + x_{21} = x_4 + x_{20} =\ldots\hm= x_{11} + x_{13} = x_{24}.\]
Но число $x_{12}$ остаётся без пары, что приводит к противоречию и тем самым к решению головоломки\footnote{Число 25 можно заменить любым нечётным числом $n> 3$ (при $n=3$ множество $\{1,2,3\}$ даёт контрпример).
Если $n$ чётно, то доказательство проще. "--- \emph{Прим. пер.}}.
\heart


% \medskip
% В доказательстве число 25 можно заменить любым нечётным числом $n> 3$ (при $n=3$ множество $\{1,2,3\}$ даёт контрпример).
% Если $n$ чётно, то доказательство проще.



\subsubsection*{Производство дробей}% (GENERATING THE RATIONALS) 

В первую очередь заметим, что множество $S$ содержит все двоично"=рациональные числа, 
то есть дроби вида $p/2^n$: все такие числа со знаменателем $2^n$ и нечётным числителем можно получить, взяв среднее значение двух соседних чисел со знаменателями меньшей степени.

Любая дробь $p/q$, очевидно, является средним $p$ единиц и $q-p$ нулей.
Выберем $n$ достаточно большим и заменим все нули на $1/2^n$, $-1/2^n$, $2/2^n$, $-2/2^n$, $3/2^n$ и так далее, включая один $0$, если $q-p$ нечётное.
Подобным же образом заменим единицы на $1-1/2^n$, $1+1/2^n$, $1-2/2^n$, $1+2/2^n$ и так далее.
Конечно, некоторые из этих чисел находятся вне единичного отрезка, но можно провести то же рассуждение для интервала между двоично"=рациональными числами, содержащего $p/q$ и лежащего строго в единичном отрезке.%(rescale the procedure to fit some dyadic interval)
\heart


\medskip
{% \small
Источник: XIII Всесоюзная математическая олимпиада%
\footnote{% \cite[№272]{VsMO}, \emph{Там же}.
\VsMO. Задача №272, автор  М.",И.",Серов. "--- \emph{Прим. ред.}}, Тбилиси, 1979.

}

\subsubsection*{Суммирование дробей}%СУММИРОВАНИЕ ДРОБЕЙ ( SUMMING FRACTIONS ) 

Проведём доказательство по индукции, заметив, что утверждение верно при $n=2$.
При переходе от $n$ к $n+1$ мы добавляем $1/pn$ для каждого такого $p$, что $\text{НОД}(p,n)=1$, и теряем $1/pq$ для таких пар $p$ и $q$, что $\text{НОД}(p,q)=1$ и $p+q=n$.

Если $p+q=n$, то
$\text{НОД}(p,q)=\text{НОД}(p,n)=\text{НОД}(q,n)$.
Значит, каждая потерянная пара $(p,q)$ соответствует двум добавленным парам $(p,n)$ и $(q,n)$.
Поскольку $1/pn+1/qn=1/pq$, прибавляемые величины в точности равны вычитаемым, то есть сумма не меняется.
\heart

\medskip
{% \small
Источник: III Всесоюзная математическая олимпиада%
\footnote{% \cite[№120]{VsMO}
\emph{Там же}. Задача №120, автор не указан. "--- \emph{Прим. ред.}}, Киев, 1969. 

}

\subsubsection*{Вычитания по кругу}%ВЫЧИТАЯ ПО КРУГУ (SUBTRACTING AROUND THE CORNER) 

Один внештатный преподаватель математики старших классов (средняя школа в Фер Лон, Нью-Джерси, 1962)
%(Fair Lawn Senior High School) 
рассказывал мне, что военнопленные Второй мировой войны развлекались
тем, что брали различные наборы из четырёх чисел и смотрели, как долго
они могут прокручивать эту операцию.

\medskip

Обе задачи решаются рассмотрением процесса по модулю 2.
Для $n=4$ с точностью до циклических перестановок и симметрий наборы
1 0 0 0 
и
1 1 1 0 переходят в
1 1 0 0, затем в
1 0 1 0, затем в
1 1 1 1 и затем в
0 0 0 0.
Поскольку здесь охватываются все случаи, мы видим, что при работе с обычными целыми числами нам понадобится не более 4 шагов, чтобы все они стали чётными, и на этом этапе, до того как продолжить далее, можно поделить их на двойку в наибольшей общей степени.
Так как самое большое в последовательности число~$M$ не может увеличиваться и уменьшается в два раза или более хотя бы один раз за каждые четыре шага, 
мы приходим к 
0 0 0 0 
максимум за $4(1+\lceil\log_2 M\rceil)$ шагов.

С другой стороны, при $n=5$ последовательность 
1 1 0 0 0
(рассматриваемая как последовательность вычетов по модулю~$2$ или обычных чисел)
проходит по циклу 
1 0 1 0 0, 
1 1 1 1 0, 
1 1 0 0 0.\heart 

\medskip
Несложный анализ, использующий многочлены над целыми числами по модулю два, показывает, что всё зависит от того, является ли $n$ степенью двойки.
%
Если не требовать, чтобы числа были целыми, то, как это ни удвивтельно, последовательность из четырех действительных чисел, для
которой процесс не заканчивается, является единственной с точностью до
очевидных преобразований; это показали Антонио Бен, Крис Крибс-Залета
и Вадим Пономаренко.

\begin{addedbytheeditors}
Эта задача приводится в «Сборнике задач Московских математических олимпиад»\footnote{% \cite[№257, с. 73]{sbornikM}
\emph{А. А. Леман}. Сборник задач московских математических олимпиад. М.:~Просвещение, 1965. С. 73, задача №257.}, где предлагаются два решения методом спуска.
Похожая задача предлагалась в 1961 году на Московской математической олимпиаде (№10.5). 
Каждое из решений обобщается на случай, когда $n=2^k$.

Например, чтобы доказать, что после некоторого шага все числа станут чётными, достаточно проводить все рассуждения по модулю~$2$.
Тогда модули можно отбросить, а разности  заменить суммами.
После двукратного применения процедуры (тройка последовательных чисел $(x,y,z)$ сначала даст пару $(x+y,y+z)$, которая затем даст число $x+2y+z\equiv x+z \pmod{2}$) процесс сводится к аналогичным  процедурам, которые независимо делаются над числами с чётными и с нечётными номерами. В каждом случае чисел становится в 2 раза меньше, что позволяет решить задачу по индукции.
"--- \emph{Прим. ред.}
\end{addedbytheeditors}


\subsubsection*{Прибыли и убытки}%ПРИБЫЛИ И УБЫТКИ (PROFIT AND LOSS) 

Данная головоломка представляет собой адаптированный вариант задачи с Международной математической олимпиады 1977 года,
предложенной одним вьетнамским автором.
Мне её рассказал Титу Андрееску, %(Titu Andreescu), 
за что я ему очень благодарен.
Решение, однако, моё собственное.

\medskip

Нам нужна такая последовательность чисел
максимальной длины, что сумма чисел каждой подстроки длины 8 больше нуля, а сумма чисел каждой подстроки длины 5 меньше нуля.
Строка должна быть конечной "--- длиной меньше
40, иначе  сумму первых 40 членов было бы можно выразить и как (положительную) сумму 5 подстрок длины 8, и как (отрицательную) сумму 8 подстрок длины 5.

Решим эту задачу в более общем виде.
Пусть $f(x,y)$ "---
длина максимальной строки, для которой сумма каждой $x$"=подстроки
положительна, а сумма каждой $y$"=подстроки отрицательна.
Можно
предположить, что $x>y$.
Если $x$ кратно $y$, то $f(x,y)=x-1$
(если $x$-подстрок нет, то любое утверждение про них верно).
% (мы должны согласиться, что это утверждение верно по отношению к $x$"~подстрокам за отсутствием таковых).

А что, если $y=2$ и $x$ нечётно?  Тогда можно построить строку длины
$x$ с чередующимся элементами, скажем, $x-1$ и $-x$.
Однако такой
строки длины $x+1$ не существует.
Действительно, в каждой
$x$"~подстроке каждый нечётный элемент должен быть положительным (так
как можно покрыть всю $x$"=подстроку 2-подстроками, за исключением
произвольного нечётного элемента).
Применив это соображение к двум
$x$"=подстрокам, мы получим, что все элементы положительны "---
противоречие.

Обобщая это pассуждение, можно получить, что $f(x,y)\le x+y-2$, если $x$ и $y$ взаимно просты.
Докажем это по индукции.
От противного: пусть $f(x,y)\ge x+y-1$,
то есть имеется строка длины $x+y-1$, удовлетворяющая указанным условиям.
Положим $x=ay+b$, где $0\z<b\z<y$.
Рассмотрим подстроку из последних $y+b-1$ чисел в строке.
Заметим, что каждая $b$"=подстрока в ней 
может быть представлена как $x$"=подстрока полной строки, 
из которой исключены $a$ подстрок длины~$y$; 
следовательно, сумма в любой такой $b$"=подстроке положительна.
Поэтому
$f(b,y)\ge y+b-1$,
что противоречит предположению индукции, поскольку $y$ и $b$ взаимно просты и $b<y<x$. %Питер согласен.

Чтобы показать, что $f(x,y)=x+y-2$, когда $x$ и $y$ взаимно просты, 
построим $(x+y-2)$-строку, обладающую требуемыми свойствами.
%
Числа нашей строки будут принимать ровно два различных значения $u$ и
$v$, а сама строка будет периодической с двумя периодами, $x$ и~$y$.

Представим себе, что мы расставили $u$ и $v$ произвольным образом в
первой $y$"=подстроке.
Продолжим расстановку, чтобы строка стала
периодической с периодом $y$.
Чтобы добиться и периода $x$, нам нужно
обеспечить, чтобы последние $y-2$ элемента соответствовали первым.
Это условие можно записать как $y-2$ условия на $y$ чисел, выбранных
нами изначально.
% Поскольку этих равенств недостаточно, чтобы заставить все решения быть одинаковыми,
При таких ограничениях можно гарантировать, что
существует по меньшей мере одно $u$ и одно $v$.

Проделаем это, например, для $x=8$ и $y=5$.
Пусть $c_1\dots c_5$ "---
первые пять элементов строки; тогда вся строка будет выглядеть как
$c_1c_2c_3c_4c_5c_1c_2c_3c_4c_5c_1$.
Чтобы строка была
периодичной с периодом 8, нужно потребовать, чтобы выполнялись
равенства $c_4=c_1$, $c_5=c_2$ и $c_1=c_3$.
Значит, можно считать,
что $c_1=c_3=c_4=u$ и $c_2=c_5=v$; тем самым получается
последовательность $uvuuvuvuuvu$.

Возвращаясь к задаче в общем виде, заметим, что в строке с периодом
$x$ суммы всех $x$"=подстрок одинаковы: каждый раз, когда вы
сдвигаете $x$"=подстроку на один шаг, элемент, добавленный на одном
конце, будет таким же, как и элемент, удалённый на другом.
Это же верно и для $y$"=подстрок, если строка периодична с периодом $y$.

Пусть $S_x$ "--- сумма всякой $x$"=подстроки, а $S_y$ "---
сумма всякой $y$"=подстроки.
Заметим, что $S_x/x\ne S_y/y$.
В самом деле, если $u$ встречается в каждой$x$"=подстроке, скажем, $p$ раз, а $v$ в каждой $y$"~под\-строке "--- $q$ раз, то равенство $S_x/x=S_y/y$означает, что
\[y(pu+(x-p)v)=x(qu+(y-q)v)\]
а это равенство сводится к $yp=xq$, так как $u\ne v$.
Поскольку $x$ и $y$ взаимно просты, этого не может быть при $0<p<x$ и $0<q<y$.

Отсюда следует, что можно подобрать $u$ и $v$ так, чтобы сумма $S_x$ была положительна, а $S_y$ отрицательна.
Например, в случае, рассматриваемом выше, каждая 8-подстрока содержит пять $u$ и три $v$, 
а в свою очередь, каждая 5-подстрока имеет три $u$ и две $v$.
Если взять $u\z=5$ и $v\z=-8$, то получим $S_x=1$ и $S_y=-1$.
Итак, решением исходной задачи будет последовательность $5,-8,5,5,-8,5,-8,5,5,-8,5$.
\heart

\medskip
Усердный читатель легко обобщит вышеприведённое доказательство на случай, 
когда наибольший общий делитель $x$ и $y$ отличен от~1.
В результате получится, что $f(x,y)=x+y-1-\text{НОД}(x,y)$.

\begin{addedbytheeditors}
Есть похожая по духу задача Н.",Н.",Константинова\footnote{% \cite[№~73652]{problems}
Задачник <<Кванта>>, М117 (Квант. 1971. №12. C 62--64).}"--- \emph{Прим. ред.}
\end{addedbytheeditors}


\subsubsection*{Первое по алфавиту нечётное число}

Первое слово будет, конечно, \emph{восемнадцать}, а первое идущее за ним слово "--- \emph{миллионов}.
Итак, искомое число должно начинаться с <<восемнадцать миллионов>>.
Продолжая в том же духе, получаем окончательный ответ: 18~018~089 "--- \emph{восемнадцать миллионов восемнадцать тысяч восемьдесят девять}%
\footnote{Ответ в задаче на английском языке выглядит похоже: 8~018~018~885 "--- \emph{eight billion eighteen million eighteen thousand eight hundred eighty-five}.}.
\heart

\medskip
Идея этой забавной задачи пришла ко мне после того, как Херб Уилф из Пенсильванского университета %(Herb Wilf, University of Pennsylvania) 
попросил меня назвать первое по алфавиту \emph{простое} число.
Автором этого вопроса считается компьютерный гуру из Стэндфордского университета Дональд Кнут. %(Donald Knuth, Stanford University).
Рассуждая так же, как и выше, с проверкой простоты числа на компьютере
получаем, что ответ равен\footnote{На английском языке это будет число 8~018~018~881 "--- \emph{eight billion eighteen million eighteen thou\-sand eight hundred eighty-one}.
%на французском 5?
%%% нет, 105
%на немецком 8 808 808 803?
} 18~018~881.

\begin{addedbytheeditors}
Предложенный русский вариант задачи получился несколько проще английского оригинала.
Чтобы приблизить его по сложности, можно ограничиться числами, не превосходящими $10^{11}$.

Заинтересованный читатель может попробовать решить задачу на других языках.
На немецком ответ выглядит похоже, а на французском он, скорее всего, разочарует.
"--- \emph{Прим. ред.} 
\end{addedbytheeditors}

%%% \input{combinatorics.tex}

\chapter{Комбинаторика}
%  \addcontentsline{toc}{chapter}{Комбинаторика}

\thispagestyle{empty}

\setlength{\epigraphwidth}{.5\textwidth}
\epigraph{Ложь имеет бесконечное число комбинаций,
тогда как правда бывает только одна.\vspace{1ex}}{Жан-Жак Руссо}
 
Если задача начинается со слов «Сколько существует способов...», то
это точно задача по комбинаторике, но обратное
неверно.
Комбинаторный подход  полезен при решении
как нижеследующих (довольно разнообразных) задач, так и многих других
в этой книге.

Наша вводная задача совершенно классическая и использует основной
принцип комбинаторики: <<правило умножения>>.

\subsection*{Расстановка цифр}% (Sequencing the Digits)
\rindex{Расстановка цифр}

Сколькими способами можно записать в ряд цифры от 0 до 9, так, чтобы
каждая цифра, кроме самой левой, отличалась от одной из цифр, стоящих
слева от неё, на единицу.

\paragraph{Решение} 
На первый взгляд кажется, что данная задача с помощью правила
умножения не решается, так как число вариантов зависит от того, что
выбрано на предыдущих шагах.
Например, у нас есть десять вариантов
для самой левой цифры, но, начав ряд, скажем, с 3, мы получаем только
два варианта для следующей цифры; если же мы начинаем с 0 или 9, то у
нас только один вариант.
Если вы знаете, как суммировать биномиальные
коэффициенты, то сможете построить на этом решение задачи, но есть
лучший способ.

Заметим, что ряд заканчивается нулём или девяткой, и если
мы движемся \emph{справа налево}, то каждый раз мы стоим перед выбором
"--- написать наибольшую неиспользованную цифру или наименьшую, пока
не дойдём до левого края, где эти два варианта
совпадают.
Таким образом, получаем два варианта
на каждом из девяти
мест.
Отсюда ответ: $2^9=512$ способов.\heart

\medskip
{% \small 
Источник: олимпиада Патнема 1960-х годов.
Другие решения можно найти в статье Сола Голомба\footnote{\emph{S. Golomb}. The fifteen billiard balls---a case study in combinatorial problem solving /\!/ Math. Mag. 1985. Vol.~58, no. 3. P.~156--159.}.


}
\medskip

Остальные задачи решать вам.
Подсказка: смотрите внимательно, где можно применить принцип Дирихле!

\subsection*{Подмножества подмножеств}% (Subsets of subsets)
\rindex{Подмножества подмножеств}

Докажите, что любое множество из десяти различных чисел от 1 до 100 содержит два непересекающихся непустых подмножества, сумма элементов которых одинакова.

\subsection*{Вредный метрдотель}% (The Malicious Maitr D’)
\rindex{Вредный метрдотель}

На банкете математической конференции 48 математикам, ни один из которых не знает, как вести себя в ресторане, назначены места за большим круглым столом.
На столе между каждой парой приборов стоит кофейная чашка с салфеткой.
Как только человек занимает своё место (по указанию метрдотеля), он берёт салфетку слева или справа от себя; если и справа, и слева от него есть салфетка,
он выбирает одну случайным образом (метрдотель не видит, какую именно).

В каком порядке метрдотель должен рассаживать гостей, чтобы максимальному числу математиков не досталось салфетки?

\subsection*{Рукопожатия на приёме}% (Handshakes at a Party)
\rindex{Рукопожатия на приёме}

Майк и Жанна, а также ещё четыре пары побывали на праздничном обеде, где каждый из присутствующих обменялся рукопожатием с каждым ему дотоле незнакомым гостем.
Позже Майк опросил всех и обнаружил, что каждый из девяти остальных гостей пожал руки разному числу людей.

Со сколькими гостями обменялась рукопожатиями Жанна?

\subsection*{Выбор из трех кандидатов}% (Three-Way Election)
\rindex{Выбор из трех кандидатов}

Ашфорд, Бакстер и Кэмпбелл баллотируются на пост председателя союза %(secretary of union) 
и набирают одинаковое числе голосов.
Для разрешения этой ситуации они провели голосование, при котором каждый из голосующих указывал не только <<своего>> кандидата, но и запасного "--- того, кого он хотел бы видеть на месте председателя, если предпочитаемый им кандидат не походит. Увы, и при этом голосовании голоса как за основного, так и за запасного кандидатов разделились строго поровну.
Тогда Ашфорд предлагает (число избирателей нечётное) провести выборы в два этапа: избиратели выбирают между Бакстером и Кэмпбеллом, а затем между победителем и Ашфордом.

% {\looseness1\par}

Но Бакстер недоволен данным предложением.
Он считает этот способ несправедливым, потому что, по его мнению, у Ашфорда больше шансов выиграть, чем у остальных.
Прав ли Бакстер?

\subsection*{Зарплата короля}% (King’s Salary)
\rindex{Зарплата короля}

После революции каждый из 66 граждан некоторой страны, включая короля, получает зарплату в 1 доллар.
Король не может больше голосовать, но сохраняет право ставить на голосование предложение об изменении зарплат.
Зарплата каждого должна быть целым числом долларов, и сумма
всех зарплат должна равняться 66.
Каждое предложение по изменению ставится на голосование и принимается, если получает больше голосов «За», чем «Против».
Будем считать, что те, кто получают прибавку к зарплате, голосуют «За», а те, у кого зарплата уменьшается, "--- «Против», остальные же голосованием себя не утруждают.

Король "--- человек умный и корыстный.
Какой максимальной зарплаты для себя он сможет добиться и сколько
голосований ему для этого понадобится?

\subsection*{Бестолковые часы}% (A Poorly Designed Clock)
\rindex{Бестолковые часы}

Есть часы, у которых минутная стрелка никак не отличается от часовой.
Сколько раз в сутки возникает ситуация, когда по этим часам невозможно определить время?

\subsection*{Таинственный карточный фокус}% (A Mystifying Card Trick )
\rindex{Таинственный карточный фокус}

Давид и Дороти придумали хитрый карточный фокус.
Давид отворачивается, кто-нибудь выбирает пять карт из колоды для
бриджа\footnote{52 карты. "--- \emph{Прим. ред.}} и даёт их Дороти; она просматривает карты, вытаскивает одну и передаёт оставшиеся карты Давиду.
Давид правильно называет вытащенную Дороти карту.

Как они это делают?
На какой наибольшей колоде можно демонстрировать их фокус?

\subsection*{Коммивояжёры}% (Travelling Salesmen )
\rindex{Коммивояжёры}

Будем считать, что для любой пары городов России цена авиаперелета из
одного в другой всегда одна и та же; цена полета <<туда>> и
<<обратно>> одинакова.
Коммивояжёр Жмоткин начинает свою поездку по
всем большим городам из Москвы и всегда выбирает самый дешёвый перелёт
до города, который он ещё не посещал.
(Возвращаться именно в Москву
не обязательно.)  Коммивояжёру Щедрину также нужно посетить каждый
город, но он начинает свою поездку в Калининграде и каждый раз
выбирает самый дорогостоящий перелёт до города, в котором он ещё не
побывал.

Докажите, что поездки Щедрина стоят в сумме не меньше, чем поездки Жмоткина.

\subsection*{Проигрыш в кости}% (Losing at Dice)
\rindex{Проигрыш в кости}

При броске шести кубиков количество различных выпавших чисел может быть от 1 до 6.
Предположим, что каждую минуту крупье бросает шесть кубиков
и вы ставите 1 доллар на то, что выпадет ровно 4 различных числа
(вы получаете 1 доллар, если выигрываете, и теряете 1 доллар, если проигрываете).

Вы начинаете игру с 10 долларами.
Оцените приблизительно, сколько вы в среднем продержитесь до разорения.

%%% \input{combinatorics-sol}

\section*{Решения и комментарии}

\subsubsection*{Подмножества подмножеств}% (Subsets of subsets)

Хитрость в данной задаче, основанной на одном из заданий Международной
математической олимпиады 1972 года, заключается в том, чтобы рассматривать не только непересекающиеся
подмножества.

\medskip

Множество $S$ из $10$ элементов содержит, разумеется, $2^{10} - 1 \z=
1023$ непустых подмножества.
Могут ли все суммы чисел этих
подмножеств быть различными?  Максимальная сумма элементов множества
из десяти чисел от 1 до $100$ будет составлять
$100+99+\hm\ldots\hm+91\hm<1000$, а минимальная, очевидно, равна 1;
таким образом, согласно принципу Дирихле должны существовать два
различных подмножества $A\subset S$ и $B\subset S$ с одинаковой
суммой.
Конечно, $A$ и $B$ могут пересекаться, но их общие элементы
можно удалить: $A\backslash B$ (множество элементов $A$, не
содержащихся в $B$) и $B\backslash A$ уже не пересекаются и
по-прежнему имеют одинаковую сумму элементов.\heart

\begin{addedbytheeditors}
Ноам Элкис заявил%
\footnote{\url{http://djm.cc/rpa-output/combinatorics/subsets.s}}, что подобным рассуждением можно доказать, что 9 элементов тоже достаточно.
Правильность этого утверждения несложно проверить полным перебором на компьютере.
Существуют десятки тысяч примеров с 8 элементами, например $\{40,60,71,77,80,82,83,84\}$. 

Задача имеет следующее естественное обобщение.
Пусть $L_n$ обозначает такое минимальное натуральное число,
что в отрезке натурального ряда от $1$ до $L_n$ можно выбрать множество из $n$ чисел для которого все $2^n$ подмножеств имеют различные суммы\footnote{%  \cite[A276661]{oeis} OEIS (Онлайн-энциклопедия целочисленных последовательностей).
\url{https://oeis.org}. Последовательность A276661.}.
Поскольку у последовательности $1,2,\dots, 2^{n-1}$ суммы подмножеств различны, получаем, что $L_n\le 2^{n-1}$.
Приведённое решение даёт оценку $L_n\ge 2^n/n$.
Известная гипотеза Пола Эрдёша\footnote{См. C8 в кн.: \emph{R. Guy.} Unsolved problems in number theory. New York: Springer-Verlag, 2004.} состоит в том, что $L_n>c\cdot 2^n$ для некой положительной постоянной~$c$.
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Вредный метрдотель}% (The Malicious Maitr D’)

Появление данной задачи связано со следующим событием:
30 марта 2001 года принстонский математик Джон Хортон Конвей %(John H. Conway) 
прибыл в Bell Labs, %(Bell Labs) 
чтобы сделать доклад на общенаучном семинаре. %(“General Research Colloquium”).
На обеде ваш автор оказался сидящим за столом между Конвеем и специалистом по компьютерным технологиям Робом Пайком %(Rob Pike) 
(в дальнейшем работал в Гугле), а салфетки и кофейные чашки были расставлены точно так же, как описано в задаче.
Конвей задался вопросом, сколько человек из
сидящих за столом остались бы без салфеток, если бы их рассаживали в случайном порядке (см. предпоследнюю главу), а Пайк сказал: «Вот более лёгкий вариант: а какой порядок самый плохой?»

\bigskip

Допустим, что метрдотель, когда сажает человека на место, видит, какую
салфетку он взял (специалисты по computer science сказали бы, что в этом случае метрдотель действует как \emph{адаптивный противник}). %(“adaptive adversary”) 
Тогда лучшая для него стратегия состоит в следующем:
если первый гость возьмёт салфетку, скажем, справа от себя, то следующий будет посажен через место справа от первого, так что тот, кто окажется между ними, может остаться ни с чем.
Если второй гость берёт салфетку справа, то метрдотель поступает аналогично, пропуская одно место справа.
Если же второй гость возьмёт салфетку слева (оставляя, таким образом, место между ним и первым посаженным без салфеток), то третий сажается непосредственно справа от второго.
Далее гостям указываются места по этому правилу, пока круг не замкнётся, и тогда последние обедающие (обречённые остаться без салфеток) садятся за стол.
В~результате в среднем $1/6$ часть гостей остаётся без салфеток.

Когда же, как в поставленной задаче, метрдотель адаптивным противником не является, то, как показалось Пайку и мне, правильной стратегией было бы заполнить сначала все чётные, а затем нечётные места.
Для каждого нечётного гостя вероятность остаться без салфетки будет равна $1/4$, %(for an overall yield) 
а конечным результатом будет $1/8$ (то есть в среднем 6 из 48 обедающих).

Впрочем, если подумать ещё немного, то наилучшая стратегия для метрдотеля "--- заполнить сначала места с номерами, делящимися на 4, затем места с нечётными номерами, и только потом "--- все остальные.
Это огорчит в среднем $9/64$ гостей.
Чтобы понять это, назовём гостя \emph{одиноким}, если, когда он посажен на место, у него ещё нет соседа ни справа, ни слева.
Можно считать, что все одинокие гости рассаживаются первыми, и заметить, что между каждыми двумя последовательными одинокими гостями будет максимум один бессалфеточный гость.

Допустим, два последовательно сидящих одиноких гостя находятся на
расстоянии $d$ друг от друга (то есть между ними $d-1$ спустых тульев).
Эти места будут заполняться с обеих сторон.
Предположим, что последний садящийся между ними человек находится на расстоянии $a$ от левого и на расстоянии $b$ от правого одинокого гостя, где $a+b=d$.
Правая салфетка будет уже взята, если только сидящий справа одинокий
гость и все гости между ними не выбрали правые салфетки.
Это случается с вероятностью $1/2^a$.
Таким образом, наш
гость проигрывает (остаётся без салфетки) с вероятностью
\[(1-2^{-a})(1-2^{-b})=1 + 2^{-d}-2^{-a}-2^{-b},\]
которая минимальна, когда $a$ и $b$ равны или отличаются на 1.

Если одинокие гости рассажены на расстоянии $d$ друг от друга, то мы получаем одного потенциального проигравшего на $d$ человек.
Таким образом, если число гостей $n$ кратно $d$, то среднее число проигравших равно $(n/d)(1-2^{-\lfloor d/2\rfloor})(1-2^{-\lceil d/2\rceil})$.
Легко проверить, что эта величина достигает максимума не при $d=2$, где она будет равна $n/8$, а при $d=4$, где получаем $9n/64$.
\heart

\subsubsection*{Рукопожатия на приёме}% (Handshakes at a Party)

Это задача на старую избитую тему "--- на первый взгляд нам кажется, что предоставлено недостаточно информации.
Почему можно сказать что-то о \emph{Жанне}? 
Потому что Жанна в паре с тем, кто не принимал участия в опросе.

Так как для каждого гостя максимальное число рукопожатий равно 8, 
девять ответов, полученных Майком, "--- это как раз числа от 0 до 8.
Два человека (скажем, $A$ и $B$), ответившие 0 и 8, должны быть парой,
иначе и наличие, и отсутствие рукопожатия между ними противоречило бы одному из их ответов.
Теперь проверим $C$ и $D$, которым соответствуют 1 и 7;
поскольку $C$ должен был пожать руку гостю~$B$, а $D$ не пожимал руку гостю~$A$, применяя такое же рассуждение, получаем, что $C$ и $D$ также являются парой.

% {\looseness1\par}

Аналогично гости, ответившие 2 и 6, 3 и 5,
также должны быть парами.
Легко видеть, что при этом и Майк, и Жанна в каждой из
остальных пар пожимали руки тому из гостей,
у кого количество рукопожатий больше, то есть каждый из них пожал руку
четверым. \heart

\medskip
Если вы не нашли доказательства, но догадались, что ответ "--- 4, то
ваша интуиция была права.
В самом деле, если предположить, что задача
имеет единственный ответ (скажем $x$), то можно получить равенство
$x=4$ из соображений симметрии.
Именно, если бы заодно члены каждой
пары пожали руки друг другу, то получится, что и Майк, и Жанна пожали
по~$x+1$ рук. Если при этом Майк спросит каждого, скольким гостям тот
\emph{не} пожал руку, то мы вернёмся к ситуации, описанной в исходной
задаче, так что ответ Жанны опять будет~$x$. Стало быть, $x+(x+1)=9$.

То, что головоломка имеет единственное решение, часто оказывается полезным.
В одной из своих «Математических игр» для \emph{Scientific American} Мартин Гарднер спросил:
Предположим, что в шаре (через центр) высверлено отверстие длиной 6 дюймов;
чему равен объём оставшейся части шара?

Кажется, что ответ зависит диаметров отверстия и/или шара, но это не так.
Чем больше шар, тем шире должно быть отверстие длиной 6 дюймов,
а вычисления показывают, что объём оставшегося тела всегда один и тот же.
% 
Однако нет необходимости делать эти вычисления, если поверить автору
задачи, что объем от диаметров шара и отверстия не зависит. В этом
случае 
ответ должен быть тот же, что для шара диаметром 6 дюймов и вообще
без отверстия, то есть $\tfrac43 \pi \cdot 3^3=36\pi$ кубических дюймов.

\subsubsection*{Выбор из трех кандидатов}% (Three-Way Election)

Бакстер более чем прав: 
если никто из голосующих не изменит своих предпочтений, то
Ашфорд выигрывает всегда!
В самом деле, предположим, что избиратели, голосовавшие за Ашфорда,
предпочитают Бакстера Кэмпбеллу (то есть Бакстер выиграет у Кэмпбелла в
первом туре предложенных выборов).
Тогда избиратели, голосовавшие за Бакстера, должны предпочитать
Кэмпбелла Ашфорду, иначе Кэмпбелл не набрал бы $1/3$ голосов второго выбора.
Аналогично избиратели, голосовавшие за Кэмпбелла, предпочитают Ашфорда
Бакстеру.
Таким образом, в нашем случае Ашфорд побеждает Бакстера во втором
туре.

Если же избиратели, голосовавшие за Ашфорда, предпочитают Кэмпбелла Бакстеру, то симметричное рассуждение приводит нас к тому же результату "--- во втором голосовании побеждает Ашфорд.
\heart

\medskip
Эту задачу придумал Эхуд Фридгут %(Ehud Friedgut)
для занятий со студентами;
она показывает, что не так-то просто устроить честный тай-брейк!

\begin{addedbytheeditors}
Так называемая <<теорема Эрроу о диктаторе>> гласит, что если
кандидатов по крайней мере трое, то при некоторых ограничениях систему
выборов нельзя построить в принципе. "--- \emph{Прим. ред.}
\end{addedbytheeditors}

\subsubsection*{Зарплата короля}% (King’s Salary)

Данная задача придумана Йоханом Вестлундом %(Johan Waestlund) 
из Линчёпингского университета; её сюжет напоминает (отдаленно)
реальный эпизод из истории Швеции.

Вот две ключевые идеи: (1) для начала король должен временно
отказаться от зарплаты; (2) на каждом шаге следует уменьшать число граждан, получающих зарплату.

Король начинает с того, что предлагает удвоить зарплату
(с одного доллара до двух) $33$ гражданам, а остальным $33$, включая
его самого, зарплату не платить.
Затем он увеличивает зарплату $17$ из $33$ получающих ее избирателей
(они получат по $3$ или $4$ доллара), а остальным $16$ устанавливает
нулевую зарплату.
На каждом последующем шаге число голосующих граждан сводится
уменьшается до $9$, $5$, $3$ и $2$.
На последнем шаге король подкупает троих граждан, зарплаты не
получающих, зарплатой в $1$ доллар каждому, для того чтобы они помогли ему перевести две большие зарплаты на него самого, и, таким образом, завершает игру с королевской зарплатой в $63$ доллара.

Нетрудно заметить, что на каждом этапе король не может предпринять
ничего лучшего, чем уменьшать количество избирателей с зарплатой до
наименьшего числа, превышающего половину от предыдущего количества.
В частности, он не сможет сократить количество избирателей, получающих
зарплату, до единицы.
Стало быть, $63$ доллара "--- это лучшее, чего он сможет добиться, и оптимальное число голосований равно~$6$.
\heart

\medskip

В более общем случае, если количество граждан равно $n$, король может добиться зарплаты в $n-3$ доллара за $k$ шагов, где $k$ "--- наименьшее целое число, большее или равное $\log_2(n-2)$.

\subsubsection*{Бестолковые часы}% (A Poorly Designed Clock)

Энди Латто, инженер"=программист из Бостона, представил эту красивую задачу в Атланте, на конференции «Gathering for Gard\-ner IV», одной из серии конференций в честь Мартина Гарднера.
При достаточном терпении и внимательности задачу можно решить алгебраическим или геометрическим способом, но есть замечательное доказательство без карандаша и бумаги, предложенное Майклом Ларсеном, %(Michael Larsen)
профессором математики из Индианского университета.
Идею третьей стрелки (вместо вторых часов) подсказал Дэвид Гейл. %(David Gale)

\medskip

Чтобы эта задача имела какой-то смысл, нам надо предположить, что стрелки движутся непрерывно и что
мы не различаем время <<пополудни>>  и <<пополуночи>> (скажем,
полпятого вечера и полпятого утра).
Обратим также внимание, что если стрелки совпадают, то мы знаем,
который час, даже не зная, какая стрелка минутная, а какая часовая.
Такое совпадение случается $22$ раза в сутки, так как за сутки минутная стрелка делает полный оборот $24$ раза, а часовая "--- $2$ раза в том же направлении.

Представим теперь, что мы добавили к часам третью, <<быструю>>,
стрелку, которая начинает двиаться в полночь и движется ровно в $12$
раз быстрее, чем минутная. 

Мы утверждаем, что всякий раз, когда часовая и быстрая стрелка
совпадают, часовая и минутная стрелка находятся в <<неопределённом>>
положении (то есть невозмножно, глядя на них, понять, кто из них
часовая, а кто минутная).
Почему?
Потому что когда минутная стрелка пройдёт в $12$ раз больше,
чем она успела пройти с полуночи, она окажется там, где быстрая
стрелка (а следовательно, и часовая) находится в данный момент; в этот
же момент часовая стрелка окажется там, где сейчас находится минутная.
По тем же соображениям верно и обратное утверждение: все неопределённые положения случаются тогда, когда часовая и быстрая стрелка совпадают.

Нам остаётся только вычислить, сколько таких совпадений происходит за сутки.
Быстрая стрелка делает $12^2\times 2 = 288$ оборотов в сутки, а часовая только два, таким образом, случается 286 совпадений.
Из них 22 раза совпадают минутная и часовая стрелки (и тем самым все
три стрелки), так что остаются 264 неопределённых момента. 
\heart

\subsubsection*{Таинственный карточный фокус}% (A Mystifying Card Trick ) 

Данный карточный фокус обычно приписывается математику Уильяму Фитчу Чейни. % (William Fitch Cheney).
Дополнительную информацию читатели могут найти в статье Майкла Клебера\footnote{\emph{M. Kleber}. The best card trick /\!/ {Math. Intell.} 2002. Vol.~24, no.~1 P.~9--11.}
или в статье Колма Малкэхи%
\footnote{\emph{C. Mulcahy}. Fitch Cheney's five card trick /\!/ {Math Horizons}. 2003. Vol.~10, no.~3. P.~10--13.}, в которой обсуждаются различные варианты этого фокуса.

\medskip

Дороти сообщает Давиду информацию через порядок четырёх карт, которые она ему передаёт.
Конечно, у нас только $4!=24$ возможные перестановки на $48$ вариантов
для пятой карты, но хитрость в том, что Дороти ещё и может выбрать, какую из пяти карт вытащить.

Самый простой способ для Дороти, который я знаю, "--- это вытащить карту той масти, которая представлена хотя бы дважды (опять принцип Дирихле!).
Предположим, что это пики, обозначим карты $x$ и $y$ (будем думать о
них как о числах по модулю 13, от~$1$ (туз) и до~$13$ (король).
В одну сторону или в другую карты отстоят друг от друга не более чем на 6;
допустим, что $x>y$ больше, так что $x-y\in {1,2,3,4,5,6} \pmod{13}$.
Таким образом, например, у нас может быть $x =3\equiv 16$ и $y = 12$ (дама пик), так что $x-y\equiv4$.

Дороти выбирает $x$, ставит $y$ первой из оставшихся четырёх карт и тремя другими картами кодирует разность $x-y$.
Для этого Дороти и Давиду надо заранее договориться, в каком порядке
идут карты в колоде. Пусть, например, в таком: 
$\clubsuit\text{Т}$,
$\clubsuit 2$,
\dots,
$\clubsuit\text{К}$,
$\Diamond\text{Т}$,
\dots,
$\Diamond\text{К}$,
$\heartsuit\text{Т}$,
\dots,
$\heartsuit\text{К}$,
$\spadesuit \text{Т}$,
\dots,
$\spadesuit \text{К}$.
Если Давид получает карты в порядке возрастания (скажем, 
$\clubsuit 5$,
$\clubsuit \text{В}$,
$\Diamond 3$; обозначим этот порядок $123$), то это будет означать, $x-y\z=1$.
Положим $x-y=2$ для порядка $132$,
$x-y=3$ для $213$, $x-y=4$ для~$231$, $x-y=5$ для $312$ и, наконец, $x-y=6$ для~$321$.

Придётся тренироваться, чтобы всё вышло без запинки.

\medskip

Заметим, что в этой схеме у Дороти может присутстввовать определенная
свобода: если в пяти картах, полученных ею, мастей представлено меньше
четырёх, то у нее есть по меньшей мере два варианта выбора карты.


Покажем, что максимальный размер колоды, с которой можно исполнить этот фокус, равен $124$. Представим, что карты
пронумерованы числами от $1$ до $n$, и
рассмотрим функцию $f$, которая каждой упорядоченной четвёрке
$(u,v,y,z)$ с попарно различными элементами сопоставляет пятую карту
$x$ "--- ту, которую Давид должен угадать, глядя на эту четвёрку.
Чтобы фокус получился, Дороти должна уметь, имея любое
пятиэлементное подмножество $S\subset {1, \dots, n}$, выбрать четыре элемента $(u,v,y,z)$ так, что
$S = \{u,v,y,z, f(u,v,y,z)\}$.
Таким образом, число всех четвёрок
должно быть по меньшей мере равно числу всех
подмножеств из пяти элементов, то есть
\[n(n - 1)(n - 2)(n - 3)\ge \binom n5,\]
откуда $n - 4 \le5!$ и, значит, $n\le 124$.


Исполнить фокус с картами, пронумерованными числами от $1$
до $124$, удивительно легко.
Вот способ, предложенный Элвином
Берлекампом.
%(Elwyn Berlekamp).
Допустим, выбраны карты $c_1 < c_2 < \ldots < c_5$;
Дороти берёт карту $c_j$, где $j$ "--- сумма значений всех пяти карт
по модулю 5.
Глядя на оставшиеся четыре карты, сумма которых равна, скажем, $s$ по модулю 5, Давид должен найти такое число
$x$, что $x\equiv -s + k \pmod 5$, если $x$ есть
$c_k$.
Иными словами, либо $x$ меньше, чем любая из карт Давида, и
удовлетворяет условию $x\equiv-s + 1 \pmod 5$, либо $x$ больше наименьшей
карты, но меньше следующей за ней и $x\equiv -s + 2 \pmod 5$; и так
далее.
Но это всё равно, что $x\equiv -s + 1 \pmod 5$,
\emph{если оставшиеся $120$ карт перенумерованы подряд числами от $1$ до $120$}.
%% , пропуская четыре карты в руках
%% у Давида.

Ровно $120/5 = 24 = 4!$ чисел от 1 до 120 имеют данное значение по модулю 5.
Поэтому, переставляя четыре карты Давида, можно закодировать все возможные значения $x$.
\heart

\begin{addedbytheeditors}
Эта задача вошла в Задачник «Кванта» ({М1644}, 1998), её автор
Григорий Гальперин.
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Коммивояжёры} %(Travelling Salesmen )

Эта задача с XI Всесоюзной математической олимпиады\footnote{% \cite[№240]{VsMO}
\VsMO. Задача №240, автор  А.",Берзиньш. "--- \emph{Прим. ред.}} в
Таллине.
Она до обидного трудна. %(annoyingly tricky)
Ясно, что Щедрин потратит не меньше денег, чем Жмоткин,
но как это доказать? %посмотреть на формулировку 

\medskip

Видимо, наилучший способ "--- показать, что $k$"~й по дешевизне
перелёт Щедрина (обозначим этот перелет через~$f$) стоит не меньше,
чем $k$"~й по дешевизне рейс Жмоткина, для любого $k$.
На первый взгляд это утверждение сильнее, чем то, что требуется доказать, однако это не так:
если бы существовал контрпример, то мы могли бы так подправить стоимость перелётов, не меняя их порядка, что Щедрин потратил бы меньше, чем Жмоткин.

Для удобства представим, что Щедрин посещает города по порядку с
запада на восток.
Пусть $F$ "--- множество $k$ самых дешёвых
перелётов Щедрина, $X$ "--- множество городов вылета этих перелетов и $Y$ "--- множество
городов прилёта  ($X$ и $Y$ могут персекаться).

Будем называть перелёт \emph{дешёвым}, если он стоит не больше перелёта $f$.
Мы хотим показать, что у Жмоткина есть по меньшей мере $k$~дешёвых перелётов.
Обратите внимание, что все перелёты на восток в из городов, входящих в
множество $X$, дешёвые; в противном случае этим рейсом летел бы Щедрин
вместо того дешёвого перелёта из множества $F$, который он в
реальности выбрал.

Назовём город \emph{хорошим}, если Жмоткин улетает из него дешёвым рейсом, и \emph{плохим} в остальных случаях.
Если все города множества~$X$ хорошие, то задача решена: рейсы Жмоткина из этих городов и составят $k$ дешёвых перелётов.
В противном случае пусть $x$ будет самым западным плохим городом в множестве $X$, тогда, когда  Жмоткин попадает в $x$, он уже побывал в каждом городе к востоку от $x$, иначе он улетал бы из $x$ дешёвым рейсом.
Но тогда в каждом городе к востоку от $x$, когда его посещал Жмоткин, был доступен дешёвый перелёт в $x$, то есть все эти города хорошие.
В частности, все города множества $Y$ к востоку от $x$ хорошие, так же как и все города множества $X$ к западу от $x$, что в сумме даёт $k$ хороших городов.
\heart

\medskip
Я благодарен Брюсу Шеперду %(Bruce Shepperd) 
из  Bell Labs 
за помощь в нахождении вышеприведённого решения.
Мы не знаем, какое решение предполагалось автором задачи%
\footnote{См. также решение задачи М459, <<Квант>> №6 за 1978 год, с. 45--46.
%%% Это НЕ авторское решение: Д.Бернштейн \ne А.Берзиньш
Аналогичное решение
% , лишь менее нагруженное символикой,
приводится в
% \cite[№240]{VsMO}
кн.: \VsMO, задача №240. "--- \emph{Прим. ред.} }.

\subsubsection*{Проигрыш в кости}% (Losing at Dice)

Конечно же, здесь есть подвох.
В среднем потребуется вечность, чтобы полностью проиграться, "--- шансы на вашей стороне! 
Я обратил на это внимание много лет назад,
при составлении домашнего задания по элементарной теории вероятностей в Университете Эмори.

При одном броске кубиков цифры могут выпасть $6^6 =46\,656$ способами.
Ровно четыре различные цифры выпадают, если либо выпало две пары
одинаковых цифр, а цифры на остальных двух кубиках различны (AABBCD), либо выпали три
одинаковые цифры, а цифры на остальных трех кубиках различны (AAABCD).
Есть
\(\binom62\cdot\binom42\,\big/\,2=45\)
способов выбрать номера кубиков, на которых выпадают пары одинаковых
цифр, в ситуации~AABBCD,  
%% вариантов первого набора, где парные и одиночные цифры
%% располагаются в алфавитном порядке, например, AABBCD, ABABCD,
%% ACDABB, но не BBAACD или AABBDC. 
и есть $\smash[t]{\binom63}=20$ выбрать номера кубиков, на которых
выпадают три одинаковые цифры, в ситуации~AAABCD.

Существует $6\cdot 5\cdot 4\cdot 3\z=360$ установить соответствие
между буквами A, B, C и~D и числами от~$1$ до~$6$, что даёт в сумме $360\cdot (45+20)=23\,400$ вариантов.
Таким образом, вероятность выигрыша равна
$23\,400/46\,656 = 50{,}154321\,\%$.
\heart

\medskip
Если вы выиграете в эту игру, не забудьте послать мне 5\,\% от суммы
выигрыша. Если вы не знаете моего адреса, то перешлите деньги через
издательство.


%%% \input{probability.tex}

\chapter{Вероятность}
% \addcontentsline{toc}{chapter}{Вероятность}

\thispagestyle{empty}

\setlength{\epigraphwidth}{.75\textwidth}
\epigraph{Человеческий мозг был создан эволюцией для решения задач, связанных с добычей пропитания в составе небольших кочевых племён в африканской саванне...
Осуждать наш разум за слабость к азартным играм "--- это всё равно, что жаловаться на то, что наше запястье плохо устроено, потому что мы не можем вытащить руку из наручников.\vspace{1ex}
}{Стивен Пинкер, «Как работает мозг» %(Steven Pinker « How the Mind Works»)
% (Ни в оригинале, ни в русском переводе О.Ю.Семиной буквально такого
%   фрагмента не находится. "--- \emph{Прим. ред.})
}

Мы сталкиваемся с теорией вероятностей каждый день.
Она является основой для изучения статистики, играющей в современном обществе огромную роль при принятии решений.
Но исторически теория вероятностей берёт своё начало в азартных играх и мысленных экспериментах, как те, что будут рассмотрены ниже.

\medskip

Вероятностные задачи могут быть катастрофически контринтуитивными.
Рассмотрим следующий разумно выглядящий вопрос.

\subsection*{Групповая русская рулетка} %( GROUP RUSSIAN ROULETTE)
\rindex{Групповая русская рулетка}

В комнате находятся $n$ сердитых вооружённых людей.
При каждом ударе часов все одновременно случайным образом
поворачиваются  и каждый стреляет в случайного человека.
Те, в кого попали, тут же падают мертвыми, выжившие опять поворачиваются и снова стреляют со следующим ударом часов.
В конце концов либо все умирают, либо остаётся один выживший.

Каков предел вероятности того, что останется выживший, при $n\to\infty$?

\paragraph{Решение} Удивительным образом, вероятность не стремится ни
к какому пределу.
При возрастании $n$ вероятность все время несильно, но меняется%
\footnote{Вероятность стремится к периодической функции от $\ln n$, имеющей период $1$.
Эта функция колеблется примерно между $0{,}477$ и $0{,}515$, см.: \emph{T.~van~de~Brug, W.~Kager, R.~Meester}. The asymptotics of group Russian roulette /\!/ {Markov Process. Related Fields}. 2017. Vol.~23. P.~35--66. "--- \emph{Прим. ред.}}, в
зависимости от дробной части натурального логарифма $n$.
(Схожий
результат описан в статье Хельмута Продингера%
\footnote{\emph{H. Prodinger}.
How to select a loser /\!/
Discrete Math. 1993. Vol.~120, no. 1--3. P.~149--159.}%
)

\medskip

Следующая задача тесно связана со знаменитым «парадоксом Монти Холла»
(см. ниже), который лет десять назад\footnote{Видимо, имеется в виду первая половина 90-х годов. "--- \emph{Прим. ред.}} породил бурю смятений и споров.

\subsection*{Обратная сторона монеты}% ( THE OTHER SIDE OF THE COIN)
\rindex{Обратная сторона монеты}

Монета, у которой обе стороны "--- решки, монета, у которой обе стороны "--- орлы, и обычная монета, кладутся в мешок.
Выберем случайным образом одну монету и подбросим ее.
Если выпала решка,
какова вероятность того, что другая сторона монеты "--- тоже решка?

\paragraph{Решение}
Очевидно, что выбранная монета либо обычная, либо «двурешечная», таким образом, у её другой стороны одинаковые шансы оказаться орлом или решкой.
Так?
Нет, неверно.

Можно думать об этом следующим образом: если монета была обычная, то
мог бы выпасть и орёл, тогда как у двурешечной выбора нет, поэтому вероятнее, что монета двурешечная.
Эта идея известна игрокам в бридж (а сто лет назад была известна игрокам в вист) как \emph{принцип ограниченного выбора}.

Чтобы было понятнее, представим, что монета подбрасывается десять раз и каждый раз выпадает орёл.
Она всё ещё может быть обычной монетой, но, скорее всего, эта монета двуорловая.
То же самое верно и после первого броска.

Один из способов подсчитать вероятность напрямую таков.
Обозначим все шесть \emph{сторон} наших монет "---
на двурешечной монете обозначим стороны Р1 и Р2, на двуорловой "--- О1 и О2, а на обычной "--- Р3 и О3.
Когда мы выбираем и подкидываем монету, шанс выпасть у каждой из шести сторон одинаковый.
Из всех трёх решек, у Р1 и Р2 на другой стороне решка, таким образом, искомая вероятность равна $2/3$.\heart

\medskip
Источник этой задачи неизвестен. Я использовал эту задачу, когда
преподавал курс элементарной теории вероятностей в Стэнфордском
университете и университете Эмори. 


% \medskip

Парадокс Монти Холла основан на телеигре «Let’s Make a Deal», в
которой участников игры (некоторых) просили выбрать одну из трёх
дверей в поисках ценного приза.
Ведущий Монти Холл, который знал, где
находился приз, открывал вместо выбранной другую дверь, за которой
приза не было.
Участникам предоставлялась возможность либо остаться с
первоначальным выбором, либо поменять свой выбор на третью дверь.
В
детстве я смотрел иногда это шоу, и помню, как примерно половина
зрителей кричала участнику: «Оставляй!», а другая половина: «Меняй!»

Конечно, дверь следует менять.
Если бы эта игра игралась 300 раз, то правильная дверь была бы выбрана с первого раза примерно 100 раз.
Остальные 200 игр выиграл бы участник, который поменял дверь!

%  \medskip

Не отчаивайтесь, если для вас это было очевидно.
Следующие задачи еще могут поколебать вашу уверенность в своей вероятностной интуиции.

\subsection*{Потерянный посадочный талон}% (THE LOST BOARDING PASS)
\rindex{Потерянный посадочный талон}

Сто человек выстроились в очередь на посадку в самолёт, но первый в очереди пассажир потерял посадочный талон и садится на случайное место.
Каждый следующий пассажир занимает место согласно своему посадочному талону, если оно свободно, либо, в противном случае, случайно выбирает любое незанятое место.

% \medskip

Какова вероятность того, что последний пассажир найдёт своё место занятым?

\subsection*{Все грани кубика}% (ROLLING ALL THE NUMBERS)
\rindex{Все грани кубика}

Сколько раз в среднем  надо бросить кубик до того, как выпадет каждая из шести цифр?

\subsection*{Нечётная череда решек}% (ODD STREAK OF HEADS)
\rindex{Нечётная череда решек}

Сколько раз в среднем надо подбросить честную монету до того, как нечётное число раз подряд выпадет решка, а затем выпадет орёл? 

\subsection*{Три кубика}% (THREE DICE)
\rindex{Три кубика}

У вас есть возможность поставить 1 доллар на число между 1 и~6.
Далее бросаются три кубика.
Если ваше число не выпадает, то вы проиграли доллар.
Если ваше число выпало на одном кубике, то выиграли 1 доллар, если на двух кубиках "--- 2 доллара, на трёх "--- 3~доллара.

% \medskip

Является ли эта ставка выигрышной, нейтральной или проигрышной? Есть
ли способ узнать это без вычислений?

\subsection*{Доллары в урнах}% (MAGNETIC DOLLARS)
\rindex{Доллары в урнах}

Миллион монет номиналом в 1 доллар распределяются по двум урнам
следующим способом: сначала в каждую урну кладут по одной монете,
затем все оставшиеся монеты, одна за другой, помещаются в одну из двух
урн по следующему правилу: 
если в первой урне $x$ монет, а во второй "--- $y$ монет, то очередную монету кладут в первую урну с вероятностью $x/(x+y)$ и во вторую с вероятностью $y/(x+y)$.

Сколько вы готовы заплатить вперёд за содержимое урны, в которой в итоге окажется меньше монет?

\subsection*{Торговля вслепую}% (BIDDING IN THE DARK)
\rindex{Торговля вслепую}

У вас есть возможность купить вещь, стоимость которой для его
владельца, насколько вам известно, равномерно распределена между 0 и
100 долларами.
Для вас стоимость этой вещи на 80",\% выше, чем для
хозяина.

Если вы предложите сумму, превышающую стоимость вещи с точки зрения владельца, то он вам ее продаст.
При этом назвать свою цену вы можете только один раз.
Сколько следует предложить?


\subsection*{Случайные интервалы}% (RANDOM INTERVALS)
\rindex{Случайные интервалы}

Точки $1, 2,\dots, 1000$ на числовой прямой разбиты случайным образом
на пары и тем самым образуют 500 интервалов.
Какова вероятность того, что хотя бы один из этих интервалов
пересекается с каждым из остальных?

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.8]{Figs/Probability/ints}
\includegraphics{mp/wink-4}
\end{figure}

%%% \input{probability-sol.tex}

\section*{Решения и комментарии}

\subsubsection*{Потерянный посадочный талон}% (THE LOST BOARDING PASS)

Давайте дождёмся, когда сотый пассажир поднимется на борт.
Оставшееся
место будет либо то, что указано на его посадочном талоне, либо место
первого пассажира.
Все остальные места заняты пассажирами согласно
посадочным талонам или теми, что успели занять место раньше, чем го
законный владелец.

Так как на каждом шаге ни одному из этих двух мест не было дано никакого предпочтения, вероятность того, что сотый пассажир сядет на своё место, равна 50",\%.
\heart

Приведённое здесь рассуждение аналогично тому, что используется,
скажем, при подсчёте шансов в игре <<крэпс>> (разновидность игры в
кости с двумя кубиками).
Согласно её правилам, если вы выбросили два
кубика с суммой очков 4, 5, 6, 8, 9 или 10, вы продолжаете бросать
кости до тех пор, пока не выпадет та же сумма очков (тогда вы
выиграли) или 7 (тогда вы проиграли).
Чтобы определить вероятность
выигрыша, вы можете оценивать шансы, считая, что следующий бросок
последний.
Например, если вы выбросили в сумме 5 очков, то шансы
выигрыша "--- 4 из 10 (потому что имеется 4 способа выбросить 5 очков
и 6 способов выбросить 7 очков).
В случае с потерянным посадочным
талоном один из 99 пассажиров в конце концов сядет на место первого
или на место сотого, и в этот момент оба этих места выбираются с
равной вероятностью.

\medskip

Источник: дружеские беседы.
Я услышал эту задачу на конференции «Gathering for Gardner V».
Приведённау здесь версия рассказал мне Андер Холройд. % (Ander Holroyd). 

\begin{addedbytheeditors}
Эта задача вот уже более 20 лет считается фольклорной.
Наиболее ранняя публикация, которую удалось найти "--- книга 2001 года Гальфрида Гриммета и Дэвида Стирзакера%
\footnote{Задача 1.8.39 в кн: \emph{G. Grimmett, D. Stirzaker}. One Thousand Exercises in Probability. Oxford University Press, 2001.};
авторы книги пишут, что узнали задачу от Дэвида Белла.
Подробный разбор задачи приводится в их статье%
\footnote{\emph{G. Grimmett, D. Stirzaker}.
The lost boarding pass and other practical problems.
/\!/
Math. Gaz. 2021. Vol.~105, no. 563. P.~216--221.}.
%% Задача также обсуждалась в популярной американской радиопередаче
%% \emph{Car Talk} от 2 ноября 2004 года. 
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}


\subsubsection*{Все грани кубика}% (ROLLING ALL THE NUMBERS)

Это классическая задача на понятие среднего времени ожидания и принцип
линейности математического ожидания.
Предположим, что вы повторяете
эксперимент, вероятность успеха которого равна $p$.
Как долго
придётся ждать успешного исхода? Вы можете вычислить это значение как
сумму
\[\tsum_{n=1}^\infty n(1-p)^{n-1}p=1/p,\]
но это не выглядит особо убедительно с интуитивной точки зрения.
Лучше представим, что эксперимент повторяется $n$ раз и $n$ настолько большое, что доля успешных экспериментов сколь угодно близка к $p$ (закон больших чисел).
Об этих $n$ испытаниях можно думать как об отдельных сериях из $pn$
экспериментов, где каждая серия завершается успехом.
Средняя длина серии равна $n/(np)=1/p$.

В задаче требуется выбросить все шесть цифр, и ключевой момент состоит
в том, чтобы разбить этот процесс на шесть этапов.
Среднее время,
которое потребуется для завершения всех этапов, будет равно сумме
средних времён каждого этапа.
Если теперь проследить за числом
различных цифр, которые уже выпали, то первое значение этого числа
будет равно 1 (после первого броска) и оно будет шаг за шагом
увеличиваться на единицу, пока не достигнет 6.
Будем говорить, что
\emph{этап номер $k$} "--- это период, в течение которого $k-1$
различных цифр уже были выброшены, и мы ожидаем появления $k$"=й.

Вероятность успеха на этапе номер $k$ равна всего лишь числу цифр, ещё не выпавших на кубике, а именно $6-(k-1)$, делённому на $6$;
значит, средняя длина этапа номер $k$ равна $6/(6-k+1)$.
Из этого следует, что среднее время для всего процесса составит
\[\frac66+\frac65+\frac64+\frac63+\frac62+\frac61=14{,}7.
\pushQED{\heart}\qedhere
\]

% \heartf

Пожалуй, стоит отметить, что результат был бы совсем другим, если бы мы бросали шесть кубиков одновременно и ожидали, когда выпадут все цифры сразу при одном броске.
Вероятность успеха равна $6\cdot 5\cdot 4\cdot 3\cdot 2\cdot 1/6^6$ (см., например, последнюю задачу в предыдущей главе), что приблизительно равно $0{,}0154321$.
Следовательно, среднее время ожидания будет состоять целые $64{,}8$
попытки, невзирая на то, что за одну попытку мы бросаем сразу 6 кубиков.

\subsubsection*{Нечётная череда решек}% (ODD STREAK OF HEADS)

Данная задача была предложена%
\footnote{Делегацией от США. "--- \emph{Прим. ред.}}, 
но не использована, на ММО в начале 80-х годов%
\footnote{\emph{M. Klamkin}. {International Mathematical Olympiads, 1978--1985.} MAA, 1986.}.
Она идёт в~паре с предыдущей задачей, но здесь надо больше думать.

\medskip

Подсчитаем вероятность того, что мы выбрасываем решку сразу же нечётное число раз, и потом орла: 
\[\mathbb{P}(\textsc{ро})+ \mathbb{P}(\textsc{ррро})+ \mathbb{P}(\textsc{ррррро})+\ldots =
\Bigl(\frac12\Bigr)^2+\Bigl(\frac12\Bigr)^4+\Bigl(\frac12\Bigr)^6+\ldots =\frac13.
\]

Если так не получилось, то есть выпадал орёл (после чётного числа решек), то нам надо начинать сначала.
Таким образом, в среднем нам понадобится три подобных эксперимента.
Но нам надо подсчитать число бросков, а не экспериментов.

К счастью, можно воспользоваться другим свойством математического ожидания:
если имеется случайное число $n$ объектов средней величины $s$, то общая средняя величина всех объектов равна~$s$, помноженному на среднее значение $n$.
Каждый из экспериментов (успешный или нет) заканчивается, когда появляется первый орёл, таким образом, среднее число бросков на эксперимент равно $1:\tfrac12=2$.
Из этого следует, что
ответом к задаче будет $2\cdot 3=6$ бросков.\heart


У этой задачи есть и более красивое решение.
Пусть ответ равен $x$.
Если мы  начинаем с \textsc{о} или \textsc{рр}, то для достижения успеха нам предстоит сделать в среднем ещё $x$ бросков.
Если мы начинаем с \textsc{ро}, то это уже успех.
Отсюда 
\[x=\frac12 \cdot(1+x)+\frac14 \cdot(2+x)+\frac14 \cdot2,\]
откуда $x=6$.


\subsubsection*{Три кубика}% (THREE DICE)

Игра со ставками на таких учловиях действительно предлагается в
некоторых казино. В Америке она называется <<чак-э-лак>>
(chuck-a-luck) или <<птичья клетка>>. Собствннно говоря, это
обстоятельство уже указывает, без всяких вычислений, что игра идёт в
пользу казино. 

Однако есть довольно красивый способ доказать это математически, и он применим также и к другим азартным играм.

\medskip

Представим себе, что у нас шесть игроков, все ставят по 1 доллару на разные числа и затем бросают кубики.
Казино никогда не проигрывает!
Если выпадают три различных числа, то крупье забирает 3 доллара у проигравших и отдаёт их выигравшим.
В остальных случаях крупье забирает 4 или 5 долларов, отдавая
выигравшим только~3 доллара.
\heart

\medskip
Итак, казино выигрывает, если игроки делают ставки, как описано выше.
Но значит ли это, что она \emph{всегда} в пользу казино?
Да, значит "--- статистически казино выигрывает или проигрывает независимо от того, кто, как и сколько ставит.

Конечно, несложно определить напрямую, что чак-э-лак "--- дело проигрышное.
Вероятность того, что выпадут три разных числа, равна $6\cdot 5\cdot 4/6^3=5/9$.
Игрок, делающий ставку, уже здесь ничего не выигрывает, так как вероятность того,
что его число "--- одно из выпавших, равна $1/2$.
С вероятностью $1/36$ на всех кубиках выпадет одно и то же число;
и тут игрок получает $3$ доллара с вероятностью $1/6$ и теряет 1
доллар всё остальное время, так что средний проигрыш будет $1/3$ доллара.
И наконец, оставшиеся $5/12$ времени игрок выигрывает $2$~доллара с
вероятностью $1/6$ и теряет $1$ доллар с вероятностью $2/3$, а в среднем проигрывает $1/6$ доллара.
В целом его потери составят $1/36 \cdot 1/3 + 5/12 \cdot 1/6 = 17/216$, то есть примерно $8$ центов с~доллара.

\medskip

Игру можно сделать честной, давая игроку 3 доллара вместо 2 при выпадении двух одинаковых чисел 
и 5 долларов вместо 3, когда выпадают 3 одинаковых числа.

\medskip

Эта задача впервые появилась в «Энциклопедии головоломок» Сэма Лойда,
под редакцией Сэма Лойда II\footnote{{Sam Loyd’s Cyclopedia of 5000   Puzzles, Tricks, and Conundrums} / Edited by Sam Loyd II. 1914.}.
Сэм Лойд старший (1841--1911) хорошо известен многим читателям как
непревзойдённый мастер занимательных задач и величайший американский
головоломщик.

\subsubsection*{Доллары в урнах}% (MAGNETIC DOLLARS)

Большинство людей предположат, что урна с меньшим количеством монет ничего не стоит.
Так, недавно, сидя в ресторане с профессиональными математиками, я задал им этот вопрос, и в ответ только один был готов предложить 100 долларов, остальные же давали не больше~10.

На самом деле эта урна в среднем стоит аж четверть миллиона долларов.
В самом деле, распределение вероятностей для конечного содержимого обеих урн равномерно:
вероятность того, что, скажем, в первой урне в конце окажется только одна монета, такая же, как и вероятность того, что там будет 451 382 монеты.

Это легко доказывается по индукции, но интереснее провести
следующее рассуждение по аналогии.
Представим себе колоду из 
$999~999$
карт, из которых только одна красная.
Будем их тасовать следующим способом.
Положим красную карту на стол.
Теперь возьмём следующую карту (любую) и положим её с одинаковой вероятностью на или под красную карту.
Есть три варианта, куда можно поместить следующую карту; с равной
вероятностью выберем один из них и положим карту соответственно.
Когда последняя карта будет добавлена, на столе у нас окажется идеально перетасованная колода карт.

Но заметьте: когда сверху красной карты находятся $x-1$ карта, а снизу "--- $y-1$, вероятность того, что следующая карта окажется выше красной, равна $x/(x+y)$.
Таким образом, карты сверху красной карты ведут себя так же, как
монеты (не считая начальной) из первой урны, а карты снизу "--- как
монеты из второй урны.

Из того, что в перетасованной колоде красная карта может с равной вероятностью оказаться на любой высоте, следует равномерность распределения для монет.\heart

\medskip
Эту задачу (или это парадокс?) иногда называют «Урной Пойа»,\footnote{\emph{N. Johnson, S. Kotz}. {Urn Models and Their Applications: An Approach to Modern Discrete Probability Theory.} New York: Wiley, 1977.} по имени великого математика, популяризатора науки и любителя головоломок Дьёрдя Пойа (1887---1985).
Нетрудно показать, что если подбрасывается бесконечное количество монет, то в пределе с вероятностью, равной 1, процент монет, попавших в первую урну, задаётся однородным распределением на единичном интервале.

\subsubsection*{Торговля вслепую}% (BIDDING IN THE DARK)

Вам вообще не следует совершать покупку на таких условиях.
Если вы предложите $x$ долларов, то ожидаемая стоимость вещи для
хозяина, при условии, что он её продаст, будет равна $x/2$ доллара.
Следовательно, для вас ожидаемая стоимость вещи, если вы её получите, будет равна $1{,}8 \cdot  x/2=0{,}9\cdot x$ долларов.
Таким образом, в среднем вы теряете деньги, если покупаете эту вещь, и, конечно же, ничего не теряете и не приобретаете, если не покупаете.
Значит, нечего в это ввязываться.
\heart
%%% Ни фига не понимаю!!!

\medskip
{% \small 
Источник: Майя Бар Хиллел, Иерусалимский университет.

}

\subsubsection*{Случайные интервалы}% (RANDOM INTERVALS)

У этой задачи любопытная история.
Моему коллеге (Эду Шнайнерману из университета Джона Хопкинса) и мне нужно было решить эту задачу, чтобы вычислить диаметр так называемого <<случайного интервального графа>>. 
Вначале мы доказали, что асимптотическое значение этой вероятности равно $2/3$.
Потом с помощью муторных интегрирований мы нашли, что вероятность того, что найдётся интервал, который пересекает все остальные, в точности равна $2/3$ (для любого числа интервалов начиная с двух).

Приводимое ниже комбинаторное доказательство придумал Джойс Джастич,
%(Joyce Justicz) 
в то время "--- мой аспирант в университете Эмори.

\medskip

Предположим, что конечные точки интервалов выбираются из множества
$\{1,2,\dots,2n\}$.
Обозначим $2n-4$ из их концов символами $A(1)$,
$B(1)$, $A(2)$, $B(2),\dots, A(n-2)$, $B(n-2)$ согласно следующему
рекурсивному правилу.
Будем называть точки из множества $\{n+1, \dots
, 2n\}$ <<правыми>>, а точки из множества $\{1, \dots , n\}$ "---
<<левыми>>.
Положим $A(1)=n$, и пусть $B(1)$ "--- парная ей точка.
Допустим, что точки до $A(j)$ и $B(j)$ уже выбраны.
Если $B(j)$ "---
левая, тогда в качестве $A(j+1)$ выберем самую левую из не выбранных
ещё правых точек, а в качестве $B(j+1)$ выберем её пару.
Если $B(j)$
"--- правая, то в качестве $A(j+1)$ выберем самую правую из не
выбранных ещё левых точек, а в качетсве $B(j+1)$ "--- опять же её
пару.

Если $A(j) < B(j)$, мы говорим, что интервал \emph{ушёл направо}, в обратном случае "--- он \emph{ушёл налево}.
Точки вида $A(j)$ будем называть \emph{внутренними} концами интервала,
а точки вида $B(j)$ "--- \emph{вне\-ш\-ними}.

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.55]{Figs/Probability/labeling-ru}
\includegraphics{mp/wink-5}
\end{figure} 

Используя индукцию по $j$, легко доказать, что после того, как выбраны
$A(j)$ и $B(j)$, либо левых и правых точек будет выбрано
поровну (если $A(j) < B(j)$), либо левых точек выбрано на
две больше, чем правых (если $A(j) \z> B(j)$).

После того как мы выбрали точки $A(n-2)$ и $B(n-2)$, остаются четыре
необозначенных конца интервалов; назовём их $a<b<c<d$.
Мы утверждаем, что из трёх равновероятных способов разбиения этих точек на пары два приведут к <<большому>> интервалу, пересекающему все остальные, а один "--- нет.

В случае, если $A(n-2) < B(n-2)$, точки $a$ и $b$ являются левыми, а $c$ и $d$ "--- правыми;
в противном случае левой является только $a$.
В любом случае все внутренние концы интервалов лежат между точками $a$
и $c$, иначе одна из них была бы выбрана ранее.
Из этого следует, что интервал $[a,c]$ пересекает все остальные, и то же верно для $[a,d]$, то есть если $a$ не в паре с $b$, то у нас есть большой отрезок.

Допустим, напротив, что наши пары "--- именно $[a, b]$ и $[c, d]$.
Ни одна из них не может быть большим интервалом так как они не пересекаются друг с другом.
Предположим теперь, что существует другой большой интервал, скажем $[e,f]$, с концами $A(j)$ и $B(j)$.

Если точки $a$ и $b$ "--- левые, то внутренний конец $A(j)$ лежит между $b$ и $c$.
Таким образом, $[e, f]$ не может пересекать оба интервала $[a, b]$ и $[c, d]$, что противоречит нашему предположению.

В оставшемся случае, так как $[e, f]$ пересекает $[c, d]$, $f$ является внешним концом интервала. 
В этом случае $f=B(j)$, то есть интервал $[e, f]$ ушёл направо.
Поскольку последняя выбранная пара точек ушла налево, существует $k>j$, для которого $A(k)>B(k)$ и $A(k-1)<B(k-1)$.
В этом случае $A(k)<n$ и, значит, $A(k) < A(j)$, так как $A(k)$ "--- левая внутренняя точка, выбранная позже. %расхождение с оригиналом --- оно незначительное и так более прозрачно.
Тогда $[A(j), B(j)]$ не пересекает $[B(k), A(k)]$; это последнее противоречие доказывает наше утверждение.
\heart

Проводя данное рассуждение чуть аккуратнее, можно доказать, что 
для $k < n$ вероятность того, что в семействе случайных $n$ интервалов
найдётся по меньшей мере $k$ интервалов, пересекающих пересекают все остальные, равна
\[{2^k}\,\big/\,{\binom{2k+1} k}\]
и она не зависит от $n$.
Здесь $\binom n k$ означает \emph{биноминальный коэффициент}, то есть число подмножеств размера $k$ из множества размера~$n$, и он равен
\[\frac{n(n-1)(n-2)\ldots(n-k+1)}{k(k-1)(k-2)\ldots 1}.\]

%\section*{Всё что не попало в конец и сноски}


%\subsubsection*{Обратная сторона монеты}
%В аналогичной задаче про двух детей, один из которых мальчик (и требуется найти вероятность того, что второй тоже %мальчик), \?{}{Это нужно? Если да, то надо написать больше.}
%очень часто «забывают» корректно определить вероятностное пространство, из-за чего задача становится %малокорректной.

%%% \input{geometry.tex}

\chapter{Геометрия}
% \addcontentsline{toc}{chapter}{Геометрия}

\thispagestyle{empty}

\setlength{\epigraphwidth}{.66\textwidth}
\epigraph{Уравнения "--- просто скучная часть математики.\\
Я пытаюсь смотреть на мир с точки зрения геометрии.\vspace{1ex}}{Стивен Хокинг (1942"--~2018)}

Классическая геометрия в двух- или трёхмерном пространстве является бездонным источником для составителей задач. 
Но нас интересуют \emph{головоломки}, а это не те задачи, которые бы Евклид включил в книгу II своих «Начал».
Вас не будут просить доказать, что $AB=CD$ или что один треугольник равен другому.

К счастью, существует огромное множество очаровательных геометрических задач, отвечающих нашей цели. 
Задача, которую мы разберём в качестве примера, появилась в 1980 году на подготовительном  школьном экзамене, %(Preliminary Scholastic Aptitude Exam),
где, к стыду составителей, %из экзаменационного комитета,  
заготовленный ими ответ оказался неверен,
и один упорный ученик, получив результат экзамена, сапеллировал свою оценку.

Для нас очень кстати, что правильное решение этой задачи является
очень простым и красивым.

(К слову сказать, впоследствии была создана специальная группа, в которой  трудился и ваш автор, для анализа экзаменационных заданий по математике.)

\subsection*{Склеивание пирамид}% (GLUING PIRAMIDS)
\rindex{Склеивание пирамид}

Пирамида с квадратным основанием, у которой все рёбра имеют единичную длину, и пирамида с треугольным основанием (тетраэдр), у которой также все рёбра имеют единичную длину, склеены вместе по треугольной грани.

Сколько граней имеет полученный многогранник?

\paragraph{Решение}

Пирамида с квадратным основанием имеет пять граней, тетраэдр "--- четыре.
Так как две грани склеены вместе, у получившегося многогранника будет $7=4+5-2$ граней, правильно?
Это, очевидно, был предполагаемый ход рассуждений.
Составителю задачи могло бы прийти в голову, что  пара прилегающих
граней из разных многогранников может после склейки оказаться и в
одной плоскости, в результате чего они сольются в одну и ответ уменьшится.
Но, конечно же, такое совпадение исключено:
ведь два наших многогранника разные!

А на самом деле так и случается (дважды):
склеенный многогранник имеет пять граней.
Можно вообразить себе такую картину: две пирамиды с квадратным
основанием стоят на столе (на основаниях)
и примыкают друг к другу по ребру основания.
Теперь, соединив вершины пирамид прямой, отметим, что длина полученного отрезка равна единице, как и все рёбра пи\-ра\-миды. 

\begin{figure}[!ht]
\vspace{-\jot}
\centering
% \includegraphics[scale=0.55]{Figs/Geometry/pyrs}
\includegraphics{mp/wink-6}

% \vspace{\jot}
\end{figure}

Таким образом, между двумя пирамидами с квадратным основанием помещается правильный тетраэдр.
Две плоскости, каждая из которых содержит по треугольной грани от каждой из двух пирамид, также содержат и грань тетраэдра.
Отсюда результат. 
\heart

\medskip

%пропущено предложение --- согласовано с Питером https://github.com/anton-petrunin/test/wiki}
Данное доказательство, иногда называемое \emph{палаточным решением}, приведено в статье Стивена Янга%
\footnote{\emph{S. Young}. The mental representation of geometrical knowledge /\!/ {The Journal of Mathematical Behavior}. 1982. Vol.~3, no.~2. P.~123--144.}.


\begin{addedbytheeditors}
Усечённый тетраэдр "--- одно из архимедовых тел.
Ещё Архимед строил
его, отрезая углы у тетраэдра.
Скорее всего, он понимал, что в
результате у многогранника получаются те же углы, что и у октаэдра.
Но даже если допустить, что этот факт прошёл мимо великого грека, то
он никак не мог ускользнуть от Е.",С.",Федорова и Г.",Ф.",Вороного,
построивших в XIX веке классификацию кристаллических решёток.  "---
\emph{Прим. ред.}
\end{addedbytheeditors}

% \medskip

Одна из задач, приведённых ниже, имеет «доказательство без слов» "--- достаточно одного рисунка.
Сможете понять, какая?

\subsection*{Окружности в пространстве}% (CIRCLES IN SPACE)
\rindex{Окружности в пространстве}

Можно ли разбить трёхмерное пространство на окружности? 

\subsection*{Магия кубов}% (MAGIC WITH CUBES)
\rindex{Магия кубов}

Можно ли протащить куб сквозь отверстие в кубе меньшего размера?

\subsection*{Красные и синие точки}% (RED POINTS AND BLUE POINTS)
\rindex{Красные и синие точки}

На плоскости дано $n$ красных и $n$ синих точек, при этом никакие три точки не лежат на одной прямой.
Докажите, что можно установить взаимно однозначное соответствие между
красными и синими тосками таким образом, что отрезки, соединяющие каждую красную точку с соответствующей ей синей, не пересекаются.

\subsection*{Прямая через две точки}% (LINE THROUGH TWO POINTS)
\rindex{Прямая через две точки}

Пусть $X$ "--- конечное множество точек на плоскости, не все из которых лежат на одной прямой.
Докажите, что существует прямая, проходящая ровно через две точки из $X$.

\subsection*{Пары на максимальном расстоянии}% (PAIRS AT MAXIMUM DISTANCE)
\rindex{Пары на максимальном расстоянии}

И снова $X$ "--- конечное множество точек на плоскости.
Предположим, что $X$ содержит $n$ точек и что максимальное расстояние
между парами точек в этом множестве равно $d$.
Докажите, что существует не более $n$ пар точек из $X$, расстояние между которыми равно $d$.

\subsection*{Монах на горе}% (MONK ON A MOUNTAIN)
\rindex{Монах на горе}

В понедельник на рассвете монах начинает восхождение на гору Фудзияма и с приходом ночи достигает вершины.
Он проводит ночь на вершине горы и на следующее утро пускается в обратный путь, добираясь до подножия горы на закате.

Докажите, что в некоторый  момент времени во вторник  монах окажется точно на той же высоте, на какой  он был в то же время в понедельник.

\subsection*{Раскраска многогранника}% (PAINTING THE POLYHEDRON)
\rindex{Раскраска многогранника}

Предположим, что грани многогранника $P$ раскрашены в красный и зелёный цвет так, что каждая красная грань окружена зелёными, но суммарная площадь красных граней превосходит суммарную площадь зелёных.
Докажите, что в многогранник $P$ невозможно вписать сферу.

\subsection*{Круглые тени}% (CIRCULAR SHADOWS)
\rindex{Круглые тени}

Два круга являются проекциями некоторого тела на две плоскости.
Докажите, что радиусы этих кругов равны.

\subsection*{Полоски на плоскости}% (STRIPS IN THE PLANE) 
\rindex{Полоски на плоскости}

Назовём \emph{полоской} часть плоскости между двумя параллельными прямыми.
Докажите, что нельзя покрыть плоскость семейством полосок, суммарная ширина которых конечна.

\subsection*{Ромбики в шестиугольнике}% (DIAMONDS IN HEXAGON)
\rindex{Ромбики в шестиугольнике}

Из правильной треугольной решётки вырезали большой правильный шестиугольник и замостили его \emph{ромбиками} (парами равносторонних треугольников, склеенных по стороне).
Ромбики разбиваются на три вида в зависимости от их ориентации.
Докажите, что в замощении присутствует равное число ромбиков каждого вида.

\begin{figure}[!ht]
\vspace{\jot}
\centering
% \includegraphics[scale=0.55]{Figs/Geometry/hex}
\includegraphics[scale=1]{mp/wink-7}

\vspace{-2\jot}
\end{figure}

\subsection*{Замощение ромбами}% (RHOMBUS TILING)
\rindex{Замощение ромбами} 

Давайте ещё раз то же самое, но с б\'{о}льшими плитками и б\'{о}ль\-шим числом сторон.


Рассмотрим $\binom n2$ различных ромбов, образованных парами
непараллельных сторон правильного $2n$"=угольника\footnote{Имеется в виду, что сторона каждого ромба равна стороне $2n$"=угольника, а угол между соседними сторонами равен углу между какими-то двумя сторонами $2n$"=угольника. "--- \emph{Прим. ред.}}.
Замостите ими $2n$"=угольник, используя только параллельный перенос ромбов,
и докажите, что в любом таком замощении каждый ромб будет использоватн ровно один раз.

\subsection*{Векторы на многограннике}% (VECTORS ON A POLYHEDRON)
\rindex{Векторы на многограннике}

Каждой грани многогранника сопоставим вектор, перпендикулярный грани, направленный вовне и имеющий длину, равную площади грани.
Докажите, что сумма этих векторов равна нулю.

\subsection*{Три окружности}% (THREE CIRCLES)
\rindex{Три окружности}

\begin{figure}
\centering
% \includegraphics[scale=0.4]{Figs/Geometry/foci}
\includegraphics[scale=1]{mp/wink-8}
\end{figure} 

Назовём \emph{фокусом} двух окружностей точку пересечения их двух общих внешних касательных.
Таким образом, три окружности различных радиусов (не лежащие друг в друге)
определяют три фокуса.
Докажите, что эти три фокуса лежат на одной прямой.


\subsection*{Сфера и четырёхугольник}% (SPHERE AND QUADRIATERAL)
\rindex{Сфера и четырёхугольник}

{% \sloppy 
Пространственный четырёхугольник касается всеми сторонами сферы.
Докажите, что все точки касания лежат в одной плоскости.

}

\medskip

Последняя задача представляет собой небольшой экскурс в топологию и
иерархию бесконечностей.

\subsection*{Восьмёрки на плоскости}% (FIGURES 8S IN THE PLANE)
\rindex{Восьмёрки на плоскости}

Сколько непересекающихся топологических <<восьмёрок>> можно нарисовать на плоскости?

\begin{figure}[!ht]
\centering
\vspace{-.5\baselineskip}
% \includegraphics[scale=0.5]{Figs/Geometry/eights}
\includegraphics{mp/wink-9}

\vspace{-.5\baselineskip}

\end{figure} 

%%% \input{geometry-sol.tex}

\section*{Решения и комментарии}

\subsubsection*{Окружности в пространстве}% (CIRCLES IN SPACE)

\begin{figure}[tb]
\vspace{\jot}
\centering
% \includegraphics[scale=0.7]{Figs/Geometry/ring}
\includegraphics {mp/wink-10}
\end{figure} 

Да.
Построим на $XY$-плоскости окружности радиуса $1$, центр которых лежит
на оси $X$ в точках, абсцисса которых "--- целое число, сравнимое с $1$ по модулю $4$ (то есть в точках $\dots, (-7,0)$, $(-3,0)$, $(1,0)$, $(5,0)$, $(9,0)$,~\dots).
Обратите внимание на то, что каждая сфера с центром в начале координат
пересекает объединение этх окружностей ровно в двух точках.
Оставшаяся часть каждой такой сферы "--- это объединение окружностей.
\heart

\medskip

Известны другие доказательства, например, с помощью торов, но я не знаю рассуждений проще и красивей приведённого выше.

Эту милую задачу на разбиения я впервые услышал от Ника Пиппенджера, %(Nick Pippenger)
профессора информатики Принстонского университета\footnote{Эта задача обсуждается в следующей статье: 
\emph{A.~Szulkin}. $\mathbb{R}^3$ is the union of disjoint
circles. /\!/ Amer. Math. Monthly. 1983. Vol.~90,
no. 9. P.~640--641. Возможно, она была известна и ранее. "--- \emph{Прим. ред.}}.

\subsubsection*{Магия кубов}% (MAGIC WITH CUBES)

Да, это можно сделать.
Для того чтобы протащить единичный куб сквозь отверстие в другом единичном кубе, достаточно найти проекцию (второго) куба, содержащую в своей внутренности единичный квадрат.
Тогда во втором кубе можно проделать сквозное квадратное отверстие %(square cylindrical) 
со стороной чуть больше единицы, чтобы можно было протащить первый куб.

Можно сделать то же самое с меньшим допуском, если второй куб слегка меньше первого.

Самая простая (но не единственная) проекция, которую можно использовать, "--- это правильный шестиугольник.
Можно увидеть этот шестиугольник, если посмотреть на куб так, чтобы одна из вершин была посредине.
Формально говоря, это проекция куба на плоскость, перпендикулярную его диагонали. 

Пусть $A$ "--- проекция одной из видимых граней на плоскость.
Мы видим, что её б\'{о}льшая диагональ имеет ту же длину ($\sqrt{2\mkern1mu}$), что и диагональ единичного куба, так как в этом направлении проекция не сокращает длину.
Если сдвинуть $A$ к центру шестиугольника и затем растянуть её до единичного квадрата $B$, то вытянутые углы квадрата $B$ не дотянутся до вершин шестиугольника (так как расстояние между противоположными вершинами шестиугольника превышает расстояние между противоположными сторонами).

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.7]{Figs/Geometry/pass}
\includegraphics{mp/wink-11}
\end{figure}

Значит, если слегка повернуть квадрат $B$, то он окажется строго внутри шестиугольника.\heart

\medskip

Об этой очаровательной задаче, появлявшейся в колонке Мартина Гарднера, мне напомнил Григорий Гальперин из Университета Восточного Иллинойса.

\subsubsection*{Красные и синие точки}% (RED POINTS AND BLUE POINTS)

Среди всех возможных разбиений возьмём то, при котором общая длина всех $n$ отрезков минимальна.
Мы утверждаем, что такое разбиение не будет иметь пересечений.
Действительно, если бы отрезок $uv$ пересекал отрезок $xy$, то эти отрезки были бы диагоналями выпуклого четырёхугольника $uyvx$ %ошибка в книжке
и по неравенству треугольника, заменив диагонали на стороны $uy$ и $xv$, мы бы уменьшили общую длину отрезков.
\heart


\medskip
{% \small 
Источник: Задача А-4 олимпиады Патнема 1979 года.

}

Технику, которой мы здесь воспользовались, состоящую в том, что мы находим нужный объект, минимизируя или максимизируя некую величину, иногда называют \emph{вариационным методом}%
\footnote{В отечественной литературе чаще говорят о \emph{методе полуинвариантов} или \emph{методе спуска}. "--- \emph{Прим. ред.}},
и он, как знают многие читатели, чрезвычайно полезен.
Следующая задача предлагает ещё один пример его применения.


\subsubsection*{Прямая через две точки}% (LINE THROUGH TWO POINTS)

Эта знаменитая гипотеза была сформулирована Джеймсом Сильвестром в 1893 году.
Первое доказательство найдено Тибором Галлаи. %(Tibor Gallai).
Приведённое ниже доказательство, данное в 1948 году Л.",М.",Келли\footnote{\emph{H. S. M. Coxeter.} A problem of collinear points /\!/ {Amer. Math. Monthly}. 1948.  Vol. 55. P.~26--28. "--- \emph{Прим. ред.}}, 
часто упоминалось Полом Эрдёшем как пример доказательства из «Книги».

\setbox180\hbox{\includegraphics[scale=.7]{wink-12}}
\begin{wrapfigure}[7]{l}{\wd180}
\box180
\end{wrapfigure}

Предположим, что каждая прямая, проходящая через две точки множества $X$, содержит по меньшей мере три точки из $X$.
Идея состоит в том, чтобы рассмотреть такую прямую $\ell$ и такую точку $P$, не лежащую на~$\ell$, что расстояние от $P$ до $\ell$ минимально.

% \begin{figure}[h]
% \centering
% % \includegraphics[scale=0.7]{Figs/Geometry/kelly}
% \includegraphics[scale=1]{mp/wink-12}
% \end{figure}

Поскольку $\ell$ содержит по меньшей мере три точки из $X$, две из них, скажем $Q$ и $R$, лежат с одной стороны от перпендикуляра, опущенного из точки $P$ на прямую $\ell$.
Но тогда если $R$ "--- дальняя точка, то $Q$ находится ближе к прямой $PR$, чем $P$ к $\ell$ "--- противоречие.\heart

\subsubsection*{Пары на максимальном расстоянии}% (PAIRS AT MAXIMUM DISTANCE)

Это задача из олимпиады Патнема 1957 года.
Для её решения будет полезно следующее наблюдение.
Предположим, что $A,B$ и $C,D$ "--- две \emph{максимальные пары} (то есть пары точек из $X$, расстояние между которыми равно $d$).
Тогда отрезки $AB$ и $CD$ пересекаются (иначе длина одной из диагоналей четырёхугольника $ABCD$ превысит $d$).

Предположим, что утверждение задачи неверно, и пусть наименьший
контрпример имеет размер $n$.
Поскольку максимальных пар больше, чем
$n$, и каждая состоит из двух точек, должна существовать такая точка
$P$, которая принадлежит трём максимальным парам (пусть это будут пары
с точками $A$, $B$, $C$).
Каждые два из отрезков $PA$, $PB$ и $PC$
должны в точке $P$ образовывать угол максимум в~$60^\circ$.
Один из
этих отрезков, скажем $PB$, 
%% ошибка в книжке 
должен лежать между двумя
другими.

Но тогда точке $B$ будет довольно сложно образовать максимальную пару с какой-либо другой точкой, так как если бы пара $B,Q$ была максимальной, то отрезок $BQ$ должен был бы пересечь и $PA$, и $PC$, что невозможно.
Значит, можно выбросить $B$ из множества $X$, теряя при этом только одну максимальную пару и получая таким образом меньший контрпример.
Это противоречие завершает доказательство.\heart

\begin{addedbytheeditors}
У этой задачи есть много интересных решений.


Несмотря на элегантность приведённого решения Келли, оно вызывало
критику за использование метрики, чуждой формулировке задачи.
В
частности, в своей книге Гарольд Кокстер сравнивает его с
колкой ореха кувалдой\footnote{\emph{H. Coxeter}. Introduction to Geometry. New York: Wiley, 1969.}  и приводит другое доказательство,
использующее лишь аксиомы инцидентности и порядка.  "---
\emph{Прим. ред.}
\end{addedbytheeditors}

\subsubsection*{Монах на горе}% (MONK ON A MOUNTAIN)

Пожалуй, самое лёгкое решение "--- это представить себе, что у монаха есть близнец, которому даны указания взобраться на гору во вторник утром точно тем же путём, каким шёл монах в понедельник.
Тогда монах должен встретить близнеца по дороге вниз или, если они идут разными тропами, оказаться в какой-то момент на одной с ним высоте.\heart

\medskip

(Возможно, эта задача показалась слишком лёгкой.
Не волнуйтесь, гораздо более сложная её версия ожидает вас в предпоследней главе «Крепкие орешки».)

На эту древнюю задачу можно смотреть как на пример применения теоремы о промежуточном значении "--- очень полезной теоремы, утверждающей, что непрерывная функция, определённая на отрезке, обязана принять все свои промежуточные значения.
В нашем случае функция это разность между высотой, на которой оказался монах в определённое время дня в понедельник, и высотой, на которой он был в то же самое время дня во вторник.
Начальное значение функции будет отрицательным (примерно минус высота горы Фудзияма), а конечное значение "--- положительным, таким образом, в некоторой точке функция должна обратиться в ноль.

Можно считать, что высота, на которой находился монах в каждый из дней, представлена графиком, и два графика наложены друг на друга.
Тогда должна существовать точка (или точки), где они пересекаются.

Другими  известными примерами применения теоремы о промежуточном значении являются задачи о том, можно ли вписать озеро Мичиган в квадрат и можно ли  разрезать сэндвич (плоскостью) так, чтобы разделить ветчину, сыр и хлеб точно пополам.

\begin{addedbytheeditors}
По-видимому, эта задача придумана немецким психологом Карлом Данкером%
\footnote{\emph{A. Koestler}. The Act of Creation. New York: Macmillan, 1964.} в 1945 году.
Приведём ещё похожую и очень известную задачу Н.",Н.",Константиновa о возах\footnote{\emph{В. И. Арнольд.} Обыкновенные дифференциальные уравнения. М.: МЦНМО,
2018, с. 14.}.

Из города $A$ в город $B$ ведут две непересекающиеся дороги.
Известно, что две машины, выезжающие по разным дорогам из $A$ в $B$ и
связанные  верёвкой длины, меньшей $2\ell$, смогли проехать
из $A$ в $B$, не порвав веревки.
Могут ли разминуться, не коснувшись, два круглых воза радиуса $\ell$, центры которых движутся по
этим дорогам навстречу друг другу?
"--- \emph{Прим. ред.}
\end{addedbytheeditors}


\subsubsection*{Раскраска многогранника}% (PAINTING THE POLYHEDRON)

Предположим, что сфера вписана в многогранник~$P$; разобьем каждую его
грань на треугольники с вершиной в точке касания сферы.
Тогда треугольники по обе стороны любого ребра равны и, значит, имеют одинаковую площадь.
В каждой такой паре не более одного красного треугольника.
Из этого следует, что площадь красных граней не превосходит площади зелёных, что противоречит условию задачи.\heart

\medskip

Эта задача пришла ко мне от Эмины Солянин %(Emina Soljanin) 
из Bell Labs.
На иллюстрации представлена двумерная версия, где стороны и вершины многоугольника заменяют грани и рёбра многогранника%
\footnote{Варианты этой задачи рассматриваются в лекции 21 «Математического дивертисмента» С.",Л.",Табачникова и Д.",Б.",Фукса (М.: МЦНМО, 2016). "--- \emph{Прим. ред.}}~$P$.

\begin{figure}[!ht]
%   \vspace{-.8\baselineskip}
\centering
% \includegraphics[scale=0.6]{Figs/Geometry/polygon}
\includegraphics[scale=.9]{mp/wink-13}

\vspace{-2\jot}
\end{figure}


\subsubsection*{Круглые тени}% (CIRCULAR SHADOWS)

Эта обескураживающая задача пришла к нам из V Всесоюзной математической олимпиады\footnote{% \cite[№150]{VsMO}
\VsMO. Задача №150, автор не указан. "--- \emph{Прим. ред.}} в Риге 1971 года.
Простой способ превратить интуитивное ощущение в строгое доказательство состоит в следующем: поместим тело между двумя плоскостями, перпендикулярными одновременно обеим плоскостям проекций, и начнём  эти две новые плоскости сдвигать.
В  момент, когда они коснутся тела, они пройдут через противолежащие точки каждой из проекций и расстояние между параллельными плоскостями будет равно общему диаметру проекций.
\heart

\subsubsection*{Полоски на плоскости}% (STRIPS IN THE PLANE) 

Как и предыдущая, данная задача представляет собой пример «интуитивно очевидного» утверждения, которое всё-таки нужно доказать.
Версия этой задачи появлялась в ранних олимпиадах Патнема.

\medskip

Поскольку сложно сравнивать бесконечные площади, имеет смысл сосредоточиться на какой-нибудь конечной части плоскости.
Мы не можем контролировать углы между полосками, так что логично будет рассмотреть круг $D$ радиуса $r$.

Предположим, что полоски имеют ширину $w_1$, $w_2,\dots$, причём суммарная ширина равна $1$.
Оказывается, что они не могут покрыть даже круг $D$ при $r=1$.
Действительно, пересечение круга $D$ с полоской шириной $w$ лежит в прямоугольнике шириной $w$ и длиной $2$, и, следовательно, его площадь меньше $2w$.
Таким образом, площадь, покрытая полосками внутри $D$, меньше $2$, а
площадь круга $D$, конечно же, равна~$\pi>2$.
\heart 

\medskip

Это доказательство говорит, что для того, чтобы покрыть полосками
единичный круг, их суммарная ширина должна быть больше $\pi/2$, но на
самом деле это можно сделать, только если суммарная ширина равна хотя бы 2 (в этом случае решение дают параллельные полоски)%
\footnote{Это так называемая \emph{задача Тарского о покрытии полосками}. "--- \emph{Прим. ред.}}.
Есть очень красивое доказательство этого утверждения.
Именно, надо выйти в пространство, рассмотрев $D$ как сечение единичного шара, проходящее через его центр.
Предположим, что круг покрыт полосками, суммарная ширина которых равна $W$, и пусть $S$ "--- одна из полосок шириной, скажем, $w$.
Можно предположить, что либо оба края полоски пересекают $D$, либо один край пересекает и один касается.
Проектируя $S$ вверх и вниз на поверхность шара, мы получаем пояс (или шапочку)
на шаре площадь которого , как можно показать с помощью
математического анализа, равна 
$2\pi w$ независимо от положения полоски!

Поскольку площадь поверхности шара равна $4\pi$, чтобы её покрыть, потребуются полоски суммарной шириной $W\ge 2$,
а если не покрыта поверхность шара, то и круг не покрыт.


\subsubsection*{Ромбики в шестиугольнике}% (DIAMONDS IN HEXAGON)

\leavevmode

\begin{figure}[h]
\vspace{-.5\baselineskip}
\centering
% \includegraphics[scale=0.3]{Figs/Geometry/diamonds}
\includegraphics[scale=1.15]{wink-37}

\vspace{-\baselineskip}

\heart
\end{figure}




Доказательства без слов стали очень популярной темой в журналах «Mathematics Magazine» и «The College Mathematics Journal» Математической ассоциации Америки.
Такие задачи можно найти в двух книгах Роджера Б. Нелсена%
\footnote{\emph{R. B. Nelsen}. {Proofs Without Words}; {Proofs Without Words II}. MAA, 2000.}.
Задача о ромбиках в шестиугольнике появляется в первой из этих двух
книг как «Задача o калиссонах»\footnote{Калиссон "--- французское сладкое печенье в форме ромба. "--- \emph{Прим. ред.}}.


\subsubsection*{Замощение ромбами}% (RHOMBUS TILING)

Пусть $\vec u$ "--- одна из сторон $2n$-угольника.
Назовём $\vec
u$-ромбом любой из $n-1$ ромбов, у которых $\vec u$ параллельна одной
из сторон.
В нашем замощении плитка, прилегающая к стороне~$\vec u$,
должна быть $\vec u$-ромбом, как и плитка с другой стороны от этого
ромба, и так далее, пока мы не достигнем противоположной стороны
$2n$-угольника.
Заметьте, что каждый шаг на этом пути делается в
одном
направлении (а именно, вправо или влево) относительно вектора $\vec u$. 
Так же должен вести себя и любой другой путь, содержащий $\vec u$-ромб.
Но тогда не может быть других $\vec u$-ромбов, поскольку они
образовали бы дополнительный путь, который не мог бы замкнуться и которому негде было бы закончиться.


\begin{figure}[h]
\centering
% \includegraphics[scale=0.5]{Figs/Geometry/dimers}
\includegraphics{mp/wink-14} 
\end{figure}

Аналогично определяемый путь для другой стороны $\vec v$ должен пересечь $\vec u$, и их общая плитка, разумеется, образована сторонами $\vec u$ и~$\vec v$.
Могут ли они пересечься дважды?
Нет, поскольку при повторном пересечении внутренний угол ромба между $\vec u$ и $\vec v$ превысил бы~$\pi$. \heart

\medskip

Данная задача досталась мне от Дейны Рэндалл из Технологического
института Джорджии. 



%% \subsection*{Векторы на многограннике}% (VECTORS ON A POLYHEDRON)
%% \rindex{Векторы на многограннике}

%% Каждой грани многогранника сопоставим вектор, перпендикулярный грани, направленный вовне и имеющий длину, равную площади грани.
%% Докажите, что сумма этих векторов равна нулю.

\subsubsection*{Векторы на многограннике}% (VECTORS ON A POLYHEDRON)

На эту задачу обратил моё внимание Юваль Перес, профессор факультета статистики Калифорнийского университета в Беркли. %( (Yuval Peres of the Department of Statistics at UC Berkeley).

\medskip

Самый простой способ понять, что сумма векторов должна быть нулевой, "--- это провести следующий мысленный эксперимент.
Накачаем воздух в (жёсткий) многогранник и отметим, что давление на грань есть сила, действующая по нормали, и её величина пропорциональна площади поверхности грани.
Давление на грани должно быть уравновешено, иначе многогранник бы двигался сам по \mbox{себе}. \null
\heart


%% \subsection*{Три окружности}% (THREE CIRCLES)
%% \rindex{Три окружности}

%% \begin{figure}[b]
%% \centering
%% % \includegraphics[scale=0.4]{Figs/Geometry/foci}
%% \includegraphics[scale=1]{mp/wink-8}
%% \end{figure} 

%% Назовём \emph{фокусом} двух окружностей точку пересечения их двух общих внешних касательных.
%% Таким образом, три окружности различных радиусов (не лежащие друг в друге)
%% определяют три фокуса.
%% Докажите, что эти три фокуса лежат на одной прямой.


\subsubsection*{Три окружности}% (THREE CIRCLES)

Это лучший известный мне пример, демонстрирующий пользу от перехода к
старшей размерности.

\medskip

Заменим каждую окружность сферой с центром на плоскости, пересечение
которой с плоскостью и есть заданная окружность.
Теперь каждой паре
сфер соответствует конус, и искомые точки являются вершинами трёх
конусов.

Но все эти вершины лежат на плоскости, которая касается сфер сверху;
точно так же они все лежат на плоскости, которая касается сфер снизу.
Значит, они принадлежат пересечению двух плоскостей "--- прямой! \heart

\medskip
Похоже, что это старинная классическая задача%
\footnote{Эта задача называется \emph{теоремой Монжа}.
Она была сформулирована Жаном Д’Аламбером и доказанна Гаспаром Монжем. "---
\emph{Прим. ред.}}.
Впервые я услышал её от Дейны Рэндалл %(Dana Randall), 
из Колледжа компьютерных наук Технологического института Джорджии.
Вадим Жарницкий из Иллинойсского университета заметил, что можно задать аналогичный вопрос о четырёх сферах в трёхмерном пространстве: будут ли вершины шести конусов, определяемых данными сферами, лежать на одной плоскости?
Так оно и будет, и один из способов это доказать "--- повысить размерность до 4.


%% \subsection*{Сфера и четырёхугольник}% (SPHERE AND QUADRIATERAL)
%% \rindex{Сфера и четырёхугольник}

%% {% \sloppy 
%% Пространственный четырёхугольник касается всеми сторонами сферы.
%% Докажите, что все точки касания лежат в одной плоскости.

%% }

%% \medskip


\subsubsection*{Сфера и четырёхугольник}% (SPHERE AND QUADRIATERAL)

Эту задачу я узнал от Тани Ховановой, приглашённого научного
сотрудника Принстонского университета в рамках программы по прикладной
и вычислительной математике\footnote{Это задача XIII Московской математической олимпиады 1950 года, см.: \MMO. Задача 13.17. "---
\emph{Прим. ред.}}.
У неё есть коллекция задач, которые она
называет «гробами».
Она пишет:

\medskip

\begin{trivlist}\leftskip=5mm\rightskip=.5cm
\small
\item\relax«Механико-математический факультет Московского государственного университета, самый престижный математический вуз России, в то время (1975) препятствовал поступлению еврейских (и других <<нежелательных>>) абитуриентов на факультет.
Один из методов, используемых в этих целях, был таков: неугодным абитуриентам давался на устном экзамене отдельный набор задач.
Задачи эти выбирались очень аккуратно: они имели простое решение
(чтобы избежать скандала), которое было почти невозможно найти.
Любому, кто не решал задачу, могли с лёгкостью отказать в приёме, так
что подобная система хорошо отсеивала неугодных». 
\end{trivlist}

\medskip

Найти следующее решение действительно трудно, но, кажется, не совсем
невозможно, если осознать, что хороший способ установить, что четыре
точки лежат в одной плоскости, "--- найти точку, в которой
пересекаются прямые, соединяющие две пары этих точек.
Заметим, что
каждая вершина $A_i$ четырёхугольника находится на одинаковом
расстоянии $d_i$ до точек касания образующих её сторон.

Снабдим вершину $A_i$ массой $1/d_i$, тогда центр масс двух соседних
вершин есть точка касания соединяющей их стороны.
Из этого следует,
что центр масс всех четырёх точек лежит на отрезке, соединяющем
противоположные точки касания, "--- это и есть искомая точка. \heart



%% Последняя задача является небольшой экскурсией в топологию и иерархию бесконечностей.

%% \subsection*{Восьмёрки на плоскости}% (FIGURES 8S IN THE PLANE)
%% \rindex{Восьмёрки на плоскости}

%% Сколько непересекающихся топологических <<восьмёрок>> можно нарисовать на плоскости?

%% \begin{figure}[!ht]
%%   \centering
%%   \vspace{-.5\baselineskip}
%% % \includegraphics[scale=0.5]{Figs/Geometry/eights}
%% \includegraphics{mp/wink-9}

%%   \vspace{-.5\baselineskip}

%% \end{figure} 

%%% \input{geometry-sol.tex}


\subsubsection*{Восьмёрки на плоскости}% (FIGURES 8S IN THE PLANE)

Эта задача известна уже около 50 лет.
Говорят, что автором её
является великий тополог, профессор Техасского университета Роберт Ли
Мур (1882"--~1974).

Читатели, незнакомые с разными <<степенями бесконечности>>, могут уже пребывать в недоумении: ведь очевидно, что на плоскости можно нарисовать бесконечно много восьмёрок, например, поместив по одной восьмёрке внутри каждой клетки квадратной решётки.
О таком множестве мы говорим, что оно счётно. 
Это означает, что восьмёрки можно пронумеровать натуральными числами так, что каждой восьмёрке будет соответствовать только одно число.

\medskip

Множество целых чисел, множество всех пар целых чисел, и, таким
образом, множество рациональных чисел "--- всё это счётные множества,
но, как было замечено замечательным
%% блестящим (но зачастую депрессивным)
%% И пусть автор со своим юмором идет в задницу 
математиком
Георгом Кантором в 1878 году, множество всех вещественных чисел \emph{не} является счётным.
Можно было бы начертить на плоскости концентрические окружности всех возможных положительных вещественных диаметров, и, следовательно, если бы в задаче говорилось об окружностях вместо восьмёрок, то ответ был бы «несчётное число», или, более точно, «равномощно множеству вещественных чисел».

Тем не менее восьмёрок можно нарисовать только счётное число.
Каждой восьмёрке поставим в соответствие пару рациональных точек (точки плоскости, обе координаты которых "--- рациональные числа), по одной в каждой петле.
Никакие две восьмёрки не могут иметь общих пар точек.
Значит, мощность множества восьмёрок не превышает мощности множества пар из пар рациональных чисел, которое является счётным.\heart

\medskip

Более хитрую версию данной задачи смотрите в предпоследней главе «Крепкие орешки».


%% \section*{Решения и комментарии}

\chapter{География\upshape(!)}

\thispagestyle{empty}

\setlength{\epigraphwidth}{.4\textwidth}
\epigraph{Без географии мы были бы нигде.\vspace{1ex}}{Джимми Баффет (1946---)} 

Честно говоря, данная глава совсем не вписывается в эту книгу.
Некоторые из задач, представленных здесь, конечно, математические по своей природе, %(mathematical in nature) 
но в основном они включены в книгу потому, что доставляют, как мне кажется, большое удовольствие любителям математических головоломок.
Мой издатель сообщил мне, что без этой главы цена книги была бы той
же, 
так что эта глава бесплатна, и её можно пропустить с чистой совестью.

Основная тема приведённых ниже задач "--- поверхность планеты Земля,
но предпочтение всё-таки отдаётся моей стране "--- Соединённым Штатам
Америки, извините, пожалуйста.
Я буду благодарен за подобные задачи про другие страны; присылайте их мне мне на pw@akpeters.com.

Некоторые из этих задач показывают, до какой степени %( test the degree) 
картографическая проекция %( на плоскость) (planar projections) 
искажает наше представление о земном шаре. %(глобусе, globe).
Вот одна из них. 

\subsection*{Африка}
\rindex{Африка}

Какой штат США ближе всего к Африке? 

\paragraph{Решение} Штат Мэн.\heart

\medskip
Он совсем не близко "--- проверьте по глобусу.
Но если лететь по ортодромии (в картографии и навигации ортодромия "--- название кратчайшего пути между двумя точками на поверхности Земли) из Майами, скажем, в Касабланку, то вначале курс %(путь)
будет лежать на северо-восток вдоль восточного побережья и пройдёт очень близко к штату Мэн.
%(not missing Maine by much)

\medskip

Дальше попробуйте сами.

\subsection*{На восток от Рино}%EAST OF RENO 
\rindex{На восток от Рино}

Какой самый большой город в США к востоку от Рино, Невада, и к западу от Денвера, Колорадо? 

\subsection*{Телефонный звонок}%(THE PHONE CALL) 
\rindex{Телефонный звонок}

Представьте, что вы звоните из какого-то штата Восточного побережья в один из штатов Западного побережья США и на обоих концах одно и то же время суток.
Как такое может быть? 

\subsection*{Диаметр США}%(THE DIAMETR OF US)  
\rindex{Диаметр США}

В каких двух штатах находятся две самые удалённые точки США? 

\subsection*{На юг от Ки-Уэст}% ( SOUTH FROM KEY-WEST) 
\rindex{На юг от Ки-Уэст}

Если вы летите на юг от города Ки-Уэст, Флорида, какая южноамериканская страна 
встретится вам первой? 

\subsection*{Индейцы на Среднем Западе}% (INDIANS IN THE MIDWEST) 
\rindex{Индейцы на Среднем Западе}

Среди штатов Среднего Запада США только один имеет название не индейского происхождения. Который?    

\subsection*{Самый большой второй по величине город}% (THE LARGEST SECOND-LARGEST CITY)  
\rindex{Самый большой второй по величине город}

Какой самый большой город в США, являющийся вторым по величине среди городов с одинаковыми названиями?

\medskip

Эта формулировка может показаться несколько путанной.
Спросим по-другому: скажем, что город (в США) \emph{находится в тени}, если существует больший город с таким же названием.
Например, Портланд, штат Мэн, находится в тени города Портланд, штат Орегон.

Итак, наш вопрос прозвучит теперь так: какой наибольший город в США находится в тени?   

\subsection*{Естественные границы}% (THE NATURAL BORDERS) 
\rindex{Естественные границы}

Граница штата может быть естественной (определяться водоёмами, горами
и пр.) или закреплённой в законе искусственной линией "--- в одном
знаменитом случае (штатаы Делавэр и Пенсильвания) это дуга окружности.
Три штата "--- Колорадо, Юта и Вайоминг "--- имеют только
искусственные границы.
Какой штат обладает только естественными
границами?

\subsection*{Непересекаемые границы}% (THE UNCROSSABLE BORDER) 
\rindex{Непересекаемые границы}

Можете ли вы найти такую границу штатов, которую невозможно пересечь
на автомобиле?  Другими словами укажите два штата, имеющие общую
границу, через которую невозможно напрямую проехать на
автомобиле из одного штата в другой.

\subsection*{Отдел странных названий}% (DEPARTMENT OF ODD NAMES) 
\rindex{Отдел странных названий}

Что особенного в неком местечке, именуемом Уэст-Куодди-Хед (West Quoddy Head),
штат Мэн?   

\subsection*{Городской и деревенский}%(URBAN AND RURAL) 
\rindex{Городской и деревенский}

Эта задача ближе к социологии.
В наши дни большинство американцев "--- порядка 75",\% "--- живут в так называемых «городских агломерациях».
Перепись населения 2000 года относит к «городскому» 100",\% населения
одного из штатов и только 27,6\% (наименьшая доля!) населения другого штата, который отдалён от первого всего лишь на несколько сотен миль.
Можете назвать эти два штата?   

\subsection*{С юга на север}% (CITIES NORTH AND SOUTH) 
\rindex{С юга на север}

Как у вас дела с визуализацией континентов?
Проверьте, как точно вы представляете себе %(визуаилизируете) 
карту мира.
Расставьте следующие четыре города по порядку с юга на север: 
Галифакс, Новая Шотландия; %(Halifax, Nova Scotia) 
Токио, Япония; %(Tokyo, Japan); 
Венеция, Италия; %(Venice, Italy); 
Алжир, Алжир. %(Algiers, Algeria).

\subsection*{Односложный город}% (THE ONE-SYLLABLE CITY) 
\rindex{Односложный город}

Какой город в США  самый большой среди городов, название которых состоит из одного слога? 

\subsection*{Вашингтоны и феминисты}%(WASHINGTONS AND FEMINISTS) 
\rindex{Вашингтоны и феминисты}

Давайте проверим, хорошо ли вы представляете себе карту США. Сможете
ли вы проложить маршрут для автомобиля из города Сиэтл, штат
Вашингтон, в Вашингтон, округ Колумбия, таким образом, чтобы названия
всех штатов, через которые вы планируете проехать, начинались только с
букв, составляющих слово «WOMAN»\footnote{Разумеется, речь об оригинальных названиях, а не их русских переводах. "---
\emph{Прим. пер.}}?


\medskip

Наша последняя географическая задача напоминает нам, что пора возвращаться к математике. %(signals us a(slight) return to mathematics) направляет 

\subsection*{Учёный и медведь}%(THE NATURALIST AND THE BEAR) 
\rindex{Учёный и медведь}

Учёный-биолог покинул лагерь экспедиции, прошёл 10 миль на юг, затем 10 миль на восток и тут заметил и сфотографировал медведя.
Пройдя 10 миль на север, он пришёл обратно в лагерь.

\medskip

Вы не видели фотографии, но всё равно знаете, какого цвета был медведь, не так ли?

%%% \input{geography-sol.tex}

\section*{Решения и комментарии}

Для проверки правильности ответов вы можете воспользоваться атласом,
глобусом, статистическим справочником или итогами переписи населения США 2000 года.
Давайте посмотрим, насколько верны были ваши предположения...
%(догадки)

\subsubsection*{На восток от Рино}% (EAST OF RENO)

Вопрос о самом большом городе не так прост: 
%(awkward question) 
принято определять это понятие числом жителей (а не площадью!) в официальных границах города, что, безусловно, может привести к неверным выводам
при наличии городских агломераций.
%(урбанизированных зон)
%(can be misleading with respect to metropolitan area).
Так, например, согласно справочникам город Джексонвилл, штат Флорида, представляется больше, чем Атланта, штат Джорджия, несмотря на то, что население всей городской агломерации Атланты превышает население Джексонвилла почти в четыре раза.

\medskip

Но в нашей задаче такие тонкости не понадобятся.
Самый большой город к востоку от Рино и к западу от Денвера в любом случае Лос-Анджелес, Калифорния.
\heart

\subsubsection*{Телефонный звонок}%ТЕЛЕФОННЫЙ ЗВОНОК (THE PHONE CALL)

\emph{Восточное побережье} Соединённых Штатов Америки включает в себя восточные штаты, имеющие выход к Атлантическому океану, от штата Мэн на севере до штата Флорида на юге.
К \emph{Западному побережью} относятся штаты Вашингтон, Орегон и Калифорния,
к которым, если хотите, можно добавить Аляску и даже Гавайи, но это в данном случае не так уж важно. %(but it doesn’t help).

Обычно разница во времени между Восточным и Западным побережьем составляет 3 часа.
Можно избавиться от одного часа, позвонив из западного района так называемой «ручки ковша» Флориды "--- её северо-западной части, % ( Florida panhandle) 
скажем, из города Пенс\'{а}кола, который находится в центральном часовом поясе.
Чтобы избавиться ещё от одного часа, мы звоним в один из городов
самого восточного района штата Орегон (скажем, Онтарио), который
находится не в тихоокеанском, а в горном часовом поясе.

Оставшийся час исчезнет, если звонок будет сделан из Пенсаколы между двумя и тремя часами ночи, при переходе с летнего времени на зимнее.
В этот момент в центральном часовом поясе время уже переведут на один
час назад, а в горном время всё ещё будет прежним.\heart 

\subsubsection*{Диаметр США}%ДИАМЕТР СОЕДИНЁННЫХ ШТАТОВ (THE DIAMETR OF US) 

Очевидно, это либо Гавайи и Мэн, либо Аляска и Флорида.
Или это Гавайи и Аляска?

\medskip

Удивительным образом, ни одно, ни другое, ни третье.
Правильный ответ "--- Гавайи и Флорида (опять дуга большого круга!).\heart

\subsubsection*{На юг от Ки-Уэст}%НА ЮГ ОТ КИ-УЭСТ ( SOUTH FROM KEY-WEST)

Это, без сомнения, каверзный вопрос. %(a trick question).
Вы не пересечёте ни одну страну Южной Америки.
Путь пройдёт к \emph{западу} от континента.
%(Ваш путь пройдёт вдоль западного побережья всего континента.)
\heart

\subsubsection*{Индейцы на Среднем Западе}%ИНДЕЙЦЫ НА СРЕДНЕМ ЗАПАДЕ (INDIANS IN THE MIDWEST)

При широком понимании Среднего Запада к нему относятся штаты Миннесота, Висконсин, Айова,
Иллинойс, Миссури, Мичиган, Огайо, Канзас и Небраска "--- все названия индейского
происхождения, и еще Индиана "--- это и есть ответ!\heart

\medskip
Любопытно, что только один штат к востоку от Миссисипи (а именно,
Флорида) имеет столицу
с названием индейского происхождения (столица "--- Таллахасси).

\subsubsection*{Самый большой второй по величине город}%THE LARGEST SECOND-LARGEST CITY 

Портланд, штат Мэн? Какой-то из Спрингфилдов? 
Частые, но неверные предположения.
Примерно до 1975 года правильным ответом был бы Канзас-Сити, штат Канзас, который затеняется городом Канзас-Сити, Миссури.
Затем некоторое время победителем был Колумбус, Джорджия, находящийся в тени столицы Огайо.
Однако мы живём в эпоху пригородов, и %(in the age of suburbia), 
перепись населения 2000 года показывает, что теперь эта честь принадлежит городу Глендейл, штат Калифорния (находится в тени Глендейла, Аризона).\heart

\subsubsection*{Естественные границы}%ЕСТЕСТВЕННЫЕ ГРАНИЦЫ (THE NATURAL BORDERS)

Конечно, Гавайи имеют только естественные границы.
Возможно, вы
подумали, что это было слишком легко, но люди часто не замечают
очевидного. \heart

\subsubsection*{Непересекаемые границы}%НЕПЕРЕСЕКАЕМЫЕ ГРАНИЦЫ (THE UNCROSSABLE BORDER)

Здесь намного сложнее.
Висконсин и Мичиган имеют общую длинную границу по озеру Мичиган, но её можно пересечь на пароме Манитовок "--- Ладингтон, сидя в своей машине.
Паром из Монток Пойнт %(Mantauk Point) 
(штат Нью-Йорк) на остров Блок %(Block Island) 
(штат Род-Айленд) пересекает не очень хорошо известную границу между
этими двумя штатами, и он только для пассажиров без машины.
Возможно, существуют и другие решения данной задачи.\heart

Можно задать схожий вопрос о части штата, попасть в которую на автомобиле из оставшейся части штата возможно, только проехав через другой штат (или Канаду, в случае с 
Пойнт Робертс, штат Вашингтон). %(Point Roberts).
Существует несколько таких мест, особенно около вечно меняющейся реки Миссисипи.%

\subsubsection*{Отдел странных названий}%ОТДЕЛ СТРАННЫХ НАЗВАНИЙ (DEPARTMENT OF ODD NAMES)

Уэст-Куодди-Хед %(West Quoddy Head) 
"--- самая восточная точка континентальных штатов США.\heart

\medskip

Иногда можно встретить утверждение, что если опустить требование \emph{континентальный}, то мыс Врангеля %(Cape Wrangel) 
на острове Атту, %(Attu Island) 
штат Аляска, является самой восточной точкой США, но я не принимаю в расчёт эти «Гринвичецентричные» доводы.
%(but I do not buy Greenwich-centered reasoning) 
Назовёте ли вы мыс Врангеля самой восточной точкой \emph{Аляски}?

\subsubsection*{Городской и деревенский}%ГОРОДСКОЙ И ДЕРЕВЕНСКИЙ (URBAN AND RURAL)

Нью-Джерси и Вермонт.

Эту и множество другой интересной информации можно найти в результатах
переписи 2002 года. 
%% по ссылке
%% \href{http://www.census.gov/prod/2002pubs/01statab/pop.pdf}{\url{www.census.gov/prod/2002pubs/01statab/pop.pdf}}.
%% Доступ из России закрыт!
\heart                          

\subsubsection*{С юга на север}% (CITIES NORTH AND SOUTH)

Токио, Алжир, Галифакс и, наконец, Венеция.
Широты этих городов равны
$35^\circ 40'$ с.",ш.; $36^\circ 50'$ с.",ш.; $44^\circ 53'$ с.",ш.; и $45^\circ 26'$ с.",ш. соответственно.
Обратите внимание на то, что последние два города разделяет 45-я параллель, и это позволяет нам яснее увидеть, что Венеция находится севернее.
Один уроженец Новой Шотландии однажды проспорил мне по этому случаю 1 доллар.
\heart

\subsubsection*{Односложный город}%ГОРОД В ОДИН СЛОГ (THE ONE-SYLLABLE CITY)

Йорк (York), Пенсильвания, и Трой (Troy), Нью"=Йорк, называются чаще
всего, но всё же Флинт (Flint), Мичиган, несмотря на существенное сокращение населения за последние годы, остаётся единственным односложным городом в США с населением более 100 тысяч человек.
Хотя если судить по тому, как произносят названия городов местные жители, победителем, несомненно, будет Нью-Арк («Норк», с длинным «о»), штат Нью"=Джерси.%
\heart

\subsubsection*{Вашингтоны и феминисты} %ВАШИНГТОНЫ И ФЕМИНИСТЫ (WASHINGTONS AND FEMINISTS)

{\sloppy 

Без проблем.
Езжайте на юг "--- через Орегон (Oregon), 
Неваду (Nevada) 
и Аризону (Arizona), 
затем на восток сквозь Нью-Мексико (New Mexico) 
в Оклахомовскую «ручку ковша», из северо-восточного угла Оклахомы (Oklahoma) 
вы попадаете в Миссури (Mis\-sou\-ri).
Здесь надо будет повернуть на север и из северо-западного угла штата проехать в Небраску (Nebraska), продолжая путь на запад в Вайоминг (Wyoming) и на север в Монтану (Montana), "--- довольно большой крюк для того, чтобы объехать Айдахо (Idaho).
В конце концов вы сможете снова развернуться и поехать на восток через Северную Дакоту (North Dakota), 
Миннесоту (Minnesota), 
Висконсин (Wiskonsin) 
и Мичиган (Michigan).
Теперь берите курс на юг в Огайо (Ohio) и на восток сквозь Западную Вирджинию (West Virginia) в Мериленд (Maryland) и в Вашингтон (Washington DC), округ Колумбия.\heart
 
}

\medskip

Чтобы пройти по этому маршруту, придётся несколько раз 
покинуть национальную систему автомагистралей, но мы полагаем, что вы никуда не торопитесь.

\subsubsection*{Учёный и медведь}%УЧЕНЫЙ И МЕДВЕДЬ (THE NATURALIST AND THE BEAR)

Изначальная идея была, конечно, что лагерь экспедиции находился на Северном полюсе, так как маршрут учёного (10 миль на юг, 10 миль на восток и 10 миль на север) является замкнутым контуром, %(to have been a closed loop), 
следовательно, медведь был белый.

Однако, как заметил Сол Голомб в одной из колонок 
Мартина Гарднера, %(Martin Gardner’s columns), 
на поверхности Земли существует бесконечно много других точек, где подобный путь будет замкнутым.

Некоторые из этих точек лежат на окружности с центром в Южном полюсе и радиусом чуть больше $10 + \slfrac5\pi$ мили.
Начав прогулку из такой точки, наш учёный после первых 10 миль окажется в некоторой точке $P$, 
находящейся на чуть дальше чем $\slfrac5\pi$ мили от Южного полюса.
Повернув на восток и пройдя 10 миль, он совершит кругосветное путешествие и вернётся в точку $P$, откуда 10 миль на север приведут его обратно в лагерь.

Другая окружность, радиусом чуть больше $10 + \slfrac5{(2\pi)}$ миль, тоже годится, во второй (восточной) части пути наш учёный должен будет дважды обойти вокруг Южного полюса и так далее.

В Антарктике медведи не водятся, но если бы водились, то наверняка были бы белыми.
Так что ответ не изменится.\heart

%%% \input{games.tex}

\chapter{Игры}
% \addcontentsline{toc}{chapter}{Игры}

\thispagestyle{empty}

\setlength{\epigraphwidth}{.66\textwidth}
\epigraph{Деньги никогда не были для меня серьёзной мотивацией, это просто способ считать очки.
Настоящий азарт "--- вести игру.\vspace{1ex}}{Дональд Трамп (1946---),
«Трамп: Искусство сделки»}
%Сами по себе деньги меня не интересуют, это только способ считать очки. Азарт в самой игре.  
%(Деньги никогда не были для меня серьёзной мотивацией – скорее способом вести счёт. Настоящее возбуждение получаешь от процесса игры)

Иногда  описание игры приводит к чудесной задаче.
А честная ли игра? А какова наилучшая стратегия? Особенность этой главы состоит в том, что каждая задача имеет две версии, различия между которыми весьма занимательны.
Здесь представлены четыре пары игр: в первой паре речь пойдёт о числах, во второй "--- о шляпах, в третьей "--- о картах, а в четвёртой "--- о гладиаторах.

\medskip

Начнём с классической игры, являющейся  хорошим примером класса вероятностных алгоритмов (как таковая она и использовалась Мануэлем Блюмом,  профессором Университета Карнеги"--~Меллона). %(Manuel Blum from  Carnegie Mellon University)

\subsection*{Сравнение чисел, версия I} % (COMPARING NUMBERS, VERSION I)
\rindex{Сравнение чисел, версия I}

Паула (злоумышленник) пишет на двух листочках бумаги по целому числу.
На числа нет никаких ограничений, кроме того, что они должны быть различными.
Она прячет в каждой руке по бумажке.

Виктор (жертва) выбирает руку Паулы, она открывает эту руку и показывает число на листочке бумаги.
Виктор теперь должен угадать, является ли это число б\'{о}льшим или меньшим из двух чисел Паулы.
Если он угадывает правильно, он выигрывает 1 доллар, если нет "--- проигрывает 1 доллар.

Очевидно, Виктор может обеспечить себе равные шансы в игре, например, подбрасывая монету, чтобы выбрать между «большее» и «меньшее».
Вопрос:  может ли Виктор, не зная ничего о характере Паулы, сыграть лучше, чем просто остаться при своих?

\subsection*{Сравнение чисел, версия II} %(COMPARING NUMBERS, VERSION II)
\rindex{Сравнение чисел, версия II}

Давайте теперь упростим Виктору задачу:
Паула чисел не загадывает, они выбираются независимо случайным образом из интервала $[0,1]$ с равномерным распределением (подойдут два числа, выданные стандартным генератором случайных чисел).

Но зато мы разрешаем Паулуе посмотреть на эти два случайных числа и
выбрать, которое из них показать Виктору.
Снова на кону 1 доллар, и Виктор должен решить, является ли
показанное ему число б\'{о}льшим или меньшим из двух чисел.
Сможет ли Виктор сыграть лучше, чем просто остаться при своих?
Каковы лучшие (то есть <<равновесные>>) стратегии у Виктора и Паулы?

\subsection*{Синие и красные шляпы, версия I} % (RED AND BLUE HATS, VERSION I)
\rindex{Синие и красные шляпы, версия I}

На каждого члена команды из $n$ игроков надета красная или синяя шляпа.
Каждый игрок видит, какого цвета шляпа у его товарищей, но свою шляпу он не видит.
Обмениваться информацией запрещено.
По сигналу все игроки одновременно должны назвать цвет своей шляпы.
После этого те игроки, которые угадали неправильно,  отправляются на казнь.

Перед игрой у команды есть возможность договориться о стратегии
(то есть установить набор правил, не обязательно одинаковых для всех игроков, какому игроку какой цвет называть, основываясь на том, что он видит).
Их задача "--- гарантировать максимально возможное число выживших, предполагая наихудший вариант распределения шляп.

% \medskip

Другими словами, допустим, что распределяющий шляпы противник знает о
командной стратегии и будет стараться всеми силами её расстроить.
Сколько игроков можно спасти?


\subsection*{Синие и красные шляпы, версия II} % (RED AND BLUE HATS, VERSION II)
\rindex{Синие и красные шляпы, версия II}

И снова на каждого из $n$ игроков команды надевается красная или синяя шляпа.
Но в этот раз игроки выстраиваются в колонну по одному так, что каждый игрок видит только шляпы впереди стоящих.
И снова каждый игрок должен угадать цвет своей шляпы, и  если он ошибётся, то будет казнён.
Но в этот раз игроки отвечают по очереди, начиная с конца колонны.
Например, $i$"~й игрок в шеренге видит, какого цвета шляпы у игроков с номерами $1, 2,\dots, i-1$, и слышит, что сказали игроки с номерами $n, n-1,\dots, i+1$.
(При этом он не знает, какие из ответов правильные, "--- казнь состоится позже.)
{\looseness1\par}

% \medskip

Как и прежде, у команды есть возможность договориться заранее о стратегии, которая бы гарантировала им максимально возможное число выживших.
Сколько игроков можно спасти при наихудшем раскладе?

\subsection*{Ставка на следующую карту, версия I} % (BETTING ON THE NEXT CARD, VERSION I)
\rindex{Ставка на следующую карту, версия I}

Паула тщательно тасует колоду, а затем начинает открывать по одной карте.
В любой момент Виктор может прервать её и поставить 1 доллар на то, что следующая карта будет красной.
Он делает ставку ровно один раз.
Если он ни разу не останавливает Паулу, то ставка автоматически делается на последнюю карту.

% \medskip

Какова лучшая для Виктора стратегия?
Насколько его шансы лучше, чем $50/50$? 
(Предполагается, что в колоде 26 красных и 26 чёрных карт.)

\subsection*{Ставка на следующую карту, версия II} % (BETTING ON THE NEXT CARD, VERSION II)
\rindex{Ставка на следующую карту, версия II}

И снова Паула тщательно тасует колоду и затем открывает по одной карте.
Виктор начинает играть, имея в наличии один доллар.
Он может в любой момент поставить  любую часть имеющейся у него на данный момент суммы на цвет следующей карты.
%% Его шансы на выигрыш не зависят от текущего состава колоды.
Так, например, он может не делать ставки до последней карты, цвет которой он, разумеется, будет знать, поставить всё и уйти домой с двумя долларами.

% \medskip

Существует ли стратегия, гарантирующая Виктору больший выигрыш, чем 2 доллара?
Если да, то какую максимальную сумму он может гарантированно выиграть? 

\subsection*{Гладиаторы, версия I} % (GLADIATORS, VERSION I)
\rindex{Гладиаторы, версия I}

У Паулы и Виктора есть по команде гладиаторов.
Гладиаторы Паулы обладают силой $p_1, p_2,\z\dots, p_m$, а гладиаторы Виктора "--- $v_1, v_2,\z\dots, v_n$.
Гладиаторы бьются до смерти один на один. Когда гладиатор силы $x$ встречается с гладиатором силы $y$, первый побеждает с вероятностью $x/(x+y)$, а второй "--- с вероятностью $y/(x+y)$.
Более того, если гладиатор силы $x$ побеждает, то он наследует силу
противника (видимо, потому что победа увеличивает его уверенность в себе), так что его сила увеличивается до $x+y$.
Аналогично, если побеждает второй гладиатор, его сила увеличивается с $y$ до $x+y$.

После каждого поединка Паула выставляет на ринг гладиатора (из тех в её команде, кто ещё остался в живых), и Виктор должен выбрать одного из своих гладиаторов для поединка.
Выигрывает та команда, в которой остаётся хотя бы один живой боец.

% \medskip

Какова наилучшая стратегия для Виктора?
Например, если Паула начинает с её лучшего гладиатора, должен ли в ответ Виктор выставить сильного или слабого?


\subsection*{Гладиаторы, версия II} % (GLADIATORS, VERSION II)
\rindex{Гладиаторы, версия II}

И снова Паула и Виктор должны противостоять друг другу в Колизее, но на этот раз сила не меняется "--- когда гладиатор побеждает, его сила остаётся той же, что была.

% \medskip

Как и прежде, перед каждым поединком Паула выбирает участника первой.
Какова лучшая для Виктора стратегия? Кого он должен выставить на бой, если Паула начинает с лучшего бойца?

%%% \input{games-sol.tex}

\section*{Решения и комментарии}

\subsubsection*{Сравнение чисел, версия I}% (COMPARING NUMBERS, VERSION I)

Насколько мне известно, данная задача была придумана Томом Ковером %(Tom Cover) 
в 1986 году%
\footnote{\emph{T. Cover}. Pick the largest number /\!/ {Open problems in communication and computation.} Springer, 1987. P. 152.}.
Удивительным образом, существует стратегия, гарантирующая Виктору победу с вероятностью больше 50",\%.

\medskip

До начала игры Виктор должен обзавестись таким вероятностным распределением на множестве целых чисел, что каждому целому числу назначается положительная вероятность.
(Например, он может подбрасывать монету до первой решки.
Если выпадает чётное число $2k$ орлов, то он выбирает целое число $k$, а если выпадет $2k-1$ орлов, ему нужно выбрать целое число $-k$.)

Если Виктор умён, он скроет это распределение от Паулы, но, как вы увидите позже, у него всё равно будет гарантия победы, даже если Паула узнает его секрет.

После того как Паула записала свои числа, Виктор выбирает целое число, используя своё вероятностное распределение, и прибавляет к нему~$\tfrac12$;
полученную величину $t$ назовём \emph{порогом}.
Например, если для рассмотренного выше распределения вышло $5$ орлов до первой решки, то его случайное целое число будет равно $-3$, и порог~$t$ будет равен~$-2 \tfrac12$.


Когда Паула начинает игру, Виктор подбрасывает монету, чтобы решить, какую руку выбрать, потом смотрит на число в этой руке.
Если число превышает $t$, он полагает, что это большее из чисел Паулы; если оно меньше чем $t$, то считает, что оно меньшее.

А почему стратегия Виктора работает? 
Предположим, что $t$ оказывается больше, чем оба числа Паулы.
Тогда ответ Виктора будет «меньшее» независимо от того, какое число
ему достанется, и тем самым шанс угадать равен $\tfrac12$.
Если $t$ меньше обоих чисел Паулы, Виктор с неизбежностью скажет «большее», и опять вероятность выигрыша будет равна $\tfrac12$.

Но с положительной вероятностью порог $t$ окажется между двумя числами Паулы, и тогда Виктор выигрывает вне зависимости от того, какую руку он выбрал.
Эта возможность и обеспечивает вероятность выигрыша более 50",\%.\heart

\medskip

Ни эта, ни какая-либо другая стратегия не даёт Виктору гарантию, что при некотором фиксированном $\varepsilon>0$ вероятность выигрыша превысит 50",\%${}+\varepsilon$.
Умная Паула может выбрать два последовательных многозначных целых числа и тем самым свести преимущество Виктора к самой малости.

\subsubsection*{Сравнение чисел, версия II}% (COMPARING NUMBERS, VERSION II)

Может показаться, что возможность решать, какое из чисел увидит Виктор, является для Паулы ничтожной компенсацией того, что не она выбирает числа.
Но вот эта версия игры как раз абсолютно честная:
Паула может исключить какое-либо преимущество Виктора в игре.

У неё простая стратегия "--- посмотреть на два случайных вещественных числа, а затем показать Виктору то, что ближе к~$\tfrac12$.

Такая стратегия не оставляет Виктору ничего лучше чистого угадывания.
Чтобы это понять, предположим, что число $x$, показанное ему, лежит между $0$ и $\tfrac12$.
Тогда скрытое число равномерно распределено на множестве $[0,x]\cup [1-x, 1]$ и, таким образом, с одинаковой вероятностью будет больше или меньше $x$.
Если $x>\tfrac12$, то рассматривается множество $[0, 1-x]\cup [x, 1]$ и далее рассуждение аналогично.

Конечно, Виктор может гарантировать вероятность $\tfrac12$ при любой
стратегии, не глядя на число и подбрасывая монету, так что игра абсолютно честная.
\heart

\medskip
Эту забавную игру я узнал в одном ресторане в Атланте.
За столом было много умных людей, и все они оказались в тупике.
Так что, если у вас не получилось найти эту красивую стратегию для
Паулы, вы в хорошей компании.

\subsubsection*{Синие и красные шляпы, версия I}% (RED AND BLUE HATS, VERSION I)

Не сразу очевидно, что можно спасти хоть кого-то.
Часто первой рассматривают \emph{стратегию большинства},
то есть если $n\z=10$, то каждый игрок называет цвет, который он видит на пяти или более из девяти товарищей.
Но это приведёт к десяти казням, если шляпы распределены пять на пять,
и наиболее очевидная модификация этой схемы при наихудшем раскладе
также закончится всеобщим истреблением.

\medskip

Тем не менее легко спасти $[n/2]$ игроков с помощью следующего приёма.
Игрокам надо разбиться на пары (скажем, муж и жена); каждый муж выбирает цвет шляпы жены, и каждая жена выбирает цвет, \emph{противоположный} цвету шляпы её мужа.
Очевидно, если у пары шляпы одного цвета, останется в живых муж, а если нет, выживет жена.

Чтобы понять, что это наилучший возможный вариант, представим, что цвета распределяются не противником, а случайным образом 
(например, по результату подкидывания монеты).
Независимо от стратегии, вероятность того, что какой-либо конкретный игрок выживет, равна $\tfrac12$.
Значит, математическое ожидание числа выживших равно $n/2$. 
Из этого следует, что минимальное число выживших не может превысить $[n/2]$.\heart

\subsubsection*{Синие и красные шляпы, версия II}% (RED AND BLUE HATS, VERSION II)

Эту версию игры мне рассказала Гириджа Нарликар из Bell Labs; %(Girija Narliar of Bell Labs)
она услышала её на одной вечеринке (предыдущая версия "--- мой ответ на задачу Гиринджи, хотя, несомненно, она была известна прежде)%
\footnote{Эта задача предлагалась на Всероссийской математической олимпиаде 1997 года, автор К.",А.",Кноп.  На олимпиаде предлагались две версии этой задачи "--- «трёхцветная» и «двуцветная» (\Vseros. Задачи №524 и №538). 
Задача для любого числа цветов, обсуждаемая после решения, полностью аналогична трёхцветной версии. "--- \emph{Прим. ред.}}.
В версии с колонной легко увидеть, что можно спасти $[n/2]$ игроков.
Например, игроки номер $n, n-2, n-4,\dots$
могут назвать цвет шляпы товарища, стоящего прямо перед ними, после
чего игроки номер $n-1, n-3,n-5,\dots$
повторяют предыдущий ответ и спасаются.

\medskip

Кажется, что с помощью какого-нибудь вероятностного рассуждения можно,
как и в версии с одновременным угадыванием, доказать, что $[n/2]$ "--- максимальное возможное число спасённых игроков.
Но нет "--- можно спасти всех игроков, кроме последнего!

Именно, стоящий последним игрок (бедняга!) должен сказать
«красная», если он видит впереди себя нечётное число красных шляп, и «синяя» в противном случае.
Теперь игрок номер $n-1$ может отгадать, какого цвета на нём шляпа.
Например, если он услышал, что игрок $n$ сказал
«красная», и видит чётное число красных шляп впереди себя, то он
знает, что шляпа на нём красная.

Таким же образом рассуждает каждый следующий игрок.
Игрок под номером
$i$ суммирует число красных шляп, которые он видит, и число услышанных
ответов «красная».
Если это нечётное число, он говорит «красная»,
если чётное "--- «синяя», и угадывает правильно (если никто не
напортачил).

Разумеется, гарантированно спасти последнего игрока нельзя, так что $n-1$ "--- наилучший возможный вариант.
\heart

\medskip

Стоит отметить (спасибо Джо Булеру %(Joe Buhler)
за напоминание), что даже при наличии $k$ различных цветов шляп вместо
двух достаточно будет пожертвовать лишь последним игроком.
Именно, стоящий последним кодирует цвета как $0$, $1$, $2$, \dots, $k-1$ и суммирует все цвета шляп, которые он видит, по модулю $k$.
Затем он объявляет цвет соответственно полученной сумме, и теперь каждый последующий игрок может определить цвет своей шляпы, вычитая из заявленного первым цвета сумму цветов, которые он видит, и цветов, названных предыдущими игроками.

Стратегия последнего игрока (при $k=10$), возможно, используется вашим банком для генерирования последней цифры номера банковского счёта.

\subsubsection*{Ставка на следующую карту, версия I}% (BETTING ON THE NEXT CARD, VERSION I)

Похоже, что Виктор может добиться небольшого преимущества, дождавшись
момента, когда в колоде останется больше красных карт, чем чёрных, и
сделав ставку в этот момент.
Конечно, этого может никогда и не случиться, и если так, то Виктор проигрывает.
Компенсируется ли это гораздо большей вероятностью малого выигрыша?

В действительности это честная игра.
У Виктора не только нет способа добиться какого-либо преимущества, у
него нет и стратегии, ведущей к проигрышу.
Все стратегии равно неэффективны.

Это следствие теоремы Дуба об остановке %(of the martingale stopping time theorem)
и может быть легко доказан индукцией по числу карт каждого цвета в~колоде.
Однако существует другое доказательство, которое я приведу ниже и которое, без сомнения, содержится в «Книге»\footnote{Как известно многим читателям, великий, ныне покойный математик Пол Эрдёш часто говорил о Книге, имеющейся у Бога, в которой записаны лучшие доказательства для всех теорем.
Я представляю себе, что Эрдёш с великим удовольствием читает сейчас эту книгу, но нам придётся ещё подождать.}.

Предположим, что Виктор выбрал некоторую стратегию $S$.
Применим $S$ к~несколько модифицированной версии этой задачи.
В новом варианте Виктор прерывает Паулу, как и прежде, но на этот раз он делает ставку не на \emph{следующую} карту, а на \emph{последнюю} карту в колоде.

Разумеется, в любой ситуации у последней карты точно такая же вероятность оказаться красной, как и у следующей карты в колоде.
Таким образом, стратегия $S$ имеет в новой игре такое же
математическое ожидание, как и в предыдущей.

И, конечно же, проницательный читатель уже заметил, что новый вариант
игры не слишком интересен:
Виктор выигрывает, если последняя карта красная, независимо от стратегии.
\heart

\medskip
В книге Т. Ковера и Дж. Томаса% «Элементы теории информации»
\footnote{\emph{T. Cover, J. Thomas}. {Elements of Information Theory}. Wiley (1991).} 
эта игра обсуждается на основе результата статьи Т. Ковера%
\footnote{\emph{T. Cover}. Universal Gambling Schemes and Complexity Measures of Kolmogorov and Chaitin. % /\!/
{Statistics Department Technical Report \#12}. Stanford University, October 1974.}.

Модифицированная версия игры %«Следующая карта "--- красная»
напоминает об игре, которая много лет назад была описана "--- в сатирических целях "--- в журнале «Гарвардский пасквилянт»\footnote{Harvard Lampoon. Vol. CLVII, No. 1, March 30, 1967. P.~14--15.
Номер журнала называется «Games People Play Number», и авторами рассматриваемой игры являются, по всей видимости, Д. Кенни и Д. Макклелланд.%(D.C. Kenney and D.C.K. McClelland).
}.
Называлась она «Великая игра во искупление и отпущение грехов».
По правилам игроки делают ходы, бросая кубик, и двигаются по круговому полю, похожему на поле «Монополии», пока каждый из них не оказывается на клетке с надписью «Смерть».
Так кто же выигрывает?

В начале игры всем сдаётся по одной карте «Шанс», рубашками вверх.
В конце игры карты открываются, и те, у кого карта «Проклят», проигрывают.

\subsubsection*{Ставка на следующую карту, версия II}% (BETTING ON THE NEXT CARD, VERSION II)

Наконец-то Виктору досталась действительно хорошая игра.
Но может ли он гарантированно сыграть лучше, чем просто удвоить свои деньги, вне зависимости от того, как распределены карты?

\medskip

Для начала полезно будет подумать, какие же из стратегий Виктора будут
оптимальными в смысле математического ожидания.
Легко видеть, что, как только в колоде остаются карты одного цвета, Виктор должен ставить всё на каждом ходу до конца игры.
Назовём стратегию, которая следует этому правилу, \emph{разумной}.
Ясно, что каждая оптимальная стратегия является разумной.

Поразительно, но обратное также верно: для всех разумных стратегий
математическое ожидание выигрыша будет одно и то же.
Чтобы увидеть
это, рассмотрим вначале следующую <<чистую>> стратегию: Виктор
представляет себе какое-то конкретное фиксированное распределение
красных и чёрных карт в колоде и ставит всё, что у него есть, на
каждую карту, согласно этому распределению.

Конечно же, с такой стратегией Виктор почти всегда разоряется, но если он выиграет, то сможет купить весь земной шар "--- он унесёт домой $2^{52}$ долларов, то есть около 50 квадриллионов.
Поскольку существуют $\binom{52}{26}$\vspace{0pt minus6pt} способов
распределения цвета карт в колоде, математическое ожидание выигрыша Виктора равно $2^{52}\mathbin/\binom{52}{26} \approx 9{,}0813$.

Разумеется, эта стратегия нереалистична, но согласно нашему определению она разумна, и, что особенно важно, \emph{каждая разумная стратегия является комбинацией чистых стратегий подобного типа}.
Чтобы это понять, вообразите себе, что у Виктора есть $\binom{52}{26}$ аспирантов, играющих для него, и каждый применяет свою чистую стратегию (отличную от других).

Мы утверждаем, что каждая разумная стратегия Виктора сводится к некоторому распределению  его первоначальной суммы в 1 доллар среди этих помощников.
Если в какой-то момент его помощники ставят $x$ долларов на красную и $y$ долларов на чёрную карту, то это равносильно тому, что Виктор сам ставит $x-y$ на красную карту (если $x > y$) или $y-x$ на чёрную (если $y>x$).

Каждая разумная стратегия даёт некоторое распределение следующим образом.
Скажем, Виктор хочет поставить $0{,}08$ долларов на то, что первая карта будет красной.
Это означает, что те его помощники, что первую ставку делают на
красное, получают в сумме $0{,}54$, в то время как те, что ставят на чёрную, получают только $0{,}46$.
Если, выиграв, Виктор планирует поставить на следующем ходу $0{,}04$ на чёрную, он выделяет на $0{,}04$ больше помощникам со ставками «красная-чёрная», чем «красная-красная».
Продолжая таким образом, каждый помощник в итоге получит положенную ему сумму денег.

Теперь заметим, что любая выпуклая комбинация стратегий с одинаковым
математическим ожиданием имеет то же математическое ожидание.
Отсюда следует, что каждая разумная стратегия для Виктора имеет одно и
то же математическое ожидание выигрыша в $9{,}08$ (дающее ожидаемую прибыль в $8{,}08$ долларов).
В частности, все разумные стратегии оптимальны.

Но одна из этих стратегий \emph{гарантирует} $9{,}08$ долларов, а именно та, в которой ставка в 1 доллар поровну делится между помощниками.
Поскольку нельзя гарантировать больше, чем математическое ожидание, эта стратегия является наилучшей.\heart

\medskip

На самом деле данную стратегию достаточно легко реализовать (предполагая, как и раньше, что валюту США можно делить до бесконечности).
Если в колоде остаётся $b$ чёрных и $r$ красных карт, где $b\ge r$, то Виктор ставит $(b - r)/(b + r)$ от имеющейся у него на данный момент суммы на чёрное; если $r > b$, то он ставит $(r - b)/(b + r)$ часть его денег на красное.

\medskip

Если изначальный доллар не делится до бесконечности, а состоит из 100
неделимых центов, то ситуация усложняется.
В этом случае выигрыш
Виктора будет меньше примерно на доллар.
Динамическая программа
(написанная Иоаной Димитриу из Калифорнийского университета в Беркли)
демонстрирует, что при оптимальной игре Виктор завершает игру с
$8{,}08$ долларами.
Приведённая ниже таблица показывает, сколько у
Виктора центов на каждой стадии правильно ведущейся игры.

\begin{figure}[!ht]
\centering
% \includegraphics[width=\textwidth]{Figs/Games/ioana} % scale=0.67
\includegraphics[scale=1.06]{wink-38}
\end{figure}

Например, к моменту игры, когда в колоде остаётся 12 чёрных и 10
красных карт, у Виктора должно быть 129 центов.
Сравнивая с числами
сверху и справа, мы видим, что ему следует поставить либо 11 центов (в
этом случае Паула позволит ему выиграть), либо 12~центов (в этом
случае он проиграет) на то, что следующая карта чёрная.

Заметьте, что в 100-центовом варианте игры Виктор делает ставки осторожнее, чем в непрерывной её версии.
Если же он решит ставить каждый раз число центов, ближайшее к $(b - r)/(b + r)$ суммы его денег, то Паула разорит его ещё до того, как выйдет половина колоды!

% \medskip

Я услышал эту задачу от Раса Лайонса из Индианского университета, %(Russ Lyons, of Indiana University), 
который услышал её от Юваля Переса, %(Yuval Peres), 
который услышал её от Серджиу Харта. % (Sergiu Hart).
Серджиу Харт не помнит, где он её услышал, но подозревает, что, скорее всего, Мартин Гарднер писал о ней десятилетия тому назад.

\subsubsection*{Гладиаторы, версия I}% (GLADIATORS, VERSION I)

Как и в первой версии «Ставки на следующую карту», все стратегии для Виктора одинаково хороши.

Чтобы это увидеть, представим себе, что сила гладиаторов "--- это деньги.
Паула начинает игру с суммой в $P = p_1 + p_2 + \ldots + p_m$ долларов, 
а Виктор с $V = v_1 + v_2 + \ldots + v_n$.
Когда гладиатор силы $x$ побеждает гладиатора силы $y$, команда первого гладиатора получает $y$ долларов, в то время как команда второго теряет $y$ долларов.
Общее количество денег всегда остаётся одним и тем же.
В итоге либо Паула закончит игру с $P+V$ долларами, а Виктор с нулём, либо наоборот.

Ключевое наблюдение здесь состоит в том, что каждый поединок "--- честная игра.
Если Виктор выставляет гладиатора силы $x$ против гладиатора силы $y$, то ожидаемая прибыль составит 
\[\frac{x}{x+y}y + \frac{y}{x+y}(-x) =0.\]

Таким образом, весь турнир "--- честная игра, из чего следует, что для Виктора ожидаемый выигрыш по окончании игры равен той сумме, с которой он начинал, то есть $V$. %тут и далее замена $P\to V$ --- Питер согласился https://github.com/anton-petrunin/test/wiki
Значит,
\[q\cdot(P + V) + (1-q)\cdot0 = V,\]
где $q$ "--- вероятность того, что Виктор выигрывает.
Таким образом, $q = V/(P+V)$,
независимо от чьей-либо стратегии в турнире.
\heart

\medskip
Вот ещё одно, более комбинаторное доказательство, придуманное одним из моих любимых соавторов, Грэмом Брайтуэллом из Лондонской школы экономики. %(Graham Brightwell of London School of Economics).

Применяя приближение рациональными числами и избавляясь от знаменателей, можно предположить, что силы гладиаторов выражаются целыми числами.
Выдадим каждому гладиатору $x$ шариков, если его начальная сила равнялась $x$.
Когда два гладиатора сражаются, их шарики случайным образом
выстраиваются вертикально; тот, кому принадлежит шарик, оказавшийся сверху,побеждает (это случается с требуемой вероятностью $x/(x+y)$), и шарики проигравшего достаются победителю.

%% Новый набор шаров выжившего гладиатора имеет такое же равномерное вероятностное распределение в начальном вертикальном порядке, как если бы он только что начал игру с полным набором шаров.
%% Отсюда следует, 
Ясно, что результат каждого поединка не зависит от предыдущих событий, что и требовалось доказать.
Вне зависимости от стратегии, Виктор выигрывает тогда и только тогда, когда самый верхний из всех шариков принадлежит ему.
Это случается с вероятностью $V/(P+V)$.

\subsubsection*{Гладиаторы, версия II}% (GLADIATORS, VERSION II)

Очевидно, что изменение правил приводит к совершенно отличным от
предыдущей версии стратегическим соображениям в игре, не так ли? Нет,
опять стратегия не имеет значения!

\medskip

На сей раз мы превратим каждого гладиатора
в электрическую лампочку.

Для математика идеальная лампочка обладает следующим свойством: её
срок службы не имеет памяти.
Это означает, что знание того, как долго лампочка горела, абсолютно
ничего нам не говорит о том, через какое время она перегорит.

Вы, возможно, знаете, что единственное вероятностное распределение, обладающее таким свойством, "--- экспоненциальное.
Если ожидаемая (средняя) продолжительность жизни лампочки равна $x$, то вероятность того, что она всё ещё горит в момент времени $t$, будет равна $e^{-t/x}$.
Однако для данной задачи нам не нужны формулы.
Необходимо только знать, что существует вероятностное распределение без памяти.

Рассмотрим две лампочки со средней продолжительностью жизни $x$ и $y$ соответственно.
Вероятность того, что первая будет гореть дольше второй, равна $x/(x+y)$.
Чтобы увидеть это, не применяя матанализ, предположим, что у нас имеется один светильник, который использует только лампочки типа «$x$», и другой, использующий только лампочки типа «$y$».
Каждый раз, когда лампочка перегорает, мы заменяем её на другую того же типа.
Когда лампочка перегорает, вероятность того, что это $y$-лампочка, является константой, не зависящей от прошлого.
Но эта константа должна быть равной $x/(x+y)$, потому что за долгий промежуток времени $y$-лампочки и $x$-лампочки будут использованы в пропорции $x : y$.

Вернёмся в Колизей.
Представим себе, что поединок двух гладиаторов соответствует включению соответствующих им лампочек.
Они горят до тех пор, пока один из них (проигравший) не перегорает, затем победителя выключают до следующего боя.
Так как распределение не имеет памяти, сила победителя в следующем поединке не изменяется.
Замена гладиаторов лампочками, может быть, и не совсем удовлетворяет зрителей, зато является действенной моделью для сражений.

На протяжении турнира у Паулы и Виктора горит ровно по одной лампочке в любой момент времени.
Победителем является тот, чьё общее время горения (всех лампочек/гладиаторов в её/его команде) больше.
Поскольку это не имеет никакого отношения к порядку, в котором включались лампочки, вероятность победы Виктора не зависит от стратегии.
(Заметим, что эта вероятность "--- более сложная функция от сил гладиаторов, чем в предыдущей игре.)
\heart

\medskip

Игра, где сила не меняется, описана в статье Каминского, Лукса и Нельсона%
\footnote{\emph{K. S. Kaminsky, E. M. Luks, P. I. Nelson}. Strategy, Nontransitive Dominance and the Expo\-nen\-tial Distribution /\!/ {Austral. J. Statist.} 1984. Vol.~26, no.~2. P.~111--118.}.
У меня есть теория, как появилась другая игра: кому-то очень понравилась эта задача, и он запомнил ответ (все стратегии одинаково хороши), но забыл условие.
Когда же он пытался воссоздать правила игры, то было совершенно естественно ввести условие наследования силы, чтобы получился <<мартингал>>.



\chapter{Алгоритмы}
% \addcontentsline{toc}{chapter}{Алгоритмы}

\thispagestyle{empty}

%Achievement is largely the product of steadily raising one’s level of aspiration and expectation.
%Jack Nicklaus (1940 --) “My Story”

\setlength{\epigraphwidth}{.65\textwidth}
\epigraph{Успех в значительной степени является результатом неуклонного роста наших устремлений и ожиданий.\vspace{1ex}}{Джек Никлаус (1940"--~), «Моя история»}


%\epigraph{По большей части успех есть результат неуклонного повышения уровня запросов и надежд.}{---Джек Никлаус (1940---) «Моя история»}

Множество увлекательных математических задач закручено вокруг алгоритмов.
Обычно вам 
%% (жертвам) 
предлагается некая ситуация вместе с набором возможных операций и целевое состояние.
Вы можете или не можете выбирать, как применять эти операции.
Вас спросят: «Возможно ли достичь целевого состояния?», или, например, «Возможно ли \emph{избежать} целевого состояния?», или, иногда, «А за сколько шагов?».

Как правило, при выполнении операции что-то меняется в лучшую сторону, но при этом, возможно, что-то портится в другом месте.
Как определить, что цель достижима?

Наша вводная задача была предложена на I Всероссийской математической олимпиаде\footnote{%  \cite[№7]{VsMO},
\VsMO. Задача №7, автор А.",С.",Шварц. "--- \emph{Прим. ред.}}
1961 года.%

\subsection*{Знаки в таблице}% (SIGNS IN AN ARRAY)
\rindex{Знаки в таблице}

Пусть дана таблица $m\times n$, в клетки которой вписаны вещественные числа, и разрешается одновременно менять знак у всех чисел некоторой строки или некоторого столбца.
Докажите, что можно поменять знаки таким образом, что суммы чисел, стоящих в любой строке и любом столбце, станут неотрицательными.

\begin{figure}[h]
\vspace{-\jot}
\centering
% \includegraphics[scale=0.6]{Figs/Algorithms/array}
\includegraphics[scale=.85]{mp/wink-16}
\vspace{-\jot}
\end{figure}

\paragraph{Решение}
Поменяв знаки в строке с отрицательной суммой, мы выправим данную сумму, но, возможно, испортим сумму в каком-то столбце.
Как же можно убедиться, что мы улучшили позицию?



Данная задача соответствует первому из следующих классических типов задач.
В задачах на алгоритмы обычно предлагается начальное положение, целевое положение и набор операций, которые можно использовать, чтобы улучшить ситуацию.
Требуется доказать одно из следующих утверждений (но не обязательно известно, которое):
\begin{enumerate}[label=(\arabic*),noitemsep,leftmargin=\parindent,labelsep=3.5pt]
\item Существует (конечная) последовательность операций, которая приведёт к целевому положению.
\item Любая последовательность операций в конечном итоге достигнет целевого положения.
\item Каждая последовательность операций достигает цели за одинаковое число шагов.
\item Никакая последовательность операций не может достичь цели.
\end{enumerate}

Алгоритмические задачи обычно решаются нахождением параметра%
\footnote{Называемого полуинвариантом. "--- \emph{Прим. ред.}}
$P$ "--- некоего числового показателя состояний, который каким-либо
образом отражает, насколько мы приблизились продвижения к целевому состоянию.

Для доказательства утверждения (1) нужно показать, что до того, как вы достигнете целевого состояния, всегда будет существовать операция (или последовательность операций), улучшающая $P$.
Чтобы не попасть в апорию Зенона (последовательность все меньших
шагов, не достигающая цели), возможно, придётся доказать, что $P$
можно всегда улучшить по крайней мере на некоторую фиксированную величину или что существует только конечное число возможных позиций.

Для доказательства утверждения (2) вы делаете то же самое, но показываете, что любая операция улучшает $P$.

Чтобы доказать утверждение (3), вы показываете, что каждая операция увеличивает $P$ на одну и ту же величину.

Чтобы доказать утверждение (4), вы показываете, что не существует операции, улучшающей $P$, а для достижения цели требуется улучшение.

\medskip

Вернёмся к задаче с таблицей.
Мы видим, что общее число строк и
столбцов с неотрицательной суммой "--- неправильный параметр.
Это
число может уменьшаться даже тогда, когда строка с отрицательной
суммой поменяла знак.
Вместо этого попробуем положить параметр $P$
равным сумме всех чисел в таблице.
Если поменять знаки в строке с
суммой $-S$, то параметр $P$ увеличится на $2S$, так как $P$ можно
записать как сумму сумм всех строк (аналогично для столбцов).
Поскольку имеется только конечное число достижимых позиций (а именно,
не более чем $2^{m+n}$) и поскольку $P$ увеличивается всякий раз,
когда меняются знаки в строке или столбце с отрицательной суммой,
должен настать момент, когда сумма в каждой строке и каждом столбце
будет неотрицательна.

Эта задача "--- типа (1), но её можно также переформулировать как
задачу типа (2).
Для этого следует добавить условие, что можно менять
знаки только в строках и столбцах с отрицательными суммами, а затем
потребовать доказать, что вы достигнете такого момента, когда сумма в
каждой строке и каждом столбце будет неотрицательной.

\medskip

{
% \sloppy

Задачи, приведённые ниже, могут потребовать значительно большей изобретательности для отыскания параметра $P$.

}

\subsection*{Инфекция на шахматной доске}% (THE INFECTED CHECKBOARD)
\rindex{Инфекция на шахматной доске}

Инфекция распространяется по клеткам шахматной доски $n \times n$ следующим образом: если у клетки два или более инфицированных соседа, то она также заражается.
(Соседями считаются только клетки с общей стороной, так что у каждой клетки имеется максимум четыре соседа.)

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.6]{Figs/Algorithms/diag}
\includegraphics{mp/wink-17}
\end{figure}

Предположим, например, что все $n$ клеток на главной диагонали инфицированы.
Тогда инфекция распространится на соседние диагонали и в итоге на всю доску.

Докажите, что нельзя заразить всю шахматную доску, если изначальное число инфицированных клеток меньше $n$.

\subsection*{Пустое ведро}% (EMPTYING A BUCKET)
\rindex{Пустое ведро}

Имеются три больших ведра, в каждое налито целое число унций жидкости.
В любой момент вы можете удвоить объём жидкости в одном из вёдер, долив туда из ведра с б\'{о}льшим объёмом жидкости.
Другими словами, разрешается переливать жидкость из ведра, содержащего $x$ унций, в ведро, содержащее 
$y\le x$ унций, до тех пор, пока там не станет $2y$ унций (а в первом ведре останется $x-y$).

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.6]{Figs/Algorithms/buckets-ru}
\includegraphics{mp/wink-18}
\end{figure}

Докажите, что, независимо от начального состояния, вы сможете вылить всю жидкость из одного из вёдер.

\subsection*{Фишки по углам}% (PEGS ON THE CORNERS)
\rindex{Фишки по углам}

Четыре фишки начинают ходить с углов некоего квадрата на плоскости.
В любой момент одна фишка может перепрыгнуть через другую,
встав на том же расстоянии с противоположной стороны.
Фишка, через которую перепрыгнули, остаётся на месте.
Возможно ли передвинуть все фишки по этим правилам так, чтобы они оказались в углах большего квадрата?


\begin{figure}[b]
% \vspace{-\baselineskip}
\centering
% \includegraphics[scale=0.6]{Figs/Algorithms/pegs}
\includegraphics{mp/wink-19}\hspace*{-4mm}
\end{figure}

\subsection*{Фишки на полуплоскости}% (PEGS ON THE HALF-PLANE)
\rindex{Фишки на полуплоскости}

На оси $X$ и ниже её в каждой вершине целочисленной решётки координатной плоскости  стоит по фишке.
В любой момент фишка может перепрыгнуть через соседнюю с ней фишку (по горизонтали, вертикали или диагонали) и встать на следующую вершину решётки при условии, что она не занята.
При этом фишка, через которую перепрыгнули, снимается с поля.

Может ли фишка продвинуться произвольно далеко наверх от оси~$X$?

\subsection*{Фишки на квадрате}% (PEGS IN A SQUARE)
\rindex{Фишки на квадрате}

И снова фишки расположены в вершинах решётки на плоскости, только в этот раз в квадрате $n\times n$.
В данной задаче фишки могут прыгать только по горизонтали или вертикали и фишка, через которую перепрыгнули, убирается с поля.
Требуется сократить число фишек с $n^2$ до $1$.

Докажите, что в случае, когда $n$ делится $3$, этого сделать нельзя!


\subsection*{Кульбиты многоугольника}% (FLIPPING THE POLYGON)
\rindex{Кульбиты многоугольника}

В каждой вершине многоугольника написано число; сумма этих чисел положительна. 
Один ход состоит в том, что у одного из отрицательных чисел знак
меняется на противоположный, и при этом новое значение вычитается из
чисел, стоящих в двух соседних вершинах (так что сумма всех чисел не меняется).

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.6]{Figs/Algorithms/pent}
\includegraphics{mp/wink-20} 
\end{figure}

Докажите, что по таким правилам можно сделать лишь конечное число
ходов: как бы мы ни выбирали очередую <<отрицательную>> вершину, в
какой-то момент все числа окажутся положительными и тем самым дальнейшие ходы
станут невозможны.

\subsection*{Лампочки по кругу}% (LIGHT BULBS IN A CIRCLE)
\rindex{Лампочки по кругу}

Лампочки расставлены по кругу и пронумерованы числами от $1$ до $n$.
Изначально они все включены.
В момент времени $t$ вы смотрите на лампочку номер $t$ (mod ${n}$) и если она включена,  меняете состояние у лампочки $t + 1$ (mod ${n}$),
то есть выключаете её, если она включена, и включаете, если она выключена.
Если лампочка $t$ выключена, то вы ничего не делаете.

Докажите, что если ходить и ходить по кругу подобным образом, то в конце концов наступит момент, когда все лампочки снова будут включены.

\subsection*{Жуки на многограннике}% (BUGS ON A POLYHEDRON)
\rindex{Жуки на многограннике}

На каждой грани выпуклого многогранника живёт по жуку.
Жуки ползают по периметру своеих граней, возможно с переменными (и
разными) скоростями, но все время по часовой стрелке.
Докажите, что невозможно создать такое расписание движения, чтобы
каждый жук мог обойти свою грань и вернуться в исходную точку, ни с кем не столкнувшись.

\subsection*{Жуки на числовом луче}% (BUGS ON THE LINE)
\rindex{Жуки на числовом луче}

В каждой целочисленной точке на числовом луче~$[1;+\infty)$ стоит зелёная, жёлтая или красная лампочка.
Жук выставляется в точку~$1$ и ползёт, подчиняясь следующим правилам:
\begin{itemize}[noitemsep,leftmargin=\parindent,labelsep=3.5pt]
\item если он видит зелёный свет, он переключает его на жёлтый и передвигается на один шаг вправо; 
\item если он видит жёлтый свет, он переключает его на красный и передвигается на один шаг вправо; 
\item если же он видит красный свет, он переключает его на зелёный и передвигается на один шаг \emph{влево}.
\end{itemize}

В конце концов жук либо свалится с левого конца, либо уползёт на бесконечность вправо.
Затем второй жук выставляется в точку~$1$, затем третий.

Докажите, что если второй жук свалился с левого конца, то третий жук уползёт на бесконечность.

\begin{figure}[b]
\centering
% \includegraphics[scale=0.5]{Figs/Algorithms/bar}
\includegraphics{mp/wink-21}
\end{figure}

\subsection*{Как разломать шоколадку}% (BREAKING A CHOCOLATE BAR)
\rindex{Как разломать шоколадку}

Дана прямоугольная плитка шоколада, разделенная на $m\times n$ квадратных долек. 
Требуется разломить её на одиночные дольки.
За один шаг вы можете взять один кусок и разломить его по вертикальной или горизонтальной линии.


Докажите, что, какой бы вы метод ни выбрали, вам потребуется одно и то же  число шагов.


%%% \input{algorithms-sol.tex}

\section*{Решения и комментарии}

\subsubsection*{Инфекция на шахматной доске}% (THE INFECTED CHECKBOARD)


Эта красивая задача появилась на Московской городской олимпиаде%
\footnote{Автор А.",Д.",Рикун. См.: Задачи XLIX Московской городской математической олимпиады /\!/ {Квант}. 1986. №",9. С. 57. "--- \emph{Прим. ред.}} в 1986 году,
а затем перекочевала в Венгрию\footnote{\emph{G. Pete}. Hogyan gyepesítsünk kockát? /\!/ {Polygon (Szeged)}. 1997. Vol.~VII, no.~1. P.~69--80. "--- \emph{Прим. ред.}}.
В случае произвольного расположения начальных клеток такой процесс называется \emph{двумерной бутстрепной перколяцией}.
Прекрасный математический анализ этого процесса был сделан Анде Холройдом%
\footnote{\emph{A. Holroyd}. Sharp metastability threshold for two-dimensional bootstrap percolation /\!/ {Probab. Theory Related Fields}. 2003. Vol.~125, no.~2. P.~195--224.} (ныне профессор Университета Британской Колумбии).
Эта задача попала ко мне от Джоэла Спенсера %Joel Spenser, NYU) 
из Нью-Йоркского университета, который утверждал, что существует «решение в одну строку».
Как вы увидите, это не слишком большое преувеличение.


% \begin{wrapfigure}{r}{40mm}
% \vskip-\baselineskip
% \centering
% % \includegraphics[scale=1.5]{Figs/Algorithms/sick}
% \includegraphics{mp/wink-170}
% \end{wrapfigure}

\medskip

Пример с диагональю может натолкнуть на неверный путь, когда пытаются доказать, что в начальный момент инфицированные клетки должны быть в каждой строке или столбце.
Но это далеко не так.
Например, при расположении инфицированных клеток, показанном на рисунке, заражается вся доска.


\begin{figure}[h]
\centering
% \includegraphics[scale=1.5]{Figs/Algorithms/sick}
\includegraphics[scale=.95]{mp/wink-170}
\end{figure}

Существует великое множество способов заразить всю доску при помощи $n$ изначально инфицированных клеток, но, оказывается, нет способа сделать это с меньшим числом.
Здесь нужен магический параметр $P$, но какой?

Этот параметр "--- периметр!
Когда клетка заражена, по меньшей мере две из её сторон сливаются с внутренностью заражённой территории и максимум две стороны добавляются к её границе.
Следовательно, периметр заражённой территории не может увеличиваться.
Поскольку периметр всей доски равен $4n$ (в предположении, что клетки единичные), начальная заражённая территория должна содержать минимум $n$ клеток.
\heart

\medskip
Дополнительное упражнение для тех, кому интересно: докажите, что $n$ изначально инфицированных клеток необходимо даже тогда, когда верх и низ доски склеены так, что получился цилиндр.
Если же ещё склеить правую и левую стороны (так что получится тор), то достаточно (и необходимо) $n-1$ изначально инфицированных клеток.
Периметр здесь больше не поможет,
работает другой подход, найденный Брюсом Рихтером (Университет Ватерлоо) %(Bruce Richter, University of Waterloo) 
и вашим автором.

\subsubsection*{Пустое ведро}% (EMPTYING A BUCKET)

Ещё одна красивая задача из бывшего Советского Союза, которая была представлена на V Всесоюзной математической олимпиаде%
\footnote{% \cite[№148]{VsMO}
\VsMO. Задача №148, автор Г.",А.",Гальперин.
Первое решение практически совпадает с приведённым в задачнике <<Кванта>>  (Задача М115 /\!/ {Квант}. 1972. №",8. С. 61). "--- \emph{Прим. ред.}} в Риге в 1971 году.
Позже она появлялась (уже без хозяйственного инвентаря) на математической олимпиаде Патнема в 1993~году.
Задача попала ко мне от Кристиана Боргса из лаборатории «Microsoft Research». %(Christian Borgs of Microsoft Research).
Я покажу два решения "--- одно моё, комбинаторное, и второе "---
красивое теоретико-числовое доказательство, найденное Сванте Янсоном
из Уппсальского университета
%% , Швеция 
(а также, независимо от него, Гартом Пэйном). 
Я не знаю, которое из двух решений, если не третье, предполагалось изначально.

\medskip

В решении Сванте за параметр $P$ берётся содержимое конкретного ведра и показывается, как можно каждый раз уменьшать $P$ и довести его до нуля.
В моём доказательстве, напротив, показывается, как можно каждый раз \emph{увеличивать} $P$ до тех пор, пока одно из оставшихся вёдер не окажется пустым.

Чтобы доказать последнее утверждение, во-первых, отметим, что можно
предположить, что ровно одно из вёдер содержит нечётное число унций
жидкости.
Действительно, если нет «нечётных» вёдер, то можно
масштабировать задачу, разделив все объёмы на подходящую степень
двойки.
Если же «нечётных» вёдер больше двух, то переливание из
одного «нечётного» ведра в другое уменьшит их количество на~$2$.

Во-вторых, заметим, что с нечётным и чётным ведром всегда можно
сделать \emph{обратный ход}, то есть вылить половину содержимого
чётного ведра в нечётное.
Действительно, поледовательно переливая
воду (по правилам) только между этими двумя ведрами, после какого-то
числа шагов вы вернётесь в начальное состояние.
Состояние
непосредственно перед тем, как вы возвращаетесь к начальному, и
является результатом вашего «обратного хода».

И последнее: мы утверждаем, что, пока нет пустого ведра, содержимое
нечётного ведра всегда можно увеличить. В самом деле,
если есть ведро, объем воды в котором делится на 4, то обратным ходом можно половину его перелить в нечётное ведро.
Если же такового нет, то его легко получить, совершив одно переливание между двумя чётными вёдрами.
\heart

\medskip
А вот доказательство Сванте, в его собственном изложении.

\medskip

Обозначим число унций жидкости, которое изначально содержалось в вёдрах $A$, $B$ и $C$, через $a$, $b$ и $c$, где $0<a\le b\le c$.
Я опишу последовательность шагов, приводящую к тому, что минимальный
из трёх объёмов жидкости станет меньше чем $a$; повторяя эту
процедуру, мы придем к искомому результату.

Пусть $b = qa + r$, где $0\le r<a$ и $q\ge 1$ "--- целое число.
Запишем $q$ в двоичной системе: $q=q_0+2q_1+\ldots+2^nq_n$, где каждое $q_i$ "--- это $0$ или~$1$, причём $q_n = 1$.

Проделаем $n+1$ шаг, пронумеровав шаги числами $0,\dots, n$, следующим образом: на $i$-м шаге  мы выливаем жидкость из $B$ в $A$, если $q_i = 1$, и из $C$ в $A$, если $q_i = 0$.
Поскольку мы всё время льём жидкость в $A$, его содержимое каждый раз удваивается, так что  перед $i$-м шагом $A$ содержит $2^ia$ унций жидкости.
Следовательно, общий объём жидкости, вылитый из $B$, равен $qa$, таким образом, в конце  в $B$ остаётся $b-qa=r<a$ унций жидкости.
Заметим, что общий объём жидкости, вылитый из $C$, не превосходит
\[
\tsum_{i=0}^{n-1} 2^ia<2^na\le qa\le b\le c.\]
Таким образом, в $C$ (и в $B$) достаточно жидкости, чтобы проделать все эти шаги.
\heart

\medskip
Насколько мне известно, никто не знает даже приблизительно, сколько требуется шагов для решения этой задачи (в худшем начальном состоянии с общим объёмом жидкости, равным $n$ унциям).
Моё решение показывает, что достаточно порядка $n^2$ шагов.
Решение Сванте лучше, оно ограничивает число шагов произведением константы на $n\log n$.
Окончательный ответ может оказаться ещё меньше.

\subsubsection*{Фишки по углам}% (PEGS ON THE CORNERS)

На эту симпатичную задачу обратил моё внимание Миккель Торуп из лаборатории AT\&T, %(Mikkel Thorup of AT&T Labs),
который её услышал от Ассафа Наора %(Assaf Naor)
(в то время научного сотрудника Майкрософта), который, в свою очередь, услышал её от аспирантов Еврейского университета в Иерусалиме%
\footnote{Задача предлагалась на Московской математической олимпиаде в 1994 году, автор А.",К.",Ковальджи (Московские математические олимпиады. 1993--2005 / Р.",М.",Федоров и др. М.: МЦНМО, 2017). %   \cite[№107751]{problems}.
"--- \emph{Прим. ред.}}.


\medskip

Заметим, что если фишки начинают ходить с вершин решётки (то есть точек плоскости с целыми координатами), то они всегда будут оставаться в вершинах решётки.

В частности, если изначально они располагаются в вершинах единичного квадрата решётки, то они, разумеется, не могут позже оказаться в углах меньшего квадрата, поскольку в решётке не существует квадратов, меньших единичного.
Но почему они не окажутся в углах большего квадрата?

Основное наблюдение: прыжок через фишку обратим!
Если бы было возможно прийти к большему квадрату, то мы могли бы обратить весь процесс и завершить ход на меньшем квадрате, что, как мы уже знаем, невозможно.
\heart

\subsubsection*{Фишки на полуплоскости}% (PEGS ON THE HALF-PLANE)

Это вариант задачи, описанной во втором томе «Выигрышных стратегий ваших математических игр»\footnote{\label{winningways}\emph{E. Berlekamp, J. Conway, R. Guy}. {Winning Ways for Your Mathematical Plays.} Academic Press, 1982.}.
Мы полагаем, что задача была изначально придумана
одним из авторов книги, Джоном Конвеем.
В его варианте не разрешались
прыжки по диагонали, тем не менее можно было без особых трудностей
продвинуть фишку до линии $y = 4$.
Рассуждение, подобное приведённому
ниже, показывает, что выше забраться невозможно.

\medskip

С прыжками по диагонали или без них, трудность состоит в том, что,
когда фишки поднимаются выше, вершины решётки под ними оголяются.
Нам
нужен такой параметр $P$, который бы получал награду за ушедшую высоко
фишку, но в качестве компенсации подвергался бы наказанию за
оставленные позади дырки.
Естественно было бы выбрать сумму по всем
фишкам некоторой функции от их позиции.
Поскольку фишек бесконечно
много, необходимо позаботиться, чтобы получающийся ряд сходился.

Например, фишке в точке $(0, y)$ можно присвоить вес $r^y$, где $r$ "--- некое вещественное число, большее $1$.
В этом случае веса фишек на нижней части оси $Y$ в сумме дадут конечное число $\sum\limits_{y\le 0}r^y = r/(r-1)$.
Веса в прилегающих столбцах нужно будет уменьшать, чтобы сумма по всей плоскости оставалась конечной.
Если при удалении от оси $Y$ на один шаг  мы делим вес на $r$, то получаем, что вес фишки в точке $(x, y)$ равен $r^{y - |x|}$, и тогда общий вес в начальной позиции равен
\[\frac r{r-1} + \frac 1{r-1} +\frac 1{r-1} +\frac 1{r(r-1)} +\frac 1{r(r-1)} + \ldots =\frac{r^2+r}{(r-1)^2} <\infty.\]

Если фишка прыгнула, то в лучшем случае (когда прыжок был совершён по диагонали вверх к оси $Y$) $P$ приобретает $vr^4$ и теряет $v+vr^2$, где $v$ "--- вес фишки перед прыжком.
Если $r$ не превышает квадратного кореня из <<золотого сечения>> $\varphi=(1+\sqrt5)/2\approx 1{,}618$, удовлетворяющего уравнению $\varphi^2=\varphi+1$, этот прирост не может быть положительным.

Далее, если положить $r = \sqrt{\varphi}$, то начальное значение $P$ составит примерно $39{,}0576$, но вес одной фишки в точке $(0, 16)$ \emph{сам по себе} равен $\varphi^8\approx 46{,}9788$.
Мы не можем увеличить $P$, следовательно, мы не можем продвинуть фишку в точку $(0, 16)$.

Но если бы мы смогли продвинуть фишку в какую-нибудь точку прямой $y =
16$ или выше, то мы бы смогли попасть и в точку $(0, 16)$ (или выше на
оси~$Y$): если мы попали в точку $(x, 16)$, то, чтобы попасть
в~$(0;16)$, надо сделать те же ходы, но со сдвигом на~$-x$.
\heart

\medskip
Дэн Хиршберг из Калифорнийского университета в Ирвайне недавно доказал, что при разрешённых диагональных прыжках можно добраться до прямой $y=8$, но не выше%
\footnote{\emph{G. Bell, D. Hirschberg, P. Guerrero-García}.
The minimum size required of a solitaire army  
/\!/ Integers. 2007. Vol.~7, \#G07. %  22 pp.
"--- \emph{Прим. ред.}}.

\begin{addedbytheeditors}
Эта задача также называется «Солдаты Конвея».

Следующая очень похожая задача была предложена М. Концевичем в 1981
году для Турнира городов.
Она была признана одной из лучших среди
опубликованных в Задачнике «Кванта» в 1981 году, её решению была
посвящена отдельная статья\footnote{\emph{А.",Ходулёв}. Расселение фишек /\!/ Квант. 1982. №7. C. 28---31.}.


Прямой угол разбит на клетки.
На некоторых клетках стоят фишки, причём расположение фишек можно преобразовывать так: если для некоторой фишки соседняя сверху и соседняя справа клетки свободны, то в эти клетки ставится по фишке, а старая фишка убирается.
Вначале в угловую клетку ставится одна фишка.
Можно ли несколькими указанными преобразованиями освободить от фишек уголки из 
а) трёх, 
б) шести, 
в) десяти клеток,
показанных на рисунках?
% а), б), и в)?
"--- \emph{Прим. ред.}  

\begin{figure}[!ht]
\centering
\begin{tabular}{c@{\qquad}c@{\qquad}c}
\includegraphics{wink-340} & % {final/test-master/mp/pic-10} % {Figs/mppic/pic-1}
\includegraphics{wink-341} & % {final/test-master/mp/pic-11}
\includegraphics{wink-342} \\ % {final/test-master/mp/pic-12}
а) &  б) &  в) 
\end{tabular} 

\vspace{-3\jot}
\end{figure}
\end{addedbytheeditors}

\subsubsection*{Фишки на квадрате}% (PEGS IN A SQUARE)

Существует несколько способов решения данной задачи, которая является частью задачи, представленной на Международной математической олимпиаде 1993 года%
\footnote{Предложена Финляндией. "--- \emph{Прим. ред.}}.
Приведённое ниже доказательство мне рассказал Бенни Судаков из Принстонского университета.

\medskip

Покрасим точки $(x, y)$ решётки в серый цвет, если ни $x$, ни $y$ не делятся на $3$, в противном случае покрасим их в белый цвет.
Получается периодический узор из серых квадратов $2\times 2$ (см. рисунок). 

\begin{figure}[ht!]
%   \vspace{-\baselineskip}
\centering
% \includegraphics[scale=0.5]{Figs/Algorithms/square}
\includegraphics{mp/wink-190}
\end{figure}

Если две соседние  фишки стоят обе в серых или обе в белых вершинах решётки, то фишка, оставшаяся после прыжка, окажется в белой вершине.
Если же одна вершина серая, а другая белая, то, напротив, фишка, оставшаяся после прыжка, будет стоять в серой вершине.
Из этого следует, что если изначально в серых вершинах находится чётное число фишек, то это свойство будет сохраняться.

Несложно увидеть, что если взять квадрат с фишками $3\times 3$ и
поместить его на плоскость, то, в какое бы место решётки мы его ни
определили, он всегда накроет чётное число серых вершин.
А~так как
квадрат $n\times n$, где $n$ делится на $3$, состоит из таких
квадратов, в нём также всегда будет содержаться чётное число серых
вершин.
Предположим, что оказалось возможным уменьшить число фишек в
таком квадрате до одной.
Тогда мы смогли бы передвинуть начальный
квадрат так, чтобы выжившая фишка оказалась в серой вершине.
Это
противоречие завершает доказательство. \heart

\medskip
Существует банальное, не особенно простое и не слишком интересное 
доказательство того, что если $n$ \emph{не} делится на $3$, то можно уменьшить число фишек до одной.
На олимпиаде участников просили точно определить, при каких $n$ можно
дойти до одной фишки, "--- довольно сурово требовать сделать это вот так сразу!

\subsubsection*{Кульбиты многоугольника}% (FLIPPING THE POLYGON)

Данная головоломка является обобщением задачи, появлявшейся на Международной математической олимпиаде 1986 года (представленной, как мне говорили, составителем из Восточной Германии) и впоследствии получившей название «Задача о пятиугольнике».

Задача имеет много решений\footnote{Решение, отличное от приведенного здесь, можно найти в <<Кванте>> (%% М1017
Квант. 1987. №4. С. 25--26.).
Шесть различных решений приведено в статье: \emph{E. Wegert, C. Reiher}. Relaxation procedures on graphs /\!/ Discrete Appl. Math. 2009. Vol.~157, no. 9. P.~2207--2216. "--- \emph{Прим. ред.}}.
Более того, её можно обобщить и дальше, на случай произвольных связных графов.
Однако решение, приводимое ниже, выделяется среди прочих тем, что оно
и красиво, и доказывает весьма сильное утверждение.
Его придумали независимо друг от друга по крайней мере два математика, один из них "--- Бернар Шазель, профессор информатики Принстонского университета. %(Bernard Chazelle, Professor of Computer Science at Princeton University)

\medskip

Пусть $x(0),\dots,x(n-1)$ "--- числа, стоящие в вершинах, дающие в
сумме $s > 0$; будем рассматривать их номера как вычеты модулю $n$.
Определим двустороннюю бесконечную последовательность
$b(\cdot)$, где $b(0) = 0$ и $b(i) = b(i -1) \hm+ x(i$~mod~${n})$.
Последовательность $b(\cdot)$ не является периодической, но она периодически возрастает: $b(i + n) = b(i) + s$.

\begin{figure}[h]
\centering
% \includegraphics[scale=0.5]{Figs/Algorithms/sort}
\includegraphics{mp/wink-200}
\end{figure}

Если $x(i)$ отрицательно, то $b(i) < b(i-1)$; в результате смены знака
у $x(i)$ числа $b(i)$ и $b(i - 1)$ меняются местами, так что они располагаются теперь в возрастающем порядке.
Это верно и для всех пар $b(j)$, $b(j - 1)$, где $j-i$ кратно~$n$.
Таким образом, изменение знака при вершине сводится к упорядочиванию $b(\cdot)$ с помощью перестановок соседних членов!

Чтобы проследить за ходом упорядочивания, введем параметр~$P$ следующим образом.
Пусть $i^+$ "--- число индексов $j > i$, для которых $b(j) < b(i)$, и
пусть $i^-$ "--- число индексов $j < i$, для которых $b(j) >
b(i)$.
Ясно, что $i^+$ и $i^-$ имеют конечны и зависят только от $i$ (mod~$n$).
Также отметим, что 
\[ \tsum_{i=0}^{n-1}i^+= \tsum_{i=0}^{n-1}i^-;
\]
эта сумма и будет нашим волшебным параметром $P$.

Когда мы меняем знак у $x(i+1)$, $i^+$ уменьшается на $1$, а все другие $j^+$ не меняются.
Значит, $P$ уменьшается в точности на 1.
Когда $P$ достигает значения~$0$, последовательность полностью отсортирована, так что все числа в вершинах неотрицательны и процесс завершен.

Мы доказали даже больше, чем требовалось: независимо от выбора чисел в
этом процессе, он заканчивается за одно и то же число шагов
(именно,~$P$); более того, конечная конфигурация также не зависит от
порядка выбора чисел!  Причина этого кроется в том, что существует
только один способ сортировки $b(\cdot)$.
Когда сортировка завершена,
член исходной последовательности $b(i)$ должен оказаться в позиции $i
\z+ i^+ - i^-$. \heart

\subsubsection*{Лампочки по кругу}% (LIGHT BULBS IN A CIRCLE)

Эта головоломка является частью задачи, представленной на Международной математической олимпиаде 1993 года.
При неуказанном значении $n$ лучшим способом решения будет показать
(как мы это уже делали в одном из решений «Пустого ведра»), что
пространство состояний представляет собой цикл.

\medskip

Во-первых, отметим, что невозможно выключить все лампочки,
ведь если последнюю лампочку выключили в момент времени $t$, то
лампочка номер $t$ при этом была включена.

Более того, если мы посмотрим на наш круг сразу \emph{после} момента~$t$, то узнаем, в каком состоянии были лампочки в момент~$t$ (изменив состояние лампочки $t+1$, если лампочка $t$ включена).
Поскольку число возможных состояний в круге конечно (мы учитываем,
какая лампочка рассматривается, а также какие лампочки включены),  в
какой-то момент состояния начнут повторяться.
Пусть первое повторение произошло в момент $t_1$, и пусть при этом повторилось состояние, бывшее в момент $t_0$, где $t_1$ и $t_0$ отличаются на число, кратное $n$.
Если $t_0>0$, то в момент $t_1 - 1$ мы уже были в том же состоянии,
что и в момент $t_0 - 1$, и получаем противоречие с тем, что первый
повтор произошел в момент~$t_1$.
Значит, что $t_0=0$, то есть повторилось состояние, когда все лампочки были включены.
\heart

\subsubsection*{Жуки на многограннике}% (BUGS ON A POLYHEDRON)

Данная задача была представлена в~статье Антона Клячко%
\footnote{\emph{A. Klyachko}. А Funny Property of Sphere and Equations over Groups /\!/ Com\-mu\-ni\-ca\-tions in Algebra. 1993. Vol. 21, no. 7. P.~2555--2575.}. 
Для её решения мы сделаtv противоположное тому, что делали в
предыдущей задаче: покажем, что некоторый параметр будет всегда
меняться в одном направлении и тем самым вернуться в исходное состояние мы не сможем.

\medskip

Можно считать, что в начальный момент ни один жук не находится в вершине (можно жуков слегка ускорить или замедлить).
Можно также считать, что никакие два жука не проходят через вершины одновременно.

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.5]{Figs/Algorithms/dodec}
\includegraphics{mp/wink-22}
\end{figure}

В любой момент времени можно нарисовать стрелку из центра каждой
грани\footnote{Подразумевается, что внутри каждой грани мы выбрали по точке и назвали эти точки центрами граней. "--- \emph{Прим. ред.}} $F$ к жуку с этой грани и далее к центру грани с другой стороны от жука.
Начав с любой грани и следуя далее по таким стрелкам, мы должны будем
в конце концов оказаться на некоторой грани второй раз. При этом на
поверхности многогранника появится последовательность стрелок
(<<цикл>>), возвращающаяся в ту же точку (центр одной из граней), из
которой вышла.

Этот цикл из стрелок разбивает поверхность многогранника на две части.
Назовём внутренней частью ту из них, которую мы обходим по часовой стрелке.
Пусть $P$ "--- количество вершин многогранника во внутренней части.

Число $P$ может принимать любое значение от $0$ до количества всех
вершин многогранника (обозначим его через $n$).
Два крайних значения~$0$ и~$n$ получаются, когда длина цикла равна $2$ и, следовательно, два жука ползут по одному ребру.
Если при этом $P=0$, два жука ползут по ребру навстречу друг другу и столкновение не\-из\-бежно.

Если $P>0$, то в момент, когда один из жуков в цикле переходит на следующее ребро,
стрелка, проходящая через него, поворачивается по часовой стрелке, так
что
вершина, через которую жук переползает, бывшая до того внутри цикла, оказывается теперь снаружи.
Другие вершины также могли перейти из внутренней части цикла во внешнюю, но не существует способа перейти из внешней части во внутреннюю.
Чтобы это увидеть, заметьте, что новая стрелка теперь направлена внутрь цикла.
У последовательности стрелок, исходящих из её конца, нет никакой
возможности выйти за пределы внутренности исходного цикла, так что
обязательно возникнет новый цикл с меньшим количеством вершин во внутренней части.
При этом значение $P$ уменьшится хотя бы на~$1$.
{\looseness-1\par}

Поскольку $P$ не сможет принять своё начальное значение, нам остаётся только надеяться, что у жуков имеется страховка от столкновений.
\heart


\subsubsection*{Жуки на числовом луче}% (BUGS ON THE LINE)

Для начала нам нужно убедиться, что жук обязательно либо свалится с левого конца, либо убежит на бесконечность вправо, то есть он не может вечно ползать туда-сюда.
В~самом деле, в противном случае жуку пришлось бы проходить через
какие"=то целые числа бесконечное число раз.
Пусть $n$ "--- наименьшее из таких чисел.
Здесь необходимо отметить, что, попадая каждый третий раз на число
$n$, жук увидит там красный свет и, следовательно, будет вынужден
уползти влево в точку $n-1$, а это противоречит предположению, что он
посетил точку $n-1$ только конечное число раз.

Теперь, когда с этим всё ясно, будем думать о зелёном свете как о цифре 0, о красном как о 1 и о жёлтом, как это ни парадоксально, как о «цифре» $\tfrac12$.
А расположение цветов лампочек может быть представлено как число, лежащее между $0$ и $1$, записанное в модифицированной двоичной системе;
\[x = 0{,}\,x_1\,x_2\,x_3\dots;\]
то есть
\[x = x_1\cdot(\tfrac12)+x_2\cdot(\tfrac12)^2+\dots\]
Будем думать о жуке в точке $i$ как о дополнительной единице в $i$-й позиции, 
полагая
\[y=x+(\tfrac12)^i.\]
Ключевое наблюдение состоит в том, что $y$ является \emph{инвариантом}, то есть не меняется при передвижении жука.
В самом деле, если жук сдвигается вправо от точки $i$, то число,
соответствующее изначальному цвету точки, в которой он сидел,
увеличивается на $\tfrac12$, так что
$x$ увеличивается на $(\tfrac12)^{i+1}$, но при этом дополнительное
слагаемое, соответствующее жуку, уменьшается на ту же самую величину.
Если же жук сдвигается влево от точки~$i$, то соответствующее ему
дополнительное слагаемое увеличивается на $(\tfrac12)^i$, но это компенсируется тем, что цифра числа $x$ в $i$-й позиции уменьшается на единицу.

Исключение составляет только момент, когда жук сваливается с левого конца.
В этом случае и $x$, и дополнительное слагаемое уменьшаются на $\smash{\tfrac12}$, то есть общая потеря равна $1$.
Когда выставляется следующий жук, значение $y$ увеличивается на $\smash{\tfrac12}$.
Стало быть, значение $x$ увеличивается на $\smash{\tfrac12}$, если выставляется новый жук и он исчезает справа на бесконечности, и $x$ падает на $\smash{\tfrac12}$, если выставляется новый жук и он сваливается с левого конца.

Конечно же, в любой момент $x$ должно лежать в единичном интервале.
Если его начальное значение лежит строго между $0$ и $\smash{\tfrac12}$, то жуки должны будут поочерёдно убегать направо, падать слева, убегать, падать и так далее.
Если $x$ лежит строго между $\smash{\tfrac12}$ и $1$, то жуки поочерёдно будут падать, убегать, падать, убегать и так далее.

Оставшиеся случаи можно проверить <<руками>>.
Если изначально $x = 1$
(все точки красные), то первый жук переключит свет в точке~$1$ на
зелёный и свалится.
Второй жук, двигаясь по правилу <<шаг вправо "---
шаг влево "--- шаг вправо>>, удаляется вправо на бесконечность,
оставив все лампочки опять красными, то есть мы получим чередование:
падает, убегает, падает, убегает...

Если $x = 0$ (то есть все точки зелёные), то первый жук убежит, второй опять убежит (так как все точки сменятся на жёлтые, а потом на все красные), а затем чередование "--- падает, убегает, падает, убегает... как и прежде.

Самый интересный случай "--- это $x=\smash{\tfrac12}$, так как существует не\-сколько способов представления числа $\smash{\tfrac12}$ в нашей модифицированной двоичной системе: $x$ может быть составлен из одних $\smash{\tfrac12}$, или он может начинаться с любого конечного количества (включая ноль) <<цифр>>~$\smash{\tfrac12}$, за которым следуют либо $0111\dots$, либо $1000\dots$
В первом случае начинающий жук переключит все жёлтые лампочки на красные по мере удаления направо, таким образом, мы получаем чередование: убегает, падает, убегает, падает...
Второй случай такой же: первый жук  уползает направо (опять "---
начиная с какого-то момента "--- делая каждый третий шаг влево), опять оставляя все точки после себя красными.
В третьем случае жук переключает жёлтый на красный по ходу движения, но, когда он достигает красной точки, он разворачивается и двигается налево, меняя красный на зелёный по пути, пока не упадёт.
После этого приходим к случаю $x = 0$, так что в этом случае  последовательность будет такая: падает, убегает, падает, убегает...

Возвращаясь опять ко всем случаям, мы видим, что всякий раз, когда второй жук падает, третий жук убегает.
\heart

\medskip
Это красивое рассуждение предложили
Анде Холройд (университет Британской Колумбии) и Джим Пропп (Висконсинский университет) на встрече группы «Институт элементарных исследований» в Банфе, Альберта, в 2003 году. %
%\footnote{прим. перев.: \href{https://www.birs.ca/files/scientific-reports/}{\url{www.birs.ca/files/scientific-reports/BIRS_SR_2003.pdf}} стр. 63}
Пропп предложил использовать жука, чтобы детерминированно смоделировать случайные блуждания на неотрицательных целых числах, в которых шаги делаются (независимо) влево с вероятностью $\tfrac13$ и вправо с вероятностью $\tfrac23$.
В~подобных блужданиях конкретный жук падает с левого конца луча или убегает на бесконечность вправо с одинаковой вероятностью.
Как мы видели, в детерминированной модели после первой пары жуков направления строго чередуются.
Рассуждение обобщается и на другие виды случайных блужданий.

\subsubsection*{Как разломать шоколадку}% (BREAKING A CHOCOLATE BAR)

Эта до смешного простая задача известна тем, что некоторые весьма сильные математики зависали на ней на целый день, пока среди  стенаний и битья головой об стену на них не снисходило озарение.
Рискуя прослыть садистом, решение я~опускаю%
\footnote{Задача предлагалась на Турнире городов в 1986~году, автор С.",В.",Фомин (\emph{А.",К.",Толпыго}. Тысяча задач Международного математического Турнира городов. М.: МЦНМО, 2010). % \cite[№97909]{problems}.
"--- \emph{Прим. ред.}}.

\chapter{Ещё игры}

\thispagestyle{empty}

%“Half this game is 90\% mental.”
%-- Danny Ozark manager of the Phillies baseball team.

\setlength{\epigraphwidth}{.5\textwidth}
\epigraph{Половина этой игры на 90",\% идёт в уме.\vspace{1ex}}{Дэнни Озарк, менеджер филадельфийской бейсбольной команды} 

Вообще говоря, анализ игры часто требует решения двух задач:
нахождения правильной стратегии и нахождения доказательства того, что
эта стратегия наилучшая из возможных.
(Таким доказательством может
быть подходящая стратегия для другого игрока.)

Иногда, впрочем, нужно гораздо меньше.
Рассмотрим следующую невинную с виду задачу.

\subsection*{Щёлк}% (CHOMP)
\rindex{Щёлк}

Два игрока по очереди откусывают от прямоугольной шоколадки, состоящей
из $m \times n$ квадратных долек.
Каждый раз игрок выбирает дольку и
откусывает её вместе со всеми дольками, находящимися сверху и справа
от неё.
Левая нижняя долька отравлена: кому она досталась, тот
проиграл.

Докажите, что если шоколадка состоит больше чем из одной дольки, то у
первого игрока есть выигрышная стратегия. 

\begin{figure}[h]
\centering
% \includegraphics[scale=0.5]{Figs/MoreGames/chomp}
\includegraphics{mp/wink-23}
\end{figure}

\paragraph{Решение} Либо у первого игрока (Алисы), либо у второго
(Боба) должна быть выигрышная стратегия. 
Предположим, она у Боба.
Тогда, в частности, у Боба должен быть
выигрышный ответ на первый ход Алисы, которым она откусывает лишь
правую верхнюю дольку.

Но каков бы ни был ответ Боба, Алиса может сделать таким же свой
первый ход, что противоречит предположению о том, что Боб всегда может
выиграть.
Отсюда следует, что выигрышная стратегия должна быть у
Алисы. \heart

Такой вид доказательства известен как \emph{передача хода}, и он, к сожалению, ничего не говорит нам о том, как же, собственно, Алисе выигрывать.
В последней главе подробнее рассказывается об игре «Щёлк», её истории и более общей версии.

\medskip

Для решения оставшихся задач-игр используются разнообразные методы.

\subsection*{Детерминированный покер}% (DETERMENISTIC POKER)
\rindex{Детерминированный покер}

Не желая зависеть от капризного случая, Алиса и Боб решили сыграть в
абсолютно детерминированную версию 
покера.

Колода карт раскладывается на столе в открытую.
Алиса выбирает 5 карт, затем Боб выбирает 5 карт.
Алиса меняет у себя любое число карт (заменённые карты выходят из игры),
затем то же проделывает и Боб.
Все действия производятся в открытую на виду у оппонента.
Игрок с лучшей комбинацией выигрывает.
Поскольку Алиса начинает, Боб, чтобы скомпенсировать это преимущество, объявляется победителем, если конечные комбинации оказываются равносильными.
Кто победит при оптимальной игре?

\medskip

Детерминированный покер "--- это игра с полной информацией.
В~играх, содержащих скрытую информацию или одновременные ходы, может потребоваться вероятностная стратегия.
Говорят, что набор таких стратегий (один для каждого игрока) находится в \emph{равновесии}, если никто из игроков не может увеличить выигрыш, изменив свою стратегию, при условии, что остальные участники своих стратегий не меняют.
Например, в игре «Камень, ножницы, бумага» в~(единственной) равновесной стратегии каждый игрок выбирает все три возможных варианта с одинаковой вероятностью.

\subsection*{Шведская лотерея}% (SWEDISH LOTTERY)
\rindex{Шведская лотерея}

Для шведской национальной лотереи предлагаются следующие правила игры. Каждый участник выбирает целое положительное число.
Объявляется победителем тот, кто называет наименьшее из чиел, не выбранных никем другим.
(Если нет числа, выбранного только одним участником, то победителя нет.)

Пусть в игре участвуют только три человека и каждый применяет
оптимальную и равновесную вероятностную стратегию.
Чему равно наибольшее положительное число, имеющее положительную вероятность быть выбранным?

\subsection*{Блины}% (PANCAKES)
\rindex{Блины}

Алиса и Боб опять проголодались, и перед ними лежат две стопки блинов,
высотой в $m$ и $n$ блинов.
Каждый игрок по очереди должен съесть из
большей стопки число блинов (ненулевое), кратное количеству блинов в
меньшей стопке.
Разумеется, последний блин в каждой стопке
непропеченный, так что игрок, который первым доедает одну из стопок,
проигрывает.

Для какой пары $(m,n)$ у Алисы (она ходит первая) имеется выигрышная стратегия?

Что случается, если у игры обратная цель, то есть побеждает тот, кто первым доест стопку?

\subsection*{Определение разности}% (DETERMINING A DIFFERENCE)
\rindex{Определение разности}

Позавтракав, Алиса и Боб решили для отдыха сыграть в простую числовую игру.

% \medskip

Алиса выбирает цифру, а Боб подставляет её вместо звёздочки в
выражение «${*}{*}{*}{*} - {*}{*}{*}{*}$»; процедура повторяется, пока
все звёздочки не будут заменены числами. 
Алиса стремится сделать окончательную разность максимальной, а Боб "--- минимальной.
Какая разность получится при оптимальной игре?

\subsection*{Тройная дуэль}% (THREE-WAY DUEL)
\rindex{Тройная дуэль}

Алиса, Боб и Кэрол устраивают тройную дуэль.
Алиса "--- плохой стрелок, попадает в цель в среднем только в $\slfrac13$ случаев.
Боб стреляет лучше, он попадает в цель с вероятностью $\slfrac23$.
Кэрол бьёт без промаха.

Противники стреляют по очереди, первой Алиса, вторым Боб и третьей Кэрол, затем опять Алиса, и так далее пока не останется только один стрелок.
Каков наилучший план действий для Алисы?


%%% \input{more-games-sol.tex}

\section*{Решения и комментарии}

\subsubsection*{Детерминированный покер}% (DETERMENISTIC POKER)

Чтобы решить эту задачу, надо кое-что знать о правилах
покера. Наилучшей комбинацией карт является стрит-флеш (пять
карт одной масти по порядку).
Стрит-флеш со старшей картой "--- тузом (его
также называют «флеш-рояль»), сильнее, чем флеш со старшей картой "---  королём, и
так далее.

Это означает, что если Бобу удастся собрать флеш-рояль, то Алисина песенка спета.
Поэтому, чтобы Алиса получила шанс выиграть, её первый набор карт должен содержать по одной карте каждого из четырёх возможных флеш-роялей.

Для этой цели лучшими картами являются десятки каждой масти, поскольку
они не дают собрать флеш со старшей десяткой или выше.
И действительно, поразмыслив минутку, вы поймёте, что любая комбинация Алисы с изначальными четырьмя десятками выигрывает.
У Боба не остаётся надежды собрать стрит-флеш со старшей картой выше девятки.
Но чтобы не дать Алисе собрать флеш-рояль, он должен взять по меньшей мере по одной карте старше десятки из каждой масти и не более одной карты ниже десятки.
Алиса же теперь может поменять четыре карты и собрать стрит-флеш, начинающийся с десятки, в любой масти, кроме масти младшей карты Боба,
и Боб тут оказывается совершенно беспомощен.
\heart

\medskip
У Алисы имеются также и другие способы выиграть.
Эта странная игра обсуждалась в одной из ранних колонок Мартина
Гарднера. 

\begin{addedbytheeditors}
Впервые появилась в одной из самых первых колонок Мартина Гарднера в <<{Scientific American}>> (февраль 1957 года).
Позднее включена в книгу «Математические головоломки и развлечения»%
%Gardner, M. Hexaflexagons and other mathematical diversions U. Chicago Press, 1959 (Ch. 3)
\footnote{Глава 3 «Девять задач» в книге «Математические головоломки и развлечения» М.~Гарднера.}
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Шведская лотерея}% (SWEDISH LOTTERY)

Предположим, что $k$ "--- наибольшее число, которое готов выбрать каждый из игроков.
Если игрок выбирает $k$, он выигрывает, когда совпадает выбор двух других игроков, кроме случая, когда они также выбрали $k$.
Но если он выбирает $k+1$, то с гарантией выигрывает каждый раз, когда выбор двух других совпадает.
Отсюда следует, что лучше выбрать $k+1$, чем $k$ и, значит, стратегия не равновесна.
Это противоречие указывает на то, что необходимо рассматривать произвольно большие числа "--- иногда следует выбрать $1487564$.
\heart

\medskip
В равновесной стратегии каждый игрок должен выбрать число $j$ с вероятностью $(1-r)r^{j-1}$, где\vspace {-\jot}
\[r = -\frac13-\frac2{\sqrt[\scriptstyle 3]{17+3\sqrt{33}}}+\frac{\sqrt[\scriptstyle 3]{17+3\sqrt{33}}}3,\]
что примерно равно $0{,}543689$.
Вероятности выбора чисел 1, 2, 3 и 4 равны примерно $0{,}456311$, $0{,}248091$, $0{,}134884$ и $0{,}073335$ соответственно.

На эту довольно симпатичную идею лотереи обратил моё внимание Улле
Хеггстрём из Университета Чалмерса в Гётеборге, Швеция. %(Olle
Häggström of Chalmers University in Göteborg, Sweden.)  Я не знаю,
была ли эта идея осуществлена или хотя бы серьёзно рассматривалась для
какой-либо официальной лотереи; а вы как думаете, стоило бы?

\subsubsection*{Блины}% (PANCAKES)

Предположим, что в настоящий момент в стопках $m$ и $n$ блинов, причем $m > n$.
Если отношение размеров стопок $r = m/n$ лежит строго между 1 и 2, то на следующем ходу отношение станет равно $\slfrac1{(1-r)}$.
Эти отношения равны, только если $r$ равно золотому сечению,
то есть $r=\varphi=(1+\sqrt{5})/2\approx 1{,}618$.
Поскольку число $\varphi$ иррационально, одно из двух отношений $r$ и $\slfrac1{(1-r)}$ должно быть больше, а другое меньше~$\varphi$.

Первый игрок (Алиса) выигрывает тогда и только тогда, когда начальное отношение большей стопки к меньшей превышает $\varphi$.
Чтобы это увидеть, предположим, что $m>\varphi n$, но $m$ не кратно $n$.
Запишем $m=an+b$, где $0<b<n$.
Тогда либо $n/b<\varphi$, и в этом случае Алиса съедает $an$ блинов, либо $n/b>\varphi$, и в этом случае она съедает только $(a-1)n$ штук.
Боб остаётся с отношением, меньшим $\varphi$, и он вынужден сделать ход, который возвращает отношению значение, большее~$\varphi$.

Рано или поздно Алиса достигнет момента, когда её отношение $m/n$
станет целым числом, после чего она сможет уравнять число блинов в двух стопках и оставить Боба с сырым блином.
Заметим, что она также может, если захочет, забрать себе всю стопку блинов.

Разумеется, если вместо этого Алиса имеет дело с отношением $m/n$, которое лежит строго между $1$ и $\varphi$, то дело её плохо:
теперь Боб форсированно выигрывает.

Стало быть, если высоты стопок различны и равны $m$ и~$n$, где $m>n$,
то в обеих вариантвх этой игры Алиса выигрывает тогда и только тогда,
когда $m/n>\varphi$.
Только в тривиальном случае, когда стопки
изначально одной высоты, имеет значение, какова цель игры.\heart

\medskip
Данная задача была представлена на XII Всесоюзной математической олимпиаде\footnote{\VsMO. Задача №256, автор А.",Слинько. "--- \emph{Прим. ред.}} в Ташкенте в 1978 году.
Мне её показал Билл Газарч из Мэрилендского университета.% (Bill Gasarch of the University of Maryland).

\subsubsection*{Определение разности}% (DETERMINING A DIFFERENCE)

Запишем эту разность как $x-y$, где $x\hm=\overline{abcd}$ и $y=\overline{e\mkern-2mu fgh}$.
В любой момент игры будем обозначать через $x(0)$ результат замены остающихся звёздочек на нули; аналогично будем использовать обозначения $x(9)$, $y(0)$ и $y(9)$.

Алиса может гарантировать себе разность 4000 или выше, если будет
назвать $4$ и $5$, пока Боб не поставит цифру на позицию~$a$ или~$e$,
после чего  до конца игры будет называть нули в первом случае и
девятки "--- во втором. 
%% если же Боб ставит $4$ или $5$ на позицию $e$, то она заканчивает игру одними девятками.
Ей нужно следить за тем, чтобы всякий раз, когда она называет цифру~5, выполнялось условие $x(9)\ge y(9)$, так как Боб может поставить $5$ на позицию $e$;
также она должна гарантировать, что каждый раз, когда она выбирает цифру~4, выполнялось условие $x(0)\ge y(0)$, иначе Боб поставит эту четвёрку на позицию $a$.
Это можно проделать следующим образом.

Всякий раз, когда последовательности символов $x$ и $y$ одинаковы,
Алиса называет либо 4, либо 5.
В противном случае обозначим через $u$
и~$v$ символы из последовательностей $x$ и~$y$ соответственно, стоящие
в самой левой из позициий, в которых $x$ и~$y$ отличаются.
Если $u=*$
(в этом случае $x(9)\geqslant y(9)$), то Алиса называет 5, если же
$v=*$ (в этом случае $x(0)\geqslant y(0)$), то
она называет 4.
Никогда не может случиться, что $u=4$ и $v=5$, а если
$u=5$ и $v=4$, то выполняются оба неравенства $x(9)> y(9)$ и $x(0)>
y(0)$, так что Алиса может смело выбирать либо 4, либо 5.

С другой стороны, Боб легко гарантирует себе разность не ниже 4000,
если сразу же поставит 4 или меньшую цифру на позицию $a$ либо 5 или
б\'{о}льшую цифру на позицию $e$.
Затем он не меняет первую звёздочку
в другом числе, пока не появится не ноль (в первом случае) или не
девять (во втором случае).
Таким образом, он получит либо
$4000-0000$, либо $9999-5999$, а может быть, и что-то получше. \heart

\medskip
Эта задача восходит по меньшей мере к VI Всесоюзной математической олимпиаде\footnote{\VsMO. Задача №168, автор Ю.",Ионин. "--- \emph{Прим. ред.}} (Челябинск 1972).

\subsubsection*{Тройная дуэль}% (THREE-WAY DUEL)

Об этой древней задаче мне напомнил Ричард Плотц из Провиденса, штат
Род-Айленд.
У неё есть множество вариаций, одна из которых появилась
в книге головоломок Хьюберта
Филлипса\footnote{\emph{H. Phillips}. {Question Time}. London: J. M. Dent \& Sons, 1938} 1938 года.

\medskip

Совершенно очевидно, что Алиса не должна целиться в Боба "--- если она
попадёт, то на следующем шаге её подстрелит Кэрол, на чем все и закончится.
В
случае удачи с Кэрол Алисе предстоит дуэль с Бобом, а Боб лучше
попадает в цель, и стреляет он первым.
Шансы выжить у неё определённо
меньше $\tfrac13$.

(На самом деле, если обозначить через $p$ вероятность для Алисы
остаться в живых в случае, когда Боб стреляет первым, а через $q$ "---
вероятность (б\'{о}льшую) выживания Алисы, когда она стреляет первой,
то $p=\tfrac13\cdot q$ и $q=\tfrac13+\tfrac23\cdot p$, а значит,
$p=\tfrac17$.
Не очень хорошо для Алисы.)

Однако если она промахивается, то в Кэрол будет стрелять Боб.
Если он попадает, то опять предстоит дуэль между Алисой и Бобом, но в этот раз первой стреляет Алиса, и её шансы выжить превышают $\tfrac13$ (а точнее, равны $\tfrac37$).

Если Боб терпит неудачу, то Кэрол пристрелит его и у Алисы будет один
шанс попасть в Кэрол.
Вероятность выжить для неё в этом случае равна
ровно $\tfrac13$.

Суть в том, что, независимо от того, попадёт ли Боб в Кэрол или нет,
Алисе лучше промахнуться, чем попасть, стреляя в Кэрол.
И~ей намного лучше промахнуться, чем попасть, если она будет стрелять в Боба.

Итак, лучшая стратегия для Алисы "--- пожертвовать своим преимуществом
первого выстрела и стрелять в воздух. 

% \medskip

Однако стойте!
Если мы разрешили Алисе стрелять в воздух, то нам следует дать такую
же возможность и остальным.
Они должны просчитать, что Алиса никого не убьёт, пока все три дуэлянта живы. 
Применим обратный ход, как и прежде.
Предположим что выстрел за Кэрол и все трое живы,
следует ли ей убивать Боба? 
Если Боб пытался её убить, то да.
Но если Боб выстрелил в воздух и таким образом продемонстрировал желание продолжать так и далее,
то Кэрол лучше сделать так же, как и он, "---
никто не рискует жизнью и, когда кончатся патроны, можно пойти домой и заняться математическими головоломками.
Возвращаясь на шаг назад, мы заключаем, что Бобу действительно выгодно стрелять в воздух, и вся дуэль оказывается липовой.


Обдумав всё это ещё раз, заключаем, что если цель каждого состоит в
том, чтобы остаться в живых, "--- а мы это и предполагаем, "--- то не
стоит устраивать дуэли. 
\heart


\chapter{Алгоритмы с~ограничениями}

\thispagestyle{empty}

% \setlength{\epigraphwidth}{.6\textwidth}
% \epigraph{У кислоты есть три побочных эффекта: усиление долговременной памяти, ослабление кратковременной, а третий я забыл.\vspace{1ex}}{Тимоти Лири (1920"--~1996)}

\setlength\epigraphwidth{.75\textwidth}
\epigraph{%%%  Оформить как эпиграф. Подпись: Старый флоридский анекдот
Два старичка, Сэм и Тед, сидят на крыльце у Сэма и болтают.

--- Это ужасно, "--- говорит Тед, "--- последнее время у меня совсем плохо с короткой памятью.
Я с трудом вспоминаю, принял ли я уже таблетки за этот день или нет.

--- Знаю, о чём ты говоришь, "--- отвечает Сэм.
--- Мой доктор нашёл решение этой проблемы "--- он добавил специальную таблетку памяти к моим ежедневным лекарствам, и теперь у меня всё отлично!

--- Ты шутишь! Как называются эти таблетки? Может, и мне такие пропишут?

--- Хм-м, хороший вопрос.
Дай подумать, ... ум-м... быстро, скажи мне название растения.

--- Растение? Ты имеешь в виду куст или дерево?

--- Нет, поменьше такое, декоративное...

--- Цветок?

--- Да, бывает красный...

--- Гвоздика? Тюльпан?

--- Нет, такой, с шипами...

--- Роза?

--- Точно! Она! "--- Сэм поворачивается и кричит в открытую дверь. "--- Роза! Как называются мои таблетки для памяти?\vspace{1ex}}
{Старый флоридский анекдот}

% \medskip

В этой главе мы рассматриваем задачи на алгоритмы с различными
ограничениями, обычно связанными с памятью.
Требуется много
воображения, чтобы разобраться с такими задачами и найти решение,
которое смог бы применить менее способный человек, чем вы.
Вводную
задачу в этом наборе можно охарактеризовать как вполне реалистичную.

\subsection*{Нахождение числа}% (FINDING THE MISSING NUMBER)
\rindex{Нахождение числа}

Вам зачитывают все числа от 1 до 100, кроме одного.
Каждые 10 секунд называется одно число в произвольном порядке.
Вы хорошо соображаете, но обладаете обычной памятью, и у вас нет возможности делать записи во время чтения.
После прочтения вам надо определить неназванное число.
Как это безошибочно сделать?

\paragraph{Решение} Легко "--- вы складываете называемые числа, прибавляя их по порядку к общей сумме.
Сумма \emph{всех} чисел от 1 до 100 равна числу 100, умноженному на их среднее ($50\smash{\tfrac12}$), то есть равна 5050.
Вычитя этого полученную вами сумму, получаем пропущенное число.

И незачем держать в голове сотни или тысячи во время суммирования,
достаточно складывать по модулю 100.
Результат можно вычесть из 50 или 150, чтобы получить ответ в правильном диапазоне.
\heart

\medskip

Обработка потока информации при ограничениях на возможности вычислений и память "--- это важная тема исследований.
Первая задача напоминает вводную, но она возникла из серьёзной задачи в теории вычислений.

\subsection*{Определение большинства}% (IDENTIFYING THE MAJORITY)
\rindex{Определение большинства}

Читается длинный список имён, некоторые имена повторяются много раз.
Ваша цель "--- назвать имя, которое называлось б\'{о}льшую часть
времени\footnote{Подразумевается, что на произнесение любого имени расходуется одно и то же время; под большинством здесь имеется в виду абсолютное большинство.}, при условии,
что таковое существует.

При этом у вас в распоряжении только один счётчик, и в памяти у вас в
каждый момент удерживаеатся только одно имя.
Возможно ли это сделать?

\medskip

Следующая задача пришла ко мне от Джона Конвея, профессора
Принстонского университета (наряду со многими другими его достижениями
"--- автора игры «Жизнь»).
Говорят, что одна несчастная жертва, которой попалась эта головоломка, просидела без движения на стуле шесть часов.

\subsection*{Обездвиживатель Конвея}% (THE CONWAY IMMOBILIZER)
\rindex{Обездвиживатель Конвея}

Три карты, туз, король и дама, выкладываются рубашкой вниз на стол 
%% в несколько или в одну из отмеченных колод (\emph{левая, средняя, правая}).
на три заранее отмеченных места (<<левое>>, <<среднее>> и <<правое>>)
%% Если они все кладутся в одну колоду, то 
Можно положить все три карты на одно место, то тогда будет
видна только верхняя карта;
%% если в две колоды, то 
можно занять только два места из трех, но тогда будут
видны только две карты и вы не будете знать, под которой из двух спрятана третья.

Ваша задача "--- сложить все карты 
%% в левую колоду "---  
на левое место в следующем порядке:
сверху туз, потом король, а внизу дама.
Можно перекладывать по одной карте за ход, беря только верхнюю карту 
%% с одной из колод 
и кладя её на другое место (если на этом месте уже есть карты, новую
карту кладут сверху).
%%(возможно, пустую).

Проблема в том, что у вас нет кратковременной памяти и вам необходимо придумать алгоритм, в котором каждый ход основывается только на том, что видно в данный момент, а не на том, что вы видели и делали перед этим или сколько произошло ходов.
Сторонний наблюдатель сообщит вам, когда вы достигнете цели.
Возможно ли придумать алгоритм, приводящий к выигрышу за ограниченное число шагов вне зависимости от начального расположения карт?

\medskip

Две из следующих трёх головоломок посвящены выключателям "--- очень полезным приспособлениям для придумывания головоломок.
Последняя полушуточная задача возвратит нас к эпиграфу.

\subsection*{Крутящиеся выключатели}% (SPINNING SWITCHERS)
\rindex{Крутящиеся выключатели}

К лампочке последовательно подключены четыре одинаковых, ничем не
помеченных выключателя.
Эти выключатели "--- простые кнопки, по виду
которых невозможно определить, в каком состоянии они находятся.
Их
состояние можно поменять, нажав на кнопку.
Выключатели установлены в
углах вращающегося квадрата.
За один раз вы можете одновременно
нажать любое количество кнопок, а~затем ваш противник крутит квадрат.
Докажите, что существует детерминированный алгоритм, который позволит
вам включить лампочку за не более чем фиксированное число шагов.

\subsection*{Комната с одной лампочкой}% (THE ONE-BULB ROOM)
\rindex{Комната с одной лампочкой}

Каждого из $n$ заключённых заводят в некоторую комнату бесконечно
часто, в порядке, определяемом тюремщиком.
У заключённых есть
возможность договориться заранее, но, как только начинаются посещения
комнаты, у них остаётся единственный способ передачи информации друг
другу "--- включать или выключать лампочку в~комнате.
(В начальный
момент времени состояние лампочки может быть любым.)

Помогите создать протокол, который гарантирует, что хотя бы один из
заключённых сможет определить, что каждый из них побывал в комнате.

\subsection*{Два шерифа}% (ТHE TWO SHERIFFS)
\rindex{Два шерифа}

Шерифы двух соседних городков ищут убийцу; в деле имеется восемь
подозреваемых.
Опираясь на независимые достоверные оперативные
источники, каждый шериф сузил свой список подозреваемых до двух
человек.
И теперь они ведут телефонный разговор, цель которого "---
сравнить свои списки и, если их пары подозреваемых имеют одно
пересечение, установить убийцу.

Проблема в том, что их телефон прослушивается местной бандой
линчевателей, которым известен начальный список подозреваемых, но до
каких пар сошлись шерифы, они не знают.
Если в результате этого
звонка линчеватели смогут точно определить убийцу, то его линчуют
прежде чем полиция сможет его арестовать.

Шерифы раньше не общались. Смогут ли они провести разговор таким
способом, чтобы по его окончании они оба узнали, кто убийца (если это
возможно), но при этом линчеватели осталась бы в неведении?

\subsection*{Рассеянный профессор}% (THE ABSENT-MINDED PILL TAKER)
\rindex{Рассеянный профессор}

Рассеянный профессор математики должен каждый день принимать таблетку,
но у него проблема с кратковременной памятью: ни в какой день он не
помнит, принял он уже таблетку или нет.
Поэтому он купил специальную
коробочку с семью прозрачными ячейками, помеченными ВС, ПН, ВТ, СР,
ЧТ, ПТ, СБ.
К счастью, поскольку ему
\textls[-12]{приходится вести знаятия, он
всегда знает, какой сегодня день недели.}


Проблема в том, что он получает новую упаковку из примерно 30
таблеток, как только старые заканчиваются, и это может случиться в
любой день недели.
Он хотел бы сразу сложить все таблетки в
коробочку, но при этом он не в состоянии запомнить, сколько таблеток
было в упаковке или в какой день недели были получены новые таблетки.

Кажущийся очевидным способ раскладывать таблетки по одной за раз, начиная с текущего дня, не работал, потому что наступал момент, когда в каждой ячейке было одинаковое число таблеток и профессор не мог понять, принимал он в этот день таблетку или нет.
Профессор пытался класть все таблетки в одну ячейку текущего дня, а затем перекладывать их все вправо каждый раз, когда пил таблетку.
Но при этом он иногда забывал их перекладывать!

Можно ли предоставить профессору алгоритм, который, опираясь только на день недели и то, что видно в коробочке,  будет говорить, должен он принять таблетку или нет, и если да, то из какой ячейки?
Алгоритм должен сказать профессору, как раскладывать новые таблетки
так, чтобы после этого их не нужно было перекладывать.

% \clearpage

%%% \input{handicaps-sol.tex}

\section*{Решения и комментарии}

\subsubsection*{Определение большинства}% (IDENTIFYING THE MAJORITY)

Идея состоит в том, что каждый раз, когда на счётчике появляется 0
(начальная позиция), вы запоминаете имя, которое слышите в данный
момент, и добавляете на счётчике 1.
Когда на счётчике больше, чем 0,
вы прибавляете~1, если имя, которое вы слышите, то же, что вы держите
в памяти.
В противном случае вы отнимаете 1 из счётчика, но
продолжаете помнить прежнее имя.

Конечно, есть возможность закончить с именем, которое называлось
только раз (например, если список был «Алиса, Боб, Алиса, Боб, Алиса,
Боб, Чарли»).
Тем не менее если имя появлялось больше чем половину
раз, то оно гарантированно сохранится у вас в памяти до конца.
Дело в
том, что при этом к счётчику больше прибавляется, чем отнимается.

Данный алгоритм описан в статье Майкла Фишера и Стивена
Зальцберга\footnote{\emph{M. J. Fischer, S. L. Salzberg}. Finding a Majority Among $n$ Votes /\!/ {Journal of Algorithms}. Vol. 3, No 4 (December 1989). P.~362--380.}.

\begin{addedbytheeditors}
В решении описан алгоритм, известный как \emph{алгоритм большинства Бойера"--~Мура}. "--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Обездвиживатель Конвея}% (THE CONWAY IMMOBILIZER)

Непросто придумать алгоритм, который движется в нужном направлении,
избегает зацикливания и не делает глупостей, когда вы практически
дошли до цели.
В данной задаче сработает следующее.

\medskip

Если есть свободное место, то перекладываем на него карту, лежащую
слева от него (возможно, по кругу) кроме следующих двух случаев: К,
---, Т и К, Т, ---, в которых следует положить туза на короля.

Если все места заняты и дама находится в левой позиции, то кладём короля на даму, в противном случае карту справа от дамы перекладываем правее (опять же, возможно, по кругу).

Очевидно, что если какой-то ход собирает три карты в одну стопку, то
мы победили. Далее,
начав с позиции с одним свободным местом, в том числе и К, ---, Т или
К, Т, ---, мы максимум за три хода придем или к победе, или к позиции,
в которой все три места заняты.
\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.55]{Figs/Handicaps/conway-ru}
\includegraphics[scale=.98]{mp/wink-24}
% \vspace{-2\jot}
\end{figure}
Таким образом, достаточно проверить, что все шесть возможных
комбинаций с тремя занятыми местами приводят к победе; это видно из рисунка.
\heart

Удивительным образом, этот алгоритм можно обобщить для работы с любым
(фиксированным, известным) числом карт, по-прежнему разложенным в три
колоды (рубашкой вниз, в каждой колоде видна только верхняя карта,
колоды могут быть пустыми).
Скажем, для 52 карт, пронумерованных числами от 1 до 52, следующие правила (данные в приоритетном порядке) в конечном итоге приведут к тому, что слева окажется колода, сложенная по порядку, с первой картой наверху.

\begin{enumerate}[label=(\arabic*),noitemsep,leftmargin=\parindent,labelsep=3.5pt]
\item Если видим 2, 1, ---, то кладём $1$ на $2$.
\item Если видим только две карты (т.\,е. одна из колод пуста), то перекладываем карту вправо (возможно, по кругу) в пустую колоду.
\item Если видим $k$, $j$, $k-1$, где $j < k$, то кладём $(k-1)$ на $k$.
\item Если видим только одну карту (т.\,е. две колоды пусты), то перекладываем карту налево.
\item Если видим три карты, то карту справа от наибольшей из видимых перекладываем дальше направо (возможно, по кругу).
\end{enumerate}

Докажем, что этот алгоритм действительно работает.
Предположим, что мы видим карту 52 в средней или в правой колоде.
Тогда, следуя правилам (2) и (5), в итоге мы поместим её  в левую колоду, а все остальные карты попадут в среднюю.
По мере их перемещения вправо согласно правилу (2), к тому моменту, когда средняя колода опустеет, карты $51, 50, 49,
\dots, k$, где $k < 52$, будут, согласно правилу (3), сложены на карту $52$.
Разумеется, если $k = 1$, то задача решена "--- последний ход сделан по правилу (1).
В противном же случае карта $k$ переместится в среднюю колоду по правилу (2) и в правую по правилу (5), за ней аналогичным образом последует $(k+1)$ и так далее, пока в правой колоде не окажется 51 карта, причём верхние карты будут упорядочены от $51$ до $k$.

Теперь карта $52$ перекладывается в среднюю колоду,
а правая колода перекладывается в обратном порядке в левую.
Далее карта $52$ передвигается в правую колоду, а левая колода перемещается в среднюю колоду, при этом порядок снова меняется.
Наконец $52$-я карта перекладывается обратно в левую колоду.
В этот момент в средней колоде окажутся карты от $51$ до $k$, с $51$ наверху.
Дальше карты с $51$ по $k$ перемещаются согласно правилу (2) направо и оказываются в левой колоде по правилу (3), до тех пор пока $k$, $(k+1)$, $\dots, 52$ опять не попадут в левую колоду.

Правая колода сейчас пустая, следовательно,  карта $(k-1)$ находится где-то в средней.
Если она не в самом низу, то ей придётся перейти в левую колоду и процесс, описанный выше, повторится для некоторого $k'<k$.
Если же случилось, что карта $(k-1)$ оказалась в самом низу, то она не попадёт влево (если только это не $1$), потому что, когда она переместится вправо по правилу (5), средняя колода опустеет и мы вынуждены будем применить правило (2) вместо (3).
Однако в конце следующего цикла в средней колоде будет обратный порядок, с картой $(k-1)$ наверху.
Отсюда следует, что значение $k$ уменьшается хотя бы каждый второй раз, когда карта $52$ попадает в~пустую левую колоду.

Для завершения доказательства нам осталось проверить, что в какой-то момент карта $52$ появится наверху средней или правой колоды.
Очевидно, что в какой-то момент она появится на одной из колод;
предположим, что на левой.
Следуя правилу (3), мы можем собрать над ней карты $51$, $50$, $\z\dots, k$, а остальные карты окажутся в средней и, возможно, в правой колоде.
Затем правила (2) и (5) опустошат среднюю колоду.
Далее карта $k$ переместится в середину и потом вправо, затем аналогично переместится карта $(k+1)$ и так далее (как и выше), пока $52$ снова не окажется наверху, но на этот раз (после того, как $51$ перешла в правую колоду) средняя колода будет пустой.
Значит, карта $52$ кладётся на среднюю, и мы получаем желаемую конфигурацию.

\subsubsection*{Крутящиеся выключатели}% (SPINNING SWITCHERS)

Эта задача попала ко мне от Саши Барга из Мэрилендского университета,
но похоже, что в этот момент она была уже много где известна.
Как и
во многих других задачах, окажется полезным рассмотреть сначала более
простой её вариант.

\medskip

Рассмотрим версию с двумя выключателями: нажав на обе кнопки, мы выясним, находились ли они в одинаковом состоянии, поскольку если да, то лампочка загорится (если она уже не горела).
В противном случае на следующем шаге нажмём одну кнопку, после чего они
заведомо окажутся в одинаковом состоянии и в худшем случае нам придётся сделать ещё один шаг, нажав сразу обе кнопки, чтобы лампочка наконец зажглась.

Вернёмся к варианту с четырьмя лампочками.
Обозначим через~А операцию, когда мы нажимаем все четыре кнопки, 
D "--- две противоположные кнопки (по диагонали), 
N "--- две соседние и 
S "--- одну кнопку.
Тогда последовательность операций ADANADASADANADA включит лампочку максимум за 15 шагов. %испревлена ошибка --- было ADANASADAND/ 12 шагов

В более общем виде для выключателей в углах $n=2^k$"=угольника это можно проделать за $2^{n}-1$ шаг следующим образом.
Пусть $X\hm=X_1,\dots,X_m$ "--- шаги для $\slfrac n2=2^{k-1}$"=угольника.
Составим из противоположных выключателей пары, и если $X_i$ "--- шаг для $\slfrac n2$-угольника, при котором нажимаются кнопки $i_1,\dots,i_j$, тогда пусть $X_i'$ будет шагом для $n$"=угольника, при котором нажимаются кнопки $i_1,\dots,i_j$ и $i_1+\slfrac n2,\dots,i_j+\slfrac n2$.
Пусть $X'$ обозначает последовательность шагов $X_1',\dots,X_m'$.

Нам также необходим шаг $X_i''$ для $n$-угольника, при котором нажимаются только кнопки $i_1,\dots,i_j$.

Будем говорить про противоположную пару, что она \emph{чётная}, если оба выключателя включены или оба выключены.
Если все пары чётные, то последовательность шагов $X'$ включит лампочку.
Идея в том, чтобы посредством применения шагов $X_1''$, $X_2''$ и так далее сделать все пары чётными, каждый раз проверяя при помощи $X'$, добились ли мы успеха.
Порядок шагов такой:
{\small
\begin{gather*}
X_1',\dots,X_m';\ X_1'';\ X_1',\dots,X_m';\ X_2'';\
X_1',\dots,X_m';\ \dots ;\ X_m'';\ X_1',\dots,X_m',
\end{gather*}
}
или, более компактно: $X';X_1'';X',X_2'';X';\dots;X_m'',X'$.
Всего получилось $(m+1)m+m=m(m+2)$ шагов.
Следовательно, если $f(n)$ означает число шагов, предпринятых для решения $n$"=угольника, то 
$f(n)\hm=f(\tfrac n2)(f(\tfrac n2)+2)$,
и, поскольку $f(1)\hm=2^1-1=1$, получаем, что $f(n)\hm=2^n-1$, если $n$ "--- степень двойки. %расхождение с оригиналом

Эта последовательность действий работает, потому что шаги типа $X''$ работают на чётных/нечётных парах так же, как и шаги типа $X$ работали на включённых/выключенных парах, и между тем шаги типа $X'$ абсолютно не влияют на конфигурацию чётных/нечётных пар.
\heart

С другой стороны, задача неразрешима, если $n$ не является степенью двойки, то есть если $n=m\cdot 2^k$ при нечётном $m>1$.
В самом деле, будем пользоваться двоичными векторам длины $n$ для представления и конфигурации выключателей (1 $=$ «включён», 0 $=$ «выключен») и операций (1 $=$ «нажать», 0 $=$ «не трогать»).
Пусть $v$ "--- такой вектор.
Обозначим через $v^i$ результат его поворота на $i$ позиций вправо.
Примененяя операцию $w$ к конфигурации $v^i$, мы получаем $v+w^i$.

Будем говорить, что $n$-вектор $v$ является \emph{неровным}, % [rough ?], 
если количество различных среди его поворотов $v^0,v^1,\dots,v^{n-1}$ не является степенью двойки.
Исходно возможна любая неровная конфигурация кнопок.
Мы утверждаем, что после любой фиксированной операции $w$ по-прежнему
возможна любая, с точностью до поворота, неровная конфигурация,
Таким образом, нет гарантированного способа избавиться от неровных конфигураций и, в частности, нельзя гарантировать получение конфигурации~$11\dots1$.

В самом деле, для нечётного $n$, то есть при $n=m$, все векторы, кроме $00\dots0$ и $11\dots1$, неровные.
Если $w$ "--- некоторый вектор и $v$ "--- неровный вектор, то вектор $v-w=v+w$ или $v-w^1$ будет неровным, так что если один из поворотов векторов $v-w$ или $v-w^1$ был возможен до применения операции, то поворот $v$ возможен после её применения.

Если $n=m\cdot 2^k$, при $k>1$, то можно разбить $n$-цикл на сегменты длины $2^k$; вектор $v$ будет неровным, если только он не одинаков на всех сегментах.
Следовательно, если вектор $v$ неровный, то существует такое $j$, $1\le j\le 2^k$, что не все его координаты $i\cdot 2^k+j$ при $1\le i\le m$ равны между собой, и остаётся применить приведённое выше рассуждение к векторам $v-w$ и $v-w^{2^k}$. %нет в оригинале --- с согласия Питера https://github.com/anton-petrunin/test/wiki

\begin{addedbytheeditors}
Идейно задача близка к <<разностям по кругу>>.
Читатель может построить взаимно однозначное соответствие между решением этой задачи и алгоритмом решения «Ханойской башни», а также знаменитой латинской поэмой
\[
\tabcolsep2pt
\begin{tabular}{rlllllll}
aba & caba & daba & caba & eaba & caba & daba & caba\\
faba & caba & daba & caba & eaba & caba & daba & caba\\
gaba & caba & daba & caba & ...
\end{tabular}
\]


Следующая чрезвычайно похожая задача рассматривалась Мартином Гарднером\footnote{\emph{M. Gardner}.
Mathematical games /\!/ Scientific American. 1979. Vol. 240, no.~2.
% (February 1979),
P. 16--27.}.
Он предполагал, что задача родом из Советского Союза. 

Четыре стакана расположены по углам квадратного крутящегося столика.
Некоторые стаканы поставлены вверх (то есть правильно), а некоторые вниз (то есть перевёрнуты). Человек с завязанными глазами должен переставить стаканы так, чтобы все они были в одном положении, в этом случае прозвенит колокольчик.
Стаканы могут быть переставлены по очереди в соответствии со следующими правилами.
Любые два стакана могут быть проверены за один ход, и, почувствовав их ориентацию, человек может перевернуть любой из них, ни одного или оба сразу.
После каждой такой операции, столик поворачивается на случайный угол.
Задача состоит в том, чтобы разработать алгоритм, который позволит 
поставить все стаканы одинаково (вверх или вниз) за конечное число поворотов.
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Комната с одной лампочкой}% (THE ONE-BULB ROOM)

Я услышал эту задачу от Адама Чалкрафта, %(Adam Chalcraft)
который имеет честь представлять Великобританию на международных
соревнованиях по хоккею на моноциклах.
Задача также появлялась на сайте www.ibm.com и была перепечатана в <<Emissary>> "--- информационном бюллетене Математического института в Беркли. %(Matematical Science Research Institute) 
Одна из версий задачи появлялась даже в заслуженно известной программе
радио NPR «Car Talk» в 2003 году.

Однако считаю нужным предупредить читателя, что эту задачу иногда путают с куда более сложной задачей, с которой вам предстоит встретиться в следующей главе.

\medskip

Необходимо предположить, что между посещениями заключённых
с лампочкой ничего не происходит. При этом
заключённые могут и не знать, в каком состоянии изначально находится лампочка.

Идея заключается в том, что один из заключённых (скажем, Алиса) всё время пытается лампочку включить, а каждый из остальных выключает её \emph{дважды}.

Точнее говоря: Алиса всегда включает лампочку, если она выключена, в противном случае оставляет её включённой.
Остальные заключённые выключают её первые два раза, если она включена, и оставляют её гореть при последующих посещениях.

Алиса считает, сколько раз она попадает в тёмную комнату после своего первого 
посещения. После $2n-3$ <<тёмных>> посещений она может заключить, что в комнате побывали все.

В самом деле,
каждое <<тёмное>> посещение говорит о том, что один из остальных $n-1$ заключённых побывал в комнате.
Если же кто-то из них, скажем Боб, в комнату не заходил, то лампочка не могла быть выключена больше чем $2(n-2)\z=2n-4$ раз.
С другой стороны, Алиса в конце концов насчитает $2n-3$ тёмных посещения.
Действительно, в итоге лампочка будет выключена $2(n-1)\z=2n-2$
раз.
Из этих выключений только одно может не засчитаться Алисой за тёмное
посещения (в случае, если один из заключённых побывал в комнате до того,
как туда первый раз попала Алиса, и выключил изначально горящую лампочку).

Если заключённых только два, то каждый из них узнает о том, побывал ли другой в комнате, "---
Алисе нужно дожидаться повторного тёмного посещения, а Бобу своего повторного \emph{светлого} посещения.
Однако для случая $n>2$ имеется доказательство того, что невозможно гарантировать, что более чем один заключённый узнает, посетили ли все остальные комнату.
Ниже приводится набросок этого доказательства.
Читателям рекомендуется его пропустить, если только они не интересуются, как получаются отрицательные результаты в задачах о передаче информации.
Я включил это доказательство, потому что, насколько мне известно, оно
ранее не публиковалось.
{\looseness1\par}

По сути, мы утверждаем, что противник (который оставляет расписание и
знает стратегию заключённых) может сделать бесполезными любые их
действия, кроме аналогичных тем, что применялись в приведённом выше алгоритме.

Давайте сосредоточимся на одном заключённом, Алисе.
Мы предполагаем, что её стратегия детерминированная и основана исключительно на последовательности состояний лампочки, которые она до сих пор наблюдала.

Предположим, что стратегия Алисы предписывает (в какой-то ситуации) 
изменить состояние лампочки после того как она нашла
её именно в том состоянии, в котором оставила её при предыдущем посещении.
Тогда противник может немедленно отправить её обратно в комнату, сводя
на нет её предыдущее посещение;
фактически эта часть стратегии Алисы может только дать противнику дополнительную опцию.
Исходя из этого можно предположить, что Алиса никогда не меняет
состояния лампочки, если она находит её в том же виде, в котором
оставила в предыдущий раз.

Далее, предположим, что Алисе в какой-то момент требуется оставить лампочку в том же состоянии, в котором она её нашла.
Тогда мы утверждаем, что можно считать, что после этого она не
предпримет вообще никаких действий!
Почему?
Потому что если противник не хочет, чтобы она продолжала действовать, то он может устроить так, что Алиса никогда не увидит лампочку в состоянии, отличном от того, которое она видит в данный момент.
Он может это сделать, поскольку если Алиса действительно останется навсегда неактивной, то по крайней мере одно из состояний («включено» или «выключено») будет повторяться бесконечно часто.
Допустим, это состояние «выключено».
Тогда противник может составить расписание для Алисы так, что лампочка
будет выключена как при её посещении в настоящий момент, так и при
всех последующих посещениях, и, следовательно, согласно предыдущему
рассуждению она больше не будет ничего включать или выключать.
Ещё раз: в этом случае у~противника есть возможность полностью нейтрализовать Алису, и~можно предположить, что ровно это он и делает.

Теперь ясно что, алгоритм для Алисы не может начинаться с инструкции
<<оставить лампочку в том же состоянии, в котором она её находит>>,
так как в этом случае она не сделает ничего и никто никогда не узнает,
заходила ли она в комнату%
\footnote{Разве что если она не пользуется очень сильными духами...}.
Пусть теперь, скажем, Алиса должна включить лампочку, если она
выключена, и оставить ее включенной в противном случае.
Тогда она ничего не будет делать до тех пор, пока опять не попадёт в комнату с выключенной лампочкой, и в этом случае она может только снова включить лампочку или остаться бездейственной навсегда.
Таким образом, число раз, когда Алиса включает лампочку, ограничено некоторым $j$ (которое можно считать константой, иначе у противника будет больше возможностей).
Назовём такую стратегию $+j$, где $j$ "--- положительное целое число или бесконечность.
Аналогичное рассуждение, применённое для случая, когда Алиса должна во время первого посещения выключить лампочку, приводит к стратегии~$-j$.

Остаётся вариант, когда Алиса должна будет изменить состояние
лампочки при своем первом входе в комнату, но в этом случае далее она вынуждена будет продолжить действовать так, как описано выше, в зависимости от того, включила она лампочку или выключила.
И это снова даёт противнику дополнительную возможность.

Всё сводится к тому, что у каждого заключённого имеется стратегия $+j$ или $-j$ для различных $j$.
Если все они лампочку только выключают (или только включают), то никто
никакой информации не получит.
Таким образом, можно предположить, что у Алисы стратегия $+j$, а у Боба стратегия $-k$.
Если Чарли включает лампочку, Алиса никогда не сможет определить, закончили ли Боб или Чарли или же у них остаётся ещё по одному заданию.
Если же Чарли выключает лампочку, то во мраке останется Боб.

Учитывая всё вышесказанное, мы получаем, что для того, чтобы какой-то заключённый смог определить, что все посетили комнату,
Алиса должна включать лампочку, в то время как все остальные выключать (или наоборот).
Действительно, если стратегия у Алисы $+j_1$, а остальные имеют стратегии  $-j_2,\dots,-j_n$, то легко проверить, что условие, при котором каждое $j_i$ конечно и не меньше 2, а $j_1$ больше, чем сумма остальных минус наименьший из них, является необходимым и достаточным.

Значит, если $n>2$, то максимум одному заключённому гарантирована возможность узнать, все ли побывали в комнате.
Ну надо!

\subsubsection*{Два шерифа}% (ТHE TWO SHERIFFS)

Если бы шерифы (назовём их Лев и Ральф) заранее обменялись
секретной информацией, то они смогли бы использовать этот секрет для
того, для шифровки разговора "--- и их цель была бы
достигнута.
Но так как они никогда прежде не общались,
этот секрет придётся изготовить по ходу раз\-го\-вора.
{\looseness1\par}

\medskip

Предположим, что пары, к которым Лев и Ральф свели свои списки подозреваемых, не одинаковы, то есть возможность определить убийцу существует.
Тогда если, скажем, Лев просто назовет свою пару, то Ральф будет знать, кто убийца.
Но тогда и линчеватели будет знать всё, что знает Лев, так что любая попытка Ральфа сообщить Льву имя убийцы без того, чтобы об этом не прознали линчеватели, обречена на провал.

Лев и Ральф должны подойти к определению имени убийцы более хитрым способом.
Составим таблицу из всех возможных пар подозреваемых таким образом, что каждый столбец содержит разбиение восьми подозреваемых на четыре пары.
Вот один из способов:
\[
\begin{matrix}
\{1,2\}&\{1,3\}&\{1,4\}&\{1,5\}&\{1,6\}&\{1,7\}&\{1,8\}
\\
\{3,4\}&\{2,4\}&\{2,3\}&\{2,6\}&\{2,5\}&\{2,8\}&\{2,7\}
\\
\{5,6\}&\{5,7\}&\{5,8\}&\{3,7\}&\{3,8\}&\{3,5\}&\{3,6\}
\\
\{7,8\}&\{6,8\}&\{6,7\}&\{4,8\}&\{4,7\}&\{4,6\}&\{4,5\}
\end{matrix}
\]


Лев и Ральф совершенно свободно могут обсуждать по телефону вопрос о сокрытии информации от линчевателей.
В частности, ничто не мешает им согласиться пронумеровать подозреваемых и составить такую таблицу, как приведённая выше.

Далее Лев сообщает Ральфу, в каком столбце находится его пара.
Например, если пара Льва "--- $\{1,2\}$, то он говорит: «Моя пара в первом столбце». 

Если пара Ральфа находится в том же столбце, он тут же понимает, что у него и Льва одинаковые пары.
Он может прямо сказать об этом, после чего шерифам остаётся закончить разговор и вернуться к сыскной работе.

В противном случае Ральф понимает, что пара Льва "--- одна из двух пар в столбце.
Вернёмся к нашему примеру.
Если пара Ральфа "--- $\{2,3\}$, то он знает, что у Льва должна быть пара $\{1,2\}$ или $\{3,4\}$.
Тогда он разделяет столбец на две равные части так, чтобы обе предполагаемые пары были в одной части, и сообщает об этом разбиении Льву.

В нашем примере он скажет Льву: «Моя пара либо в $\{1,2,3,4\}$, либо в $\{5,6,7,8\}$.»
(А если бы пара Ральфа была бы $\{2,5\}$, то он сказал бы: «Моя пара либо в $\{1,2,4,5\}$, либо в $\{3,4,7,8\}$.»)

Лев, безусловно, будет знать, в какой части надо искать пару Ральфа, так как она может быть только в той части, где находится \emph{его собственная} пара.
Это и есть секрет Ральфа и Льва!

Теперь Лев может сказать Ральфу, сто\'{и}т ли его пара на первом или втором месте в соответствующей части.
Если, как в приведённом выше примере, пары Льва "--- $\{1,2\}$ и $\{2,3\}$, то он может сказать: «Моя пара первая», или, что то же самое: «Моя пара "--- либо $\{1,2\}$, либо $\{5,6\}$».

Далее, Ральфу становится ясно, какая пара у Льва, а следовательно, и кто  убийца.
Он может сообщить об этом Льву, просто сказав, что убийца  имеет больший или меньший номер в паре Льва, то есть сказать: «Убийца "--- больший по номеру в твоей паре», или же: «Убийца "--- 2 или 6».

Линчеватели не смогут понять, о какой из «частей» говорят Лев и Ральф.
Если бы у Льва была пара $\{5,6\}$, а у Ральфа "--- $\{6,7\}$ или $\{6,8\}$, то весь разговор, подслушанный линчевателями, был бы абсолютно таким же, как в рассмотренном примере, и в этом случае номер убийцы был бы 6, а не 2.
\heart

\medskip
Задача придумана как иллюстрация к идее, предложенной вашим автором лет двадцать пять тому назад:
как, пользуясь только открытыми каналами связи, сделать общуий секрет из общеизвестной информации%
\footnote{\emph{D. Beaver, S. Haber, P. Winkler}. On the Isolation of a Common Secret /\!/ {The Mathematics of Paul Erd\H{o}s}. Vol. II / R. L. Gracham and J.Ne\v{s}et\v{r}il, Eds. Berlin: Springer-Verlag, 1996.}.
Первоначально эта идея применялась для игры в бридж, где партнёрам не разрешается иметь необъявленных договорённостей о значениях заявок и игре.
С 1924 года, когда был создан современный бридж, считалось (неверно), что это правило препятствует какому-либо секретному общению между партнёрами.
Это заблуждение сдерживало развитие более совершенных методов торговли и стратегии вистующих, так как многие считали, что такие методы могут давать противникам слишком много информации.
Например, основанная на научных методах шлемовая торговля подскажет противнику, с какой карты начинать.
% {\looseness-1\par}

Так или иначе, ваши карты (которых, как вы знаете, нет у вашего партнёра) дают вам и вашему партнёру общее знание, которое может быть использовано для секретного общения\footnote{Подробную информацию и ссылки можно найти в статье: \emph{P. Winkler}. The Advent of Cryptology in the Game of Bridge /\!/ {Cryptologia}. Vol. 7, no.~4 (October 1983). P.~327--332.}.

\begin{addedbytheeditors}
Похоже, что для шести подозреваемых эта задача не имеет решения, но
доказательство неизвестно.
Для аналогичной задачи про двух шерифов и
7 подозреваемых было найдено замечательное решение, приведённое ниже.%
\footnote{\emph{Y. Kallus}. The Two Sheriffs puzzle. Version: 2015-04-18. \url{https://mathoverflow.net/q/203270}}

\setbox180\hbox spread3pt{\hss\includegraphics[scale=1.1]{final/test-master/mp/pic-246}}
\begin{wrapfigure}[8]{r}{\wd180}
%  \vspace{-\jot}
\box180
\end{wrapfigure}


Рассмотрим так называемую плоскость Фано "--- конечную проективную плоскость, имеющую 7 точек и 7~прямых (см. рисунок).
Сопоставим каждому подозреваемому по точке в этой плоскости.

% \begin{figure}[h]
% \centering
% \includegraphics{final/test-master/mp/pic-246}
% \end{figure}

Лев и Ральф называют друг другу имя третьего подозреваемого, стоящего
на прямой проходящей через подозреваемых в их парах.
Возможны три случая:

1. Лев и Ральф называют одного человека, тогда у шерифов те же пары подозреваемых и им необходимо вернуться к сыскной работе.

2. Лев и Ральф не указали подозреваемых в списках друг друга.
В этом случае шерифы называют друг другу пары своих подозреваемых. Оба теперь знают виновного, но линчеватели этого не знают, поскольку им неизвестно, что мы рассматриваем случай 2.

3. Лев назвал имя одного из подозреваемых Ральфа.
В этом случае Ральф также назвал одного из подозреваемых Льва.
Оба шерифа знают об этом, линчеватели "--- нет.
Кроме того, оба шерифа теперь знают виновного.
Остаток разговора предназначен, чтобы не раскрывать линчевателям, что мы в случае 3.
Лев называет двух подозреваемых, которые составляют прямую с его объявленным подозреваемым, но не включают подозреваемого, объявленного Ральфом.
Ральф делает то же самое.

(При этой стратегии линчеватели смогут определить убийцу с вероятностью 80",\%, и это существенно хуже чем 50",\% в оригинальном решении с~8~подозреваемыми.)

Похожая идея была использована А.",В.",Шаповаловым\footnote{%  \cite[№ 105089]{problems}
Московские математические олимпиады. 1993--2005 / Р.",М.",Федоров и
др. М.: \mbox{МЦНМО}, 2017. С.~44.}  в следующей более простой задаче. 

Из колоды вынули семь карт, показали всем, перетасовали и раздали Грише и Лёше
по три карты, а оставшуюся карту отдали Коле.
Гриша и Лёша могут по очереди сообщать вслух любую информацию о своих картах.
Могут ли они сообщить друг другу свои карты так, чтобы при этом Коля не смог
вычислить местонахождение ни одной из тех карт, которых он не видит?
(Гриша и Лёша не договаривались о каком-либо особом способе общения;
все переговоры происходят открытым текстом.)

Ещё несколько аналогичных задач разобраны в статье С.",Б.",Гашкова «Разностные множества, конечные геометрии, матрицы Царанкевича и экстремальные графы»%
\footnote{Математическое просвещение. Третья серия. 2017. Вып.~21. С. 145--185.}.
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Рассеянный профессор}% (THE ABSENT-MINDED PILL TAKER)

Профессорская таблеточница состоит из семи прозрачных ячеек, помеченных ВС, ПН, ВТ, СР, ЧТ, ПТ, СБ (см. рисунок ниже).
Представим, что профессор получает 30 новых таблеток в пятницу утром.
Он хочет распределить их по ячейкам таким образом, чтобы, посмотрев на свою коробочку, начиная с этого дня он мог бы сказать, выпил ли он свою ежедневную таблетку, и если нет, то смог бы взять её из соответствующей ячейки.
% {\looseness-1\par}

\begin{figure}[!ht]
\vspace{2\jot}
\centering
% \includegraphics[scale=0.5]{Figs/Handicaps/box1-ru}
\includegraphics[scale=.9]{mp/wink-25}
\vspace{-2\jot}
\end{figure}


Это можно сделать, положив по 5 таблеток в ПТ и СБ и по 4 таблетки в ВС, ПН, ВТ, СР, ЧТ и следовать такому ал\-го\-ритму:

\medskip
% \begin{itemize}
%  \item[]
Если есть не прерывающаяся (по модулю 7) последоваетельность ячеек с $k$ таблетками, а в остальных ячейках по $k-1$ таблетке, то он знает, что самая левая <<тяжёлая>> (то есть с $k$ таблетками) ячейка "--- это та, откуда нужно брать следующую таблетку.
Если, скажем, сегодня среда и такая ячейка помечена СР, он берёт
таблетку оттуда, если же эта ячейка "--- ЧТ, он знает, что таблетка на
среду уже принята.
% \end{itemize}

\medskip
Трудность в том, что каждые семь дней все ячейки становятся равными, то есть в каждой из них одно и то же число таблеток.
Какую ячейку выбрать тогда?
Ну, в данном случае профессор понимает, что это случится в
воскресенье, и он устанавливает правило: если все ячейки равны, то
надо брать из ячейки  <<ВС>>.
Таким образом, если он видит, что во всех ячейках таблеток поровну и
если сегодня воскресенье, то он берёт таблетку из ячейки <<ВС>>, если же сегодня суббота, значит, таблетку он уже принял.

Всё идёт прекрасно, пока 30 дней спустя профессор не получает новые 30 таблеток.
Это происходит в воскресенье, значит, он распределит таблетки по 5 штук в СБ и ПН и по 4 штуки в остальные ячейки;
тогда он видит, что ячейки станут равными во вторник утром, а не утром в воскресенье.
Это катастрофа "--- профессор не в состоянии запомнить, что когда
таблеток во всех ячейках станет поровну, ему надо брать очередную
таблетку из ячейки~<<ВТ>>, а~не~<<ВС>>.

Определённо, существует решение этой задачи, в котором не требуется
выбрасывать таблетки или оставлять неиспользованные.
Но какое? Профессору нужен надёжный способ отмечать ячейку, из которой нужно взять следующую таблетку.
Он мог бы положить значительно большее количество таблеток в одну
ячейку и затем передвигать этот запас таблеток каждый день, но, как мы знаем, в этом случае он не будет уверен, что уже переложил запас.
Так или иначе профессору нужно придумать простой алгоритм, который позволит ему принимать свою ежедневную таблетку, не перекладывая остальные.

Разумеется, профессор начинает задаваться вопросом, а существует ли у этой задачи решение;
может быть, удаться доказать его невозможность?
Если каждый день он берёт таблетку из ячейки, помеченной только этим
днём, то, пойдя в обратную сторону от последней таблетки, мы видим,
что каждый день коробочка состоит либо из равных ячеек, либо из не
прерывающейся последовательности ячеек с $k$ таблетками, при том что в
остальных ячейках лежит по $k-1$ таблетке.
Таким образом, он приходит назад к начальной задаче, где необходимо
запоминать ячейку для случая, когда таблеток поровну.

Но подождите, а есть ли причина, чтобы, скажем, в среду он должен
брать таблетку именно из ячейки <<СР>>?  Вовсе нет.
Конечно, алгоритм
должен оставаться простым, иначе можно перегрузить даже долговременную
память профессора.
Но можно допустить дополнительную свободу при
условии, что есть разумное правило для выбора ячейки, из которой нужно
взять таблетку (а также для определения того, не была ли она уже
взята).

Оказывается, существует алгоритм, отвечающий всем требованиям
профессора и допускающий только одно небольшое исключение из правила
<<таблетка всегда берётся из ячейки, соответствующей текущему дню
недели>>.
Профессор руководствуется следующими положениями:

\begin{enumerate}[label=(\arabic*),noitemsep,leftmargin=\parindent,labelsep=3.5pt]
\item Таблетки следует распределять по ячейкам \emph{более-менее} поровну, иначе возникнут неудобства в конце, перед покупкой новой упаковки.
\item Необходимо избегать \emph{полностью} равного распределения, иначе опять возникнет вопрос, из какой ячейки в этот момент брать таблетку.
\item В силу п.",(2) не всегда может быть правильным выбирать ячейку с наибольшим количеством таблеток.
\end{enumerate}

Учитывая эти условия, профессор приходит к идее, что в любой момент должно иметься не более трёх размеров ячеек и что, если возможно, он должен брать таблетку из ячейки среднего размера.
Чтобы сделать это как можно проще, будем считать, что есть только одна <<куча>> "--- ячейка с наибольшим числом таблеток.
Обозначим через $k$ число таблеток в куче в данный момент (в разные
дни оно может быть разным).
Во всех остальных ячейках будет $k-1$ или $k-2$ таблеток, и те ячейки,
в которых таблеток $k-2$, будут образовывать не прерывающуюся
последовательность справа от кучи.
На рисунке ниже представлены несколько допустимых конфигураций.

Таблетку надо будет брать всякий раз из первой ячейки справа от кучи, содержащей $k-1$ таблеток.
Если же ячейки с $k-1$ таблетками нет, то таблетку надо брать из кучи.
В почти всех случаях надпись на ячейке, из которой берётся таблетка, правильная, то есть совпадает с текущим днём недели.

Например, на рисунке выше подготовлены для приёма
\textls[-8]{таблетки во вторник, субботу, понедельник и четверг соответственно.}

Исключением является момент, когда у профессора остаётся последняя таблетка.
В предыдущий день он обнаружил две оставшиеся таблетки вместе в ячейке, помеченной соответствующим днём недели, и он одну оттуда взял (согласно правилу, надо брать из кучи, если нет ячейки размером на один меньше, чем куча).
Теперь последняя таблетка лежит в ячейке, помеченной \emph{вчерашним} днём, и эту таблетку он принимает сегодня.

Легко заметить, что если таблетки разложены должным образом, то правила соблюдаются до последней таблетки.
Но всегда ли возможно всё правильно настроить, когда приходят новые таблетки?
И~да, действительно, существует единственная правильная конфигурация для любого данного числа таблеток и любого данного дня недели, то есть ровно как профессору следует раскладывать новые таблетки.
Профессор вычисляет день, когда должна быть принята последняя таблетка (а именно, вчерашний день недели плюс число таблеток по модулю 7, при этом
предполагается, что сегодняшнюю таблетку он ещё не выпил).
Конечно, дни недели пронумерованы последовательно  по модулю 7, но не имеет значения, какой из дней имеет номер~1.

Если, скажем, в среду утром пришло 32 таблетки, то профессор знает, что последнюю таблетку надо будет принять в субботу (из ячейки <<ПТ>>!). Из этого следует, что ячейка ПТ содержит кучу.
Профессор кладёт шесть таблеток в <<ПТ>>, по четыре таблетки в <<СБ>>, <<ВС>>, <<ПН>>, <<ВТ>> и по пять в <<СР>> и <<ЧТ>>.
И теперь у него всё устроено должным образом, чтобы принять таблетку за среду.
\heart

% \medskip
Уместно спросить:
«А что, если у нас меньше чем семь ячеек?
При каком наименьшем числе ячеек наша задача имеет решение?
А что, если в неделе $d$ дней вместо семи,
каково тогда наименьшее возможное число ячеек как функция от $d$?»

Отметим, что профессорское решение работает и на Юпитере, где в неделе $d$ дней ($d>1$) и где таблеточницы, конечно же, имеют $d$ ячеек.
В случае $d=2$ это сводится к тому, что в одной ячейке держат на одну или две таблетки больше.
Решение для двух ячеек может быть использовано для любого чётного $d$, так как человек, принимающий таблетки, знает, какой сейчас день этой чётной недели, а значит, он знает и чётность этого дня.
Так что наличие двух ячеек достаточно и, конечно, необходимо, если $d$ чётно.

Однако две ячейки не сработают, если $d$ нечётно.
В этом случае непременно найдутся два последовательных дня недели, которые должны сойтись к одной однотаблеточной конфигурации, так что, когда человек видит такую конфигурацию в первый из этих дней, он не может сказать, принял ли он таблетку в этот день или нет.

Читателю, прошедшему уже такой долгий путь, не составит труда убедить себя, что при нечётных $d$ достаточно трёх ячеек.
Но придумать простой алгоритм с тремя ячейками для семидневной недели довольно сложно.
Предложенная далее схема основана на мнемоническом использовании двоичной записи чисел.

Пронумеруем дни недели, начиная с воскресенья $=$ 1 и заканчивая субботой $=$ 7, числами по модулю 7.
Схема включает в себя семь \emph{типов конфигураций}, пронумерованных от 1 до 7, а конфигурации в каждом типе определяются по двоичному представлению номера типа.
При этом мы считаем, что ячейки располагаются в линейном порядке "--- «левая», «центральная» и «правая» (то есть циклический порядок использоваться не будет).

Так, например, тип $1=001_2$ требует, чтобы правая ячейка была задействована как куча с гораздо б\'{о}льшим количеством таблеток, чем будет в каждой из двух остальных.
Тип $3 = 011_2$ требует, чтобы в левой ячейке было существенно \emph{меньше} таблеток, чем в любой из двух остальных ячеек,
а тип 7$ = 111_2$ "--- чтобы ячейки были более-менее равными.

Точнее, типы 1, 2 и 4 имеют кучи (справа, в центре и слева, соответственно), в которых на две или три таблетки больше, чем в любой из двух других ячеек.
При этом если оставшиеся две ячейки различны, то они упорядочены так, что б\'{о}льшая ячейка находится правее.
%
Далее, типы 3, 5 и 6 имеют особую наименьшую ячейку слева, в центре или справа соответственно.
Две другие ячейки содержат каждая на две таблетки больше, если они одинаковые.
Если нет, то они различаются по размеру не больше чем на одну таблетку и б\'{о}льшая ячейка расположена правее и содержит на 2 или 3 таблетки больше, чем самая маленькая.
%
Тип 7 требует, чтобы содержимое ячеек отличалось друг от друга максимум на одну таблетку, с меньшими ячейками справа (см. таблицу).

\begin{figure}[!ht]
\vspace{2\jot}
\centering
\begin{tabular}{ l  c c c c }
\toprule
     & 3 таб. & 4 таб. & 5 таб. & 6 таб. \\ \midrule
    тип $1$ & $003$ & $013$ & $113$ & $114$ \\ 
    тип $2$ & $030$ & $031$ & $131$ & $141$ \\ 
    тип $3$ & $012$ & $022$ & $023$ & $123$\\ 
    тип $4$ & $300$ & $301$ & $311$ & $411$\\ 
    тип $5$ & $102$ & $202$ & $203$ & $213$\\ 
    тип $6$ & $120$ & $220$ & $230$ & $231$\\ 
  тип $7$ & $111$ & $211$ & $221$ & $222$ \\
                            \bottomrule
\end{tabular}

% \vspace{-.5\jot}
\end{figure}

Теперь стратегия: если в день $D$ получено $P$ таблеток, то они распределяются согласно типу $P+D \pmod 7$.
Таблетки берутся так, чтобы сохранялся тип.

В частности, профессор каждый день смотрит на тип $T$ и поступает следующим образом:
если в день $D$ он видит $P>3$ таблеток и $D+P\ne T\pmod 7$, значит, он уже в этот день таблетку принял.
В~противном случае он берёт таблетку из одной ячейки так, чтобы сохранить тип конфигурации.

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.6]{Figs/Handicaps/3box-ru}
\includegraphics{mp/wink-26}
\end{figure}

Когда же останется три таблетки или меньше, становится трудно
следовать какому-либо типу, но можно воспользоваться правилом «слева направо» для типов, чтобы решать, как необходимо менять конфигурации.
Это сводится к использованию приведённой таблицы.

Чтобы воспользоваться таблицей, нужно найти в ней запись, соответствующую $D$ и $P$;
если такая имеется, то нужно взять таблетку так, чтобы после получилась конфигурация, находящаяся ниже и правее (по диагонали).
В противном случае конфигурация будет соответствовать дню $D+1$, и, значит, таблетка уже принята.

\chapter{Крепкие орешки}

\thispagestyle{empty}

\setlength{\epigraphwidth}{.55\textwidth}
\epigraph{Задай  труднейший  из  вопросов!  и  смотри...\\
Ответ  прекрасный  возродится  изнутри!\vspace{1ex}}{Мавлана Джалал ад-Дин Мухаммад Руми, «Радость   при   неожиданном разочаровании»
}

Задачи этого раздела сложны, но ст\'{о}ят потраченных усилий.
Некоторые из них являются вариациями или продолжениями уже рассмотренных задач.

\medskip

Следующая задача была сформулирована
Китом Кёрнесом %K. A. Kearnes
и Эмилем Киссом%Emil Kiss
\footnote{\emph{K. Kearnes, E. Kiss}. Finite algebras of finite complexity /\!/ {Discrete Math.}  1999. Vol.~207, no. 1--3. P.~89--135.}.
Петар Маркович привёз эту задачу на конференцию в честь Даниила Клейтмана, проходившую в Массачусетском технологическом институте в 1999 году.
Н\'{о}га Алон, Том Боуман, Рон Хольцман и сам Даниил Клейтман решили её на той же конференции.

Конечно же, и эту задачу стоит попробовать решить самостоятельно, но нет причин расстраиваться, если у вас не получится.

\subsection*{Ящики с подъящиками}
\rindex{Ящики с подъящиками}

Зафиксируем положительное целое число $n$.
\emph{Ящиком} будем называть декартово произведение $n$ множеств;
если даны $n$ множеств $A_1,\dots,A_n$, то их ящик $A_1{\times}\dots{\times}A_n$ есть множество всех таких последовательностей $a_1,\dots,a_n$, что $a_i$ лежит в $A_i$ для каждого~$i$.

Ящик $\bm{B}=B_1{\times}\dots{\times}B_n$ называется \emph{собственным подъящиком} ящика $\bm{A}\z=A_1{\times}\z\dots{\times}A_n$, если $B_i$ является собственным подмножеством в $A_i$, для каждого~$i$.

Можно ли разбить какой-нибудь ящик на менее чем $2^n$ собственных подъящиков?

\paragraph{Решение}
Найти разбиение на $2^n$ собственных подъящиков легко; следует, конечно, предположить, что каждое множество $A_i$ имеет хотя бы два элемента.
Однако ни один участник конференции не смог предъявить разбиение на менее чем $2^n$ подъящиков; ниже будет показано, что это сделать невозможно.

\textls[-10]{Рассмотрим один из сомножителей $A_i$. 
Выберем в нём собственное}{ подмножество $B_i$.
Выберем в $A_i$ \emph{случайное} подмножество $C_i$ с не\-чёт\-ным числом элементов ($C_i$ может совпасть с $A_i$, если $|A_i|$ нечётно).}
% {\looseness-1\par}

Заметим, что вероятность того, что $|C_i\cap B_i|$ нечётно, равна~$\tfrac12$.
Действительно, $C_i$ можно получить, выбирая элементы множества $A_i$ по порядку так, чтобы предпоследний элемент лежал в $B_i$, а последний в его дополнении $A_i\backslash B_i$.
Каждый раз решение можно принимать, подбрасывая монетку, и только последний элемент следует выбрать так, чтобы число $|C_i|$ получилось нечётным.
В этом случае последний бросок монеты определяет чётность числа $|C_i\cap B_i|$.

Заметим, что ящик $\bm{C}=C_1 \times\ldots\times C_n$ имеет нечётный размер тогда и только тогда, когда $|C_i|$ нечётно для каждого~$i$.
Пусть $\bm{C}=C_1 \times \ldots \hm\times C_n$ есть случайный подъящик нечётного размера в $\bm{A}$, то есть $C_i\subset A_i$ для каждого~$i$.
В этом случае вероятность того, что данный подъящик $\bm{B}\hm=B_1\times\ldots\times B_n$ пересекается с $\bm{C}$ по нечётному числу элементов, равна~$\slfrac1{2^n}$.

Предположим теперь, что существует разбиение на менее чем $2^n$ подъящиков $\bm{B}(1),\dots,\bm{B}(m)$.
Заметим, что вероятность того, что $\bm{C}$ пересекается с каждым подъящиком $\bm{B}(i)$ по чётному числу элементов, положительна (она не меньше чем $1-\slfrac{m}{2^n}$),
но это невозможно, поскольку $\bm{C}$ содержит нечётное число элементов.
\heart

\medskip

Для тех отважных сердец, что всё ещё с нами, мы предлагаем больше таких задач.
Начнём с задачи Сары Робинсон, которая попала в «Нью-Йорк таймс»\footnote{\emph{S. Robinson}. Why Mathematicians Now Care about their Hat Color /\!/ {The New York Times}. April 10, 2001.}.

\subsection*{Отгадать цвет шляп}
\rindex{Отгадать цвет шляп}

Команда шляпников снова на арене!
%
На этот раз цвет шляпы каждого игрока определяется подбрасыванием монеты.
Игроки становятся в круг так, чтобы видеть цвета шляп остальных, никакого общения не допускается.
Далее игроков отводят в сторону и предоставляют шанс отгадать цвет своей шляпы "--- он может быть синим или красным;
но им также предоставляется право молчать.

Развязка ужасна: если все смолчали или хотя бы один назвал неверный цвет, то всех игроков казнят.
Может показаться, что лучшей стратегией будет молчать всем, кроме
одного, в этом случае шансы избежать всеобщей казни будут 50",\%.
Но, поразительным образом, если игроков 15, %в оригинале 16 --- Питер согласился https://github.com/anton-petrunin/test/wiki
то они могут действтвать так, что вероятность всем спастись превышает 90",\%. 
Как это сделать?


Если вам кажется, что улучшить шансы в 50",\% невозможно, то, скорее всего, вы правильно поняли условие задачи.
Но прежде чем отчаиваться, попробуйте случай трёх игроков.

\medskip 

Решение следующей задачи неожиданно связано с решением предыдущей.
Далее подсказок не ждите.

\subsection*{Пятнадцать битов и шпионка}
\rindex{Пятнадцать битов и шпионка}

Каждый день шпионка имеет доступ к передаче 15 нулей и единиц на местной радиостанции.
Это её единственный канал общения с центром.
Она не знает, как выбираются эти биты, но каждый день у неё есть возможность изменить любой из них (не более одного), то есть поменять его с~0 на 1 или наоборот.

Сколько информации она может передать за день?

\subsection*{Углы в пространстве}
\rindex{Углы в пространстве}

Докажите, что среди любого множества из более чем $2^n$ точек в~$\mathbb{R}^n$ найдутся три, которые определяют тупой угол.

\subsection*{Два монаха на горе}
\rindex{Два монаха на горе}

Помните монаха из главы «Геометрия», который забрался на Фудзияму в понедельник, а спустился во вторник?
На этот раз он вместе с собратом-монахом поднимается на гору в один и тот же день, начиная одновременно с одной высоты, но по разным тропам.
По пути к вершине их тропы могут идти вверх и вниз, но не опускаются ниже стартовой высоты.

Требуется доказать, что монахи могут запланировать график своего
движения так, чтобы в \emph{каждый} момент дня они находились бы на
одной высоте.
(Разрешается планировать восхождение так, чтобы в
какие-то моменты путешественник шел по тропе в обратном направлении.)

\subsection*{Сумма под контролем}
\rindex{Сумма под контролем}

Дан набор из $n$ вещественных чисел $x_1,\dots,x_n$ из отрезка $[0,1]$.
Докажите, что можно найти такие числа $y_1,\dots,y_n$, что для любого $k$ выполняются соотношения $|y_k|=x_k$ и
\[
\left|\,\tsum_{i=1}^ky_i-\tsum_{i=k+1}^ny_i\right|\le 2.\]

\subsection*{Комната с двумя лампочками}
\rindex{Комната с двумя лампочками}

Вы помните заключённых и комнату с одной лампочкой?
Теперь снова каждого из $n$ заключённых будут вызывать поодиночке в комнату бесконечное число раз и в произвольном порядке, определяемом тюремщиком.
Однако на этот раз в комнате  \emph{две} лампы, каждая со своим бинарным выключателем.
Средств связи, кроме этих выключателей, нет, и начальные состояния их неизвестны.
У заключённых снова есть возможность договориться заранее.

В этой задаче вновь требуется, чтобы один из заключённых в какой-то момент смог сделать вывод, что все побывали в комнате.
Говорите, применить уже известный способ, игнорируя вторую лампочку?
Увы, на этот раз требуется, чтобы все заключённые получили одинаковые инструкции.

\subsection*{Площадь при данном диаметре}
\rindex{Площадь при данном диаметре}

Докажите, что среди всех плоских фигур единичного диаметра круг имеет
наибольшую площадь. 

\subsection*{Разрез пополам}
\rindex{Разрез пополам}

Докажите, что из каждого набора из $2n$ целых чисел, можно выбрать $n$ чисел, сумма которых делится на $n$.

\subsection*{Салфетки без метрдотеля}
\rindex{Салфетки без метрдотеля}

Помните задачу про банкет, там, где компания математиков рассаживается
за большой круглый стол?  И снова на столе между каждой парой приборов
находится кофейная чашка с салфеткой.
Каждый человек, садясь, берёт
салфетку слева или справа; если обе в наличии, то он выбирает её
случайным образом.

На этот раз метрдотеля нет; места занимаются в случайном порядке.
Предположим, что число математиков велико.
Какая их доля (асимптотически) останется без салфеток?

\subsection*{Группы солдат в поле}
\rindex{Группы солдат в поле}

Возможно, вы также помните солдат в поле, каждый из которых
присматривал за ближайшим соседом.
Предположим, что большое число
солдат стоят в случайных местах на большом квадрате и они разбиты на
максимально возможное число таких групп, что солдаты присматривают
друг за другом только внутри групп.

Чему равен средний размер группы?

\subsection*{Игреки на плоскости}
\rindex{Игреки на плоскости}

Вам уже известно, что на плоскости нет несчётного числа
непересекающихся топологических восьмёрок.
Конечно же, можно найти
континуум отрезков и окружностей. Естественный вопрос: что можно
сказать про игреки ({Y}), то есть про подмножества,
топологически эквивалентные объединению трех различных отрезков с общим
концом?

Докажите, что на плоскости можно нарисовать только счётное число непересекающихся игреков.

\subsection*{Снова доллары в урнах}
\rindex{Снова доллары в урнах}

В нашей последней трудной задаче мы возвращаемся к долларам в урнах,
но с немного другими вероятностями.
На этот раз бесконечная последовательность монет сыпется в две урны.
Когда одна урна содержит $x$ монет, а другая $y$, следующая монета
попадёт в первую урну с вероятностью
$x^{1{,}01}/(x^{1{,}01}+y^{1{,}01})$, а с вероятностью $y^{1{,}01}/(x^{1{,}01}+y^{1{,}01})$ "--- во вторую.

Докажите, что с какого-то момента в одной из урн количество монет
расти не будет.


%%% \input{toughies-sol.tex}

\section*{Решения и комментарии}

\subsubsection*{Отгадать цвет шляп}

Как мы предупреждали, случай трёх игроков помогает найти решение.
Как минимум, он даёт возможность убедиться, что 50",\% можно улучшить.
Однако получить отсюда общий случай непросто.

Каждого из трёх игроков следует проинструктировать молчать, если он видит шляпы разных цветов,
а если обе шляпы одного цвета, то называть цвет, которого он \emph{не видит}.
В случае, если есть шляпы обоих цветов (а это шесть из восьми случаев), один назовёт правильный цвет, а двое других промолчат.
В результате игроки выигрывают с вероятностью 75",\%.

Заметим, что в плохих случаях, когда все шляпы одного цвета, \emph{все три} игрока называют неправильный цвет, то есть данный протокол
упаковывает 6 неправильных ответов в две конфигурации, и это имеет
решающее значение.
Ведь в среднем по всем конфигурациям ровно
половина угадываний должна быть верной, поэтому, чтобы выиграть,
следует экономно использовать правильные угадывания, а неправильные
паковать вместе.
Протокол для трёх игроков делает это наилучшим
образом, и, значит, он является оптимальным.

Для $n$ игроков было бы идеально сделать то же самое, то есть построить
два типа конфигураций: <<хорошие>>, где один угадывает правильно а
остальные молчат, и <<плохие>>, в которых угадывают все, и все
неправильно.
В~этом случае хороших конфигураций будет в $n$ раз
больше, чем плохих, что даст неплохую вероятность выигрыша, равную
$n/(n+1)$.

Такая оптимальная вероятность достижима, только если число всех
конфигураций $2^n$ делится на $n+1$, то есть если $n$ равно степени
двойки без единицы.
Удивительным образом, это условие также является
достаточным.

Ключ к протоколу состоит в разбиении конфигураций на плохие и хорошие так, что любая хорошая соседствует ровно с одной плохой (две конфигурации соседствуют, если одну можно получить из другой, поменяв цвет одной шляпы).
И такой способ есть!

Пусть $n=2^k-1$.
Обозначим игроков ненулевыми $k$-значными двоичными
кодами.
(Например, если $n=15$, то игроки получают номера
$0001,0010,0011,\dots,1110,1111$.)  Эти коды будем складывать как
ним-числа\footnote{Названые так из-за игры Ним.
Насколько нам
известно, этот  термин появляется впервые на с. 43 книги
«Winning Ways», упоминавшейся в сноске на
с.~\pageref{winningways}.}, то есть без учёта переноса разрядов; например, $1011 \z+ 1101 =0110$, и ним-сумма любого кода с собой равна $0000$.

Плохими конфигурациями будут те, для которых ним-сумма кодов всех
игроков с красными шляпами равна нулю (последовательности из одних нулей).
Стратегия состоит в следующем:
каждый игрок считает ним-сумму кодов всех, кого видит в красных шляпах.
Если ним-сумма равна $0000$, то он говорит, что у него красная шляпа.
Если же ним-сумма равна его коду, он говорит, что у него синяя шляпа.
В остальных случаях он молчит.

А почему это работает?
Предположим, что ним-сумма кодов всех игроков с красными шляпами равна $0000$.
Тогда для каждого игрока с синей шляпой посчитанная им ним-сумма будет равна $0000$ и он скажет, что у него красная шляпа;
ним-сумма посчитанная каждым игроком с красной шляпой, будет его кодом, и он скажет, что у него синяя шляпа.
то есть каждый назовёт цвет и каждый сделает это неправильно "--- ровно то, что мы хотели!

Теперь  предположим, что эта ним-сумма равна чему-то другому, например $0101$.
Тогда цвет назовёт единственный игрок с кодом  $0101$, и назовёт он его \emph{правильно}.

Ним-сумма равна $0000$ с вероятностью $1/16$ (поскольку имеется 16 различных ним-сумм).
Значит, вероятность выигрыша составит $15/16$;
в общем случае она равна $1-2^{-k}$.
Полезно проверить, что в случае $k=2$ мы получим наше решение для трёх игроков.



Если $n$ не является степенью двойки минус один, то самое простое
"--- найти наибольшее число $m<n$ вида $2^k-1$.
Эти $m$ игроков следуют описанной стратегии, а все остальные всё время молчат.
В худшем случае (если $n=2^k-2$ при некотором $k$) вероятность выигрыша равна $(n/2)/(n/2-1)$.
Вообще говоря, такая стратегия не самая лучшая;
при $n=4$ невозможно улучшить $75\,\%$, но при $n=5$ (как указал Элвин Берлекамп) можно добиться вероятности $25/32\z>78\,\%$.
В общем случае наилучшая стратегия неизвестна.
\heart

\medskip

Построенное нами множество плохих конфигураций не только красиво, но и
полезно.
Оно называется кодом Хэмминга и является примером
совершенного \emph{самокорректирующегося} кода.
Представьте, что вам
надо послать сколько-то битов информации по не очень надёжному каналу,
который при передаче по которому некоторые биты иногда заменябтся на
противоположные.
Сгруппируем биты в строчки по 11 в каждой.
Существует $2^{15}/16\z=2^{11}$ красно-синих строк длины 15 с
ним-суммой $0000$; их можно записать двоичным кодом (например, код
$101010101010101$ значит, что все нечётные шляпы красные).
Эти
15-значные строки будут называться \emph{допустимыми}.
Поскольку
число допустимых строк равно $2^{11}$, можно выбрать одну для каждой
из 11-значных строк.
Простейший способ это сделать "--- выбросить
последние 4 бита из 15-значной строки.

Теперь, чтобы послать строку из 11 битов, вы посылаете единственную
соответствующую ей допустимую строку из 15 битов.
Вы проигрываете в
скорости, но выигрываете в надёжности.
Действительно, если один из
битов был искажен при передаче, то получающая сторона сможет узнать
номер этого бита и восстановить его исходное значение!

Как? А надо взять ним-сумму кодов красных битов (тех, что соответствуют единицам) в полученной 15-значной строке и удостовериться, что она равна\footnote{В теории кодирования такие суммы называются синдромами. "--- \emph{Прим. ред.}} $0000$. 
Пусть нет, скажем, она равна $0101$,
тогда какой-то бит был искажен;
если это случилось только раз, то это должен быть пятый бит.
Значит, получателю следует изменить пятый бит и посмотреть, какая 11-значная строка соответствует переданной 15-значной.
Результат будет верен, если только не произошло более одного искаженя.

% \medskip

Эта задача (в несколько другой формулировке) и её решение рассматривались Тоддом Эбертом (сейчас в Калифорнийском университете в Ирвайне) в его диссертации, защищённой в 1998~году в Калифорнийском университете в Санта-Барбаре.
Решение с кодом Хэмминга было предложено за несколько лет до этого Стивеном Рудичем из Университета Карнеги"--~Меллона  для похожей задачи про выборы.

\begin{addedbytheeditors}
%% Решение фактически использует ним-суммы из следующей задачи, хотя и
%% не называет их. 
%%% Вполне называет --- СМЛ
Подробный разбор этой и близких задач дан в статье Сергея Грибка
«Мудрецы, колпаки и арифметика конечных полей»\footnote{Квант. 2019. №4. C.~5--13.}.
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Пятнадцать битов и шпионка}

Поскольку шпионка может произвести всего 16 различных действий (изменить какой-то бит или никакого),  она в принципе может передавать четыре бита информации ежедневно.
Но как?

Ответить на этот вопрос просто, если воспользоваться ним-суммами из предыдущего решения.
Шпионка и её центр присваивают $k$"~му биту 4-значный код, соответствующий числу $k$, а «сообщение» определяется как ним-сумма кодов с единицами в передаче на радио.

Утверждение состоит в том, что шпионка может передать любое из 16 возможных сообщений по её желанию,
достигая таким образом, четырёх битов информации.
Предположим, что она желает послать код $n$, а ним-сумма кодов с единицей в намеченной передаче равна $m\ne n$.
Тогда ей следует поменять бит, номер которого равен ним-сумме $m+n$.
Не имеет значения, был ли этот бит 0 или 1, так как ним-сумма равна ним-разности.
\heart

\medskip

Я узнал эту задачу от Ласло Ловаса из Microsoft Research, который не смог с уверенностью назвать её источник.

\begin{addedbytheeditors}
Контрольные суммы (синдромы), упоминавшиеся  в решении предыдущей задачи, в теории кодирования используются для обнаружения и исправления ошибок.
Если при использовании кода Хэмминга произошла одна ошибка, то синдром указывает на номер неверного бита.
Задача про шпионку является двойственной к задаче об исправлении ошибки.
Шпионка специально вставляет в сообщение ошибку так, чтобы синдром превратился в передаваемое ею сообщение.
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Углы в пространстве}

Мне как-то предложили эту задачу, когда я был с визитом в
Массачусетском технологическом институте, и решить ее я не смог.
Кажется, что $2^n$ вершин куба дают наибольшее число точек в $n$-мерном пространстве без тупого угла.
Но как это доказать?
Оказывается, этот вопрос был сформулирован Полом Эрдёшем и Виктором Кли и решён Людвигом Данцером и Бранко Грюнбаумом. %реф

\medskip

Пусть $x_1,\dots,x_k$ "--- различные точки (векторы) в $\mathbb{R}^n$, и пусть $P$ "--- их выпуклая оболочка.
Можно считать, что $P$ имеет объём~1:
этого можно добиться, уменьшив размерность пространства до размерности многогранника $P$, а затем изменив масштаб.
Можно также предположить, что $x_1$ является началом координат (нуль-вектором).
Если точки $x_1,\dots,x_k$ не образуют тупых углов, то для каждого $i>1$ внутренность сдвига $P+x_i$ не перекрывается с внутренностью многогранника $P$:
в самом деле, плоскость, проходящая через $x_i$ и перпендикулярная вектору $x_i$, разделяет эти два многогранника.

Кроме того, внутренности многогранников $P+x_i$ и $P+x_j$ также не перекрываются при $i\ne j$;
они разделяются плоскостью, проходящей через $x_i+x_j$ и перпендикулярной $x_i-x_j$.
Отсюда делаем вывод, что объём объединения многогранников $P+x_i$ по
все $i$, $1 \le i \le k$, равен $k$.
Однако все эти многогранники лежат внутри удвоенного многогранника $2P = P+P$, объём которого равен $2^n$. Следовательно, $k \le 2^n$, что и требовалось!
\heart

\begin{addedbytheeditors}
Максимальное число точек, образующих только острые углы, также растет
экспоненциально с размерностью.
Это было показано Палом Эрдёшем и Золтаном Фюреди неявным способом, так
называемым вероятностным методом.%
\footnote{P. Erdős and Z. Füredi. “The greatest angle among $n$ points in
the $d$-dimensional Euclidean space”. Combinatorial mathematics
(Marseille-Luminy, 1981). Vol. 75. North-Holland Math. Stud. 1983,
275--283.}
Позднее московский десятиклассник Дмитрий Захаров придумал явное
построение;
оно было улучшено неким grizzly (анонимным математиком).
\footnote{D. Zakharov. “Acute sets”. Discrete Comput. Geom. 61.1 (2019),
212--217.\\
grizzly. Улучшено (?) решение Эрдёша по остроугольным треугольникам. url:
http://dxdy.ru/post1222167.html.\\
B. Gerencsér and V. Harangi. “Acute sets of exponentially optimal size”.
Discrete \& Computational Geometry (2018), 1--6.}
На сегодня лучшая нижняя оценка составляет $2^{n-1}+1$, оптимальная оценка
не известна.
"--- \emph{Прим. ред.}
\end{addedbytheeditors}

\subsubsection*{Два монаха на горе}

Давайте разделим каждый путь на монотонные отрезки, в пределах которых
путь или всегда восходящий, или всегда нисходящий.
(Горизонтальные
отрезки пути во внимание можно не принимать, так как один из монахов
может остановиться и подождать, пока другой пройдет такой отрезок).
Можно предположить, что каждый восходящий или нисходящий отрезок
прямолинеен
%% is just a straight ascent or descent 
%% является прямым
%% восхождением или спуском, 
так как мы можем заставить монахов
варьировать скорости так, чтобы их скорость восхождения или спуска
была постоянной на любом отрезке.

Пусть ось $X$ на плоскости соответствует положению на тропе первого
монаха, а ось $Y$ "--- положению второго монаха.
Отметим все точки
плоскости, для которых оба монаха находятся на одной высоте.
Полученный чертёж будет включать в себя начало координат (это начало
обоих путей), и вершину (концы обоих путей; можно считать, что это
точка $(1,1)$).
Наша цель состоит в том, чтобы найти путь по линиям
построенного чертежа от $(0,0)$ до $(1,1)$; монахи смогут не торопясь
проследовать по этому пути, так что ни одному из них не придётся идти
быстрее, чем он может.

Любые два отрезка "--- по одному от каждого пути, "--- которые имеют
некоторую общую высоту, появляются на чертеже в виде отрезка, возможно,
нулевой длины.
Если рассматривать в качестве вершины любую точку,
которая соответствует конечной точке такого отрезка (для одного или
обоих монахов), то чертёж становится графом (в~комбинаторном смысле).
См. рисунок: маршрут одного монаха показан жирной линией, другого "---
линией с кружочками, под каждой парой маршрутов изображен
соответствующий ей граф.

\begin{figure}[t]
\vspace{2\jot}
\centering
% \includegraphics[scale=0.9]{Figs/Toughies/monks}
\includegraphics[scale=1]{mp/wink-27}
% \vspace{-2\jot}
\end{figure} 

Простой перебор случаев показывает, что из каждой вершины нашего
графа, кроме $(0,0)$ и $(1,1)$, выходят 0, 2 или 4 ребра.

Поэтому если мы начнем путь по графу из точки $(0,0)$, то до вершины
$(1,1)$ мы не попадем в тупик и нам ни разу не понадобится
возвращаться в место, в котором можно было бы застрять или быть
вынужденным повторять путь, кроме~$(1,1)$.
Значит, нам удастся добраться до
точки $(1,1)$: любой пусть по графу из $(0,0)$ в $(1,1)$ задает график
движения монахов, удовлетворяющий условию. \heart

\medskip

{Эту задачу мне показал Юлий Барышников из Bell Labs.}

\begin{addedbytheeditors}
В решении задачи используется предположение, что тропы состоят из конечного числа монотонных отрезков.
Это предположение вполне естественно, так как нет смысла рассматривать отрезки существенно короче шага монаха.
Однако если этого не предполагать, то ответ в задаче окажется другим.

Пример троп двух монахов и соответствующего чертежа, описывающего пары $x$-координат двух троп, в которых высоты равны, показан на картинке.
\begin{figure}[ht!]
\vskip-0mm
\centering
\includegraphics{final/test-master/mp/pic-300}
\end{figure}
Точки $(0,0)$ и $(1,1)$ нельзя соединить кривой, идущей по линиям чертежа, 
однако можно пройти от $(0,0)$ до $(1,1)$, ступая только по линиям чертежа и имея при этом произвольно малую длину шага.
(На более продвинутом языке это означает, что точки $(0,0)$ и $(1,1)$ лежат в одной связной компоненте, но в различных линейно связных компонентах чертежа.)

Утверждение задачи остаётся верным в предположении, что у троп нет горизонтальных участков.
Это утверждение доказал Тацуо Хомма\footnote{\emph{T. Homma}. A theorem on continuous functions /\!/ Kodai Mathematical Seminar Reports, 1952. P.~13--16.}
в 1952 году.
С тех пор задача переоткрывалсь несколько раз, в частности она
предлагалась на Всесоюзной математической олимпиаде в 1989 году,
авторы Е.",В.",Абакумов и Д.",В.",Фомин. 
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Сумма под контролем}

Эта задача возникла из реальной жизни: она связана с технической
проблемой, относящейся к волоконно-оптическим
сетям\footnote{\emph{A. Schrijver, P. D. Seymour, P. Winkler}. The Ring Loading Problem /\!/ {SIAM Review}. 1999. Vol.~41, no.~4. P.~777--791.}.
Авторы статьи были убеждены, что гипотеза
верна, но им не удавалось найти доказательства. Через некоторое время
автор этих строк нашёл доказательство, приведённое ниже, которое ещё и
оказалось довольно простым!

\medskip

Задача состоит в том, чтобы поменять знаки у каких-то членов
последовательности чисел из отрезка $[0,1]$ так, чтобы сумма
оставалась под контролем даже при обращении знаков любого <<хвоста>>
последовательности.

Первое наблюдение состоит в том, что можно ограничить по модулю все
суммы начальных членов, используя <<жадный алгоритм>>: надо положить
$y_k=x_k$, если $\sum\limits_{i=1}^{k-1}y_i \le
0$,\vspace{-\jot} и $y_k=-x_k$ в противном случае.

Это гарантирует, что $\left|\,\sum\limits_{i=1}^{k}y_i\right| \le 1$ для любого $k$ и, значит,
\begin{align*}
\left|\,\tsum_{i=1}^{k}y_i-\tsum_{i=k+1}^{n}y_i\right|&=\left|\,2\tsum_{i=1}^{k}y_i-\tsum_{i=1}^{n}y_i\right|
\le2\left|\,\tsum_{i=1}^{k}y_i\right|-\left|\,\tsum_{i=1}^{n}y_i\right|\le3.
\end{align*}

Это близко к тому, что нам надо, но, к сожалению, алгоритм, который не
<<заглядывает вперёд>>, не может улучшить оценку с 3 до~2.
Чтобы это
увидеть, представьте, что последовательность начинается как 1; 0,99;
1; 0,99; 1; 0,99 и так сто раз, а затем заканчивается некоторым числом
$z$.
В этом случае знаки должны чередоваться каждый раз, кроме одного
момента, и чтобы узнать этот момент, необходимо знать $z$.

Однако заметим, что в описанном выше жадном алгоритме требуется знание
«пустой суммы», чтобы выбрать первый знак.
Раньше мы считали, что эта
сумма равна 0, но давайте объявим её равной некоторому фиксированному
$w\in [-1,1]$ и определим знаки $y_k$ индуктивно:
$y_k=x_k$, если $w+\tsum_{i=1}^{k-1}y_i \le 0$,\vspace{-2\jot} а иначе
$y_k=-x_k$.
В~этом случае $w+\tsum_{i=1}^{k}y_i \in[-1,1]$ для любого
$k$; положим $f(w) := w+\smash[t]{\tsum_{i=1}^ny_i}$.

Предположим, что $f(w)=-w$ для некоторого~$w$.
Тогда\vspace*{-\jot}
\begin{multline*}
\tsum_{i=1}^{k}y_i-\tsum_{i=k+1}^{n}y_i=
2\tsum_{i=1}^{k}y_i-\tsum_{i=1}^{n}y_i= 
2\left(w+\tsum_{i=1}^{k}y_i\right)-{}\\
-\left(w+\tsum_{i=1}^{n}y_i\right)-w=
2\left(w+\tsum_{i=1}^{k}y_i\right)\in[-2,2],
\end{multline*}
что и требуется.\vadjust pre{\vskip-\jot}

Поскольку $f(-1)+(-1)<0<f(1)+1$, существование $w$, для которого
$f(w)=-w$, следовало бы из теоремы о промежуточном значении, если бы
функция $f$ была непрерывна.
Конечно же, это не так; всякий раз,
когда частичная сумма проходит через 0, некоторые знаки меняются и
$f(w)$ может совершить скачок.
(Заметим, что $f$ непрерывна слева,
поскольку мы выбираем плюс при нулевой частичной сумме.)

Тем не менее функция~$|f|$ является непрерывной.
Действительно, с одной
стороны, если частичные суммы не равны~$0$, то производная $f'(w)$
равна 1.
С другой стороны, предположим, что $w=w_0$ таково, что хотя
бы одна частичная сумма равна нулю.
Пусть $k\ge0$ "--- минимальное
значение, для которого\vspace{-2\jot} $w+\sum\limits_{i=1}^{k}y_i\z=0$.
Тогда для достаточно малых $\varepsilon>0$ знаки $y_j$ и
$w+\sum\limits_{i=1}^{j}y_i$ при $j>k$ меняются при переходе от
$w=w_0$ к $w=w_0+\varepsilon$.
Взяв $j = m$, получаем, что
$\lim\limits_{w\to w_0^+}f(w)\z=-f(w_0)$.

Таким образом, если при $w=w_0$ какая-нибудь из частичных сумм
обнуляется, то $\lim\limits_{w\to w_0^+}f(w)\z=-f(w_0)$,
следовательно, функция $g$, определяемая как $g(w) =|f(w)|$, будет
непрерывной и будет иметь производную $\pm1$ везде, кроме конечного
числа точек.
Граф $g$ представляет собой зигзаг с производной $1$ при
$g(w)=f(w)$ и $-1$ при $g(w)=-f(w)$.

Если определить функцию $h$ как $h (w) = -w$, то график этой функции
(при $-1\le w\le1$) обязан пересекать график функции~$g$.
Более того,
он либо пересекает его в точке, где $g'(w) = 1$, либо совпадает с
отрезком графика $g$ с угловым коэффициентом $-1$; в последнем случае
самая левая точка отрезка также лежит и на графике функции $f$.
В
обоих случаях мы получаем точку $w$, в которой $-w = g (w) = f (w)$.
\heart

\subsubsection*{Комната с двумя лампочками}

Эта головоломка является частью серьёзной задачи в распределённых
вычислениях\footnote{Больше об этом вопросе можно прочитать в статье
\emph{M. J. Fischer, S. Moran, S. Rudich, G. Taubenfeld}. The Wakeup Problem /\!/ Proceedings of the 22nd Annual Symposium on Theory of Computing (Baltimore, Maryland, May 1990).}.
Решение, приведённое
ниже, предложено Стивеном Рудичем из Университета Карнеги"--~Меллона; 
оно известно как «протокол с качелями»\footnote{Англ. \emph{see-saw   protocol}.}.

\medskip

Для понимания этого протокола удобно думать об одном из выключателей
как о «выключателе с камешком»: мы считаем, что рядом с этим
выключателем расположен ящик, который пуст, еслы выключатель в
положении <<выкл>>, и в котором лежит камешек, если выключатель в
положении <<вкл>>.
А о другом выключателе мы будем думать, как о
качелях-доске, на которых качаются вдвоем: у доски качелей может быть
опущен либо правый, либо левый конец (противоположный конец доски
должен быть при этом поднят), и при каждом изменении положения доски
качелей выключатель переключается.
Будем также считать, что у каждого
заключённого изначально есть два виртуальных камешка.

При первом посещении заключённый «садится на качели и отталкивается от
земли» "--- при этом он поднимает опущенный конец доски качелей;
до конца мероприятия он остаётся той же стороне доски (то есть он
всегда помнит, с какой стороны сел на качели он попал в первый раз), пока у него не закончатся камешки; в этот момент он опускает свой конец доски (это может произойти, только когда он наверху) и далее не предпринимает никаких действий.

Пока заключённый ещё на качелях, при последующих посещениях он
пытается отдать камешек каждый раз, когда его конец доски поднят, и
взять камешек, когда он опущен.
Чтобы отдать камешек, ящик при
выключателе с камешком должен быть пустым; в этом случае заключённый
кладёт в него один свой камешек (формально говоря, он включает
выключатель с камешком и считает, что у него осталось на один камешек
меньше).
Чтобы взять камешек, ящик при выключателе с камешком должен
быть полным, в этом случае он берёт из него камешек (т.е выключает
выключатель с камешком и считает, что у него стало на один камешек
больше).
Если же выключатель с камешком не находится в подходящем
положении (т.е. если он включен, когда качели с нужного конца опущены,
или выключен, когда они подняты), то заключенный при данном посещении
не делает ничего.

Когда один из заключённых собирает $2n$ камешков, он объявляет, что в комнате все уже побывали.
В самом деле, исходно общее количество камешков было $2n$ или $2n+1$
(в зависимости от начального положения выключателя с камешком), а по
ходу дела камешки не добавляются и не пропадают. Тк что если $2n$
какмешков собрались в одних руках, то каждый внес в это свой вклад.

Но почему же у кого-нибудь обязательно окажется не менее $2n$ камешков?
Во-первых, отметим, что в любой момент между посещениями либо 
(а) одинаковое число заключённых сидят на обоих концах доски, либо 
(б) заключённых, сидящих на поднятом конце, на одного больше.
Действительно, если мы начинаем с состояния (а), то первый кто садится на качели, переведёт его в состояние (б), если же кто-то слезет с качелей, то он опускает свою сторону и мы  снова возвращаемся в состояние (б).
Если же мы начинаем с состояния (б), то при посадке на качели число уравнивается, поскольку садятся на качели с опущенной стороны доски, и мы попадаем в состояние (а).
Если же кто-то слезает, то он уменьшает число заключённых на поднятой стороне и мы снова приходим к состоянию (а).

Теперь предположим, что все заключённые уже побывали в комнате и что $k$ из них на качелях (остальные истратили свои камешки и слезли).
Из вышесказанного получаем, что, пока $k>1$, как минимум один игрок будет на поднятой стороне доски и как минимум один "--- на опущенной.
Тогда камешки будут перетекать от первых ко вторым, пока кто-то не
истратит все свои камешки, уменьшив тем самым число заключенных на качелях до $k-1$.
Когда $k$ уменьшится до $1$, у оставшегося игрока будут все $2n$ или $2n+1$ камешков и процесс завершится, если это не случилось раньше.
\heart

\medskip
Ну и как, спрашивается, до этого додуматься?
Не  знаю "--- спросите у Рудича!

\subsubsection*{Площадь при данном диаметре}


\textls[-2]{Эту задачу можно найти в книге Джона Литлвуда «Математическая смесь»;
возможно, сам Литлвуд ее и придумал.
Решение основано на элементарных
вычислениях.}

\medskip

Диаметр замкнутой фигуры является наибольшим расстоянием между парами её
точек.
Следует отметить, что не любая фигура диаметра 1 может быть
помещена внутрь круга диаметра 1; например, равносторонний треугольник
со стороной 1 не таков.
Никто не знает площадь наименьшей\footnote{Этот вопрос известен как задача Лебега. "--- \emph{Прим. ред.}} области, в
которую может поместиться каждая область диаметра~1.

Итак, как же показать, что круг имеет самую большую площадь из всех
фигур диаметра 1, если такие фигуры не помещаются внутрь круга?  Пусть
$\Omega$ "--- замкнутая фигура диаметра 1 на плоскости.
Попробуем
вычислить площадь этой фигуры, используя полярные координаты.
Можно
считать, что фигура $\Omega$ выпукла, так как переход к выпуклой
оболочке диаметра не увеличивает.

Пусть $P$ и $Q$ "--- точки фигуры $\Omega$ на расстоянии 1.
Поместим
$\Omega$ на плоскость так, чтобы $P$ совпало с началом координат, а
$Q$ "--- с~точкой~$(1,0)$.


Пусть $R(\theta)$ "--- 
самая удаленая от $P$ точка фигуры $\Omega$, лежащая на луче, исходящем
из~$P$ и образующем угол $\theta$ с осью абсцисс (считая
%
\setbox180\hbox{\includegraphics[scale=.85]{mp/pic-2}}
\begin{wrapfigure}[7]{r}{\wd180}
\vspace{-\jot}
\centering
\box180
\end{wrapfigure}
%
против часовой
стрелки); через $r(\theta)$ обозначим расстояние от $P$ до~$R(\theta)$.

Тогда площадь $S$ фигуры $\Omega$ можно выразить как интеграл:
\[S=\int\limits_{-\pi/2}^{\pi/2}\frac{r(\theta)^2}{2}\,d\theta\]
(поскольку расстояние $PQ$ равно диаметру, вся фигура обязана лежать в
правой полуплоскости).
Поскольку $r(\theta) \le 1$, интеграл ограничен величиной
\[\int\limits_{-\pi/2}^{\pi/2}\frac{1}{2}\,d\theta=\frac\pi2.\]
Это вдвое больше, чем мы хотим, но не следует разочаровываться,
поскольку до сих пор мы пользовались только тем, что $\Omega$ лежит в
правой половине круга радиуса 1 с центром в начале координат. 
Можно было бы подрезать полукруг до линзы, но как добиться оценки $\slfrac\pi4$?

Трюк заключается в разбиении интеграла на два в зависимости от знака $\theta$ и последующем преобразовании интеграла:
\begin{multline*}
\int\limits_{-\pi/2}^{\pi/2}\frac{r(\theta)^2}{2}\,d\theta
=\int\limits_{-\pi/2}^{0}\frac{r(\theta)^2}{2}\,d\theta+\int\limits_{0}^{\pi/2}\frac{r(\theta)^2}{2}\,d\theta=
\\
=\int\limits_{0}^{\pi/2}\frac{r(\theta-\slfrac\pi2)^2}{2}\,d\theta+\int\limits_{0}^{\pi/2}\frac{r(\theta)^2}{2}\,d\theta=
\int\limits_{0}^{\pi/2}\frac{r(\theta-\slfrac\pi2)^2+r(\theta)^2}{2}\,d\theta.
\end{multline*}
По теореме Пифагора $r(\theta-\slfrac\pi2)^2+r(\theta)^2$ равно квадрату расстояния между $R(\theta)$ и $R(\theta- \pi/2)$.
Таким образом, это выражение не превосходит квадрата диаметра фигуры
$\Omega$, то есть единицы.
Значит,
\[S\le \int\limits_{0}^{\pi/2}\frac12\,d\theta\le\frac\pi4,
\]
и всё доказано.
\heart

\begin{addedbytheeditors}
Это так называемое \emph{изодиаметрическое неравенство}, полученное Людвигом Бибербахом%
\footnote{\emph{L. Bieberbach}. Über eine Extremaleigenschaft des Kreises /\!/ {Jahresbericht der Deutschen   Mathematiker-Vereinigung}. 1915. B.~24. S.~247--250.}.
Другое
доказательство можно получить, применив неравенство
Бруна"--~Минковского к фигуре и её симметричной копии; оно без труда
обобщается на старшие размерности.
"--- \emph{Прим. ред.}  
\end{addedbytheeditors}

\subsubsection*{Разрез пополам}

Эта задача с $n=100$ давалась на четвёртой всесоюзной математической
олимпиаде в Симферополе (1970).
Она достаточно красива, чтобы именоваться теоремой, и на самом деле
так она  и называется%
\footnote{\emph{P. Erd\H{o}s, A. Ginzburg, A. Ziv}. Theorem in the Additive Number Theory /\!/ {Bull. Research Council of Israel}. 1961. Vol. 10F. P.~41--43.}.

\medskip


Назовём набор \emph{ровным}, если сумма его чисел сравнима с $0$ по
модулю $n$.
Заметим сначала, что из утверждения, которое мы хотим
доказать, вытекает следующее, на первый взгляд более слабое,
утверждение:  
\begin{quote}
если набор $S$ из $2n$ чисел является ровным, то $S$
можно разбить на два ровных набора размера $n$ каждый.

\end{quote}
Из этого
утверждения вытекает второе: 
\begin{quote}
любой набор размера $2n-1$ содержит ровный
набор размера $n$.

\end{quote}
Действительно, мы можем добавить к этому набору
$2n$-е число, которое сделает исходный набор ровным, и затем применить
предыдущее утверждение, чтобы разделить его на \emph{два} ровных
набора размера $n$.
Один из них (тот, что не содержит нового числа)
будет искомым. Наконец, из второго утверждения, очевидно, вытекает
третье "--- утверждение исходной задачи.

Итак, все три приведённые утверждения равносильны.
Предположим, что
мы можем доказать второе утверждение для $n = a$ и для $n = b$.
Тогда
если набор $S$ имеет размер $2n = 2ab$ и сумму $0 \pmod {ab}$, то он,
в частности, является ровным по отношению к $a$.
Значит, мы можем
отсечь от него наборы $S_1,\dots,S_{2b}$, каждый размера $a$, которые
также являются ровными по отношению к $a$.
Каждый из этих наборов
$S_i$ имеет сумму, которую можно записать в виде $ab_i$.
Теперь числа
$b_i$ составляют набор размера $2b$, сумма которого равна $0 \pmod b$,
так что мы можем разбить $S$ на два набора размера $b$, которые
являются ровными относительно~$b$.
Объединение наборов $S_i$ в каждой
части даёт разбиение набора $S$ на два набора по $ab$ чисел в каждом,
которые являются $ab$-ровными, как раз то, что и требовалось.

Значит, если мы сможем доказать утверждение для всех простых чисел
$n=p$, то мы докажем его для всех $n$.
Выберем набор $S$ размера $2p$
и будем искать в нём набор размера~$p$, ровный относительно~$p$.

Как такой найти?  Естественный способ "--- разбить числа в $S$ на пары
и выбрать по одному числу из каждой пары.
Конечно, будет хорошо,
чтобы числа в каждой паре были различны по модулю $p$ "--- пусть у нас
будет побольше возможностей для выбора!


Можем ли мы это сделать?
Да.
Упорядочим $S$ по модулю $p$ (скажем,
от $0$ до $p-1$) и рассмотрим пары $(x_i,x_{i+p})$ при $i\z=1,2,\dots,
p$.
Если $x_i\equiv x_{i+p}\pmod p$ для некоторого $i$, то
$x_i,x_{i+1},\z\dots,x_{i+p}$ сравнимы по модулю $p$ и любые $p$ из
них составят искомый набор.

Теперь, когда у нас есть пары, применим «динамическое программирование».
Пусть $A_k$ "--- множество всех сумм $\pmod p$
из $k$ слагаемых, в которых каждо слагаемое принадлежит одний 
из первых $k$ пар.
Заметим, что $|A_1|= 2$.
Мы утверждаем, что
$|A_{k+1}|\z\ge|A_k|$ и, более того, $|A_{k+1}|>|A_k|$, если $|A_k|\ne
p$.
Первое неравенство верно, так как $A_{k+1} = (A_k+x_{k+1}) \cup
(A_k+x_{k+1+p})$.
Далее, если $|A_{k+1}|=|A_k|$, то эти два набора
идентичны и, значит, $A_k \z= A_k+x_{k+1+p}-x_{k+1}$.
Но поскольку
$p$ простое и $x_{k+1+p}-x_{k+1}\not\equiv 0\pmod p$, это возможно
только в двух случаях: $|A_k|= 0$ или $p$.

Поскольку всего пар $p$, получаем, что $|A_k|= p$ для некоторого $k
\le p$ и, следовательно, $|A_p|= p$; в частности, $0\in A_p$ "---
теорема доказана. \heart

\vspace{0pt minus 12pt}

\subsubsection*{Салфетки без метрдотеля}

Мы хотим вычислить вероятность того, что гость, сидящий в положении 0
(по модулю $n$), остался без салфетки.
Предел этой вероятности при
$n\to\infty$ равен искомой доле бессалфеточников.

Можно предположить, что каждый решает заранее, брать салфетку справа
или слева, в случае, если обе в наличии; потом, конечно, некоторым
придётся изменить своё решение или вовсе остаться без салфетки.

Предположим, что гости $1,2,\dots, i - 1$ решили брать салфетку справа
(в сторону от 0), в то время как гость $i$ решил брать слева, и гости
$-1,-2,\dots, -j + 1$ также решили брать салфетку слева (опять же, в
сторону от 0), в то время как гость $-j$ решил брать справа.

Если $k = i+j+1$, то вероятность такой конфигурации равна $2^{1-k}$.
Заметим, что $i$ и $j$ по равны меньшей мере $1$, но с большой
вероятностью каждое из этих чисел меньше $n/2$.

Гость $0$ остаётся без салфетки только тогда, когда он садится
последним из гостей $-j,\dots,i$ и ни один из гостей
$-j\z+1,\z\dots,-1,1,\dots,i-1$ не смог взять салфетку, которую хотел.
Если $t(x)$ обозначает момент времени, в которое гость $x$ берет
салфетку, то гость $0$ остается ни с чем в точности тогда, когда
$t(0)$ является единственным локальным максимумом функции $t(x)$ при
$x$ в диапазоне от $-j$ до $i$.
Таким образом, график функции $t$
представляет собой «горку» с вершиной в $(0,t(0))$; иначе говоря,
выполняются следующие неравенства:
\[t(-j)\z<t(-j+1) \z<\z\dots\z<t(-1)\z<t(0)\z>t(1)\z>\z\dots\z>t(i).\]

Вместо подсчёта вероятности этого события при фиксированных $i$ и $j$
удобнее сгруппировать все пары $(i, j)$ с фиксированным $k=i\z+j+1$.
Всего существует $k!$ возможных порядков у $t(-j),\dots, t (i)$.
Пусть $T$ "--- множество всех моментов хватания, а $t_{{\max}}$ "---
последний из них.
Заметим, что горка однозначно определяется
подмножеством $\{t(1),\dots,t(i)\}$ в $T\backslash \{t_{{\max}}\}$.
Таким образом, число различных горок равно $2^{k-1}-2$.

Суммируя вероятности по $k$, получим, что вероятность того, что гость 0 остался без салфетки, равна
\[\sum_{k=3}^\infty\frac{2^{1-k}\cdot(2^{k-1}-2)}{k!}=(2-\sqrt{e})^2\approx
0{,}12339675. 
\pushQED{\qed}\qedhere
\]
% \heartf

Сравнивая это значение с показателем $9/64 = 0{,}140625$, достигнутым
вредным метрдотелем, мы видим, что его происки вредят, но не сильно.

\medskip

Читателям, предпочитащим интеграл сумме, понравится следующее
доказательство (являющееся упрощенной версией доказательства,
предложенного Эйденом Садбери из Университета Монаша в Австралии).

\medskip

Можно предположить, что «времена хватания» $t(i)$ для всех гостей "--- независимые случайные величины в отрезке $[0,1]$, заданные равномерным распределением.
Представим себе, что вместо круга гости садятся вдоль прямой, бесконечной в обе стороны.
Пусть $p(t)$ обозначает вероятность того, что у гостя, потянувшийся за
салфеткой в момент времени~$t$, салфетки справа уже нет.
Это происходит только если его правый сосед схватил салфетку первым;
либо он выбрал её сознательно,
либо был вынужден взять левую салфетку, потому что его правая была уже взята.
Таким образом,
\[p(t)=\frac12t+\frac12\int\limits_0^tp(s)\,ds.\]
Продифференцируем это равенство по $t$ и решим полученное
дифференциальное уравнение: 
\begin{gather*}
\frac{dp}{dt}=\frac12+\frac12p,
\quad
\frac2{p+1}\,dp=dt,
\quad
2\ln(p+1)=t+C.
\end{gather*}
Заметим, что $C=0$, поскольку $p(0)=0$.
Следовательно,
\[
p(t) = e^{t/2} - 1.
\]
Конечно же, вероятность того, что гость со временем хватания $t$
обнаруживает, что его \emph{левая} салфетка исчезла, такая же.
При
фиксированнгом $t$ эти два события независимы.
Следовательно,
вероятность того, что наш гость станет бессалфеточником, равна $p(t)^2
\z= (e^{t/2} -1)^2$; усредняя по времени хватания, получаем
\[\int\limits_0^1(e^{t/2}-1)^2\,dt=(2-\sqrt{e})^2.
\pushQED{\qed}\qedhere
\]
% \heartf

\subsubsection*{Группы солдат в поле}

Назовём двух солдат \emph{товарищами}, если они присматривают друг за
другом.
Как и в главе «Погружение», в любой группе два ближайших друг
к другу солдата являются товарищами.
Но в одной группе
из $k$ солдат не может быть другой пары товарищей, потому что тогда
оставшихся $k-4$ присматриваний не хватило бы, чтобы связать вместе
две пары товарищей и $k-4$ оставшихся солдат.
Таким образом, если
известна вероятность $p$ того, что данный солдат имеет товарища, то мы
знаем и средний размер группы $g$, поскольку $p = 2/g$ и, значит, $g =
2/p$.

\begin{figure}[!ht]
\centering
\includegraphics[scale=1]{mp/pic-1} % {Figs/mppic/pic-1}
\end{figure}

Начнём с солдата $X$, стоящего посреди квадратного поля $F$ площадью в
1 квадратный километр.
Затем добавим $n$ солдат по одному за раз,
каждого в случайном положении в пределах $F$.
Мы считаем, что $n$
очень велико.
Назовём второго солдата $Y$ и будем использовать
строчные буквы $x$ и $y$ для обозначения положений $X$ и $Y$.
Пусть
$\text{Б}$ обозначит событие, когда $Y$ становится ближайшим солдатом
к $X$, и $\text{Т}$ "--- событие, когда $Y$ становится товарищем $X$.
Заметим, что $\mathbb{P}(\text{Б})=1/n$, поскольку $Y$ станет
ближайшим к $X$ с той же вероятностью, что и любой другой солдат.
Остаётся найти $p=\mathbb{P}(\text{Т})/\mathbb{P}(\text{Б})$.

Чтобы произошло $\text{Б}$, требуется, чтобы другие солдаты не попали
внутрь окружности с центром $x$, проходящей через~$y$.
Чтобы
произошло $\text{Т}$, другие солдаты не должны попасть ни в этот круг,
ни в перекрывающийся с ним круг того же радиуса с центром в $y$.
Отношение площади круга к площади объединения двух кругов равно
$c=\pi/(\tfrac43\pi+\tfrac{\smash{\sqrt{3}}}{2}) \approx 0{,}6215049$.
(Конечно, это отношение не зависит от $r$; на рисунке дана подсказка,
как вычислить $c$ при $r=1$.)

Пусть поле $F'$ содержит поле $F$ и имеет площадь $1/c$ квадратных
километров.
Пусть $\text{Т}'$ обозначает событие, при котором
\emph{остальные солдаты ставятся случайным образом в $F'$, а не в $F$}, и $Y$ становится товарищем $X$.
Независимо от значения $r$,
каждый новый солдат в $F'$ имеет ту же вероятность разрушить
условие~$\text{Т}'$, что и новый солдат в $F$ разрушить
условие~$\text{Б}$.
Значит, $\mathbb{P}(\text{Т}')=
\mathbb{P}(\text{Б}) = 1/n$.

Теперь предположим, что сам $Y$ выбран из всех солдат в поле~$F'$
вместо $F$.
Чтобы иметь шанс стать товарищем для~$X$, он должен быть
в меньшем поле, что произойдёт с вероятностью~$c$.
И как мы видели,
если он оказался в $F$, то станет товарищем $X$ с вероятностью $1/n$.
Таким образом, $Y$ станет товарищем $X$ с вероятностью $c/n$, так что
$p=c$.

Следовательно, средний размер группы равен $2/p\approx3{,}2170956$.
\heart

\medskip
Приведённое выше рассуждение не вполне строго, поскольку не учитывает
краевых эффектов.
Любители интегрировать распределение Пуассона
найдут более простым и, возможно, более убедительным способ вычислить
$p$, интегрируя по $r$:
\[
p=\int\limits_0^\infty e^{-\pi r^2/c}\,2\pi r\, dr.
\]
Однако приведённое выше рассуждение более общее и элементарное, плюс,
за исключением вычисления $c$, оно не зависит от размерности.
Если
солдаты находятся на прямой, то отношение $c$ равно $2/3$ и, значит,
средний размер группы равен 3; в пространстве (для боевых водолазов?)
$c = 16/27$, следовательно, средний размер группы равен $3\tfrac38$.
При увеличении размерности $c\to 1/2$ и $g\to 4$.
Забавно, что ответы
рациональны в размерностях 1 и 3, но не для плоскости.

Луис Годдин из Университета Саймона Фрейзера, показавший мне эту
прелестную задачу и её (аналитическое) решение, указал, что было бы не
менее интересно найти вероятность того, что за каким-то солдатом никто
не присматривает.
Ни он, ни я не знаем, как это сделать; согласно
экспериментам должно получиться около 28",\% на плоскости (при 25",\%
на прямой).
Кстати сказать, граф, определённый на метрическом
пространстве путём соединения каждой точки с её ближайшим соседом,
иногда называется графом Габриэля.

\subsubsection*{Игреки на плоскости}

Следующее изящное доказательство предложено Рэндоллом Доэрти из
Университета штата Огайо.

\medskip

Для каждого игрека построим тройку рациональных кругов
(с~рациональными центром и радиусом), содержащих конечные точки, и при
этом достаточно малых "--- таких, чтобы ни один из них не пересекал
два других <<отрезка>> (точнее, множества, гомеоморфных отрезку),
составляющих игрек.

Мы утверждаем, что никаким \emph{трем} игрекам не может
соответствовать одна и ту же тройка кругов. В~самом деле, в противном случае
можно было бы соединить узловую точку каждого игрека с центром каждого
круга, идя до границы круга и далее по его радиусу
в центр.
Это дало бы вложение полного двудольного графа $K_{3,3}$ в
плоскость (этот граф известен по головоломке про домики и колодцы).

Другими словами, мы получили шесть таких точек на плоскости (тройка
центров кругов и тройка узловых точек игреков), что каждая точка из
одной тройки соединена кривой с каждой точкой другой тройки, и при
этом никакие две кривые не пересекаются.
Но это невозможно; читатели,
знакомые с теоремой Куратовского, знают этот граф как один из двух
главных непланарных графов.

Чтобы убедиться в том, что $K_{3,3}$ не вкладывается в плоскость без
самопересечений, рассмотрим два набора вершин $\{u, v, w\}$ и $\{x, y,
z\}$.
Если бы мы смогли нарисовать граф без самопересечений, то цикл
$uxvywz$ представлял бы собой (топологический) шестиугольник.
Ребро
$uy$ должно пройти внутри или снаружи шестиугольника (скажем, внутри);
тогда ребру $vz$ придётся пройти снаружи, чтобы избежать пересечения с
$uy$, а ребру $wx$ уже пройти негде. \heart

\begin{addedbytheeditors}
% У задачи имеется более прямое решение: сначала разбиваем все игреки на
% счётное число классов в зависимости от их размера или формы,  
% а потом доказываем счётность внутри каждого класса, "--- для похожих игреков легче построить однозначное соответствие с рациональными точками.

Задача рассмотрена Робертом Муром\footnote{\emph{R. L. Moore}. Concerning triods in the plane and the junction points of plane continua /\!/ {Proc. Natl. Acad. Sci. USA}. 1928. Vol.~14.1. P.~85--88.} в 1928 году.
Стоит заметить, что плоскость допускает разбиение на копии более заковыристых компактных множеств, например, на псевдодуги%
\footnote{\emph{W. Lewis, J. Walsh}. 
A continuous decomposition of the plane into pseudo-arcs /\!/
Houston J. Math. 1978. Vol.~4, no. 2. P.~209--222.}. 
"--- \emph{Прим. ред.} 
\end{addedbytheeditors}

%% По-моему, это какая-то ерунда --- СМЛ

\subsubsection*{Снова  доллары в урнах}

Этот вариант урн Пойа рассматривал Джоэл Спенсер из Нью-Йоркского
университета и его студент Роберто Оливейра.
Очень чёткий способ
показать, что в одну из урн попадут все монеты, за исключением конечного
числа, состоит в использовании того самого процесса без памяти,
который оказался полезным во второй задаче про гладиаторов из главы
«\mbox{Игры}».

\medskip

Посмотрим только на первую урну.
Предположим, что среднее время
ожидания между $n$-й и $(n+1)$-й монетой равно $1/n^{1{,}01}$ часам;
при этом мы считаем, что этот процесс не имеет памяти.
Сначала монеты
будут поступать эпизодически и не равномерно, а затем быстрее и
быстрее.
Поскольку ряд $\sum 1/n^{1{,}01}$ сходится, урна взорвётся,
то есть наполнится бесконечным числом монет, в какой-то случайный
момент (приблизительно через 4 дня, 4 чача и 35 минут после начала).

Теперь представим, что два таких процесса идут одновременно, по одному
с каждой урной.
Если в некоторый момент времени $x$ монет лежат в
первой урне и $y$ "--- во второй, то (как мы видели в задачах с
гладиаторами и лампочками) вероятность того, что следующая монета
попадёт в первую урну, составит
\[\frac{1/y^{1{,}01}}{1/x^{1{,}01}+1/y^{1{,}01}}=\frac{x^{1{,}01}}{x^{1{,}01}+y^{1{,}01}},\]
как и требуется.
Поскольку процесс не имеет памяти, не имеет
значения, сколько времени прошло с тех пор, как $x$-я монета попала в
первую урну (или $y$-я во вторую).
Из этого следует, что описанный нами
процесс равносилен исходной задаче.

Однако теперь очевидно, что с вероятностью 1 моменты взрыва у двух урн различны.
(Для этого нужно только знать, что время ожидания взрыва имеет
непрерывное распределение.) 
Но эксперимент заканчивается при первом взрыве, и в этот момент вторая
урна содержит лишь конечное число монет.\heart

\medskip

Выглядит пугающе, не так ли?  По сути, медленная урна не добралась до
финиша просто потому, что кончилось время.

\chapter{Нерешённые головоломки}

\thispagestyle{empty}
\setlength{\epigraphwidth}{.55\textwidth}
\epigraph{Человек не может учиться иначе, как двигаясь от известного к неизвестному.\vspace{1ex}}{Клод Бернар (1813"--~1878)}

Как сказал один мой приятель: «Нерешённая головоломка "--- это что за хрень?».
С этим можно согласиться, ведь невозможно узнать,
имеет ли задача изящное решение, пока она не решена.
Тем не менее
некоторые нерешённые задачи привлекают красотой и простотой своей
постановки, удивляя при этом тем, что решение неизвестно.

Математики, особенно такие, как и ваш автор, воспитанные в эрдёшевской
традиции искать самое простое в том, что пока неизвестно, часто
бравируют такими головоломками.
Соберите несколько таких фанатиков
вместе, и вы услышите разговор вроде такого:

"--- Вот что меня беспокоит; ты знаешь ответ?

"--- На самом деле, я даже не уверен, что знаю ответ на этот более
простой вопрос. 

"--- Вы шутите? Я не знаю даже \emph{вот этого}!

Конечно, следует различать нерешённую головоломку и нерешенную
проблему, вроде гипотезы Римана или P${}={}$NP.
Нерешенные проблемы
могут не иметь красивой и элементарной формулировки, но они возникают
на пути к истине (часто как препятствия), и поэтому их изучают.
Формулировка нерешенной проблемы часто требует профессиональных
математических понятий (графы, группы, многообразия, преобразования,
представления и тому подобное), которые не допускаются в головоломке
"--- хотя они могут неявно содержаться в ее формулировке или быть
необходимыми для её решения.

Нерешённые головоломки могут быть забавными, интригующими и даже
раздражающими, но они, по нашим сегодняшним меркам, не должны быть
принципиально важными.
Безусловно, каждая такая задача по-своему
важна "--- она показывает пробел в нашем знании.
Её решение может
натолкнуть на создание полезной техники; она может решиться
приложением серьёзной математики, выходящей далеко за рамки этой
книжки.
При этом некоторые из задач, приведённых ниже, такие как
гипотеза Франкла или гипотеза о $3x+1$, привлекли столько внимания,
что любое их решение привлечет значительный интерес, независимо от его
применимости в других областях.

Эти задачи представлены здесь для развлечения и для того, чтобы
напомнить о том, как мало мы знаем.
Если даже одну из них кто-то
решит, узнав про неё в этой книге, то случится небольшое чудо.
Если
вам кажется, что вы решили одну из них, то, скорее всего, вы
ошибаетесь.
Воспользуйтесь приведёнными ссылками, помощью ваших
друзей "--- профессиональных математиков и любимой поисковой системой
в интернете, чтобы узнать больше о других попытках решить эту задачу.
Скорее всего, вы узнаете, что совершили уже известную ошибку, и не
опозоритесь на публике.

Если же вы все ещё считаете, что у вас есть корректное решение, то его
надо записать и отправить в подходящий математический
журнал.
%% \footnote{В этом случае ошибку укажет рецензент. "---
%%   \emph{Прим. ред.}}.
Не шлите его мне: я не являюсь экспертом
\emph{ни в одной} из этих задач.

\medskip

В этой главе, конечно, не будет решений, но мы продолжим формат:
формулировки сначала, а комментарии и ссылки потом.
Начнём с классики от Джона Конвея.
Удачи!

% [Решения и подходы появившиеся со времени публикации английского оригинала этой книги приведены в квадратных скобках.]\footnote{Здесь и далее, квадратными скобками выделены примечания редакции.}


\subsection*{Ангел и дьявол Конвея}
\rindex{Ангел и дьявол Конвея}

Ангел летает над бесконечной шахматной доской и время от времени должен садиться на клетку.
Он может пролететь не более 1000 ходов короля до очередного приземления.

Пока ангел летит, дьявол, живущий под доской, может уничтожить одну клетку по своему выбору.

Может ли дьявол добиться того, что ангелу будет некуда приземлиться?

\subsection*{Гипотеза о $\bm{3x+1}$}
\rindex{Гипотеза о $3x+1$}

Начиная с произвольного положительного целого числа, будем повторять следующие действия:
если число чётно, то поделим его на~$2$, а если нечётно, умножим его на~$3$ и к результату прибавим~$1$.

Докажите, что в конце концов мы зациклимся; или даже сильнее, что в конечном итоге мы придём к циклу $1, 4, 2, 1, 4, 2,\dots$

\subsection*{Самая длинная общая подпоследовательность}
\rindex{Самая длинная общая подпоследовательность}


Генерируются две случайные двоичные последовательности длиной $n$, причём каждая цифра определяется независимо и равна 1 с вероятностью~$p$.
Пусть $C_p(n)$ "--- средняя длина их самой длинной общей подпоследовательности в тот момент, когда длина обеих последовательностей равна~$n$, и пусть $C_p$ "--- предел отношения~$C_p(n)/n$.

Вычислите $C_{\slfrac12}$ или, по крайней мере, докажите, что $C_{\slfrac12}<C_{p}$ при $p\ne\slfrac12$.

\subsection*{Вписать квадрат в озеро}
\rindex{Вписать квадрат в озеро}

Докажите, что всякая простая замкнутая кривая на плоскости содержит четвёрку точек, расположенных в вершинах квадрата.

\subsection*{Одинокий бегун}
\rindex{Одинокий бегун}

Бегуны  стартуют в одной точке и бегут по круговой дорожке единичной длины;
каждый бежит с постоянной скоростью, и скорости у всех различны.

Докажите, что каждый бегун в какой-то момент времени будет на расстоянии хотя бы $1/n$ от любого другого бегуна.

\subsection*{Сортировка двойного набора шаров}
\rindex{Сортировка двойного набора шаров}

В ряд стоит $n$ корзинок с двумя шарами в каждой, причём на шарах в $i$"~й корзинке написан номер $n+1-i$.
За один ход разрешается поменять два шара в соседних корзинках.

Сколько ходов необходимо для того, чтобы каждый шар попал в корзинку со своим номером?

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.5]{Figs/UnsolvedPuzzles/bins}
\includegraphics{mp/wink-28}
\end{figure}

\subsection*{Развёртка многогранника}
\rindex{Развёртка многогранника}

Докажите, что произвольный выпуклый многогранник можно разрезать по рёбрам так, что полученную поверхность можно развернуть в плоский многоугольник.

\subsection*{Освещение многоугольника}
\rindex{Освещение многоугольника}


{\sloppy

Любой ли многоугольник с зеркальными сторонами можно осветить одной лампочкой, горящей в некоторой его внутренней точке?

}

\subsection*{Треклы Конвея}
\rindex{Треклы Конвея}

\setbox180\hbox{\hskip12bp\includegraphics[scale=.6]{wink-29}}

Треклом называют диаграмму на плоскости, состоящую из вершин и рёбер (кривых без самопересечений) и удовлетворяющую следующим условиям.
\begin{itemize}[noitemsep,leftmargin=\parindent,labelsep=3.5pt]
\rightskip\wd180
\item два конца каждого ребра "--- это две различные вершины, и ребро не проходит через другие вершины; 
\item любые два ребра пересекает друг друга ровно один раз, либо в~общей вершине, либо во внутренней точке.
\end{itemize}

\begin{wrapfigure}[0]{r}{\wd180}
\vspace{-7.3\baselineskip}
\box180
\end{wrapfigure}

Существует ли трекл с б\'{о}льшим числом рёбер, чем вершин?

% \begin{figure}[!ht]
% \centering
% % \includegraphics[scale=0.5]{Figs/UnsolvedPuzzles/thrack}
% \includegraphics{mp/wink-29}
% \end{figure}

\subsection*{Затор}
\rindex{Затор}

Вершины бесконечной решётки на плоскости выбираются независимо с фиксированной вероятностью $p\in (0,1)$.
В каждую из выбранных вершин
помещают автомобиль, направленный либо на север, либо на восток, в каждом случае направление выбирается независимо подкидыванием монетки.

Движение регулируется светофорами, которые включают поочерёдно «зелёный-восточный» и «зелёный-северный».
При включённом зелёном-восточном каждый автомобиль, направленный на восток, правая соседняя вершина от которого не занята, перемещается в эту вершину;
остальные (в том числе заблокированные другим восточным автомобилем) остаются на месте.

Когда включается зелёный-северный, каждый незаблокированный
автомобиль, направленный на север, перемещается на одну вершину в
северном направлении.

Эксперименты показывают, что если $p$ меньше определённого
критического значения $p_0$, то автомобили постепенно разъедутся
(каждый автомобиль имеет предельную скорость,
равную скорости автомобиля, который никогда не блокируется).
Но когда
$p> p_0$, происходит обратное: автомобили попадают в безнадёжный
затор, то есть каждый автомобиль делает только конечное число переездов
и останавливается навсегда.

Если вы готовы в это поверить, то попробуйте доказать любое из этих утверждений.

\subsection*{Гипотеза о средних уровнях}
\rindex{Гипотеза о средних уровнях}

Докажите, что все подмножества размера $n$ или $n+1$ в множестве
размера $2n+1$ можно обойти циклически, добавляя или удаляя по одному
элементу за раз.

\subsection*{Построение диаграмм Венна}
\rindex{Построение диаграмм Венна}

Диаграмма Венна порядка $n$ представляет собой набор из $n$ простых
замкнутых кривых на плоскости с пересечениями  по две кривые в точке,
обладающий тем свойством, что для любого поднабора кривых множество
точек внутри кривых из поднабора и снаружи остальных кривых является
связной компонентой дополнения плоскости к объединению кривых.

Любую ли диаграмму Венна порядка $n$ можно расширить до диаграммы
Венна порядка $n+1$? 

\subsection*{Стратегия для игры в щёлк}
\rindex{Стратегия для игры в щёлк}

Алиса и Боб играют в следующую игру.
Выбирается число $k$.
Алиса
называет делитель числа $k$.
Боб называет другой делитель числа~$k$,
который не кратен числу, названному Алисой.
Алиса называет третий
делитель, который не является кратным ни одному из уже названных, и
так далее.
Проигрывает тот, кто называет~1.

Обратите внимание на то, что при $k=2^{n}\cdot 3^{m}$ эта игра
эквивалентна игре «Щёлк» из главы «Ещё игры» для плитки шоколада
$(m+1)\z\times (n+1)$.
То же рассуждение показывает, что у Алисы
существует выигрышная стратегия, но остаётся следующая задача, как для
версии с шоколадкой, так и для приведённого обобщения: найдите Алисе
выигрышную стратегию!

\subsection*{Все дороги ведут в Рим}
\rindex{Все дороги ведут в Рим}

Дана сеть (не обязательно плоская) из городов и односторонних дорог со
следующими свойствами: из каждого города выходят ровно две дороги, и
для некоторого фиксированного $n$ можно добраться из любого города в
любой другой город, пройдя по $n$ дорогам.

Докажите, что можно раскрасить дороги в красный и синий цвет таким
образом, что (а) из каждого города выходят дороги обоих цветов и (б)
есть набор инструкций (например, КССКК), следуя которому,
путешественник всегда попадает в один и тот же город независимо от
того, из какого города он выехал.

\subsection*{Круги в круге}
\rindex{Круги в круге}

Докажите, что любой набор кругов с общей площадью $1$ можно поместить
в круг площади $2$. 

А ещё лучше было бы доказать, что в $d$-мерном пространстве любой
набор из тел, подобных данному выпуклому телу, с общим объёмом~1,
можно поместить в тело, подобное этому выпулому телу и имеющее объём
$2^{d-1}$.

\subsection*{Гипотеза Франкла}
\rindex{Гипотеза Франкла}

Пусть $U$ "--- конечное множество, а $T$ "--- семейство непустых
подмножеств в $U$, замкнутое относительно объединений.
Докажите, что
в $U$ есть элемент, принадлежащий по меньшей мере половине множеств из
семейства~$T$.

\section*{Комментарии и ссылки}

\subsubsection*{Ангел и дьявол Конвея}

Недавний обзор этой увлекательной головоломки содержится в очень симпатичной коллекции под редакцией Ричарда Новаковского\footnote{{Games of No Chance} / Edited by Richard Nowakowski. Cambridge: Cambridge Uni\-ver\-sity Press, 1996. \href{http://library.msri.org/books/Book29/}{\url{library.msri.org/books/Book29/}}.}. 

Элвин Берлекамп показал, что если ангел обладает «силой 1»,
то есть может делать только одиночные ходы короля, то дьявол побеждает.
Может быть, дьявол побеждает независимо от силы ангела?  Но нет,
похоже, что силы 2 достаточно для того, чтобы ангел выжил.

Ангел силы 1000 должен быть в состоянии выжить, но, как сам
изобретатель головоломки говорит в своей статье, на путях к решению
возникают неприятные трудности.
Одна из них заключается в том, что
дьявол не может ошибиться, то есть независимо от того, какую клетку он
уничтожит, полученная конфигурация станет для него лучше, чем
начальная.
Другая заключается в том, что дьявол, кажется, имеет ответ
на любую простую стратегию «потенциальной функции», которой мог бы
воспользоваться ангел, то есть стратегию, которая говорит ему, куда
ходить, в зависимости от того, какие клетки уничтожены.

Кроме того, если ангел имеет какие-то, казалось бы, лёгкие недостатки
вроде того, что ему запрещено ступать на клетку, расположенную далее
чем на $10^{99}$ клеток к югу от клетки, на которой он уже побывал, то
дьявол побеждает.

Сам Конвей, похоже, верил в ангела, об этом свидетельствует то, что он
предлагал приз в тысячу долларов за доказательство того, что дьявол
побеждает, и только сто за стратегию для достаточно сильного ангела.

\begin{addedbytheeditors}
После публикации английского оригинала этой книги задача была независимо решена как минимум 4 раза.
Решения Оддвара Клостера%
\footnote{
\emph{O. Kloster}. 
A solution to the angel problem /\!/
{Theoret. Comput. Sci.} 2007.  Vol.~389, no.~1--2. P.~152--161.}
и Андре Мате%
\footnote{
\emph{A. Máthé}. 
The angel of power 2 wins /\!/ 
{Combin. Probab. Comput.} 2007. Vol.~16, no. 3. P.~363–374.}
работают для ангела силы 2.
Решение Брайна Боудича%
\footnote{\emph{B. H. Bowditch}.
  The angel game in the plane /\!/ {Combin. Probab. Comput.} 2007. Vol.~16, no. 3. P.~345--362.}
работает для ангела силы~4.
Решение Питера Гакса%
\footnote{\emph{P. G\'{a}cs}. {The angel wins.} arXiv:0706.2817 [math.CO].}
работает для ангела много большей силы. "--- \emph{Прим. ред.}
% нет в оригинале --- с согласия Питера
\end{addedbytheeditors}

\subsubsection*{Гипотеза о $\bm{3x+1}$}

Эта головоломка также известна как гипотеза Коллатца, сиракузская
задача, задача Какутани, алгоритм Хасса и гипотеза Улама.
Об её
источнике известно только то, что 1 июля 1932~года студент
Гамбургского университета по имени Лотар Коллатц записал похожую
задачу в свою тетрадь, но задача, известная теперь, кажется, стала
популярна только в 1950-е годы.

Джефф Лагариас из Лабораторий AT\&T написал о ней очень хороший
обзор\footnote{\emph{J. Lagarias}. The $3x+1$ Problem and its Generalizations /\!/ {Amer. Math. Monthly}. 1985. Vol. 92. P.~3--23.%\href{http://www.cecm.sfu.ca/organics/papers/lagarias/}{\url{www.cecm.sfu.ca/organics/papers/lagarias/}}.
}.

Лагариас указывает на то, что эта головоломка упоминалась как часть
заговора с целью замедлить математические исследования в США.
Пусть
это послужит предупреждением!

\subsubsection*{Самая длинная общая подпоследовательность}

Эта задача известна как минимум с 30-х годов; она упоминается в
диссертации В.",Данчика 1974 года, защищённой в Уорикском
университете.
\mbox{Майкл} Стил (Пенсильванский университет)
сформулировал гипотезу, что $C_{1/2} = 2/(1+\sqrt{2\mkern1mu})\approx
0{,}828427$.
Вацлав Хватал и Давид Санкофф показали, что $0{,}773911
< C_{1/2} < 0{,}837623$, и это дало основание предполагать, что число
Стила великовато; в конце концов Джордж Люкер (Калифорнийский
университет в Ирвайне) <<добил>> гипотезу, доказав,
что\footnote{\emph{G. Lueker}.  Improved bounds on the average length of longest common subsequences /\!/ {Proceedings of the 14th Annual   ACM-SIAM Symposium on Discrete Algorithms} (Baltimore, MD, 2003). P.~130--131.}  $0{,}7880 \z< C_{1/2} \z< 0{,}8263$.

Существование констаны $C_p$ легко следует из
субаддитивности\footnote{См., например,
\emph{R. Durrett}. {Probability: Theory and Examples}. Wadsworth, 1991. Section 6.6.}, но это не помогает её вычислить.
Вот ещё
подобный пример: Бела Боллобаш и автор доказали существование такого
числа $K_d$, что самая длинная координатно"=возрастающая цепь среди
$n$ случайных точек в $d$-пространстве имеет средний размер, равный
$K_d\cdot n^{1/d}$.
Мы знаем, что $K_1=1$, $K_2=2$ и
$\lim\limits_{d\to\infty} K_d=e$, но не знаем, чему равно $K_3$.

Если менять вероятность $p$, то, конечно же, $C_p>p$ при $p \z> 1/2$,
так как можно смотреть только на подпоследовательности, состоящие из
одних единиц.
Таким образом, $C_p\to 1$ при $p\to 1$, и это даёт
основание предполагать, что $C_p$ минимально при $p=1/2$.
Чтобы это
доказать, не обязательно знать точные значения $C_p$.
Вопрос в том,
как это сделать.

\subsubsection*{Вписать квадрат в озеро}

Хорошее обсуждение этой головоломки дано на «Геометрической свалке» Давида Эпштейна%
\footnote{\href{http://www.ics.uci.edu/~eppstein/junkyard/jordan-square.html}{\url{www.ics.uci.edu/~eppstein/junkyard/jordan-square.html}}}.
Похоже, что есть доказательства того, что квадрат можно вписать во все достаточно гладкие замкнутые плоские кривые%
\footnote{Например, \emph{W. Stromquist}. Inscribed Squares and Square-Like Quadrilaterals in Closed Curves /\!/ {Mathematika}. 1989. Vol. 36, no.~2. P.~187--197.}.
Тем не менее в общем случае гипотеза остаётся открытой уже более 90 лет%
\footnote{\emph{V. Klee, S. Wagon}. {Old and New Unsolved Problems in Plane Geometry and Number Theory.} MAA, 1991.}.

\medskip

Даже неловко признать, что у математиков никак не получается выяснить,
можно ли вписать квадрат в любую замкнутую плоскую кривую.

\subsubsection*{Одинокий бегун}

Эта замечательная гипотеза была, по"=видимому, выдвинута Йоргом Виллсом%
\footnote{\emph{J. M. Wills}. Zwei S\"atze \"uber Inhornogene Diophantische Approximation von Irrational\-zahlen /\!/ {Monatsch. Math.} 1967. Vol. 71. P.~263--269.}.
В 1973 году её независимо сформулировал Томас Кьюсик.
В 1984 году он вместе с Карлом Померансом доказал гипотезу для не более чем пяти бегунов.
Том Бохман, Рон Хольцман и Дэн Клейтман (те самые, что из ящиков и
подъящиков) доказали её для случая шести бегунов%
\footnote{\emph{T. Bohman, R. Holzman, D. Kleitman}.
Six lonely runners /\!/ {Electron. J. Combin.} 2001. Vol.~8, no. 2.
%\href{https://www.combinatorics.org/ojs/index.php/eljc/article/view/v8i2r3/pdf}{\url{www.combinatorics.org/ojs/index.php/eljc/article/view/v8i2r3/pdf}}
},
есть также более короткое доказательство Джерома Рено%
\footnote{\emph{J. Renault}. View-obstruction: a shorter proof for 6 lonely runners /\!/ {Discrete Math.} 2004. Vol.~287, no. 1--3. P.~93--101.}.

\medskip

Название головоломки предложил Луис Годин из Университета Саймона Фрейзера.

Головоломка носит теоретико-числовой характер; можно показать, что
достаточно рассмотреть только случай целых скоростей.

\subsubsection*{Сортировка двойного набора шаров}

Эта любопытная задачка возникла в лаборатории Bellcore (ныне
Telecordia Technologies) при статистических исследованиях предпочтений
заказов.
Я работал над ней с коллегами Майклом Литтманом (ныне в
Ратгерсе) и Грэмом Бригиттом (Лондонская школа экономики).
Задача
обобщается не только на корзинки с $k$ шарами в каждой, но и на
корзинки с различным числом шаров.
Мы ограничимся случаем двух шаров.

\medskip

Если бы в корзинках было по одному шару, то задача превратилась бы в
простое упражнение.
В этом случае для сортировки из обратного порядка
в прямой требуется $\binom{n}{2}$ перекладываний.
Чтобы это увидеть,
заметим, что в начальный момент все пары шаров находятся в обратном
порядке, а одно перекладывание исправляет только одну пару.
Из этого
также следует, что если не делать глупостей (а именно, не менять
местами шары, которые уже находились в правильном порядке), то
потребуется ровно $\binom{n}{2}$ перекладываний.
Более того,
независимо от начальной конфигурации, $\binom{n}{2}$ перекладываний
достаточно; как и следовало ожидать, обратный порядок является
наихудшим.

\medskip

На первый взгляд кажется, что те же рассуждения работают и когда в
корзинках лежит по два шара.
Можно считать, что у нас по $n$ шаров
двух цветов, красных и зелёных, и шары каждого цвета пронумерованы от
$1$ до~$n$.
Если сортировать каждый цвет по отдельности, то мы
закончим за $2\,\binom{n}{2}$ перекладываний.
Наверняка ведь 
$2\,\binom{n}{2}$ шагов необходимо, верно?

А вот и нет!  При $n = 5$ (посмотрите на рисунок ниже) шары чудесным
образом упорядочиваются всего за 15 перекладываний вместо 20.

\begin{figure}[!ht]
\vspace{\jot}
\centering
% \includegraphics[scale=0.5]{Figs/UnsolvedPuzzles/5bin}
\includegraphics{mp/wink-280}
\vspace{-3\jot}
\end{figure}

Меньше чем за 15 перекладываний упорядочить эти шары нельзя.
Более
того, не менее $\Bigl\lceil\binom{2n}{2}/3\Bigr\rceil$ перекладываний
необходимо для упорядочивания шаров в $n$ двухшарных корзинках.
Чтобы
увидеть это, будем давать одно очко за \emph{обгон}, то есть за то, что
шар с б\'{о}льшим номером прошёл слева направо относительно шара с
меньшим номером.
Если обгон проделывается в два приёма, то мы
назначаем по пол-очка за то, что шар поравнялся с шаром с меньшим
номером, и за то, что он ушёл вперёд.
%% Кроме того, заметим, что в
%% процессе любая пара шаров с одинаковыми номерами должна разделиться, а
%% потом сойтись вместе, "--- накинем ещё по пол-очка за каждое такое
%% перекладывание.

Стало быть, в процессе сортировки каждая пара шаров с разными номерами
даст нам одно очко, и каждая пара шаров с одинаковыми номерами такж
даст в сумме одно очко: пол-очка, когда они разойдутся по разным
корзинам, и еще пол-очка, когда они снова сойдутся вместе. Итого
в процессе сортировки мы соберем $\binom{2n}2$
очков.

А сколько очков можно заработать за одно перекладывание?
Предположим, что мы поменяли шары с номерами $u$ и $y$ из корзинки с $u$ и $v$ и соседней корзинки с $x$ и $y$.
Мы можем получить одно очко за то, что $u$ обогнал $y$,
по пол-очка за то, что $u$ ушёл вперёд от $v$,
и за то, что $x$ ушёл вперёд от $y$,
а ещё по пол-очка за то, что $u$ поравнялся с $x$, 
и за то, что $v$ поравнялся с $y$.
Получается максимум 3 очка за перекладывание;
отсюда следует нижняя оценка~$\Bigl\lceil\binom{2n}{2}/3\Bigr\rceil$.


Есть ещё хорошие новости.
Как и в случае с одношарными корзинками,
нетрудно показать, что обратный порядок самый плохой, то есть если
$f_2(n)$ обозначает минимальное число перекладываний, необходимых для
сортировки шаров в $n$ двухшарных корзинках из любой начальной
конфигурации, то ровно $f_2(n)$ перекладываний потребуется для
сортировки из обратного порядка в прямой.
Также легко доказать, что если обмен
должен быть сделан между $i$"~й и $(i+1)$"~й корзинками, то не может
быть неправильным менять шар с наибольшим номером в $i$"~й корзинке с
шаром с наименьшим номером в $(i+1)$"~й корзинке.

Но есть и плохие новости (иначе задача не появилась бы в этом разделе):
оценка $\Bigl\lceil\binom{2n}{2}/3\Bigr\rceil$ не всегда достижима.
Например, она даёт $f_2(6)\ge 21$, но компьютерный перебор показывает,
что $f_2(6)\geqslant 22$.

Хуже того, способ перекладывания для пяти корзинок, изобаженный на
рисунке, обычно не оптимален для большего числа корзинок.

Но всё ещё возможно, что какой-то другой способ оптимален и, более
того, даёт красивую формулу для $f_2(n)$.

\subsubsection*{Развёртка многогранника}

Есть основания полагать, что эта головоломка очень старая.
Во всяком
случае развёртки многогранников рассматривались уже в книге с длинным
заглавием «Руководство к измерению циркулем и линейкой, в плоскостях и целых телах, составленное Альбрехтом Дюрером и напечатанное с соответствующими чертежами в 1525 году на пользу всем любящим искусство».
Если требуется разукрасить поверхность многогранника,
то первое, что приходит в голову "--- это разрезать её вдоль рёбер и
развернуть на плоскости без перекрытий.

По-видимому, первая точная формулировка этой головоломки дана Г. С. Шепардом из Университета Восточной Англии%
\footnote{\emph{G. C. Shephard}. Convex Polytopes with Convex Nets /\!/ {Math. Proc. Camb. Phil Soc.} 1975. Vol. 78. P.~389--403.}.

Известно, что существуют \emph{не}выпуклые неразвёртываемые многогранники%
\footnote{\emph{M. Bern, E. Demaine, D. Eppstein, E. Kuo, A. Mantler,   J. Snoeyink}.  Ununfoldable poly\-hedra with convex faces /\!/ {Comput. Geom.} 2003. Vol.~24, no. 2. P.~51-–62.}; существуют также
выпуклые многогранники, у которых наряду с честными развёртками есть
развёртки с самоперекрытиями.
Пара развёрток тетраэдра с перекрытием
и без, построенная Макото Намики из Токийского университета, показана
ниже.

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.45]{Figs/UnsolvedPuzzles/unfold}
\includegraphics{wink-36}
\end{figure}

Отметим кстати, что существуют развертки, по которым  многогранник
восстанавливается неоднозначно.

\subsubsection*{Освещение многоугольника}

В своей книге%
\footnote{\emph{J. O'Rourke}. {Art Gallery Theorems and Algorithms.} Oxford University Press, 1987.}
Джозеф О’Рурк % (Joseph O' Rourke) 
из колледжа Смит утверждает, что источник этой головоломки неизвестен.
Виктор Кли написал о ней в 1969 году в статье, вышедшей в «American Mathe\-ma\-tical Monthly», которая привлекла большое внимание. 

Если считать, что луч, попавший в вершину, поглощается, то можно
построить многоугольник, который не освещается из некоторой своей
внутренней точки.
Пример, представленный ниже, найден Джоржем
Токарским в 1995 году.

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.5]{Figs/UnsolvedPuzzles/vision}
\includegraphics{mp/wink-31}
\end{figure} 

О’Рурк полагает, что в любом зеркальном многоугольнике $P$ множество
внутренних точек, из которых $P$ не может быть освещен, имеет меру 0 и что
если вершины заменить небольшими круглыми дугами, то таких точек
вообще не будет.

\setbox180\hbox spread 3bp{\hss\includegraphics[scale=.75]{wink-35}}
\begin{wrapfigure}{r}{\wd180}
\vspace{-5\jot}
\box180
\end{wrapfigure}


Можно построить фигуру, ограниченную гладкой замкнутой кривой, которая
не может быть освещена ни из одной своей внутренней точки.
Такой
пример был построен самим Кли (см. рисунок), он использует два
полуэллипса с фокусами в указанных точках%
\footnote{Практически идентичный пример приведён ранее в следующей заметке: \emph{L.~Penrose, R.~Penrose}. Puzzles for Christmas /\!/ {New Scientist}. 1958. Vol.~25. P.~1580--1581. "--- \emph{Прим. ред.}}.
Источник света в верхней половине оставляет тёмной левую и правую доли на нижней половине.


% \begin{figure}[!ht]
%   \vspace{-2\jot}
% \centering
% % \includegraphics[scale=0.4]{Figs/UnsolvedPuzzles/klee}
% \includegraphics[scale=.75]{wink-35}
% \end{figure} 

Есть много других интригующих открытых вопросов про зеркала.
Например, может ли конечный набор разделённых сегментных зеркал
захватывать свет от источника?  А что насчёт зеркал в форме дуг
окружностей?  Это и многое другое можно найти на слайдах
замечательного доклада О’Рурка%
\footnote{\emph{J. O'Rourke}. Unsolved Problems in Visibility. \url{http://archive.dimacs.rutgers.edu/dci/2001/Visibility.ppt}}.

\subsubsection*{Треклы Конвея}

Эта интригующая гипотеза Конвея относится к 60-м годам%
\footnote{\emph{D. R. Woodall}. Thrackles and Deadlock /\!/ {Combinatorial Mathematics and its Appli\-ca\-tions}, Proc. 1969 Oxford Combinatorial Conference. P.~335--348.}.
Её можно свести к тому, что два чётных цикла, склеенных по вершине, невозможно представить как трекл,
что, конечно, смущает ещё больше.
Лучшая известная мне оценка\footnote{\emph{L. Lovasz, J. Pach, M. Szegedy}. On Conway's Thrackle Conjecture /\!/ {Discrete and Compu\-ta\-tional Geometry}. 1997. Vol. 18. P.~369--376.} показывает, что число рёбер не может превышать $2n-3$, где $n$ "--- число вершин.

У этой головоломки имеется свой фан-клуб%
\footnote{\href{http://www.thrackle.org}{\url{www.thrackle.org}}}.

\begin{addedbytheeditors}
Уже к 2000 году было доказано, что число рёбер не превосходит%
\footnote{\emph{G. Cairns, Y. Nikolayevsky}.
Bounds for generalized thrackles /\!/ 
Discrete Comput. Geom. 2000.  Vol.~23, no. 2. P.~191--206.}
$3(n-1)/2$.
С тех пор оценку несколько раз улучшали, последний результат%
\footnote{\emph{R. Fulek, J. Pach}. Thrackles: an improved upper bound /\!/  Discrete Appl. Math.  2019. Vol.~259. P.~226--231.}
уже меньше $1{,}4\cdot n$. "--- \emph{Прим. ред.}
\end{addedbytheeditors}

\subsubsection*{Затор}

Эта модель возникала при изучении транспортного потока на пересечении двух широких односторонних улиц%
\footnote{\emph{O. Biham, A. A. Middleton, D. Levine}. Self Organization and a Dynamical Transition in Traffic Flow Models /\!/ {Phys. Rev. A}. 1992. Vol. 46.10. R6124.}.
Странное поведение модели вызвало большой интерес%
\footnote{Библиографию можно найти по адресу
\href{http://cui.unige.ch/spc/Bibliography/traffic.html.}{\url{cui.unige.ch/spc/Bibliography/traffic.html}}.}.
Ниже показаны фрагменты конфигураций,
свободной и блокированной,
каждая из которых похожа на то, что появлялось в экспериментах,
проведённых Раисой Де Соуза из Microsoft Research.

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.5]{Figs/UnsolvedPuzzles/gridlock}
\includegraphics[scale=.9]{mp/wink-32}
\end{figure}


Как бы только доказать, что для \emph{некоторых} $p$, пусть даже очень близких к $0$ или $1$, поведение на самом деле такое...

\begin{addedbytheeditors}
После публикации английского оригинала этой книги случай $p\approx 1$ был решён Омером Энджелом,
Александром Холройдом и Джеймсом Мартином%
\footnote{\emph{O. Angel, A. Holroyd, J. Martin}. 
The jammed phase of the Biham "--- Middleton "--- Levine traffic model /\!/
{Electron. Comm. Probab.} 2005. Vol.~10. P.~167--178.}. "---
\emph{Прим. ред.}
\end{addedbytheeditors}

\subsubsection*{Гипотеза о средних уровнях}

Эта знаменитая головоломка о гамильтоновом цикле приписывалась в
разные времена комбинаторикам: Ивану Гавелу, Клоду Бержу, Итало
Деджтеру, Полу Эрдёшу, У.",Т.",Троттеру и Дэвиду Келли.
Вероятно, Гавел был первым.
Вопрос лежит на поверхности, и неудивительно, что
он был придуман много раз.
Келли представил головоломку на
конференции в Обервольфахе в 1981 году и получил приз (бутылку вина)
за гипотезу с самой короткой формулировкой.


Предупреждение читателю: эта задача заразительна.
Эксперименты
привели многих к мнению, что цикл можно построить для любого $n$.
Никто не верит в контрпимер.
Роберт Рот (Университет Эмори) много лет
назад провёл несколько компьютерных экспериментов, которые говорят о
том, что количесвто гамильтоновых циклов очень быстро растёт с
ростом~$n$.
То, что это число может упасть до нуля для некоторых $n$,
кажется неправдоподобным, но нет никаких доказательств обратного.

Лучший частичный результат можно найти в диссертации Роберта Джонсона, студента Имре Лидера из Кембриджа.
Джонсон показал, что по мере увеличения $n$ существуют циклы через произвольно высокую долю множеств среднего уровня.

\begin{addedbytheeditors}
После публикации английского оригинала этой книги эту задачу решил Торстен Мюце\footnote{\emph{T. Mütze}. 
Proof of the middle levels conjecture /\!/
{Proc. Lond. Math. Soc.} (3). 2016. Vol.~112, no. 4. P.~677–-713.}.
"--- \emph{Прим. ред.}
\end{addedbytheeditors}

\subsubsection*{Построение диаграмм Венна}

Эта головоломка, как и предыдущая, о существовании гамильтонова цикла. 
Действительно, для того чтобы добавить новую область к диаграмме Венна, необходимо нарисовать замкнутую кривую, которая пройдёт ровно раз через каждую область.
Эту гипотезу придумал ваш автор%
\footnote{\emph{P. Winkler}. Venn Diagrams: Some Observations and an Open Problem /\!/ {Congressus Numerantium}. 1984. Vol. 45. P.~267--274.}.

Если разрешить пересечения более чем двух кривых, то любая диаграмма допускает продолжение; это доказли Киран Чилакамарри, Петер Хамбургер и Раймонд Пипперт%
\footnote{\emph{K. B. Chilakamarri, P. Hamburger, R. E. Pippert}.
Simple, Reducible Venn Diagrams on Five Curves and Hamiltonian Cycles /\!/ {Geometriae Dedicata}. 1997. Vol. 68. P.~245--262.}.
Двойственную задачу решили Гара Пруессе и Франк Руски%
\footnote{\emph{G. Pruesse, F. Ruskey}.
All Simple Venn Diagrams are Hamiltonian.
\texttt{arXiv:1504.06651 [math.CO]}.}.
Тем не менее изначальная гипотеза остаётся открытой уже 20 лет.

Журнал «Electronic Journal of Combinatorics» поддерживает не\-сколь\-ко полезных веб-обзоров, среди которых один о диаграммах Венна, написанный в основном Фрэнком Руски%
\footnote{\emph{F. Ruskey, M. Weston}. {A Survey of Venn Diagrams}. \href{http://www.combinatorics.org/Surveys/ds5/VennEJC.html}{\url{www.combinatorics.org/Surveys/ds5/VennEJC.html}}.}, специалистом в этой области из Университета Виктории.
Сами диаграммы известны с 1880 года%
\footnote{\emph{J. Venn}.
On the Diagrammatic and Mechanical Representation of Propositions and Reasonings /\!/ {The London, Edinburgh, and Dublin Philosophical Magazine and Journal of Science}. 1880. Vol. 9. P.~1--18.}.



То, что эти диаграммы изучаются уже 123 года, вовсе не даёт иммунитета
от элементарных новых идей!  Например, недавно была доказана другая
гипотеза "--- были построены диаграммы Венна с вращательной симметрией
любого простого порядка%
\footnote{\emph{J. Griggs, C. E. Killian, C. D. Savage}. Venn diagrams and symmetric chain decom\-po\-si\-tions in the Boolean lattice /\!/
\emph{The electronic journal of combinatorics}. 2004. Vol.~11(1), R2.}.

\subsubsection*{Стратегия для игры в щёлк}

Игра щёлк была изобретена Дэвидом Гейлом%
\footnote{\emph{D. Gale}. A Curious Nim-Type Game /\!/ {Amer. Math. Monthly}. 1974. Vol. 81. P.~876--879.\looseness1} в 1974 году, название%
\footnote{Англ. \emph{chomp} "---  откуси.}
 ей дал Мартин Гарднер.
Однако эта игра эквивалентна игре, придуманной ранее Фредериком Шу%
\footnote{\emph{F. Schuh}. Spel van Delers /\!/ {Nieuw Tijdschrift   voor Wiskunde}. 1952. Vol. 39. P.~299--304.\looseness1}.
В~игре
Шу фиксируется целое положительное число $k$ и игроки по очереди
называют делители числа $k$, которые не кратны уже названным.
Проигрывает тот, кому приходится назвать $1$.

Если $k$ имеет вид $p^mq^n$ при простых $p$ и $q$, то все делители
имеют вид $p^iq^j$ при $0 \le i \le m$, $0 \le j \le n$.
При этом на
пару $(i,j)$ налагаются те же ограничения, что и в игре щёлк на
$(m+1)\times(n+1)$-плитке шоколада.
Более того, $d$-мерная плитка
шоколада эквивалентна игре Шу, если выбранное число $k$ имеет ровно
$d$ простых делителей.
%расхождение в обозначениях с оригиналом --- с согласия Питера,
%обозначения в формулировке теперь те же, что в комментариях.

Рассуждение с передачей хода прекрасно работает и для этого обобщения.
Первый игрок должен иметь выигрышную стратегию, поскольку он может передать первый ход второму игроку, выбрав «$k$» в начале игры.
Но никто не знает, что это за стратегия.

Рассматривались и варианты игры <<щелк>> с трансфинитными ординалами.
Ещё более общий вариант "--- «ЧУМ"~игры», где начинают с
фиксированного частично упорядоченного множества $P$, из которого два
игрока поочерёдно выбирают элементы.
При этом ни один из игроков не
может взять элемент, который больше или равен любому из ранее
выбранных; проигрывает сделавший последний ход.
На момент написания
этой книги последняя хорошая теорема о ЧУМ"~играх была доказана
Стивеном Дж.~Бирнсом, старшеклассником из Уэст"=Рокбери, Массачусетс.
В~2002 году за эту теорему он получил стипендию в размере ста тысяч
долларов на конкурсе Siemens Westinghouse.
% {\looseness1\par}

\subsubsection*{Все дороги ведут в Рим}

Эта головоломка появилась в серьёзной статье%
\footnote{\emph{R. L. Adler, L. W. Goodwyn, B. Weiss}. Equivalence of Topological Markov Shifts /\!/ {Israel   J. Math}. 1977. Vol. 27. P.~49--63.}.
После того как дороги
раскрашены, можно думать про К и С как про операции на множествах
вершин, то есть К$(S)$ "--- множество всех вершин, доступных по
красному ребру от некоторой вершины из $S$, и аналогично для С$(S)$.
Тогда гипотеза утверждает, что для некоторой окраски существует
конечная композиция из К и С, которая отображает множество всех вершин
в одну.


На рисунке показаны две раскраски полного орграфа с тремя вершинами.
Первую невозможно отобразить в точку, так как
$|\text{К}(S)|\z=|\text{С}(S)|\z=|S|$ для любого $S$.
Вторую
раскраску отображает в точку композиция КС или СК.

\begin{figure}[!ht]
\centering
% \includegraphics[scale=0.5]{Figs/UnsolvedPuzzles/roads}
\includegraphics[scale=1.1]{mp/wink-33}
\end{figure}

Гипотеза доказана для некоторых классов графов, например, если в каждый город заходят ровно две дороги и число городов нечётно%
\footnote{\emph{J. Friedman}. On the Road Coloring Problem /\!/ {Proc. Amer. Math. Soc.} % (December)
1990. Vol. 110, no. 4. P.~1133--1135}.

\begin{addedbytheeditors}
После публикации английского оригинала этой книги эту задачу решил Абрам Трахтман%
\footnote{\emph{A. N. Trahtman}. The road coloring problem /\!/ {Israel J. Math.} 2009. Vol.~172. P.~51--60.}. "---
\emph{Прим. ред.}
\end{addedbytheeditors}


\subsubsection*{Круги в круге}

Эта прекрасная гипотеза сформулирована Александром Сойфером из
Университета штата Колорадо.
Она и родственные ей гипотезы стали
предметом дюжины статей в журнале «Geo\-com\-bi\-na\-tor\-ics».
Известно, например, что квадраты общей площадью 1 можно поместить в
квадрат общей площадью 2.
Обобщение на высшие размерности было
предложено, в частности, вашим автором.
Случай двух шаров, каждый
объёма $\tfrac12$, показывает, что оценку $2^{d-1}$ нельзя улучшить.

\subsubsection*{Гипотеза Франкла}

В нашей последней головоломке речь идет о простейших математических
объектах "--- конечных множествах. Но даже про них можно составить
зверски трудную задачу.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

Эта гипотеза "--- как раз из таких, и очень известная. Похоже, она
возникла в 1970-х годах в творчестве Петера Франкла, венгерского
математика, живущего в Японии (и иногда выступающего на японском
телевидении).
С тех пор она сводит комбинаториков с ума.
На сегодня
им даже неизвестно, существует ли элемент, покрытый какой-либо
фиксированной долей множеств из семейства.

Очень хитрое рассуждение Э. Кнолла, приведённое в статье Петра Вуйчика%
\footnote{\emph{P. W\'{o}jcik}. Union-Closed Families of Sets /\!/ {Discrete Math.} 1999. Vol. 199. P.~173--182.},
показывает, что существует элемент, содержащийся по крайней мере в $N/\mkern-2mu\log_2 N$ множествах, где $N$ "--- размер семейства.

Последнее продвижение в этой задаче принадлежит Дэвиду Реймеру%
\footnote{\emph{D. Reimer}. An average set size theorem /\!/ {Combinatorics, Probability and Computing.} 2003. Vol. 12. P.~89--93.} из колледжа Нью-Джерси.
Реймер показал, что средний размер множества в семействе, замкнутом по объединению, составляет по меньшей мере $\tfrac12\log_2N$ (это было недоказанное следствие гипотезы Франкла).

\begin{addedbytheeditors}
В ноябре 2022 г. появился препринт Джастина Гилмера, в котором тот доказал существование элемента, принадлежащего по крайней мере 1",\% от количества множеств. Идея Гилмера, опирающегося на вероятностный метод, получила развитие буквально моментально: сначала была доказана предположенная Гилмором оценка $\frac{3-\sqrt5}2\approx0{,}38197$,\vspace{.5\jot} а к 1 декабря Ли Ю улучшил оценку до $0{,}38234$. Скорее всего, это не последнее улучшение, но до желаемого результата $0{,}5$ пока все еще далеко. "--- \emph{Прим. ред}.
\end{addedbytheeditors}

Многие простые вопросы о семействах множеств остаются открытыми.
Другой такой вопрос был предложен Вацлавом Хваталом из Ратгерского
университета в 1972 году.
Предположим, что семейство~$T$ множеств
замкнуто относительно перехода к подмножеству, то есть любое
подмножество множества в $T$ также содержится в $T$.
Предположим, мы
нашли самое большое возможное пересекающееся подсемейство,
то есть такое, что в любые два множества в нём имеют непустое
пересечение.
Один из способов получения пересекающегося семейства
состоит в том, чтобы взять все множества в $T$, содержащие
фиксированный правильно выбранный элемент.
Гипотеза Хватала состоит в
том, что лучше сделать невозможно.

\chapter{Послесловие}

\thispagestyle{empty}
%% \setlength{\epigraphwidth}{.6\textwidth}
%% \epigraph{Математика "--- не церемониальный марш по гладкой дороге, а путешествие по незнакомой местности, где исследователи часто рискуют заблудиться.
%% Строгость должна стать указанием для историка о том, что данная местность нанесена на карту, а настоящие исследователи отправились дальше.\vspace{1ex}}{У. С. Энглин
%% %https://biography.wikireading.ru/57144
%% }

\setlength{\epigraphwidth}{.6\textwidth}
\epigraph{Того, кто в состоянии иметь дело с математикой, нельзя назвать в полной мере человеком. В лучшем случае это человекоподобное существо, которое можно терпеть постольку, поскольку он умеет носить обувь, мыться и не загаживать квратиру.\vspace{1ex}}{Лазарус Лонг, <<Достаточно времени для любви>>
%https://biography.wikireading.ru/57144
}


Книга, которую вы прочитали, представляет собой не книгу по
математике, а коллекцию математических головоломок, или, по крайней
мере, она была так задумана.
Она посвящена задачам занимательным, а
не важным.
Она не выстраивает теории, не вносит структуру и не
навязывает правил, она также не требует продолжительного внимания.

Даже сторонники подхода к математике, ориентированного на решение
задач (такие как Тим Гауэрс, автор статьи «Две культуры в~математике»\footnote{\emph{Gowers, W. T.} The two cultures of mathematics /\!/ {Mathematics: frontiers and per\-spec\-tives.} Providence, R.I.: Amer. Math. Soc., 2000. P.~65--78; перевод на русский язык Никиты Калинина:
\href{http://www.mathcenter.spb.ru/nikaan/misc/Two_cultures.pdf}{\url{www.mathcenter.spb.ru/nikaan/misc/Two_cultures.pdf}}. "---
\emph{Прим. ред.}}), ужаснулись бы идее изучать математику по
книжке головоломок.
Ваш автор и не возражает.

Но всё же меня не оставляет чувство, что способность понять и оценить
головоломки, даже с решениями? идеи которых нигде больше не
встречаются, очень полезна.
Я не пытался описать философию решения
задач, как это сделал Пойа и другие, я дал задачам говорить самим за
себя.
А задачи действительно говорят, и они говорят \mbox{правду}.

\begin{flushright}
\emph{Питер Уинклер}
\\
9 июля 2003
\end{flushright}

{
\small

\printindex

}




\tableofcontents

\thispagestyle{empty}


\end{document}
